<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ELK+KAFKAè¯¦è§£(äºŒ)</title>
    <url>/2018/08/25/ELK+KAFKA%E8%AF%A6%E8%A7%A3(%E4%BA%8C)/</url>
    <content><![CDATA[<p><img src="https://res.cloudinary.com/leon824/image/upload/v1535599872/pic5_pn74x6.jpg" width="80%" height="80%"></p>
<blockquote>
<p> ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å·²ç»å°†filebeatã€kafkaã€zookeeperã€logstashå®‰è£…é…ç½®å®Œæ¯•äº†ã€‚æ¥ä¸‹æ¥ä¸»è¦æ˜¯ç´¢å¼•æ•°æ®ã€å±•ç¤ºæ•°æ®é˜¶æ®µã€‚</p>
</blockquote>
<hr>
<h2 id="å®‰è£…Elasticsearch"><a href="#å®‰è£…Elasticsearch" class="headerlink" title="å®‰è£…Elasticsearch"></a>å®‰è£…Elasticsearch</h2><p>é¦–å…ˆåˆ°å®˜ç½‘ä¸‹è½½5.3.3ç‰ˆæœ¬çš„å®‰è£…åŒ…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> axel -n 5 https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.3.3.tar.gz</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨ESçš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªç›®å½•dataã€logsï¼Œç”¨æ¥ä¿å­˜ç´¢å¼•æ•°æ®ã€æ—¥å¿—ç­‰ç­‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> mkdir logs</span><br><span class="line"><span class="meta">&gt;</span> mkdir data</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥<code>config</code>ç›®å½•ç¼–è¾‘<code>elasticsearch.yml</code>æ–‡ä»¶ï¼Œè¿™ç§ä»¥.ymlç±»å‹ç»“å°¾çš„æ–‡ä»¶è¦æ³¨æ„ç¼©è¿›ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></span><br><span class="line"><span class="string">path.data:</span> <span class="string">/opt/soft/elasticsearch-5.5.3/data</span></span><br><span class="line"><span class="comment"># Path to log files:</span></span><br><span class="line"><span class="string">path.logs:</span> <span class="string">/opt/soft/elasticsearch-5.5.3/logs</span></span><br><span class="line"><span class="comment"># ç»‘å®šä¸€ä¸ªæŒ‡å®šçš„ip</span></span><br><span class="line"><span class="comment"># network.host: 0.0.0.0</span></span><br><span class="line"><span class="string">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="comment"># åè¾¹ä½¿ç”¨æ’ä»¶çš„æ—¶å€™éœ€è¦ä½¿ç”¨åˆ°ä¸‹è¾¹ä¸¤ä¸ªé…ç½®ã€‚</span></span><br><span class="line"><span class="string">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹æ˜¯ä¸€äº›ä¸»è¦çš„é…ç½®ï¼Œç„¶åå¯ä»¥ç›´æ¥å¯åŠ¨ESäº†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> ./bin/elasticsearch &amp;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹æˆ‘ä»¬æ˜¯å·²ç»å¯åŠ¨äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜ä¸çŸ¥é“æ•°æ®æ˜¯å¦é€šè¿‡<code>logstash</code>å†™å…¥åˆ°ESä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸¤ä¸ªæ­¥éª¤æ¥ç¡®ä¿æˆ‘ä»¬å®‰è£…é…ç½®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼ˆESä¸­çš„ç´¢å¼•ç±»ä¼¼äºæ•°æ®åº“ä¸­çš„ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ï¼‰ ã€‚</li>
<li>å®‰è£…<code>head</code>æ’ä»¶ï¼ŒæŸ¥çœ‹ESæƒ…å†µ</li>
</ul>
<h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><p>åœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ESä¸­çš„ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p>
<ul>
<li>indexï¼šESç®¡ç†æ•°æ®çš„æœ€é¡¶å±‚å•ä½ï¼Œç±»ä¼¼äºå•ä¸ªæ•°æ®åº“çš„æ¦‚å¿µã€‚</li>
<li>document ï¼šESçš„indexä¸­å•æ¡æ•°æ®è¢«ç§°ä¸ºdocument</li>
<li>typeï¼šdocumentå¯ä»¥åˆ†ç»„ï¼Œåˆ†ç»„å°±å«type</li>
</ul>
<p>é€šè¿‡æŒ‡å®šä¸€ä¸ªæ–‡ä»¶çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span>  curl -XPUT 'http://localhost:9200/nginx_log_index/test_log/1?pretty' -H 'Content-Type: application/json' -d '/opt/soft/logstash-5.5.3/output/es_template.json'</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤ç´¢å¼•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span>  curl -X DELETE 'localhost:9200/nginx_log_index'</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…headæ’ä»¶"><a href="#å®‰è£…headæ’ä»¶" class="headerlink" title="å®‰è£…headæ’ä»¶"></a>å®‰è£…headæ’ä»¶</h3><p>headæ’ä»¶è¿è¡Œéœ€è¦nodeç¯å¢ƒï¼Œè¿™é‡Œå°±ä¸è®¨è®ºå¦‚ä½•å®‰è£…nodeäº†ï¼Œç½‘ä¸Šèµ„æ–™æ¯”è¾ƒå¤šã€‚</p>
<p>ä½¿ç”¨gitä¸‹è½½headæºç ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> git clone git://github.com/mobz/elasticsearch-head.git</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿›å…¥headçš„ç›®å½•æ‰§è¡ŒæŒ‡ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> npm install</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; npm run start</span><br></pre></td></tr></table></figure>
<p>è‹¥æ˜¯ESä½¿ç”¨çš„éƒ½æ˜¯é»˜è®¤ç«¯å£ï¼Œé‚£ä¹ˆ<code>head</code>æ’ä»¶å°±ä¸éœ€è¦ä¿®æ”¹é…ç½®ã€‚</p>
<p>åœ¨æµè§ˆå™¨ä¸­è®¿é—®<code>http://ip:9100/</code>å°±å¯ä»¥çœ‹åˆ°ESçš„æƒ…å†µ</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1535186203/head_yvixk7.png" width="80%" height="80%"></p>
<h3 id="ESè¡¥å……"><a href="#ESè¡¥å……" class="headerlink" title="ESè¡¥å……"></a>ESè¡¥å……</h3><p>Elasticsearchæ˜¯ä¸€ä¸ªæœç´¢å¼•æ“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæä¾›çš„æŸ¥è¯¢è¯­å¥å®ç°ç±»ä¼¼sqlçš„æŸ¥è¯¢åŠŸèƒ½ï¼Œä¸ºæˆ‘ä»¬å±•ç¤ºæ•°æ®æä¾›ä¾¿åˆ©ï¼Œä¸‹é¢åˆ—ä¸¾ä¸€ä¸ªå¸¸ç”¨çš„æŸ¥è¯¢ã€‚</p>
<p>1ã€æŒ‡å®šä¸€ä¸ªindexï¼Œæœç´¢å…¶ä¸‹æ‰€æœ‰typeçš„æ•°æ®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> curl -X GET 'http://localhost:9200/nginx-log/_search?pretty' -H 'Content-Type: application/json' -d '  </span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123;</span><br><span class="line">    "match_all": &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹çš„nginx-logå°±æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„index</p>
<p>2ã€æŸ¥çœ‹æ¯ä¸ªindexæ‰€åŒ…å«çš„type</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> curl 'localhost:9200/_mapping?pretty=true'</span><br></pre></td></tr></table></figure>
<p>3ã€æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰Index</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> curl -X GET 'http://localhost:9200/_cat/indices?v'</span><br></pre></td></tr></table></figure>
<p>4ã€æ ¹æ®æŸä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„åç»Ÿè®¡ï¼Œå®ç°ç±»ä¼¼äº<code>sql</code>é‡Œè¾¹çš„åŠŸèƒ½</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> table_name <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">field</span>;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„ESæŸ¥è¯¢è¯­å¥åŠŸèƒ½å’Œä¸Šè¾¹çš„sqlæ˜¯ç±»ä¼¼çš„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> curl -X POST 'http://localhost:9200/nginx-log/nginxlog/_search?pretty' -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;	</span><br><span class="line">	"size": 0,</span><br><span class="line">	"aggs": &#123;</span><br><span class="line">	"group_by_service_name": &#123;</span><br><span class="line">		"terms": &#123; </span><br><span class="line">		"field": "service_name.keyword"</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="å®‰è£…kibana"><a href="#å®‰è£…kibana" class="headerlink" title="å®‰è£…kibana"></a>å®‰è£…kibana</h2><p>ä¸‹è½½ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> axel -n 5 https://artifacts.elastic.co/downloads/kibana/kibana-5.5.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>
<p>kibanaçš„å®‰è£…é…ç½®è¾ƒä¸ºç®€å•ï¼Œåªéœ€è¦åœ¨configç›®å½•ä¸­çš„kibana.ymlæ–‡ä»¶é…ç½®ä¸¤ä¸ªå­—æ®µ</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Kibana is served by a back end server. This setting specifies the port to use.</span></span><br><span class="line"><span class="string">server.port:</span> <span class="number">5601</span></span><br><span class="line"><span class="comment"># The URL of the Elasticsearch instance to use for all your queries.</span></span><br><span class="line"><span class="string">elasticsearch.url:</span> <span class="string">"http://localhost:9200"</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åå¯åŠ¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> ./bin/kibana &amp;</span><br></pre></td></tr></table></figure>
<p>åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨kibanaçš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ä¸€ä¸ªindexï¼Œç„¶åkibanaä¼šé€šè¿‡è¿™ä¸ªindexå»ESä¸­æŸ¥è¯¢å¹¶å±•ç¤ºã€‚</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1535187828/kiaban_bozs2a.png" width="80%" height="80%"></p>
<p>æˆ‘ä»¬å°†åˆšæ‰åˆ›å»ºçš„indexåŠ å…¥åˆ°é‡Œè¾¹ï¼Œç„¶åç‚¹å‡»<code>Discover</code>é€‰æ‹©åˆšæ‰é…ç½®çš„indexï¼Œåœ¨é€‰æ‹©æ—¶é—´ï¼Œå°±èƒ½å¤Ÿçœ‹åˆ°æ•°æ®å·²ç»è¢«å±•ç¤ºå‡ºæ¥äº†ã€‚</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1535203571/discoey_g4ltbs.png" width="80%" height="80%"></p>
<p>ä¸Šå›¾ä¸­çš„å·¦ä¾§å¯ä»¥é€‰æ‹©åœ¨å³ä¾§å±•ç¤ºå“ªäº›å­—æ®µã€‚</p>
<h3 id="ä½¿ç”¨kibanaç»˜å›¾"><a href="#ä½¿ç”¨kibanaç»˜å›¾" class="headerlink" title="ä½¿ç”¨kibanaç»˜å›¾"></a>ä½¿ç”¨kibanaç»˜å›¾</h3><p>&emsp;&emsp;åœ¨kibanaä¸­ä¹Ÿæ˜¯å¯ä»¥å®Œæˆä¸€äº›ç»˜å›¾çš„ï¼Œä½†æ˜¯ç”±äºkibanaæ²¡æœ‰ç›¸åº”æƒé™æ§åˆ¶ï¼Œå¹¶ä¸”kibanaçš„é¢œå€¼æ˜¯æ²¡æœ‰Grafanaé«˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯ç”¨Grafanaæ¥å±•ç¤ºå›¾è¡¨ï¼ŒkibanaæŸ¥è¯¢æ—¥å¿—ã€‚ä¸‹é¢å°±æ¥æ¢è®¨ä¸€ä¸‹Grafanaç›¸å…³å†…å®¹</p>
<hr>
<h2 id="Grafanaç›¸å…³"><a href="#Grafanaç›¸å…³" class="headerlink" title="Grafanaç›¸å…³"></a>Grafanaç›¸å…³</h2><p>æˆ‘ä»¬å…ˆè¿›å…¥Grafanaçš„<a href="https://grafana.com/grafana/download" target="_blank" rel="noopener">å®˜ç½‘</a>ï¼Œé‡Œè¾¹æœ‰ä»‹ç»å¦‚ä½•å®‰è£…ï¼Œä¹Ÿå¾ˆç®€å•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> wget https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana_5.2.2_amd64.deb </span><br><span class="line"><span class="meta">&gt;</span> sudo dpkg -i grafana_5.2.2_amd64.deb</span><br></pre></td></tr></table></figure>
<p>ç„¶åå¯åŠ¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> sudo /bin/systemctl start grafana-server</span><br></pre></td></tr></table></figure>
<p>è®¿é—®<code>http://localhost:3000</code>ç„¶åä½¿ç”¨adminç™»å½•è¿›å»ï¼Œå¯†ç é»˜è®¤ä¹Ÿæ˜¯adminã€‚è¿›å»åéœ€è¦å…ˆé…ç½®æ•°æ®æºã€‚</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1535204856/gra_ihk0b2.png" width="70%" height="70%"></p>
<p>  ä¸Šè¾¹æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>typeï¼šç”±äºæˆ‘ä»¬æ˜¯ä½¿ç”¨ESä½œä¸ºæ•°æ®æºï¼Œæ‰€ä»¥è¿™é‡Œä¸€å®šè¦é€‰æ‹©<code>elasticsearch</code></li>
<li>url : è¿æ¥elasticsearchæœåŠ¡çš„åœ°å€</li>
<li>Accessï¼šéœ€è¦é€‰æ‹©å…·ä½“æŸç§è¿æ¥æ–¹å¼ï¼Œä¸¤ç§æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œå…·ä½“ä¸åŒè¿™é‡Œä¸è¯¦ç»†æè¿°</li>
<li>Authï¼šESè‹¥æ˜¯å®‰è£…äº†ç›¸åº”å¯†ç æƒé™ï¼Œè¿™é‡Œéœ€è¦æ­£ç¡®é…ç½®ä¹‹åæ‰èƒ½è®¿é—®ã€‚</li>
<li>Index name ï¼š è¿™é‡Œæ˜¯å¡«åœ¨ESä¸­åˆ›å»ºçš„indexï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œè‹¥æ˜¯index nameåŒ…å«äº†æ—¥å¿—ï¼Œé‚£ä¹ˆåè¾¹çš„patternå°±ä¸è¦é€‰æ‹©ä»»ä½•æ—¥æœŸäº†ã€‚</li>
<li>Version ï¼š éœ€è¦é€‰æ‹©å’Œå®‰è£…çš„ESåŒ¹é…çš„ç‰ˆæœ¬</li>
</ul>
<p>ç„¶åä¿å­˜ï¼Œç„¶åå°±å¯ä»¥åˆ›å»ºDashBoardã€panelã€‚grafanaç»˜å›¾ã€æŸ¥è¯¢ç›¸å…³å†…å®¹è¾ƒå¤šï¼Œåè¾¹è‹¥æœ‰æ—¶é—´è¿˜ä¼šæ¢è®¨ä¸€ä¸‹grafanaç»˜å›¾ç›¸å…³ã€‚</p>
<hr>
<h3 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h3><ul>
<li><a href="https://www.cnblogs.com/hupengcool/p/4031543.html" target="_blank" rel="noopener">elasticsearch åˆ›å»ºç´¢å¼•ï¼Œä»¥åŠæ£€ç´¢ä¸€æ¡æ•°æ®</a></li>
<li><a href="https://grafana.com/grafana/download" target="_blank" rel="noopener">grafanaå®˜ç½‘</a></li>
<li><a href="https://groups.io/g/grafana/topic/tutorial_for_elasticsearch/716433?p=,,,20,0,0,0" target="_blank" rel="noopener">groups.io</a></li>
</ul>
]]></content>
      <categories>
        <category>ELK</category>
      </categories>
  </entry>
  <entry>
    <title>ELK+KAFKAè¯¦è§£ï¼ˆä¸€ï¼‰</title>
    <url>/2018/08/22/ELK+KAFKA%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<p>  <img src="https://res.cloudinary.com/leon824/image/upload/v1535599870/pic4_vjsn1u.jpg" width="80%" height="80%"></p>
<blockquote>
<p>&emsp;&emsp;æ—¥å¿—ï¼Œå¯¹äºä»»ä½•ç³»ç»Ÿæ¥è¯´éƒ½æ˜¯åŠå…¶é‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚åœ¨è®¡ç®—æœºç³»ç»Ÿé‡Œé¢ï¼Œæ›´æ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯ç”±äºç°åœ¨çš„è®¡ç®—æœºç³»ç»Ÿå¤§å¤šæ¯”è¾ƒå¤æ‚ï¼Œå¾ˆå¤šç³»ç»Ÿéƒ½ä¸æ˜¯åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç”šè‡³éƒ½æ˜¯è·¨å›½ç•Œçš„ï¼›å³ä½¿æ˜¯åœ¨ä¸€ä¸ªåœ°æ–¹çš„ç³»ç»Ÿï¼Œä¹Ÿæœ‰ä¸åŒçš„æ¥æºï¼Œæ¯”å¦‚ï¼Œæ“ä½œç³»ç»Ÿï¼Œåº”ç”¨æœåŠ¡ï¼Œä¸šåŠ¡é€»è¾‘ç­‰ç­‰ã€‚ä»–ä»¬éƒ½åœ¨ä¸åœäº§ç”Ÿå„ç§å„æ ·çš„æ—¥å¿—æ•°æ®ã€‚<br> &emsp;&emsp;æ ¹æ®ä¸å®Œå…¨ç»Ÿè®¡ï¼Œæˆ‘ä»¬å…¨çƒæ¯å¤©å¤§çº¦è¦äº§ç”Ÿ 2EBï¼ˆ1018ï¼‰çš„æ•°æ®ã€‚é¢å¯¹å¦‚æ­¤æµ·é‡çš„æ•°æ®ï¼Œåˆæ˜¯åˆ†å¸ƒåœ¨å„ä¸ªä¸åŒåœ°æ–¹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å»æŸ¥æ‰¾ä¸€äº›é‡è¦çš„ä¿¡æ¯ï¼Œéš¾é“è¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹æ³•ï¼Œå»ç™»é™†åˆ°ä¸€å°å°æœºå™¨ä¸ŠæŸ¥çœ‹ï¼Ÿçœ‹æ¥ä¼ ç»Ÿçš„å·¥å…·å’Œæ–¹æ³•å·²ç»æ˜¾å¾—éå¸¸ç¬¨æ‹™å’Œä½æ•ˆäº†ã€‚äºæ˜¯ï¼Œä¸€äº›èªæ˜äººå°±æå‡ºäº†å»ºç«‹ä¸€å¥—é›†ä¸­å¼çš„æ–¹æ³•ï¼ŒæŠŠä¸åŒæ¥æºçš„æ•°æ®é›†ä¸­æ•´åˆåˆ°ä¸€ä¸ªåœ°æ–¹ã€‚</p>
</blockquote>
<p>ä¸€ä¸ªå®Œæ•´çš„é›†ä¸­å¼æ—¥å¿—ç³»ç»Ÿï¼Œæ˜¯ç¦»ä¸å¼€ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç‰¹ç‚¹çš„ã€‚</p>
<ul>
<li>æ”¶é›†ï¼èƒ½å¤Ÿé‡‡é›†å¤šç§æ¥æºçš„æ—¥å¿—æ•°æ®</li>
<li>ä¼ è¾“ï¼èƒ½å¤Ÿç¨³å®šçš„æŠŠæ—¥å¿—æ•°æ®ä¼ è¾“åˆ°ä¸­å¤®ç³»ç»Ÿ</li>
<li>å­˜å‚¨ï¼å¦‚ä½•å­˜å‚¨æ—¥å¿—æ•°æ®</li>
<li>åˆ†æï¼å¯ä»¥æ”¯æŒ UI åˆ†æ</li>
<li>è­¦å‘Šï¼èƒ½å¤Ÿæä¾›é”™è¯¯æŠ¥å‘Šï¼Œç›‘æ§æœºåˆ¶</li>
</ul>
<p>æœ¬æ–‡é‡‡ç”¨ELK + FILEBEAT + KAFKAçš„æ¶æ„æ­å»ºæ—¥å¿—æ”¶é›†ç³»ç»Ÿã€‚æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<p>  <img src="https://res.cloudinary.com/leon824/image/upload/v1535176986/geranal_eugyfc.png" width="80%" height="80%"></p>
<hr>
<h3 id="ç¯å¢ƒã€ç‰ˆæœ¬"><a href="#ç¯å¢ƒã€ç‰ˆæœ¬" class="headerlink" title="ç¯å¢ƒã€ç‰ˆæœ¬"></a>ç¯å¢ƒã€ç‰ˆæœ¬</h3><ul>
<li>JDK 1.8</li>
<li>OS : ubuntu18.04</li>
<li>filebeatã€logstashã€elasticsearchã€kibanaï¼ˆ5.5.3ï¼‰</li>
<li>kafka_2.11-0.10.0.1</li>
<li>Grafana ï¼šLatest version</li>
</ul>
<h3 id="filebeatå®‰è£…"><a href="#filebeatå®‰è£…" class="headerlink" title="filebeatå®‰è£…"></a>filebeatå®‰è£…</h3><blockquote>
<p>  &emsp;&emsp;ä¸€ä¸ªè½»é‡çº§å¼€æºæ—¥å¿—æ–‡ä»¶æ•°æ®æœé›†å™¨ï¼ŒåŸºäºLogstash-Forwarder æºä»£ç å¼€å‘ï¼Œæ˜¯å¯¹å®ƒçš„æ›¿ä»£ã€‚åœ¨éœ€è¦é‡‡é›†æ—¥å¿—æ•°æ®çš„ server ä¸Šå®‰è£… Filebeatï¼Œå¹¶æŒ‡å®šæ—¥å¿—ç›®å½•æˆ–æ—¥å¿—æ–‡ä»¶åï¼ŒFilebeat å°±èƒ½è¯»å–æ•°æ®ï¼Œè¿…é€Ÿå‘é€åˆ°æŒ‡å®šçš„MQä¸­ï¼Œäº¦æˆ–ç›´æ¥å‘é€åˆ°logstashè¿›è¡Œè¿‡æ»¤è½¬å‘ã€‚<br>ç°ä¸‹è½½åˆ°æœ¬åœ°</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> axel -n 5 https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.3.3-linux-x86_64.tar.gz</span><br><span class="line"><span class="meta">&gt;</span> tar -zxvf  filebeat-5.5.3-linux-x86_64.tar.gz</span><br><span class="line"><span class="meta">&gt;</span> mv filebeat-5.5.3-linux-x86_64 filebeat-5.5.3</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿›å…¥ç›®å½•ä¸­å¤åˆ¶ä¸€ä»½cp filebeat.yml filebeat-kafka.ymlï¼Œä¿®æ”¹æ–‡ä»¶ä¸­ç›¸åº”çš„åœ°æ–¹ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŒ‡å®šè¾“å…¥ç±»å‹</span></span><br><span class="line"><span class="attr">- input_type:</span> <span class="string">log</span> </span><br><span class="line"><span class="comment"># éœ€è¦ç›‘æ§çš„æ–‡ä»¶ç›®å½•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦å¯¹æ•´ä¸ªç›®å½•ç›‘æ§</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">/opt/soft/logs/platform.pro.access.log</span></span><br><span class="line"><span class="comment">#å®šä¹‰kafkaä¸ºè¾“å‡ºç›®çš„åœ°</span></span><br><span class="line"><span class="string">output.kafka:</span></span><br><span class="line">  <span class="comment"># Array of hosts to connect to.</span></span><br><span class="line"><span class="attr">  hosts:</span> <span class="string">["ip:9092"]</span></span><br><span class="line">  <span class="comment">#kafkaçš„ä¸»é¢˜</span></span><br><span class="line"><span class="attr">  topic:</span> <span class="string">nginx_log</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">  processors:</span></span><br><span class="line"><span class="attr"> - drop_fields:</span></span><br><span class="line"><span class="attr">     fields:</span> <span class="string">["beat",</span> <span class="string">"input_type"</span><span class="string">,</span> <span class="string">"offset"</span><span class="string">,</span> <span class="string">"source"</span><span class="string">]</span></span><br></pre></td></tr></table></figure>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ä¸Šè¾¹<code>drop_fields</code>ï¼Œå¯ä»¥åœ¨ä¸Šè¾¹é…ç½®ä½ ä¸å¸Œæœ›filebeatè¾“å…¥çš„å­—æ®µï¼ˆå¯ä»¥æ’é™¤ä¸€äº›æ— ç”¨çš„ä¿¡æ¯ï¼Œå‡å°‘å­˜å‚¨ï¼‰ï¼Œå¯ä»¥æ·»åŠ <code>condition</code>æ¡ä»¶ï¼Œè‹¥æ˜¯ä¸æ·»åŠ æ¡ä»¶ï¼Œé»˜è®¤å°†æ‰€æœ‰å£°æ˜çš„å­—æ®µå…¨éƒ¨æ’é™¤ï¼Œä¸ä¼šå°†å­—æ®µåŠ å…¥åˆ°è¾“å‡ºæµä¸­ã€‚åŒæ—¶è¿˜è¦æ³¨æ„ä¸€å®šè¦å°†outputè¾“å‡ºç›®çš„ä»é»˜è®¤çš„<strong>ElasticSearch</strong>ä¿®æ”¹æˆ<strong>kafka</strong>ã€‚ ä»¥ä¸Šé…ç½®å°±ç®—å®‰è£…å®Œæˆäº†ã€‚<br>æ¥ç€å¯åŠ¨.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> ./filebeat -e -c filebeat-kafka.yml</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="kafkaå®‰è£…é…ç½®"><a href="#kafkaå®‰è£…é…ç½®" class="headerlink" title="kafkaå®‰è£…é…ç½®"></a>kafkaå®‰è£…é…ç½®</h3><p>  kafkaçš„è¿è¡Œä¾èµ–zookeeperï¼Œæ‰€ä»¥å®‰è£…kafkaä¹‹å‰éœ€è¦å…ˆå®‰è£…zookeeperï¼Œè¿™é‡Œä¸ç”¨kafkaè‡ªèº«å¸¦æœ‰çš„zookeeperã€‚</p>
<h4 id="zookeeperé…ç½®"><a href="#zookeeperé…ç½®" class="headerlink" title="zookeeperé…ç½®"></a>zookeeperé…ç½®</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> axel -n 5 https://archive.apache.org/dist/zookeeper/zookeeper-3.4.6/zookeeper-3.4.6.tar.gz</span><br><span class="line"><span class="meta">&gt;</span> tar -zxvf zookeeper-3.4.6.tar.gz</span><br></pre></td></tr></table></figure>
<p>  ç„¶åè¿›å…¥zookeeperç›®å½•åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> mkdir logs</span><br><span class="line"><span class="meta">&gt;</span> mkdir data</span><br></pre></td></tr></table></figure>
<p>åœ¨/root/elk/zookeeper-3.4.6/confç›®å½•ä¸‹å¤åˆ¶zoo_sample.cfgå‘½åä¸ºzoo.cfg</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> cp zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure>
<p>  æ‰“å¼€zoo.cfgï¼Œä¿®æ”¹éœ€è¦é…ç½®çš„åœ°æ–¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/opt/soft/zookeeper-3.4.6/data</span><br><span class="line">dataLogDir=/opt/soft/zookeeper-3.4.6/logs</span><br><span class="line">clientPort=2181</span><br></pre></td></tr></table></figure>
<p>åœ¨/root/elk/zookeeper-3.4.6/dataç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidæ–‡ä»¶ã€‚ç”±äºæˆ‘ä»¬è¿™é‡Œåªæ˜¯å•ç‚¹ç¯å¢ƒä¸‹ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨æ–‡ä»¶é‡Œè¾¹å†™å…¥server.1ã€‚</p>
<p> æœ€åå°†zkçš„è·¯å¾„æ·»åŠ åˆ°ç›¸å…³çš„ç¯å¢ƒå˜é‡ä¸­ï¼Œå¹¶æ·»åŠ PATH,ç„¶åå¯åŠ¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> zkServer.sh start</span><br></pre></td></tr></table></figure>
<p>æœ€åæŸ¥çœ‹zkæ˜¯å¦å¯åŠ¨æˆåŠŸ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> zkServer.sh status</span><br></pre></td></tr></table></figure>
<h4 id="kafkaé…ç½®"><a href="#kafkaé…ç½®" class="headerlink" title="kafkaé…ç½®"></a>kafkaé…ç½®</h4><p>å®‰è£…kafkaçš„æ—¶å€™éœ€è¦æ³¨æ„å’Œlogstashä¹‹é—´ç‰ˆæœ¬åŒ¹é…çš„é—®é¢˜ï¼Œlogstash5.xä»¥ä¸Šå¿…é¡»ä½¿ç”¨kakfa 0.10ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸è¿è¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> axel -n 5 https://archive.apache.org/dist/kafka/0.10.0.1/kafka_2.11-0.10.0.1.tgz</span><br></pre></td></tr></table></figure>
<p>ä¸‹è½½å®Œæˆä¹‹åè§£å‹ã€è¿›å…¥kafkaæ ¹ç›®å½•åˆ›å»ºlogsç›®å½•,ç„¶åæ‰“å¼€configç›®å½•ä¸‹çš„server.propertiesä¿®æ”¹ä¸€äº›å‚æ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">log.dirs=/opt/soft/kafka_2.11-0.10.0.1/logs</span><br><span class="line">zookeeper.connect=ip:2181</span><br><span class="line">å…¶ä»–é¡¹æ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹....</span><br></pre></td></tr></table></figure>
<p>ç„¶åå¯ä»¥å¯åŠ¨kafka</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> bin/kafka-server-start.sh config/server.properties &amp;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªåå«nginx_logçš„kafkaä¸»é¢˜</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic nginx_log</span><br></pre></td></tr></table></figure>
<p>ç„¶åè‡ªå·±å¯ä»¥å°è¯•æ‰“å¼€ä¸€ä¸ªç»ˆç«¯è¿›å…¥ç”Ÿäº§è€…æ¨¡å¼ï¼Œå‘é€å‡ æ¡æ•°æ®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> bin/kafka-console-producer.sh --broker-list localhost:9092 --topic nginx_log</span><br></pre></td></tr></table></figure>
<p>åœ¨å¦å¤–ä¸€ä¸ªç»ˆç«¯ä¸­å¼€å¯æ¶ˆè´¹è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹ç”Ÿäº§è€…å‘é€çš„æ•°æ®æ˜¯å¦èƒ½å¤Ÿçœ‹åˆ°ï¼Œè‹¥èƒ½æ­£å¸¸çœ‹åˆ°å‘é€çš„æ•°æ®ï¼Œè¯´æ˜kafkaå®‰è£…æ²¡æœ‰é—®é¢˜ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic nginx_log --from-beginning</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="logstashå®‰è£…é…ç½®"><a href="#logstashå®‰è£…é…ç½®" class="headerlink" title="logstashå®‰è£…é…ç½®"></a>logstashå®‰è£…é…ç½®</h3><p> &emsp;&emsp;&ensp;è®°ä½æ–‡ç« å¼€å§‹çš„é‚£å¼ æ•´ä½“æ¶æ„å›¾ï¼Œkafkaæ˜¯ä»filebeatæ¥æ”¶æ•°æ®ï¼Œç„¶åå‘é€ç»™logstashã€‚æ‰€ä»¥è¿™é‡Œlogstashçš„inputå°±æ˜¯kafkaäº†ã€‚<br> logstashæ˜¯æ•´ä¸ªæµç¨‹ä¸­é…ç½®ã€ä¿®æ”¹æœ€å¤šçš„ä¸€ç¯ï¼Œè¿‡ç¨‹ä¸­ä¹Ÿæœ‰ä¸€äº›å‘ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> axel -n 5 https://artifacts.elastic.co/downloads/logstash/logstash-5.3.3.tar.gz</span><br></pre></td></tr></table></figure>
<p>è€è§„çŸ©ï¼Œå…ˆè§£å‹ï¼Œè¿›å…¥configç›®å½•åˆ›å»ºä¸€ä¸ªlogstash.confçš„æ–‡ä»¶ï¼Œç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶é‡Œè¾¹æ·»åŠ inputã€filterã€outputä¸‰ä¸ªæ¨¡å—ã€‚</p>
<h4 id="inputæ¨¡å—"><a href="#inputæ¨¡å—" class="headerlink" title="inputæ¨¡å—"></a>inputæ¨¡å—</h4><p>å…ˆæ¥è®²è®²inputæ¨¡å—ï¼Œç”±äºåœ¨logstash5.xä¸­å·²ç»é»˜è®¤æ”¯æŒkafkaä½œä¸ºinput,æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">    kafka&#123;</span><br><span class="line">       topics =&gt; ["nginx_log"]</span><br><span class="line">       type =&gt; "nginx-access"</span><br><span class="line">       bootstrap_servers =&gt; "ip:9092"</span><br><span class="line">       codec =&gt; "json"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>topics :æŒ‡å®šæ¶ˆè´¹kafkaçš„topic</li>
<li>type ï¼š è‹¥æ˜¯logstashéœ€è¦å¤„ç†å¤šä¸ªæ•°æ®æºï¼Œå¯ä»¥ä½¿ç”¨typeæ¥åšåè¾¹è¿‡æ»¤çš„åŒºåˆ†ã€‚</li>
<li>bootstrap_servers ï¼škakfaæœåŠ¡çš„ipå’Œç«¯å£å·</li>
</ul>
<h4 id="filteræ¨¡å—"><a href="#filteræ¨¡å—" class="headerlink" title="filteræ¨¡å—"></a>filteræ¨¡å—</h4><p>&emsp;&emsp;&ensp; filteræ¨¡å—æ˜¯å…·ä½“å¤„ç†æ•°æ®çš„ä¸€ä¸ªç¯èŠ‚ï¼Œå½“kafkaçš„æ•°æ®è¢«inputæ¨¡å—æ¥æ”¶è¿‡æ¥ä¹‹åï¼Œæ¥ä¸‹æ¥å°±ä¼šäº¤ç»™filteræ¨¡å—å¤„ç†ã€‚è¿™é‡Œæˆ‘ä»¬æ˜¯ä¸ºäº†å¤„ç†nginxçš„accessæ—¥å¿—ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦æ ¹æ®nginxçš„log_formatæ¥å®šåˆ¶è‡ªå·±çš„grokæ­£åˆ™è¡¨è¾¾å¼ã€‚<br>ç”Ÿäº§ç¯å¢ƒçš„log_formatæ˜¯ä¸‹é¢è¿™æ ·ğŸ‘‡</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">log_format</span><br><span class="line">        '$remote_addr [$time_local] $host "$request" '</span><br><span class="line">        '$status $body_bytes_sent "$http_referer" '</span><br><span class="line">        '"$http_x_forwarded_for" "$http_user_agent" $request_time $upstream_response_time';</span><br></pre></td></tr></table></figure>
<p>å®é™…çš„æ—¥å¿—é•¿æˆè¿™æ · </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">100.116.224.17 [14/Aug/2018:07:45:49 +0800] platform.blingabc.com "POST /homeworkRecord/v1/insert HTTP/1.1" 200 517 "https://i.blingabc.com/home/read-book?stuID=11936" "27.187.252.91" "Mozilla/5.0 (iPhone; CPU iPhone OS 11_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E216 MicroMessenger/6.7.1 NetType/WIFI Language/zh_CN" 0.456 0.456</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;&ensp;å½“æˆ‘ä»¬åœ¨åšnginxæ—¥å¿—è§£æçš„æ—¶å€™ï¼Œå°½é‡å¤ç”¨grokè‡ªèº«å¸¦æœ‰çš„ã€‚å°‘æ•°ä¸èƒ½è§£æçš„æ ¹æ®ç°æœ‰ä¿®æ”¹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ»¡è¶³è§£ænginxæ—¥å¿—ã€‚åœ¨filteræ¨¡å—ä¸­åŠ å…¥ä¸‹é¢çš„é…ç½®</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">grok &#123;</span><br><span class="line">      patterns_dir =&gt; <span class="string">"/opt/soft/logstash-5.5.3/patterns/nginx_pattern"</span> </span><br><span class="line">      match =&gt; &#123;</span><br><span class="line">         <span class="string">"message"</span> =&gt; <span class="string">"%&#123;NGINXACCESS&#125;"</span></span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;&ensp;éœ€è¦æ³¨æ„ä¸Šè¾¹çš„patterns_dirï¼Œè¿™ä¸ªè·¯å¾„ä¸­patternsè¿™ä¸ªç›®å½•å¿…é¡»åˆ›å»ºåœ¨logstashçš„æ ¹ç›®å½•ä¸­ä¸”åªèƒ½å«è¿™ä¸ªåå­—ï¼Œä¹‹åçš„nginx_patternå¯ä»¥éšæ„å–ã€‚<br>nginx_patternæ–‡ä»¶çš„å†…å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">STATUS ([<span class="number">0</span>-<span class="number">9</span>.]&#123;<span class="number">0</span>,<span class="number">3</span>&#125;)</span><br><span class="line">REQUEST_TIME ([<span class="number">0</span>-<span class="number">9</span>.]&#123;<span class="number">0</span>,<span class="number">5</span>&#125;)</span><br><span class="line">FORWORD (?:%&#123;IPV4&#125;[,]?[ ]?)</span><br><span class="line">NGINXACCESS %&#123;IPV4:remote_addr&#125; \[%&#123;HTTPDATE:time_local&#125;\] (%&#123;HOSTNAME:host&#125;) (%&#123;QUOTEDSTRING:request&#125;) %&#123;STATUS:http_status&#125; %&#123;BASE10NUM:body_bytes_sent&#125; \<span class="string">"(?:%&#123;DATA:http_referer&#125;|-)\" \"(%&#123;FORWORD:http_x_forwarded_for&#125;|-)\" \"(%&#123;GREEDYDATA:user_agent&#125;|-)\" (%&#123;REQUEST_TIME:request_time&#125;|-) (%&#123;REQUEST_TIME:upstream_response_time&#125;|-)</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;&ensp;å…¶ä¸­å‰é¢ä¸‰æ¡æ˜¯è‡ªå·±çš„å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåè¾¹NGINXACCESSæ˜¯æ•´ä½“è§£ænginxæ—¥å¿—çš„è¡¨è¾¾å¼ã€‚åœ¨è‡ªå·±å†™è§£ææ—¥å¿—çš„grokè¡¨è¾¾å¼çš„æ—¶å€™åœ¨<a href="https://grokdebug.herokuapp.com/" target="_blank" rel="noopener">Grok Debugger</a>ä¸­æµ‹è¯•ã€‚</p>
<p><strong>æœ€ç»ˆè§£æå‡ºæ¥çš„æ•°æ®å¦‚ä¸‹</strong> <em>ã€éƒ¨åˆ†çœç•¥ã€‘</em></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"remote_addr"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"100.116.224.72"</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"time_local"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"14/Aug/2018:00:20:14 +0800"</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"host"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"platform.blingabc.com"</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"request"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">""</span>OPTIONS /foreign/teacher/v1/login HTTP/<span class="number">1.1</span><span class="string">""</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"http_status"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"200"</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"body_bytes_sent"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"0"</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"http_referer"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"-"</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"http_x_forwarded_for"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"181.143.78.26"</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"user_agent"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36"</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"request_time"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"0.001"</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"upstream_response_time"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"0.001"</span></span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦é€šè¿‡ä¸‹é¢çš„requestè§£æå¾—åˆ°/foreign/teacher/v1/loginå’Œforeignï¼Œç„¶åé€šè¿‡Grafanaç»Ÿè®¡åštop Nå±•ç¤ºï¼Œé‚£ä¹ˆæ•°æ®å°±è¿˜éœ€è¦è¿›ä¸€æ­¥æ‹†åˆ†ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"request": [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">""</span>OPTIONS /foreign/teacher/v1/login HTTP/<span class="number">1.1</span><span class="string">""</span></span><br><span class="line">    ]</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>
<p>filteræ¨¡å—ä¸­æ”¯æŒå¾ˆå¤šæ’ä»¶ç»™æˆ‘ä»¬ä½¿ç”¨ï¼Œä¾‹å¦‚grokã€kvã€rubyã€mutateç­‰ç­‰â€¦ ä¸‹é¢å°±ç”¨rubyå’Œmutateæ¥å®ç°æˆ‘ä»¬æƒ³è¾¾åˆ°çš„ç›®æ ‡ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"> filter &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">          patterns_dir =&gt; <span class="string">"/opt/soft/logstash-5.5.3/patterns/nginx_pattern"</span> </span><br><span class="line">          match =&gt; &#123;</span><br><span class="line">             <span class="string">"message"</span> =&gt; <span class="string">"%&#123;NGINXACCESS&#125;"</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">if</span> [request] &#123;</span><br><span class="line">        ruby &#123;</span><br><span class="line">            init =&gt; <span class="string">"@kname = ['method','uri']"</span></span><br><span class="line">            code =&gt; <span class="string">"</span></span><br><span class="line"><span class="string">                new_event = LogStash::Event.new(Hash[@kname.zip(event.get('request').split(' '))]) </span></span><br><span class="line"><span class="string">                new_event.remove('@timestamp')</span></span><br><span class="line"><span class="string">                event.append(new_event)</span></span><br><span class="line"><span class="string">            "</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> [uri] &#123;</span><br><span class="line">            ruby &#123;</span><br><span class="line">                init =&gt; <span class="string">"@kname = ['url_path','url_args']"</span></span><br><span class="line">                code =&gt; <span class="string">"</span></span><br><span class="line"><span class="string">                    new_event = LogStash::Event.new(Hash[@kname.zip(event.get('uri').split('?'))])</span></span><br><span class="line"><span class="string">                    new_event.remove('@timestamp')</span></span><br><span class="line"><span class="string">                    event.append(new_event)</span></span><br><span class="line"><span class="string">                "</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">if</span> [url_path] &#123;</span><br><span class="line">            ruby &#123;</span><br><span class="line">                init =&gt; <span class="string">"@kname = ['service_name', 'url_path']"</span></span><br><span class="line">                code =&gt; <span class="string">"</span></span><br><span class="line"><span class="string">                    new_event = LogStash::Event.new(Hash[@kname.zip(event.get('uri').split('/'))])</span></span><br><span class="line"><span class="string">                    new_event.remove('@timestamp')</span></span><br><span class="line"><span class="string">                    event.append(new_event)</span></span><br><span class="line"><span class="string">                "</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">    mutate &#123;</span><br><span class="line">            rename =&gt; [<span class="string">"url_path[1]"</span>, <span class="string">"service_name"</span>]</span><br><span class="line">	    rename =&gt; [<span class="string">"url_path[0]"</span>, <span class="string">"uri"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> [service_name] == <span class="string">"monitor"</span> <span class="keyword">or</span> [service_name] == <span class="string">"weixin"</span> <span class="keyword">or</span> [method] == <span class="string">"OPTIONS"</span> &#123;</span><br><span class="line">            drop &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹çš„æ‰§è¡Œæ—¶æµå¼æ‰§è¡Œçš„ï¼Œå°±æ˜¯è¯´ä¸Šè¾¹æ‰§è¡Œå¾—åˆ°çš„ç»“æœä¸‹è¾¹å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ç„¶åå°†æ•°ç»„é‡Œè¾¹çš„ç»“æœé‡ååï¼Œæä¾›ç»™ä¸‹é¢ESä½¿ç”¨ã€‚</p>
<h4 id="output"><a href="#output" class="headerlink" title="output"></a>output</h4><p>æœ€åå°±æ˜¯outputæ¨¡å—äº†ï¼Œè¿™é‡Œæ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯è®²è¿‡æ»¤åçš„æ•°æ®äº¤ç»™ESã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">output &#123;</span><br><span class="line">        elasticsearch&#123;</span><br><span class="line">        hosts =&gt; [<span class="string">"ip:9200"</span>]</span><br><span class="line">        index =&gt; <span class="string">"nginx-log"</span></span><br><span class="line">        template_overwrite =&gt; <span class="literal">true</span></span><br><span class="line">        template =&gt; <span class="string">"/opt/soft/logstash-5.5.3/output/es_template.json"</span></span><br><span class="line">        &#125;</span><br><span class="line">        stdout&#123;codec =&gt; rubydebug&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„ä¸Šè¾¹çš„templateæŒ‡å®šçš„æ–‡ä»¶ï¼Œåœ¨es_template.jsonè¿™ä¸ªæ–‡ä»¶ä¸­å®šä¹‰äº†filteræ¨¡å—è§£æå‡ºæ¥çš„å­—æ®µåç§°ã€ç±»å‹ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"template"</span>:<span class="string">"nginx-log"</span>,</span><br><span class="line">    <span class="attr">"settings"</span>:&#123;</span><br><span class="line">        <span class="attr">"index.refresh_interval"</span>:<span class="string">"5s"</span>,</span><br><span class="line">        <span class="attr">"index.number_of_replicas"</span>:<span class="string">"1"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"analysis"</span>:&#123;</span><br><span class="line">        <span class="attr">"analyzer"</span>:&#123;</span><br><span class="line">            <span class="attr">"default"</span>:&#123;</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"standard"</span>,</span><br><span class="line">                <span class="attr">"stopwords"</span>:<span class="string">"_none_"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"mappings"</span>:&#123;</span><br><span class="line">        <span class="attr">"nginx_log"</span>:&#123;</span><br><span class="line">            <span class="attr">"_all"</span>:&#123;</span><br><span class="line">                <span class="attr">"enabled"</span>:<span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"properties"</span>:&#123;</span><br><span class="line">                <span class="attr">"remote_addr"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"ip"</span>,</span><br><span class="line">		    <span class="attr">"fielddata"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"time_local"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"date"</span>,</span><br><span class="line">                    <span class="attr">"format"</span>:<span class="string">"dd/MMM/yyyy:HH:mm:ss Z"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"host"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">		    <span class="attr">"fielddata"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">		<span class="attr">"uri"</span>:&#123;</span><br><span class="line">		    <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">		    <span class="attr">"fielddata"</span>: <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">                <span class="attr">"request"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"string"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"http_status"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"integer"</span>,</span><br><span class="line">		    <span class="attr">"fielddata"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"body_bytes_sent"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"integer"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"http_referer"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"string"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"http_x_forwarded_for"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"ip"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"user_agent"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"string"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"request_time"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"float"</span>,</span><br><span class="line">		    <span class="attr">"fielddata"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"upstream_response_time"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"float"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"service_name"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">		    <span class="attr">"fielddata"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"request_url"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">		    <span class="attr">"fielddata"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"geoip"</span>:&#123;</span><br><span class="line">                    <span class="attr">"properties"</span>:&#123;</span><br><span class="line">                        <span class="attr">"city_name"</span>:&#123;</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"country_name"</span>:&#123;</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"latitude"</span>:&#123;</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"float"</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"location"</span>:&#123;</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"geo_point"</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"longitude"</span>:&#123;</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"float"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆå½¢æˆçš„é…ç½®æ–‡ä»¶å°±æ˜¯è¿™æ ·çš„</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">    kafka&#123;</span><br><span class="line">       topics =&gt; [<span class="string">"nginx_log"</span>]</span><br><span class="line">       type =&gt; <span class="string">"nginx-access"</span></span><br><span class="line">       bootstrap_servers =&gt; <span class="string">"ip:9092"</span></span><br><span class="line">       codec =&gt; <span class="string">"json"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">          patterns_dir =&gt; <span class="string">"/opt/soft/logstash-5.5.3/patterns/nginx_pattern"</span> </span><br><span class="line">          match =&gt; &#123;</span><br><span class="line">             <span class="string">"message"</span> =&gt; <span class="string">"%&#123;NGINXACCESS&#125;"</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">if</span> [request] &#123;</span><br><span class="line">        ruby &#123;</span><br><span class="line">            init =&gt; <span class="string">"@kname = ['method','uri']"</span></span><br><span class="line">            code =&gt; <span class="string">"</span></span><br><span class="line"><span class="string">                new_event = LogStash::Event.new(Hash[@kname.zip(event.get('request').split(' '))]) </span></span><br><span class="line"><span class="string">                new_event.remove('@timestamp')</span></span><br><span class="line"><span class="string">                event.append(new_event)</span></span><br><span class="line"><span class="string">            "</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> [uri] &#123;</span><br><span class="line">            ruby &#123;</span><br><span class="line">                init =&gt; <span class="string">"@kname = ['url_path','url_args']"</span></span><br><span class="line">                code =&gt; <span class="string">"</span></span><br><span class="line"><span class="string">                    new_event = LogStash::Event.new(Hash[@kname.zip(event.get('uri').split('?'))])</span></span><br><span class="line"><span class="string">                    new_event.remove('@timestamp')</span></span><br><span class="line"><span class="string">                    event.append(new_event)</span></span><br><span class="line"><span class="string">                "</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">if</span> [url_path] &#123;</span><br><span class="line">            ruby &#123;</span><br><span class="line">                init =&gt; <span class="string">"@kname = ['service_name', 'url_path']"</span></span><br><span class="line">                code =&gt; <span class="string">"</span></span><br><span class="line"><span class="string">                    new_event = LogStash::Event.new(Hash[@kname.zip(event.get('uri').split('/'))])</span></span><br><span class="line"><span class="string">                    new_event.remove('@timestamp')</span></span><br><span class="line"><span class="string">                    event.append(new_event)</span></span><br><span class="line"><span class="string">                "</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">    mutate &#123;</span><br><span class="line">            rename =&gt; [<span class="string">"url_path[1]"</span>, <span class="string">"service_name"</span>]</span><br><span class="line">	    rename =&gt; [<span class="string">"url_path[0]"</span>, <span class="string">"uri"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> [service_name] == <span class="string">"monitor"</span> <span class="keyword">or</span> [service_name] == <span class="string">"weixin"</span> <span class="keyword">or</span> [method] == <span class="string">"OPTIONS"</span> &#123;</span><br><span class="line">            drop &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">        elasticsearch&#123;</span><br><span class="line">        hosts =&gt; [<span class="string">"localhost:9200"</span>]</span><br><span class="line">        index =&gt; <span class="string">"nginx-log"</span></span><br><span class="line">        template_overwrite =&gt; <span class="literal">true</span></span><br><span class="line">        template =&gt; <span class="string">"/opt/soft/logstash-5.5.3/output/es_template.json"</span></span><br><span class="line">        &#125;</span><br><span class="line">	stdout&#123;codec =&gt; rubydebug&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹å·²ç»æ•´ä¸ªç¯å¢ƒæ­å»ºå®Œæˆäº†ä¸€å¤§åŠäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®‰è£…Elasticsearchå’Œkibanaã€Grafanaã€‚</p>
<h3 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h3><ul>
<li><a href="https://segmentfault.com/a/1190000011263254" target="_blank" rel="noopener">ELKåˆä½“éªŒ-Nginxæ—¥å¿—å®æ—¶åˆ†æ</a></li>
<li><a href="http://blog.51cto.com/zero01/2079879" target="_blank" rel="noopener">æ­å»ºELKæ—¥å¿—åˆ†æå¹³å°ï¼ˆä¸Šï¼‰</a></li>
<li><a href="https://www.jianshu.com/p/6b7f0488ddff" target="_blank" rel="noopener">elkæ­å»ºå®æˆ˜</a></li>
<li><a href="https://my.oschina.net/itblog/blog/547250" target="_blank" rel="noopener">ELK(ElasticSearch, Logstash, Kibana)æ­å»ºå®æ—¶æ—¥å¿—åˆ†æå¹³å°</a></li>
</ul>
]]></content>
      <categories>
        <category>ELK</category>
      </categories>
  </entry>
  <entry>
    <title>Guava Cacheåˆæ¢</title>
    <url>/2018/06/01/Guava%E5%88%9D%E6%8E%A2/</url>
    <content><![CDATA[<h3 id="ç¼“å­˜çš„ç±»åˆ«ã€åº”ç”¨åœºæ™¯"><a href="#ç¼“å­˜çš„ç±»åˆ«ã€åº”ç”¨åœºæ™¯" class="headerlink" title="ç¼“å­˜çš„ç±»åˆ«ã€åº”ç”¨åœºæ™¯"></a>ç¼“å­˜çš„ç±»åˆ«ã€åº”ç”¨åœºæ™¯</h3><blockquote>
<p>&emsp;&emsp;é«˜é€Ÿç¼“å­˜ç®€ç§°ç¼“å­˜ï¼ŒåŸå§‹æ„ä¹‰æ˜¯æŒ‡è®¿é—®é€Ÿåº¦æ¯”ä¸€èˆ¬éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆRAMï¼‰å¿«çš„ä¸€ç§RAMï¼Œé€šå¸¸å®ƒä¸åƒç³»ç»Ÿä¸»å­˜é‚£æ ·ä½¿ç”¨<code>DRAM</code>æŠ€æœ¯ï¼Œè€Œä½¿ç”¨æ˜‚è´µä½†è¾ƒå¿«é€Ÿçš„<code>SRAM</code>æŠ€æœ¯ã€‚å½“<code>CPU</code>å¤„ç†æ•°æ®æ—¶ï¼Œå®ƒä¼šå…ˆåˆ°<code>Cache</code>ä¸­å»å¯»æ‰¾ï¼Œå¦‚æœæ•°æ®å› ä¹‹å‰çš„æ“ä½œå·²ç»è¯»å–è€Œè¢«æš‚å­˜å…¶ä¸­ï¼Œå°±ä¸éœ€è¦å†ä»éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆMain memoryï¼‰ä¸­è¯»å–æ•°æ®â€”â€”ç”±äº<code>CPU</code>çš„è¿è¡Œé€Ÿåº¦ä¸€èˆ¬æ¯”ä¸»å†…å­˜çš„è¯»å–é€Ÿåº¦å¿«ï¼Œä¸»å­˜å‚¨å™¨å‘¨æœŸï¼ˆè®¿é—®ä¸»å­˜å‚¨å™¨æ‰€éœ€è¦çš„æ—¶é—´ï¼‰ä¸ºæ•°ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚å› æ­¤è‹¥è¦è®¿é—®ä¸»å†…å­˜çš„è¯ï¼Œå°±å¿…é¡»ç­‰å¾…æ•°ä¸ª<code>CPU</code>å‘¨æœŸä»è€Œé€ æˆæµªè´¹ã€‚</p>
</blockquote>
<blockquote>
<p>&emsp;&emsp; ç°åœ¨çš„ç¼“å­˜æ¦‚å¿µä¸ä»…ä»…æ˜¯<code>CPU</code>å’Œä¸»å­˜ä¹‹é—´æœ‰<code>Cache</code>ï¼Œè€Œä¸”åœ¨å†…å­˜å’Œç¡¬ç›˜ä¹‹é—´ä¹Ÿæœ‰ç¼“å­˜ï¼ˆ<strong>ç£ç›˜ç¼“å­˜</strong>ï¼‰ï¼Œä¹ƒè‡³åœ¨ç¡¬ç›˜ä¸ç½‘ç»œä¹‹é—´ä¹Ÿæœ‰æŸç§æ„ä¹‰ä¸Šçš„<code>Cache</code>â”€â”€ç§°ä¸º<code>Internet</code>ä¸´æ—¶æ–‡ä»¶å¤¹æˆ–ç½‘ç»œå†…å®¹ç¼“å­˜ç­‰ã€‚å‡¡æ˜¯ä½äºé€Ÿåº¦ç›¸å·®è¾ƒå¤§çš„ä¸¤ç§ç¡¬ä»¶ä¹‹é—´ï¼Œç”¨äºåè°ƒä¸¤è€…æ•°æ®ä¼ è¾“é€Ÿåº¦å·®å¼‚çš„ç»“æ„ï¼Œå‡å¯ç§°ä¹‹ä¸º<code>Cache</code>ã€‚</p>
</blockquote>
<p>æ‘˜å½•è‡ª<a href="https://zh.wikipedia.org/wiki/%E7%BC%93%E5%AD%98" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p>
<p>&emsp;&emsp;åœ¨è¿™é‡Œæˆ‘ä»¬è®¨è®ºçš„æ˜¯ç£ç›˜ç¼“å­˜ï¼Œå½“æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­é‡åˆ°æŸ¥è¯¢è¿œè¿œæ¯”æ›´æ–°ã€æ’å…¥æ“ä½œæ›´å¤šçš„æ—¶å€™å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¼“å­˜ï¼Œç”¨ç©ºé—´æ¥æ¢å–æ—¶é—´çš„ç­–ç•¥ã€‚</p>
<h4 id="JVMç¼“å­˜"><a href="#JVMç¼“å­˜" class="headerlink" title="JVMç¼“å­˜"></a>JVMç¼“å­˜</h4><p>æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„<code>Map</code>ã€<code>List</code>éƒ½å±äº<code>JVM</code>ç¼“å­˜ï¼Œä½¿ç”¨<code>JVM</code>ç¼“å­˜çš„ä¼˜åŠ¿åœ¨äºç®€å•ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜</p>
<ul>
<li>åªèƒ½æ˜¾å¼çš„å†™å…¥ã€æ¸…ç†æ•°æ®</li>
<li>ä¸èƒ½æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ·˜æ±°æ•°æ®ï¼Œå¦‚ï¼ˆ<code>LRU</code>ï¼‰ã€å…ˆè¿›å…ˆå‡ºç®—æ³•ï¼ˆ<code>FIFO</code>ï¼‰ã€æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼ˆ<code>LFU</code>ï¼‰ã€éæœ€è¿‘ä½¿ç”¨ç®—æ³•ï¼ˆ<code>NMRU</code>ï¼‰</li>
</ul>
<p>è€Œæœ¬æ–‡æåˆ°çš„<code>Guava Cache</code>æœ‰å¦‚ä¸‹çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å½“ç¼“å­˜çš„æ•°æ®å·²ç»è¶…è¿‡é¢„å…ˆè®¾ç½®çš„æœ€å¤§å€¼æ—¶ï¼Œä½¿ç”¨<code>LRU</code>ç®—æ³•ç§»é™¤ä¸€äº›æ•°æ®;<br>ç”±äº<code>GuavaCahce</code>æ˜¯åŸºäº<code>JVM</code>çš„ç¼“å­˜æ–¹å¼ï¼Œæ‰€ä»¥å®ƒç¼“å­˜çš„å¤§å°å¯¹äºæˆ‘ä»¬è‡ªå·±åº”ç”¨çš„æœ¬èº«æœ‰å¾ˆå¤§çš„å½±å“ï¼Œæ‰€ä»¥åœ¨å¿…è¦çš„æ—¶å€™éœ€è¦å¯¹å®ƒè¿›è¡Œéƒ¨åˆ†æ§åˆ¶å’Œæ·˜æ±°ï¼Œåœ¨<code>Guava</code>ä¸­é‡‡ç”¨<code>LRU</code>ç®—æ³•ã€‚</li>
<li><p>å…·å¤‡æ ¹æ®<code>entry</code>èŠ‚ç‚¹ä¸Šæ¬¡è¢«è®¿é—®æˆ–è€…å†™å…¥çš„æ—¶é—´æ¥è®¡ç®—è¿‡æœŸæœºåˆ¶ï¼›<br>ä¾‹å¦‚åœ¨åˆå§‹åŒ–<code>loadingCache</code>å¯¹è±¡çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥æŒ‡å®šå†™å…¥çš„èŠ‚ç‚¹ç»è¿‡å¤šé•¿æ—¶é—´æ²¡æœ‰æ›´æ–°æ“ä½œï¼Œå°±ä¼šè¢«æ·˜æ±°ï¼ˆ<code>expireAfterWrite</code>ï¼‰</p>
</li>
<li><p>ç¼“å­˜çš„keyè¢«å°è£…åœ¨<code>WeakReference</code>å¼•ç”¨å†…;<br>åŒæ ·ä¸ºäº†è®©ç¼“å­˜ä¸ä¼šå½±å“åˆ°è‡ªå·±çš„åº”ç”¨ï¼Œ<code>Guava</code>å¼•å…¥äº†è½¯ã€å¼±å¼•ç”¨ï¼›å½“ç¼“å­˜å¤ªå¤§ï¼Œæˆ–è€…ç¼“å­˜åœ¨GCçš„æ—¶å€™æ— æ³•è¢«å›æ”¶æ‰ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç›´æ¥å°†è¿™éƒ¨åˆ†æ•°æ®å›æ”¶æ‰ã€‚</p>
</li>
<li><p>ç§»é™¤entryèŠ‚ç‚¹ï¼Œå¯ä»¥è§¦å‘ç›‘å¬å™¨é€šçŸ¥äº‹ä»¶ï¼›<br>ä¸€èˆ¬åœ¨<code>Guava Cache</code>ä¸­åˆ é™¤<code>entry</code>å¯¹äºæˆ‘ä»¬æ˜¯é€æ˜çš„ï¼Œä½†æ˜¯<code>Guava</code>ä¸ºæˆ‘ä»¬æä¾›äº†<code>removeLinstener</code>ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨åˆ é™¤<code>entry</code>çš„æ—¶å€™å¯¹æˆ‘ä»¬å¯è§ã€‚</p>
</li>
<li><p>ç»Ÿè®¡ç¼“å­˜ä½¿ç”¨è¿‡ç¨‹ä¸­å‘½ä¸­ç‡/å¼‚å¸¸ç‡/æœªå‘½ä¸­ç‡ç­‰æ•°æ®ã€‚</p>
</li>
</ul>
<p>&emsp;&emsp;&ensp;åŒæ—¶ï¼Œ<em>Guava Cache</em>å’Œ<em>ConcurrentHashMap</em> çš„æ ¸å¿ƒæ•°æ®ç»“æ„ä¸€è‡´ï¼Œå®é™…ä¸ŠGuavaçš„æ ¸å¿ƒç±»LocalCacheå®ç°äº†ConcurrentMapï¼Œæ‰€ä»¥Guava Cache Cacheå’ŒConcurrentHashMapæ˜¯æœ‰<strong>â€œä¸€æ ·çš„è¡€ç»Ÿâ€</strong>ï¼Œä½†æ˜¯åœ¨å…·ä½“åŠŸèƒ½ä¸Šè¿˜æœ‰æœ‰ä¸€äº›åŒºåˆ«ï¼Œ<em>ConcurrentHashMap</em> ä¼šä¸€è‡´ä¿å­˜æ‰€æœ‰æ·»åŠ çš„å…ƒç´ ï¼Œç›´åˆ°æ˜¾å¼çš„ç§»é™¤ï¼Œè€Œ<em>Guava Cache</em>åˆ™åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å°±éœ€è¦è®¾ç½®è‡ªåŠ¨å›æ”¶å…ƒç´ çš„æ–¹å¼ã€‚</p>
<h4 id="åˆ†å¸ƒå¼ç¼“å­˜"><a href="#åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜"></a>åˆ†å¸ƒå¼ç¼“å­˜</h4><p>ä¸Šé¢çš„å‡ ç§æ”¾ç¼“æ–¹å¼éƒ½åªèƒ½æ˜¯åœ¨å•èŠ‚ç‚¹ä¸­ä½¿ç”¨ï¼Œè€Œå¯¹äºåœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸‹åˆ™éœ€è¦ä½¿ç”¨<strong>Redisã€Memcached</strong>è¿™æ ·çš„ç¼“å­˜ä¸­é—´ä»¶äº†ã€‚</p>
<h3 id="å¦‚ä½•ä½¿ç”¨Guava-Cache"><a href="#å¦‚ä½•ä½¿ç”¨Guava-Cache" class="headerlink" title="å¦‚ä½•ä½¿ç”¨Guava Cache"></a>å¦‚ä½•ä½¿ç”¨Guava Cache</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨pomæ–‡ä»¶åŠ å…¥ç›¸å…³çš„ä¾èµ–</p>
<pre><code><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>21.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</code></pre><p>ç„¶åæˆ‘ä»¬å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªLoadingCacheå¯¹è±¡</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-inactive"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">private LoadingCache&lt;String, String&gt; loadingCache ;</span><br><span class="line">private void init() throws InterruptedException &#123;</span><br><span class="line">        loadingCache = CacheBuilder.newBuilder()</span><br><span class="line">                // è‹¥åœ¨2ç§’ä»¥å†…æ²¡æœ‰è¢«æ›´æ–°å°±ä¼šexpire</span><br><span class="line">                .expireAfterWrite(2, TimeUnit.SECONDS)</span><br><span class="line">                //å½“entriesæ¥è¿‘maximumSizeçš„æ—¶å€™å°±ä¼šé©±èµ¶å‡ºä¸€ä¸ªæœ€è¿‘æœ€å°‘ç”¨çš„entry</span><br><span class="line">                .maximumSize(1000)</span><br><span class="line">                .build(new CacheLoader&lt;String, String&gt;() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public String load(String key) &#123;</span><br><span class="line">                        return &quot;kobe&quot;;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        for (int i = 10; i &lt; 15; i++) &#123;</span><br><span class="line">            QUEUE.put(&quot;jordan&quot; + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">private void testCache() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(3);</span><br><span class="line">        logger.info(&quot;å½“å‰ç¼“å­˜å€¼ : &#123;&#125;,ç¼“å­˜å¤§å° : &#123;&#125;&quot;, loadingCache.get(KEY), loadingCache.size());</span><br><span class="line">        loadingCache.get(key);</span><br><span class="line">    &#125; catch (ExecutionException e ) &#123;</span><br><span class="line">        logger.error(&quot;Exception&quot;, e);</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹åˆå§‹åŒ–æ˜¯ç»™å®š2ç§’é’Ÿå†…è‹¥æ²¡æœ‰è¢«æ›´æ–°å°±å¤±æ•ˆï¼Œè€Œæˆ‘ä»¬è°ƒç”¨<code>testCache</code>æ–¹æ³•ä¸­å…ˆsleepäº†3ç§’ï¼Œæ‰€ä»¥æ­¤æ—¶ç¼“å­˜ä¸­çš„å€¼ä¸€å®šæ˜¯å¤±æ•ˆéƒ½æ¸…é™¤æ‰äº†ã€‚ä¸‹é¢æˆ‘ä»¬å¯ä»¥é€šè¿‡debugä¸€æ­¥ä¸€æ­¥çœ‹çœ‹<code>loadingCache.get(key)</code>è¿™ä¸ªæ–¹æ³•åˆ°åº•æ˜¯æ€æ ·è·å–åˆ°å¯¹åº”çš„å€¼çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">V <span class="title">get</span><span class="params">(K key, CacheLoader&lt;? <span class="keyword">super</span> K, V&gt; loader)</span> <span class="keyword">throws</span> ExecutionException </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> hash = hash(checkNotNull(key));</span><br><span class="line">   <span class="keyword">return</span> segmentFor(hash).get(key, hash, loader);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå¯ä»¥çœ‹åˆ°å°†keyå“ˆå¸Œä¸€æ¬¡ï¼Œé€šè¿‡hashå’Œ<strong>segmentShift</strong>ã€<strong>segmentMask</strong>åšä½è¿ç®—å¾—åˆ°å¯¹åº”çš„ä¸‹æ ‡ã€‚åœ¨è¿™ä¸€ç‚¹å’Œ<em>ConcurrentHashMap</em> æ˜¯ä¸€è‡´çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">V <span class="title">get</span><span class="params">(K key, <span class="keyword">int</span> hash, CacheLoader&lt;? <span class="keyword">super</span> K, V&gt; loader)</span> <span class="keyword">throws</span> ExecutionException </span>&#123;</span><br><span class="line">      checkNotNull(key);</span><br><span class="line">      checkNotNull(loader);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (count != <span class="number">0</span>) &#123; <span class="comment">// read-volatile</span></span><br><span class="line">          <span class="comment">// don't call getLiveEntry, which would ignore loading values</span></span><br><span class="line">          ReferenceEntry&lt;K, V&gt; e = getEntry(key, hash);</span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">long</span> now = map.ticker.read();</span><br><span class="line">            <span class="comment">// è·å–æ²¡æœ‰å¤±æ•ˆã€è¿‡æœŸçš„entry</span></span><br><span class="line">           V value = getLiveValue(e, now);</span><br><span class="line">            <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">              recordRead(e, now);</span><br><span class="line">              statsCounter.recordHits(<span class="number">1</span>);</span><br><span class="line">              <span class="keyword">return</span> scheduleRefresh(e, key, hash, value, now, loader);</span><br><span class="line">            &#125;</span><br><span class="line">            ValueReference&lt;K, V&gt; valueReference = e.getValueReference();</span><br><span class="line">            <span class="keyword">if</span> (valueReference.isLoading()) &#123;</span><br><span class="line">              <span class="keyword">return</span> waitForLoadingValue(e, key, valueReference);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">       ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢æ–¹æ³•é‡Œè¾¹æ¯”è¾ƒå…³é”®çš„æ˜¯<em>V value = getLiveValue(e, now);</em>è¿™è¡Œï¼Œå»è·å–ä»ç„¶æœ‰æ•ˆçš„valueï¼Œç»§ç»­è¿½è¸ª</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">V <span class="title">getLiveValue</span><span class="params">(ReferenceEntry&lt;K, V&gt; entry, <span class="keyword">long</span> now)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (entry.getKey() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        tryDrainReferenceQueues();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      V value = entry.getValueReference().get();</span><br><span class="line">      <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">        tryDrainReferenceQueues();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (map.isExpired(entry, now)) &#123;</span><br><span class="line">        tryExpireEntries(now);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä»<em>if (map.isExpired(entry, now))</em>è¿™è¡Œå¯ä»¥çœ‹åˆ°æ˜¯å¦è¿‡æœŸæ˜¯é€šè¿‡æ—¶é—´æ¥åˆ¤æ–­çš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">boolean isExpired(ReferenceEntry&lt;K, V&gt; entry, long now) &#123;</span><br><span class="line">    checkNotNull(entry);</span><br><span class="line">    if (expiresAfterAccess() &amp;&amp; (now - entry.getAccessTime() &gt;= expireAfterAccessNanos)) &#123;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    if (expiresAfterWrite() &amp;&amp; (now - entry.getWriteTime() &gt;= expireAfterWriteNanos)) &#123;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h3><p>ä¸Šè¾¹æˆ‘ä»¬åœ¨åˆå§‹åŒ–loadingCacheå¯¹è±¡æ—¶ï¼Œè‡ªä¸»é€‰æ‹©æ€§çš„åˆå§‹åŒ–äº†è‡ªå·±çš„å‚æ•°ã€‚é‡‡ç”¨å»ºé€ è€…æ¨¡å¼èµ‹äºˆçš„çµæ´»æ€§å¯¹äºåˆå§‹åŒ–å‚æ•°è¾ƒå¤šã€è‡ªå®šä¹‰ç¨‹åº¦é«˜çš„å¯¹è±¡æ—¶ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ guava cacheä¸ºæˆ‘ä»¬æä¾›äº†ä¸‹é¢è¿™äº›åˆå§‹åŒ–æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> CacheBuilder&lt;K, V&gt; <span class="title">maximumSize</span><span class="params">(<span class="keyword">long</span> size)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CacheBuilder&lt;K, V&gt; <span class="title">initialCapacity</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CacheBuilder&lt;K, V&gt; <span class="title">maximumWeight</span><span class="params">(<span class="keyword">long</span> weight)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CacheBuilder&lt;K, V&gt; <span class="title">refreshAfterWrite</span><span class="params">(<span class="keyword">long</span> duration, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">CacheBuilder&lt;K, V&gt; <span class="title">setValueStrength</span><span class="params">(Strength strength)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CacheBuilder&lt;K, V&gt; <span class="title">softValues</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	....</span></span><br></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š</p>
<p><a href="https://crossoverjie.top/2018/06/13/guava/guava-cache/" target="_blank" rel="noopener">Guava æºç åˆ†æï¼ˆCache åŸç†ï¼‰</a></p>
<p><a href="https://www.jianshu.com/p/2502e8301ec7" target="_blank" rel="noopener">guava Cacheæºç åˆ†æï¼ˆäºŒï¼‰</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>hiveå¦‚ä½•å®ç°è‡ªå®šä¹‰å‡½æ•°</title>
    <url>/2017/09/14/hive%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h1 id="hiveå¦‚ä½•å®ç°è‡ªå®šä¹‰å‡½æ•°"><a href="#hiveå¦‚ä½•å®ç°è‡ªå®šä¹‰å‡½æ•°" class="headerlink" title="hiveå¦‚ä½•å®ç°è‡ªå®šä¹‰å‡½æ•°"></a>hiveå¦‚ä½•å®ç°è‡ªå®šä¹‰å‡½æ•°</h1><blockquote>
<p>æ¦‚è¿°ï¼šæˆ‘ä»¬åœ¨ä½¿ç”¨hiveçš„æ—¶å€™ï¼Œå¾ˆå¤šæ—¶å€™æ‰§è¡Œå¤æ‚çš„sqlæ—¶ï¼Œhiveæä¾›çš„å‡½æ•°æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬è‡ªå·±å»å®šä¹‰ä¸€ä¸ªå‡½æ•°ã€‚<br>å¹¸å¥½ï¼Œhiveä¸ºæˆ‘ä»¬å…è®¸ä½¿ç”¨javaæ¥å­çº¿è‡ªå®šä¹‰å‡½æ•°ã€‚</p>
</blockquote>
<h4 id="1ã€å®ç°è‡ªå®šä¹‰UDFå‡½æ•°å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚"><a href="#1ã€å®ç°è‡ªå®šä¹‰UDFå‡½æ•°å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚" class="headerlink" title="1ã€å®ç°è‡ªå®šä¹‰UDFå‡½æ•°å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚"></a>1ã€å®ç°è‡ªå®šä¹‰UDFå‡½æ•°å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚</h4><ul>
<li>ï¼ˆ1ï¼‰ å¿…é¡»æ˜¯org.apache.Hadoop.hive.ql.exec.UDFçš„å­ç±» </li>
<li>ï¼ˆ2ï¼‰ å¿…é¡»å®ç°evaluateå‡½æ•°ã€‚</li>
</ul>
<h4 id="2ã€å®ç°æ–¹æ³•å…·ä½“å¦‚ä¸‹ï¼š"><a href="#2ã€å®ç°æ–¹æ³•å…·ä½“å¦‚ä¸‹ï¼š" class="headerlink" title="2ã€å®ç°æ–¹æ³•å…·ä½“å¦‚ä¸‹ï¼š"></a>2ã€å®ç°æ–¹æ³•å…·ä½“å¦‚ä¸‹ï¼š</h4><ul>
<li>ï¼ˆ1ï¼‰å°†$HIVE_HOME/libä¸­çš„ä¸¤ä¸ªjaråŒ…ï¼Œåˆ†åˆ«æ˜¯hive-contrib-2.1.1.jarå’Œhive-exec-2.1.1.jarï¼ŒæŠŠä¸¤ä¸ªjaråŒ…æ”¾ç½®åˆ°javaçš„ç›®å½•ä¸‹ï¼Œç„¶åæ–°å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿UDFã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.hadoop.hive.contrib.udf.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;<span class="keyword">import</span> 	org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnMin</span> <span class="keyword">extends</span> <span class="title">UDF</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">evaluate</span><span class="params">(String str, String separator)</span> </span>&#123;</span><br><span class="line">       	<span class="keyword">int</span> result = <span class="number">100</span>;       </span><br><span class="line">       	<span class="keyword">if</span>(StringUtils.isEmpty(str))&#123;</span><br><span class="line">           	<span class="keyword">return</span> result;        </span><br><span class="line">        	&#125;</span><br><span class="line">       	String[] strArray = str.split(separator);</span><br><span class="line">       	<span class="keyword">int</span>[] intArray = <span class="keyword">new</span> <span class="keyword">int</span>[strArray.length];        </span><br><span class="line">       	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; strArray.length ; i++) &#123;</span><br><span class="line">           	intArray[i] = Integer.parseInt(strArray[i]);        </span><br><span class="line">       	&#125;</span><br><span class="line">       	Arrays.sort(intArray);        </span><br><span class="line">       	<span class="keyword">return</span> intArray[<span class="number">0</span>];    </span><br><span class="line">   	&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>(2)  ç„¶åå°†ReturnMin.classæ–‡ä»¶æ‹·è´åˆ°hive-contrib-2.1.1.jar\org\apache\hadoop\hive\contrib\udf\exampleç›®å½•ä¸­ï¼Œç„¶åæ›¿æ¢hive select<br>åœ¨hiveçš„cliä¸­æ‰§è¡Œï¼šCREATE FUNCTION ReturnMin AS â€˜org.apache.hadoop.hive.contrib.udf.example.ReturnMinâ€™;<br>ç„¶åé‡æ–°è¿›å…¥cliä¸­ï¼Œç»™è¿™ä¸ªå‡½æ•°ä¼ é€’ä¸€ä¸ªæ•°å­—çš„å­—ç¬¦ä¸²å’Œåˆ†éš”ç¬¦å°±èƒ½å¤Ÿå°†è¿™ä¸ªå­—ç¬¦ä¸²æœ€å°çš„å€¼è¿”å›ã€‚</p>
<p>hiveåˆ é™¤ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼š drop function cutString;</p>
</li>
</ul>
]]></content>
      <categories>
        <category>hive</category>
      </categories>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼è°ƒåº¦ä¸­å¿ƒ</title>
    <url>/2018/09/06/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83/</url>
    <content><![CDATA[<p><img src="https://res.cloudinary.com/leon824/image/upload/v1536228539/america-american-american-flag-92730_nxhmbn.jpg" width="90%" height="90%"></p>
<blockquote>
<p>æœ€è¿‘å…¬å¸çš„æœåŠ¡å·²ç»ä»ä¼ ç»ŸtomcatæœåŠ¡æ‹†åˆ†æˆäº†å¾®æœåŠ¡ï¼Œä½¿å¾—å„ä¸ªåŸæœ¬è‡ƒè‚¿çš„ä¸šåŠ¡å˜å¾—è½»é‡ã€æ˜“ç»´æŠ¤ï¼Œä½†æ˜¯ä¹Ÿå¸¦äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ç”Ÿäº§ã€æµ‹è¯•ç¯å¢ƒä¸­çš„å®šæ—¶ä»»åŠ¡ç®¡ç†å°±æˆäº†é—®é¢˜ï¼Œç”±äºæœåŠ¡å™¨å˜å¾—æ›´å¤šï¼Œå®šæ—¶ä»»åŠ¡å˜å¾—åˆ†æ•£ï¼Œå„ä¸ªç¯å¢ƒå®¹æ˜“å˜å¾—æ··æ‚ã€ç»´æŠ¤æˆæœ¬å‡é«˜ä¸”å®¹æ˜“å‡ºé”™ï¼ŒåŒæ—¶æ— æ³•çŸ¥é“è¿™ä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ˜¯å¦æˆåŠŸï¼Œåªæœ‰å½“æœåŠ¡å‡ºç°äº†é—®é¢˜æ‰èƒ½åæ¨å®šæ—¶ä»»åŠ¡å‡ºç°äº†é—®é¢˜ã€‚</p>
</blockquote>
<h2 id="ä½¿ç”¨ç³»ç»Ÿçº§å®šæ—¶crontabå­˜åœ¨çš„ä¸»è¦é—®é¢˜"><a href="#ä½¿ç”¨ç³»ç»Ÿçº§å®šæ—¶crontabå­˜åœ¨çš„ä¸»è¦é—®é¢˜" class="headerlink" title="ä½¿ç”¨ç³»ç»Ÿçº§å®šæ—¶crontabå­˜åœ¨çš„ä¸»è¦é—®é¢˜"></a>ä½¿ç”¨ç³»ç»Ÿçº§å®šæ—¶crontabå­˜åœ¨çš„ä¸»è¦é—®é¢˜</h2><ul>
<li>ä»»åŠ¡çš„æ—¶é—´ç²’åº¦ä¸å¤Ÿå°ï¼ˆåªèƒ½æ˜¯åˆ†é’Ÿçº§åˆ«ä»¥ä¸Šï¼‰</li>
<li>å½“ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰é€šçŸ¥ï¼Œä¸èƒ½åŠæ—¶å‘ç°å®šæ—¶ä»»åŠ¡æ˜¯å¦æ‰§è¡Œï¼Œåªæœ‰å½“å‡ºç°å¼‚å¸¸çš„æ—¶å€™æ‰èƒ½å‘ç°å®šæ—¶çš„æ‰§è¡Œå‡ºç°äº†é—®é¢˜ã€‚</li>
<li>ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹æ²¡æœ‰æ—¥å¿—è®°å½•ï¼Œå‡ºç°çš„é—®é¢˜ä¸å®¹æ˜“å®šä½</li>
<li>æ²¡æœ‰å¤±è´¥å¤„ç†ç­–ç•¥ï¼ˆå¤±è´¥é‡è¯•ã€å¤±è´¥å‘Šè­¦ï¼‰</li>
<li>æ²¡æœ‰é˜»å¡ç­–ç•¥</li>
<li><p>ä¾èµ–è¿ç»´äººå‘˜ï¼Œä½æ•ˆ</p>
<p>é‚£ä¹ˆä¸Šè¾¹è¿™äº›é—®é¢˜è¦æ€æ ·è§£å†³å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼è°ƒåº¦ç³»ç»Ÿæ¥å½»åº•è§£å†³è¿™äº›ç—›ç‚¹ã€‚</p>
</li>
</ul>
<h2 id="åˆ†å¸ƒå¼è°ƒåº¦ç³»ç»Ÿ"><a href="#åˆ†å¸ƒå¼è°ƒåº¦ç³»ç»Ÿ" class="headerlink" title="åˆ†å¸ƒå¼è°ƒåº¦ç³»ç»Ÿ"></a>åˆ†å¸ƒå¼è°ƒåº¦ç³»ç»Ÿ</h2><ul>
<li><code>TBSchedule</code>ï¼šé˜¿é‡Œæ—©æœŸå¼€æºçš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿã€‚ä»£ç ç•¥é™ˆæ—§ï¼Œä½¿ç”¨timerè€Œéçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡è°ƒåº¦ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œtimeråœ¨å¤„ç†å¼‚å¸¸çŠ¶å†µæ—¶æ˜¯æœ‰ç¼ºé™·çš„ã€‚è€Œä¸”TBScheduleä½œä¸šç±»å‹è¾ƒä¸ºå•ä¸€ï¼Œåªèƒ½æ˜¯è·å–/å¤„ç†æ•°æ®ä¸€ç§æ¨¡å¼ã€‚è¿˜æœ‰å°±æ˜¯æ–‡æ¡£ç¼ºå¤±æ¯”è¾ƒä¸¥é‡</li>
<li><code>Saturn</code>ï¼šæ˜¯å”¯å“ä¼šè‡ªä¸»ç ”å‘çš„åˆ†å¸ƒå¼çš„å®šæ—¶ä»»åŠ¡çš„è°ƒåº¦å¹³å°ï¼ŒåŸºäºå½“å½“çš„elastic-job ç‰ˆæœ¬1å¼€å‘ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå¥½çš„éƒ¨ç½²åˆ°dockerå®¹å™¨ä¸Šã€‚</li>
<li><code>elastic-job</code>ï¼šå½“å½“å¼€å‘çš„å¼¹æ€§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼ŒåŠŸèƒ½ä¸°å¯Œå¼ºå¤§ï¼Œé‡‡ç”¨zookeeperå®ç°åˆ†å¸ƒå¼åè°ƒï¼Œå®ç°ä»»åŠ¡é«˜å¯ç”¨ä»¥åŠåˆ†ç‰‡ï¼Œç›®å‰æ˜¯ç‰ˆæœ¬2.15ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒäº‘å¼€å‘</li>
<li><code>xxl-job</code>: æ˜¯å¤§ä¼—ç‚¹è¯„å‘˜å·¥å¾é›ªé‡Œäº2015å¹´å‘å¸ƒçš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œæ˜¯ä¸€ä¸ªè½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±•</li>
</ul>
<p>åœ¨ä¸Šè¾¹è¿™å‡ ç§è§£å†³æ–¹æ¡ˆä¸­ï¼Œä»¥<strong>xxl-job</strong>å’Œ<strong>elastic-job</strong>ç”¨çš„æ›´å¤šã€æ–‡æ¡£ç›¸å¯¹å®Œå–„ã€‚</p>
<ul>
<li>å…±åŒç‚¹ï¼š <code>E-Job</code>å’Œ<code>X-job</code>éƒ½æœ‰å¹¿æ³›çš„ç”¨æˆ·åŸºç¡€å’Œå®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£ï¼Œéƒ½èƒ½æ»¡è¶³å®šæ—¶ä»»åŠ¡çš„åŸºæœ¬åŠŸèƒ½éœ€æ±‚ã€‚</li>
<li>ä¸åŒç‚¹ï¼š<code>X-Job</code> ä¾§é‡çš„ä¸šåŠ¡å®ç°çš„ç®€å•å’Œç®¡ç†çš„æ–¹ä¾¿ï¼Œå­¦ä¹ æˆæœ¬ç®€å•ï¼Œå¤±è´¥ç­–ç•¥å’Œè·¯ç”±ç­–ç•¥ä¸°å¯Œã€‚æ¨èä½¿ç”¨åœ¨â€œç”¨æˆ·åŸºæ•°ç›¸å¯¹å°‘ï¼ŒæœåŠ¡å™¨æ•°é‡åœ¨ä¸€å®šèŒƒå›´å†…â€çš„æƒ…æ™¯ä¸‹ä½¿ç”¨<br><code>E-Job</code> å…³æ³¨çš„æ˜¯æ•°æ®ï¼Œå¢åŠ äº†å¼¹æ€§æ‰©å®¹å’Œæ•°æ®åˆ†ç‰‡çš„æ€è·¯ï¼Œä»¥ä¾¿äºæ›´å¤§é™åº¦çš„åˆ©ç”¨åˆ†å¸ƒå¼æœåŠ¡å™¨çš„èµ„æºã€‚ä½†æ˜¯å­¦ä¹ æˆæœ¬ç›¸å¯¹é«˜äº›ï¼Œæ¨èåœ¨â€œæ•°æ®é‡åºå¤§ï¼Œä¸”éƒ¨ç½²æœåŠ¡å™¨æ•°é‡è¾ƒå¤šâ€æ—¶ä½¿ç”¨</li>
</ul>
<p>æ ¹æ®æˆ‘ä»¬ä¸šåŠ¡çš„æ•°æ®é‡ã€ç”¨æˆ·æ•°é‡å¯ä»¥é‡‡ç”¨<code>xxl-job</code>å¿«é€Ÿå®ç°åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒã€‚</p>
<h2 id="xxl-jobä¸‹è½½ã€è¿è¡Œ"><a href="#xxl-jobä¸‹è½½ã€è¿è¡Œ" class="headerlink" title="xxl-jobä¸‹è½½ã€è¿è¡Œ"></a>xxl-jobä¸‹è½½ã€è¿è¡Œ</h2><p>é¦–å…ˆæˆ‘ä»¬å…ˆå»<code>github</code>ä¸­ä¸‹è½½<code>xxl-job</code>æœ€æ–°çš„ä»£ç </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> git clone https://github.com/xuxueli/xxl-job.git</span><br></pre></td></tr></table></figure>
<p>  ç„¶ååœ¨<code>idea</code>ä¸­åŠ è½½è¿™ä¸ªæ¨¡å—</p>
<p>  <img src="https://res.cloudinary.com/leon824/image/upload/v1536229716/xxl-job2_dmcr7w.png" width="60%" height="60%"></p>
<p>  æ³¨æ„ä¸Šè¾¹çš„ä¸‰ä¸ªé»„è‰²æ¡†åœˆèµ·æ¥çš„éƒ¨åˆ†ï¼Œä»ä¸Šå¾€ä¸‹ï¼š</p>
<p>  1ã€<code>tables_xxl_job.sql</code>è¿™ä¸ªæ˜¯æˆ‘ä»¬åœ¨åº“é‡Œè¾¹åˆ›å»ºçš„åº“-è¡¨ï¼Œæ‰§è¡Œä¹‹åä¼šæœ‰16å¼ è¡¨è¢«åˆ›å»º</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> mysql -uroot -p &lt; tables_xxl_job.sql</span><br></pre></td></tr></table></figure>
<p>  <img src="  https://res.cloudinary.com/leon824/image/upload/v1536229989/xxl-job3_znsdti.png" width="40%" height="50%"></p>
<p>  2ã€<code>xxl-job-admin</code>å°±æ˜¯è°ƒåº¦ä¸­å¿ƒï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹<code>resources</code>é‡Œè¾¹çš„<code>xxl-job-admin.properties</code>æ–‡ä»¶ä¸€äº›å­—æ®µ</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line">  <span class="comment">### xxl-job db  (use &amp;amp; replace &amp; in xml)</span></span><br><span class="line"><span class="string">xxl.job.db.driverClass=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="string">xxl.job.db.url=jdbc:mysql://localhost:3306/xxl-job?useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line"><span class="string">xxl.job.db.user=root</span></span><br><span class="line"><span class="string">xxl.job.db.password=123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### xxl-job email</span></span><br><span class="line"><span class="string">xxl.job.mail.host=smtp.163.com</span></span><br><span class="line"><span class="string">xxl.job.mail.port=25</span></span><br><span class="line"><span class="string">xxl.job.mail.username=ovono802302@163.com</span></span><br><span class="line"><span class="string">xxl.job.mail.password=asdfzxcv</span></span><br><span class="line"><span class="string">xxl.job.mail.sendNick=ã€Šä»»åŠ¡è°ƒåº¦å¹³å°XXL-JOBã€‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### xxl-job login</span></span><br><span class="line"><span class="string">xxl.job.login.username=admin</span></span><br><span class="line"><span class="string">xxl.job.login.password=123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### xxl-job, access token</span></span><br><span class="line"><span class="string">xxl.job.accessToken=</span></span><br><span class="line"><span class="comment">### xxl-job, i18n (default empty as chinese, "en" as english)</span></span><br><span class="line"><span class="string">xxl.job.i18n=</span></span><br></pre></td></tr></table></figure>
<p>é…ç½®å®Œæˆä¹‹åå°±å¯ä»¥å¯åŠ¨äº†ã€‚</p>
<p> 3ã€ ç¬¬ä¸‰ä¸ªæ˜¯<code>xxl-job-executor-sample-springboot</code>è¿™ä¸ªæ˜¯xxl-jobæä¾›çš„æ‰§è¡Œå™¨ä¸­çš„ä¸€ç§ï¼Œå¦å¤–è¿˜æ”¯æŒ<code>spring</code>ç­‰ç­‰ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†ç›¸åº”å‚æ•°ä¿®æ”¹æˆå’Œè‡ªå·±ç¯å¢ƒåŒ¹é…çš„å‚æ•°ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># web port</span></span><br><span class="line"><span class="string">server.port=8081</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># log config</span></span><br><span class="line"><span class="string">logging.config=classpath:logback.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### xxl-job admin address list, such as "http://address" or "http://address01,http://address02"</span></span><br><span class="line"><span class="string">xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### xxl-job executor address</span></span><br><span class="line"><span class="string">xxl.job.executor.appname=xxl-job-executor-sample</span></span><br><span class="line"><span class="string">xxl.job.executor.ip=</span></span><br><span class="line"><span class="string">xxl.job.executor.port=9999</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### xxl-job, access token</span></span><br><span class="line"><span class="string">xxl.job.accessToken=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### xxl-job log path</span></span><br><span class="line"><span class="string">xxl.job.executor.logpath=/Users/leon/work/logs/xxl-job/jobhandler</span></span><br><span class="line"><span class="comment">### xxl-job log retention days</span></span><br><span class="line"><span class="string">xxl.job.executor.logretentiondays=-1</span></span><br></pre></td></tr></table></figure>
<p> ä¸Šè¾¹æ‰§è¡Œå™¨æ˜¯å…·ä½“æ‰§è¡Œä»»åŠ¡çš„æ¨¡å—ã€‚ä¸‹è¾¹å°±æ¥å…·ä½“è®²è®²xxl-jobæ•´ä½“ä½¿ç”¨æ¶æ„å›¾ã€‚</p>
<p>  <img src="https://res.cloudinary.com/leon824/image/upload/v1536054290/Pic2432_m0orgo.png" width="100%" height="90%"></p>
<p>  ä¸Šå›¾ä¸­è™šçº¿åŒ…å›´èµ·æ¥çš„ä¸¤ä¸ªéƒ¨åˆ†å°±æ˜¯xxl-jobæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œä¸€ä¸ªå«<strong>è°ƒåº¦ä¸­å¿ƒ</strong>ï¼Œä¸€ä¸ªå«<strong>æ‰§è¡Œå™¨</strong>ï¼ˆ<em>æˆ‘æ›´æ„¿æ„å«ä»–<code>æ‰§è¡Œå™¨ç¾¤</code></em>ï¼‰ã€‚å…¶ä¸­<strong>è°ƒåº¦ä¸­å¿ƒ</strong>è´Ÿè´£æ‰€æœ‰æ‰§è¡Œå™¨ç¾¤çš„ç®¡ç†ï¼Œå„ä¸ªæ‰§è¡Œå™¨ç¾¤çš„ä»»åŠ¡åˆ†å‘ç®¡ç†ï¼Œæ—¥å¿—çš„æŸ¥è¯¢ç­‰ç­‰åŠŸèƒ½ï¼Œè€Œ<strong>æ‰§è¡Œå™¨</strong>è´Ÿè´£å…·ä½“æ‰§è¡Œä»»åŠ¡ã€‚è€Œä¸­é—´çš„é€šè®¯ç»„ä»¶åˆ™æ˜¯è‡ªç ”çš„RPCç»„ä»¶ï¼Œç”Ÿäº§ä¸šåŠ¡æ‰§è¡Œå™¨å°±ç›¸å½“äºæ˜¯ç”Ÿäº§ç¯å¢ƒçš„æ‰§è¡Œå™¨ç¾¤ï¼Œæµ‹è¯•ä¸šåŠ¡æ‰§è¡Œå™¨ç›¸å½“äºæµ‹è¯•ç¯å¢ƒçš„æ‰§è¡Œå™¨ç¾¤ã€‚è¿™æ ·å°±èƒ½æ»¡è¶³å°†å„ä¸ªç¯å¢ƒé€šè¿‡æ‰§è¡Œå™¨ç¾¤æ¥åŒºåˆ†ï¼Œç„¶åç»Ÿä¸€ç®¡ç†èµ·æ¥åœ¨ä¸€ä¸ªwebåå°å°±èƒ½å¤„ç†æ‰€æœ‰ç¯å¢ƒçš„å®šæ—¶ä»»åŠ¡äº†ã€‚</p>
<h2 id="è°ƒåº¦ä¸­å¿ƒç›¸å…³"><a href="#è°ƒåº¦ä¸­å¿ƒç›¸å…³" class="headerlink" title="è°ƒåº¦ä¸­å¿ƒç›¸å…³"></a>è°ƒåº¦ä¸­å¿ƒç›¸å…³</h2><p>  è¦ä½¿ç”¨xxl-jobæ¥ç®¡ç†æ‰€æœ‰ç¯å¢ƒçš„å®šæ—¶ä»»åŠ¡ï¼Œé¦–å…ˆéœ€è¦æ ¹æ®ç¯å¢ƒåˆ›å»ºæ‰§è¡Œå™¨ç¾¤ï¼Œç„¶ååœ¨çŸ¥æƒ…å™¨ç¾¤çš„åŸºç¡€ä¸Šåˆ›å»ºä»»åŠ¡ã€‚</p>
<h3 id="åˆ›å»ºæ‰§è¡Œå™¨ç¾¤"><a href="#åˆ›å»ºæ‰§è¡Œå™¨ç¾¤" class="headerlink" title="åˆ›å»ºæ‰§è¡Œå™¨ç¾¤"></a>åˆ›å»ºæ‰§è¡Œå™¨ç¾¤</h3><p>ç‚¹å‡»webé¡µé¢å·¦ä¾§çš„<strong>æ‰§è¡Œå™¨ç®¡ç†</strong> =&gt; <strong>æ–°å¢æ‰§è¡Œå™¨</strong></p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1536231480/xxl-job5_virbrp.png" width="70%" height="70%"></p>
<p> ä¸Šè¾¹çš„<code>AppName</code>å¾ˆé‡è¦ï¼Œæ˜¯åŒºåˆ†å„ä¸ªæ‰§è¡Œå™¨ç¾¤çš„æ ‡å¿—ï¼Œå¦‚æœé€‰æ‹©ä¸‹è¾¹çš„æ‰‹åŠ¨å½•å…¥çš„è¯é‚£ä¹ˆå°±éœ€è¦å°†æœºå™¨<code>ip:port</code>æ·»åŠ åˆ°æœºå™¨åœ°å€ä¸­ã€‚æŠŠæ‰§è¡Œå™¨ç¾¤åˆ›å»ºå¥½äº†ä¹‹åå°±å¯ä»¥åˆ›å»ºå®šæ—¶ä»»åŠ¡äº†ã€‚</p>
<h3 id="åˆ›å»ºå®šæ—¶ä»»åŠ¡"><a href="#åˆ›å»ºå®šæ—¶ä»»åŠ¡" class="headerlink" title="åˆ›å»ºå®šæ—¶ä»»åŠ¡"></a>åˆ›å»ºå®šæ—¶ä»»åŠ¡</h3><p> ç‚¹å‡»å·¦ä¾§çš„<strong>ä»»åŠ¡ç®¡ç†</strong> =&gt; <strong>æ–°å¢ä»»åŠ¡</strong></p>
<p> <img src="https://res.cloudinary.com/leon824/image/upload/v1536231961/xxl-job6_iyd6r8.png" width="70%" height="70%"></p>
<p>  é‡Œè¾¹çš„å…·ä½“é€‰é¡¹çš„å«ä¹‰å¤§å®¶å¯ä»¥å»æŸ¥xxl-jobçš„<a href="http://www.xuxueli.com/xxl-job/#/?id=%E4%B8%89%E3%80%81%E4%BB%BB%E5%8A%A1%E8%AF%A6%E8%A7%A3" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œä¹Ÿè®°å½•çš„å¾ˆè¯¦ç»†ã€‚è¿™é‡Œä¸åœ¨é‡æ–°å¤è¿°ã€‚</p>
<p>  è¿™é‡Œè¿˜æƒ³å¤šæä¸€ç‚¹çš„æ˜¯ä»–çš„æŠ¥è­¦æœºåˆ¶ï¼Œåªæ”¯æŒé‚®ä»¶æŠ¥è­¦ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´å¤§å®¶æ‰“å¼€é‚®ä»¶çš„é¢‘ç‡æ¯”è¾ƒä½ï¼Œå¹³æ—¶ä¹Ÿè®¸ä¸å¤ªå…³æ³¨é‚®ä»¶ï¼Œæ‰€ä»¥å¯èƒ½å¯¼è‡´ä¸€äº›ä»»åŠ¡æ‰§è¡Œå¤±è´¥äº†æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åŠæ—¶å‘ç°ã€‚åŸºäºä¸Šé¢çš„åŸå› ï¼Œå°±åœ¨ä½œè€…åŸæ¥çš„ä»£ç åŸºç¡€ä¸Šå¢åŠ <strong>é’‰é’‰æŠ¥è­¦</strong>ï¼ˆåœ¨<code>github issues</code>ä¸­ä¹Ÿæœ‰äººæå‡ºè¿‡ï¼‰ï¼Œå®ç°èµ·æ¥ä¹Ÿå¹¶ä¸å¤æ‚ã€‚ä¿®æ”¹ä¹‹ååˆ›å»ºä»»åŠ¡çš„æ—¶å€™å¤šäº†ä¸¤ä¸ªå‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°ä¹Ÿéœ€è¦åœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸¤ä¸ªå­—æ®µã€‚</p>
<p>  <img src="https://res.cloudinary.com/leon824/image/upload/v1536232500/xxl-job8_fsxslg.png" width="70%" height="70%"></p>
<p>  è‹¥å‡ºç°ä»»åŠ¡å¼‚å¸¸ï¼Œé‚£ä¹ˆä¼šç›´æ¥å°†è‡ªå®šä¹‰çš„ä¿¡æ¯é€šè¿‡<code>http post</code>çš„æ–¹å¼å‘é€ç»™é…ç½®çš„é’‰é’‰ç¾¤ï¼Œä¸‹é¢æ˜¯æˆ‘æµ‹è¯•çš„æ•ˆæœã€‚</p>
<p>  <img src="https://res.cloudinary.com/leon824/image/upload/v1536232776/xxl-job9_vnqd4c.png" width="40%" height="40%"></p>
<h2 id="æ€ç»´å¯¼å›¾"><a href="#æ€ç»´å¯¼å›¾" class="headerlink" title="æ€ç»´å¯¼å›¾"></a>æ€ç»´å¯¼å›¾</h2><p>å¤§è‡´ç”»äº†ä¸€ä¸‹xxl-jobçš„æ€ç»´å¯¼å›¾ï¼Œè¿˜ä¸å¤Ÿå®Œå¤‡ã€‚</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1536114765/pic110_ugssl2.png" width="100%" height="100%"></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/36627346" target="_blank" rel="noopener">ç¾å›¢ç‚¹è¯„è®¸é›ªé‡Œï¼šåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å° XXL-JOB</a></li>
<li><a href="http://www.xuxueli.com/xxl-job/#/" target="_blank" rel="noopener">xxl-jobå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://www.cnblogs.com/davidwang456/p/9057839.html" target="_blank" rel="noopener">åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦ç³»ç»ŸæŠ€æœ¯é€‰å‹</a> </li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>hiveä¸­sqlæ€»ç»“</title>
    <url>/2017/09/14/hive%E4%B8%ADsql%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="hiveä¸­sqlæ€»ç»“"><a href="#hiveä¸­sqlæ€»ç»“" class="headerlink" title="hiveä¸­sqlæ€»ç»“"></a>hiveä¸­sqlæ€»ç»“</h2><h4 id="1ã€å¯¹æŒ‡å®šçš„æŸä¸€ä¸ªåˆ—å»é‡"><a href="#1ã€å¯¹æŒ‡å®šçš„æŸä¸€ä¸ªåˆ—å»é‡" class="headerlink" title="1ã€å¯¹æŒ‡å®šçš„æŸä¸€ä¸ªåˆ—å»é‡"></a>1ã€å¯¹æŒ‡å®šçš„æŸä¸€ä¸ªåˆ—å»é‡</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into table allrecord partition (year=2017, month=08, day=25) select t.id, t.tssend, t.apmac, t.mac, t.rssi from (select id, tssend, apmac ,mac, rssi, row_number() over(distribute by mac sort by tssend )as rn from allrecords) t where t.rn=1;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¯•å¯¹å­—æ®µmacå»é‡ï¼Œç„¶åå¯¹tssendæ’åºåæ’å…¥allrecordè¿™å¼ è¡¨</p>
<h4 id="2ã€åˆ é™¤åˆ†åŒº"><a href="#2ã€åˆ é™¤åˆ†åŒº" class="headerlink" title="2ã€åˆ é™¤åˆ†åŒº"></a>2ã€åˆ é™¤åˆ†åŒº</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> macinfo_2017 <span class="keyword">DROP</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">PARTITION</span> (<span class="keyword">year</span>=<span class="number">2017</span>, <span class="keyword">month</span>=<span class="number">03</span>, <span class="keyword">day</span>=<span class="number">22</span>);</span><br></pre></td></tr></table></figure>
<h4 id="3ã€åˆ é™¤ä¸€å¼ è¡¨ï¼Œå¦‚æœå¯åŠ¨äº†å›æ”¶ç«™åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™å¼ è¡¨ä¼šä¿å­˜åœ¨å›æ”¶ç«™é‡Œï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿæ¢å¤ä¿¡æ¯çš„ã€‚"><a href="#3ã€åˆ é™¤ä¸€å¼ è¡¨ï¼Œå¦‚æœå¯åŠ¨äº†å›æ”¶ç«™åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™å¼ è¡¨ä¼šä¿å­˜åœ¨å›æ”¶ç«™é‡Œï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿæ¢å¤ä¿¡æ¯çš„ã€‚" class="headerlink" title="3ã€åˆ é™¤ä¸€å¼ è¡¨ï¼Œå¦‚æœå¯åŠ¨äº†å›æ”¶ç«™åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™å¼ è¡¨ä¼šä¿å­˜åœ¨å›æ”¶ç«™é‡Œï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿæ¢å¤ä¿¡æ¯çš„ã€‚"></a>3ã€åˆ é™¤ä¸€å¼ è¡¨ï¼Œå¦‚æœå¯åŠ¨äº†å›æ”¶ç«™åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™å¼ è¡¨ä¼šä¿å­˜åœ¨å›æ”¶ç«™é‡Œï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿæ¢å¤ä¿¡æ¯çš„ã€‚</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> tablename;</span><br></pre></td></tr></table></figure>
<p>è‹¥æ˜¯è¡¨åˆ›å»ºä¸ºå¤–éƒ¨è¡¨ï¼Œåˆ™åªä¼šåˆ é™¤ç›¸åº”çš„åŸä¿¡æ¯ï¼Œå¯¹æ•°æ®æ²¡æœ‰å½±å“ã€‚</p>
<h4 id="4ã€-åˆ›å»ºä¸€ä¸ªpartition-table002çš„è¡¨ï¼Œä½¿å¾—è¡¨ç»“æ„å’Œpartition-table001ä¸€æ ·ã€‚"><a href="#4ã€-åˆ›å»ºä¸€ä¸ªpartition-table002çš„è¡¨ï¼Œä½¿å¾—è¡¨ç»“æ„å’Œpartition-table001ä¸€æ ·ã€‚" class="headerlink" title="4ã€ åˆ›å»ºä¸€ä¸ªpartition_table002çš„è¡¨ï¼Œä½¿å¾—è¡¨ç»“æ„å’Œpartition_table001ä¸€æ ·ã€‚"></a>4ã€ åˆ›å»ºä¸€ä¸ªpartition_table002çš„è¡¨ï¼Œä½¿å¾—è¡¨ç»“æ„å’Œpartition_table001ä¸€æ ·ã€‚</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> partition_table002 <span class="keyword">like</span> partition_table001;</span><br></pre></td></tr></table></figure>
<h4 id="5ã€ä½¿ç”¨loadåŠ è½½æ•°æ®åˆ°è¡¨ä¸­"><a href="#5ã€ä½¿ç”¨loadåŠ è½½æ•°æ®åˆ°è¡¨ä¸­" class="headerlink" title="5ã€ä½¿ç”¨loadåŠ è½½æ•°æ®åˆ°è¡¨ä¸­"></a>5ã€ä½¿ç”¨loadåŠ è½½æ•°æ®åˆ°è¡¨ä¸­</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'t_student1.txt'</span> overwrite inte <span class="keyword">table</span> t_student1;</span><br></pre></td></tr></table></figure>
<h4 id="6ã€åˆ›å»ºå¤–éƒ¨è¡¨"><a href="#6ã€åˆ›å»ºå¤–éƒ¨è¡¨" class="headerlink" title="6ã€åˆ›å»ºå¤–éƒ¨è¡¨"></a>6ã€åˆ›å»ºå¤–éƒ¨è¡¨</h4><pre><code class="sql"><span class="keyword">create</span> <span class="keyword">EXTERNAL</span> <span class="keyword">table</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> macinfo_20170221(
    tssend <span class="keyword">string</span> <span class="keyword">COMMENT</span> <span class="string">'Probe upload data time'</span>,
    apmac <span class="keyword">string</span> <span class="keyword">COMMENT</span> <span class="string">'Probe MAC address'</span>,
    mac <span class="keyword">string</span> <span class="keyword">COMMENT</span> <span class="string">'Mobile device MAC address'</span>,
    rssi <span class="keyword">string</span>  <span class="keyword">COMMENT</span> <span class="string">'WiFi signal strength of mobile devices'</span>)
    partitioned <span class="keyword">by</span> (<span class="keyword">year</span> <span class="built_in">int</span>, <span class="keyword">month</span> <span class="built_in">int</span>, <span class="keyword">day</span> <span class="built_in">int</span>) 
    <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE <span class="string">'org.openx.data.jsonserde.JsonSerDe'</span>  
    <span class="keyword">WITH</span> SERDEPROPERTIES (
    <span class="string">"mac"</span>=<span class="string">"$.mac"</span>,
    <span class="string">"apmac"</span>=<span class="string">"$.apmac"</span>,
    <span class="string">"rssi"</span>=<span class="string">"$.rssi"</span>,
    <span class="string">"tssend"</span>=<span class="string">"$.tssend"</span> 
    )
    <span class="keyword">STORED</span> <span class="keyword">AS</span> TEXTFILE
    LOCATION <span class="string">'/opt/local/software/a.txt'</span>; 

</code></pre>
<p><strong>æ³¨æ„ï¼š</strong>è¿™é‡Œåˆ›å»ºå¤–éƒ¨è¡¨æ—¶ä¼šæœ‰å‘ï¼Œä¸»è¦æ˜¯æ•°æ®å­˜å‚¨æ ¼å¼çš„é—®é¢˜ï¼Œæˆ‘çš„æ•°æ®å­˜å‚¨ä¸ºjsonæ ¼å¼ï¼Œè€Œhiveå¹¶ä¸ç›´æ¥æ”¯æŒè¯»å–jsonæ ¼å¼æ•°æ®ï¼Œéœ€è¦æ·»åŠ ç›¸åº”çš„jaråŒ…æ‰èƒ½è§£ææ•°æ®ã€‚</p>
<h4 id="7ã€hiveå¤–éƒ¨è¡¨åˆ›å»ºåˆ†åŒºå…³è”ç›¸åº”çš„ç›®å½•ï¼ˆå¿…é¡»æ˜¯ç›®å½•ï¼‰"><a href="#7ã€hiveå¤–éƒ¨è¡¨åˆ›å»ºåˆ†åŒºå…³è”ç›¸åº”çš„ç›®å½•ï¼ˆå¿…é¡»æ˜¯ç›®å½•ï¼‰" class="headerlink" title="7ã€hiveå¤–éƒ¨è¡¨åˆ›å»ºåˆ†åŒºå…³è”ç›¸åº”çš„ç›®å½•ï¼ˆå¿…é¡»æ˜¯ç›®å½•ï¼‰"></a>7ã€hiveå¤–éƒ¨è¡¨åˆ›å»ºåˆ†åŒºå…³è”ç›¸åº”çš„ç›®å½•ï¼ˆå¿…é¡»æ˜¯ç›®å½•ï¼‰</h4><pre><code class="sql"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> macinfo_2017 <span class="keyword">ADD</span> <span class="keyword">PARTITION</span> (<span class="keyword">year</span> = <span class="number">2017</span>, <span class="keyword">month</span> = <span class="number">02</span>, <span class="keyword">day</span> = <span class="number">21</span>);
</code></pre>
<p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>hive</category>
      </categories>
  </entry>
  <entry>
    <title>Spring MVCè®¿é—®é™æ€èµ„æºæ–‡ä»¶</title>
    <url>/2017/09/27/SpringMVC%E8%AE%BF%E9%97%AE%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h1 id="Spring-MVCè®¿é—®é™æ€èµ„æºæ–‡ä»¶"><a href="#Spring-MVCè®¿é—®é™æ€èµ„æºæ–‡ä»¶" class="headerlink" title="Spring MVCè®¿é—®é™æ€èµ„æºæ–‡ä»¶"></a>Spring MVCè®¿é—®é™æ€èµ„æºæ–‡ä»¶</h1><blockquote>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨spring MVCå¼€å‘æ—¶ï¼Œéœ€è¦åœ¨web.xmlæ–‡ä»¶ä¸­é…ç½®DispatcherServletï¼ŒæŒ‡å®šæ˜ å°„æ¡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
</blockquote>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:/conf/spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é€šå¸¸éƒ½éœ€è¦å°†DispatcherServleté…ç½®ä¸ºæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œæ‰€ä»¥å°†url-patterné…ç½®ä¸ºâ€/â€œã€‚ä½†è¿™æ ·å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œé€šå¸¸åœ¨é¡µé¢ä¸­éœ€è¦ä½¿ç”¨åˆ°çš„jsã€cssã€å›¾ç‰‡ç­‰ç­‰é™æ€æ–‡ä»¶å°±æ— æ³•è¯·æ±‚äº†ã€‚</p>
<h3 id="ä¸€èˆ¬æœ‰ç”¨ä¸¤ç§æ–¹å¼æ¥å¤„ç†è¿™ç§æƒ…å†µ"><a href="#ä¸€èˆ¬æœ‰ç”¨ä¸¤ç§æ–¹å¼æ¥å¤„ç†è¿™ç§æƒ…å†µ" class="headerlink" title="ä¸€èˆ¬æœ‰ç”¨ä¸¤ç§æ–¹å¼æ¥å¤„ç†è¿™ç§æƒ…å†µ"></a><strong>ä¸€èˆ¬æœ‰ç”¨ä¸¤ç§æ–¹å¼æ¥å¤„ç†è¿™ç§æƒ…å†µ</strong></h3><h4 id="1ã€ä½¿ç”¨-mvc-resourcesçš„æ–¹å¼ï¼Œå°†é…ç½®æ·»åŠ åˆ°appContext-xmlæ–‡ä»¶ä¸­"><a href="#1ã€ä½¿ç”¨-mvc-resourcesçš„æ–¹å¼ï¼Œå°†é…ç½®æ·»åŠ åˆ°appContext-xmlæ–‡ä»¶ä¸­" class="headerlink" title="1ã€ä½¿ç”¨ mvc:resourcesçš„æ–¹å¼ï¼Œå°†é…ç½®æ·»åŠ åˆ°appContext-**.xmlæ–‡ä»¶ä¸­"></a>1ã€ä½¿ç”¨ mvc:resourcesçš„æ–¹å¼ï¼Œå°†é…ç½®æ·»åŠ åˆ°appContext-**.xmlæ–‡ä»¶ä¸­</h4><p>ä¾‹å¦‚ï¼š</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- å¯¹é™æ€èµ„æºæ–‡ä»¶çš„è®¿é—® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/**"</span> <span class="attr">location</span>=<span class="string">"/"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p> mappingæ˜¯urlæ˜ å°„å¤„ç†ï¼Œlocationæ˜¯ç›¸å¯¹äºWebContentçš„è·¯å¾„ã€‚</p>
<h4 id="2ã€-é…ç½®DispatcherServletå€¼æ‹¦æˆª-doçš„è¯·æ±‚ã€‚"><a href="#2ã€-é…ç½®DispatcherServletå€¼æ‹¦æˆª-doçš„è¯·æ±‚ã€‚" class="headerlink" title="2ã€ é…ç½®DispatcherServletå€¼æ‹¦æˆª.doçš„è¯·æ±‚ã€‚"></a>2ã€ é…ç½®DispatcherServletå€¼æ‹¦æˆª.doçš„è¯·æ±‚ã€‚</h4> <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:configure/spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>å•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</title>
    <url>/2018/09/07/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>  <img src="https://res.cloudinary.com/leon824/image/upload/v1536228571/arches-national-park-dark-dusk-33688_onguan.jpg" width="100%" height="100%"></p>
<h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼æ˜¯æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ï¼Œåˆ†ä¸ºä¸¤ç§ï¼šæ‡’æ±‰æ¨¡å¼ã€æ¶æ±‰æ¨¡å¼</p>
<h3 id="æ¶æ±‰æ¨¡å¼"><a href="#æ¶æ±‰æ¨¡å¼" class="headerlink" title="æ¶æ±‰æ¨¡å¼"></a>æ¶æ±‰æ¨¡å¼</h3><p>åœ¨å±æ€§ä¸­ç›´æ¥åˆ›å»ºå¯¹è±¡ï¼Œç„¶ååœ¨æ–¹æ³•ä¸­è¿”å›ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singletom</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singletom ourInstance = <span class="keyword">new</span> Singletom();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singletom <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ourInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singletom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œå› ä¸ºåŠ è½½ç±»çš„æ—¶å€™å°±ä¼šåˆ›å»º<code>Singletom</code>çš„å¯¹è±¡ï¼Œç„¶åæ‰€æœ‰çº¿ç¨‹æ¥è·å–çš„æ—¶å€™éƒ½æ˜¯è¿”å›è¿™ä¸ªå¯¹è±¡ã€‚</p>
<h3 id="æ‡’æ±‰æ¨¡å¼"><a href="#æ‡’æ±‰æ¨¡å¼" class="headerlink" title="æ‡’æ±‰æ¨¡å¼"></a>æ‡’æ±‰æ¨¡å¼</h3><p>åˆšå¼€å§‹å¹¶ä¸ç›´æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯åœ¨éœ€è¦çš„æ—¶å€™åœ¨åˆ›å»ºï¼Œä¸»è¦ä»£ç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OtherSingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> OtherSingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">OtherSingleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> OtherSingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">if</span> (instance == <span class="keyword">null</span>)&#123;      â€”â€”â€”â€”<span class="number">1</span></span><br><span class="line">                 instance = <span class="keyword">new</span> OtherSingleton(); â€”â€”â€”â€”â€”<span class="number">2</span></span><br><span class="line">                 <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå‡è®¾ä¸¤ä¸ªçº¿ç¨‹ä¸€å‰ä¸€åæ¥æ‰§è¡Œ<code>getInstance()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹<strong>A</strong>æ­£åœ¨æ‰§è¡Œ2è¿™ä¸ªä½ç½®ï¼Œç”±äº<code>new</code>å¯¹è±¡å¹¶éä¸€ä¸ª<strong>åŸå­æ“ä½œ</strong>ï¼Œåˆ†ä¸ºä»¥ä¸‹<strong>ä¸‰æ­¥</strong>ï¼š</p>
<ul>
<li>1) åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ã€‚</li>
<li>2) è°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡ã€‚</li>
<li>3ï¼‰å°†<code>instance</code>å¼•ç”¨æŒ‡å‘å †å†…å­˜ç©ºé—´çš„èµ·å§‹åœ°å€ï¼ˆæ­¤æ—¶<code>instance</code>æ‰ä¸ºé<code>null</code>ï¼‰ã€‚</li>
</ul>
<p>è‹¥å°†ä¸Šè¾¹ä¸‰æ­¥ç”¨ä¼ªä»£ç æ¥è¡¨ç¤ºå°±æ˜¯ä¸‹è¾¹è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">memory = allocate();  <span class="comment">//  1ã€åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</span></span><br><span class="line">ctorInstance(memory); <span class="comment">// 2ã€åˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line">instance = memoryï¼›  <span class="comment">//3ã€è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€</span></span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šåœ¨ä¸Šè¾¹çš„ä¼ªä»£ç ä¸­2å’Œ3ä¹‹é—´ï¼Œå¯èƒ½ä¼šè¢«é‡æ’åºï¼ˆåœ¨ä¸€äº›JITç¼–è¯‘å™¨ä¸Šï¼Œè¿™ç§é‡æ’åºä¹Ÿæ˜¯çœŸå®å‘ç”Ÿçš„ï¼‰ ï¼Œæ ¹æ®ã€Šjavaè¯­è¨€è§„èŒƒã€‹ï¼Œæ‰€æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œjavaç¨‹åºæ—¶å¿…é¡»éµå®ˆ<strong>intra-thread semantics</strong>,<strong>intra-thread semantics</strong>ä¿è¯æ’åºä¸ä¼šæ”¹å˜å•çº¿ç¨‹çš„æ‰§è¡Œç»“æœã€‚æ¢å¥è¯è¯´ï¼Œ<strong>intra-thread semantics</strong>å…è®¸é‚£äº›åœ¨å•çº¿ç¨‹ä¸­ä¸æ”¹å˜æ‰§è¡Œç»“æœçš„é‡æ’åºï¼Œè¿™æ ·ä¼šæé«˜ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™<strong>A</strong>çº¿ç¨‹æ‰§è¡Œåˆšåˆšæ‰æ‰§è¡Œåˆ°åˆ›å»ºå¯¹è±¡çš„<strong>ç¬¬äºŒæ­¥</strong>ï¼Œçº¿ç¨‹<strong>B</strong>å°±æ‰§è¡Œåˆ°ä»£ç <strong>1</strong>å¤„ï¼Œæ­¤æ—¶åˆ¤æ–­å‡º<code>instance</code>ä¸º<code>null</code>ï¼Œç„¶åè¿›å…¥å¯¹è±¡åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ è¿™ä¸ªæ—¶å€™å°±å‡ºç°é—®é¢˜äº†ï¼Œå•ä¾‹æ¨¡å¼æ­¤æ—¶åˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ã€‚è¿èƒŒäº†å•ä¾‹æ¨¡å¼çš„åˆè¡·ã€‚</p>
<h3 id="åŒé‡é”æ£€æŸ¥"><a href="#åŒé‡é”æ£€æŸ¥" class="headerlink" title="åŒé‡é”æ£€æŸ¥"></a>åŒé‡é”æ£€æŸ¥</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OtherSingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> OtherSingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">OtherSingleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> OtherSingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>)&#123;  â€”â€”â€”â€”<span class="number">1</span></span><br><span class="line">            <span class="keyword">synchronized</span> (OtherSingleton.class)&#123;</span><br><span class="line">             <span class="keyword">if</span> (instance == <span class="keyword">null</span>)&#123;    â€”â€”â€”â€”<span class="number">2</span></span><br><span class="line">                 instance = <span class="keyword">new</span> OtherSingleton();   â€”â€”â€”â€”<span class="number">3</span></span><br><span class="line">                 <span class="keyword">return</span> instance;</span><br><span class="line">             &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡ŒåŠ åŒé‡æ£€æŸ¥é”å°±æ˜¯åœ¨åŒæ­¥ä»£ç å‰å’ŒåŒæ­¥ä»£ç åè¾¹éƒ½æ£€æŸ¥å®ä¾‹æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä»…ä»…åœ¨åŒæ­¥å—å¤–è¾¹æ£€æŸ¥ï¼Œè€Œåœ¨åŒæ­¥å—å†…ä¸æ£€æŸ¥ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥äº†åŒæ­¥å—å¤–çš„ä»£ç ï¼Œåˆ™å¯èƒ½<strong>ç”Ÿæˆå¤šä¸ªå®ä¾‹</strong>ã€‚</p>
<p>ä¸Šè¾¹ä»£ç çœ‹èµ·æ¥è¿˜ä¸é”™ï¼Œä½†æ˜¯ä»–è¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚é—®é¢˜å‡ºç°åœ¨ä»£ç <strong>3</strong>å¤„ï¼Œè¿™ä¸ªåœ°æ–¹å¹¶éæ˜¯åŸå­æ“ä½œï¼Œå¦‚ä¸Šè¾¹çš„æè¿°åˆ†ä¸º<strong>ä¸‰æ­¥</strong>ã€‚ç”±äº<code>cpu</code>ä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡å¯èƒ½ä¼šå°†è¿™ä¸ªä¸‰æ­¥åˆ†ä¸º<strong>1-2-3</strong>æˆ–è€…<strong>1-3-2</strong>ã€‚</p>
<p>å¦‚æœçº¿ç¨‹<strong>A</strong>æ‰§è¡Œåˆ°ä»£ç <strong>3</strong>å¤„çš„<strong>1-3</strong>æ­¥ï¼Œæ­¤æ—¶<code>instance</code>å·²ç»ä¸ä¸º<code>null</code>äº†ï¼Œä½†æ˜¯åˆ›å»ºå¯¹è±¡çš„ç¬¬äºŒéƒ¨å´å¹¶æ²¡æœ‰æ‰§è¡Œã€‚è€Œæ­¤æ—¶çº¿ç¨‹<strong>B</strong>è¿›å…¥åˆ°æ–¹æ³•çš„<strong>1</strong>å¤„ï¼Œåˆ¤æ–­<code>instance</code>æ˜¯å¦ä¸ºç©ºï¼Œæ­¤æ—¶å·²ç»ä¸ä¼šç©ºäº†ï¼Œä½†æ˜¯è¿”å›çš„å¯¹è±¡å´å¹¶æ²¡æœ‰åˆå§‹åŒ–ï¼Œé¡ºç†æˆç« çš„æŠ¥é”™ã€‚ã€‚</p>
<p>è¿™é‡Œçš„å…³é”®æ˜¯<code>instance</code>å¯¹è±¡è¿˜æ²¡æœ‰åˆå§‹åŒ–æ‰§è¡Œ<strong>ç¬¬äºŒæ­¥</strong>ï¼Œå°±æ‰§è¡Œçš„<strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œå¯¼è‡´çº¿ç¨‹<strong>B</strong>æ‹¿åˆ°ä¸€ä¸ªç©ºçš„å¯¹è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è®©<code>cpu</code>åœ¨æ‰§è¡Œåˆ›å»ºå¯¹è±¡æ—¶ç¦æ­¢é‡æ’åºå°±èƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚<br>æ˜æ˜¾éœ€è¦ä½¿ç”¨<code>volatile</code>å…³é”®å­—æ¥ç¦æ­¢é‡æ’åºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OtherSingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> OtherSingleton instance;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">OtherSingleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> OtherSingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (OtherSingleton.class)&#123;</span><br><span class="line">             <span class="keyword">if</span> (instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">                 instance = <span class="keyword">new</span> OtherSingleton();</span><br><span class="line">                 <span class="keyword">return</span> instance;</span><br><span class="line">             &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåˆ©ç”¨çš„æ˜¯<code>volatile</code>çš„ç¦æ­¢é‡æ’åºçš„æ€§è´¨ï¼Œåœ¨<code>volatile</code>å˜é‡çš„èµ‹å€¼æ“ä½œåè¾¹ä¼šåŠ ä¸Šä¸€ä¸ªå†…å­˜å±éšœï¼Œ<strong>è¯»æ“ä½œ</strong>ä¸ä¼šå‡ºç°åœ¨å†…å­˜å±éšœå‰è¾¹ï¼Œæ‰€ä»¥<strong>å–æ“ä½œ*å¿…é¡»æ˜¯</strong>1-2-3<strong>æˆ–è€…</strong>1-3-2<strong>ä¹‹åï¼Œä¸å­˜åœ¨</strong>1-3**ä¹‹åå°±è¯»å–åˆ°ã€‚ä»<code>happen-before</code>åŸåˆ™æ¥çœ‹ï¼Œå°±æ˜¯å¯¹äºä¸€ä¸ª <code>volatile</code> å˜é‡çš„å†™æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼ˆè¿™é‡Œçš„â€œåé¢â€æ˜¯æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºï¼‰ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://wuchong.me/blog/2014/08/28/how-to-correctly-write-singleton-pattern/" target="_blank" rel="noopener">å¦‚ä½•æ­£ç¡®åœ°å†™å‡ºå•ä¾‹æ¨¡å¼</a></li>
<li>ã€Šjavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹</li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>å†å²çš„é€»è¾‘</title>
    <url>/2019/02/18/%E5%8E%86%E5%8F%B2%E7%9A%84%E9%80%BB%E8%BE%91/</url>
    <content><![CDATA[<h2 id="å†å²çš„é€»è¾‘"><a href="#å†å²çš„é€»è¾‘" class="headerlink" title=" å†å²çš„é€»è¾‘"></a><center> å†å²çš„é€»è¾‘</center></h2><h4 id="â€“-è¯»ã€Šæ™šæ¸…åˆ°æ°‘å›½ã€‹æœ‰æ„Ÿ"><a href="#â€“-è¯»ã€Šæ™šæ¸…åˆ°æ°‘å›½ã€‹æœ‰æ„Ÿ" class="headerlink" title="â€“ è¯»ã€Šæ™šæ¸…åˆ°æ°‘å›½ã€‹æœ‰æ„Ÿ"></a><p align="right">â€“ è¯»ã€Šæ™šæ¸…åˆ°æ°‘å›½ã€‹æœ‰æ„Ÿ</p></h4><p>&emsp;&emsp;ç»™è‡ªå·±å®šä¸‹äº†ä¸€ä¸ªç›®æ ‡â€”â€”æ¯è¯»å®Œä¸€æœ¬ä¹¦å°±è¦å†™ä¸€ç‚¹è¯»ä¹¦æ„Ÿæƒ³ï¼Œå¸Œæœ›ä»ä»Šå¤©å¼€å§‹åšæŒä¸‹æ¥ã€‚<br>    ä½™è®€æ­¤æ›¸ï¼Œçµ¦æˆ‘æœ€å¤§çš„æ„Ÿå—ä¾¿æ˜¯ï¼Œå­«æ–‡æ‰€è¬›çš„ï¼šâ€œå¤©ä¸‹å¤§å‹¢ï¼Œé †ä¹‹å‰‡æ˜Œï¼Œé€†ä¹‹å‰‡äº¡â€ã€‚å¾1840å¹´èµ·ï¼Œè·ä»Šå¿«180å¹´ï¼Œé€™å€‹éç¨‹ä»ç„¶æ²’æœ‰çµæŸã€‚ä¸‹é‚Šå°±å˜—è©¦è‡ªå·±ä¾†ç¸½çµä¸€ä¸‹æ•´å€‹éç¨‹ã€‚<br>&emsp;&emsp;æ²‰ç¡ä¸­çš„å¸åœ‹ç¬¬ä¸€æ¬¡è¢«æ•²é†’ï¼Œè¥¿æ–¹æ–‡æ˜å¾æ–‡è—å¾©èˆˆå•Ÿå‹•â€œä¸­å¤æ–‡åŒ–â€çš„ç¾ä»£åŒ–éç¨‹ï¼Œç¶“æ­·å¤§èˆªæµ·æ™‚ä»£ã€å·¥æ¥­é©å‘½ã€‚å·²ç¶“åœ¨æ”¿æ²»é«”åˆ¶ã€å·¥æ¥­ç”Ÿç”¢åŠ›ã€ç§‘å­¸æ–‡åŒ–å‰µæ–°ç­‰æ–¹æ–¹é¢é¢è¶…éæ±æ–¹çš„å¤è€æ–‡æ˜ã€‚å¾ä¸€å€‹å°ä¾‹å­ä¾¿èƒ½çœ‹å‡ºä¾†ã€‚ä¹¾éš†å¹´é–“ï¼Œè‹±åœ‹å…¬ä½¿ä»£è¡¨è‹±ç‹é€ä¾†ç•¶æ™‚è¥¿æ–¹æœ€å…ˆé€²çš„æ­¥æ§ã€ä»¥åŠå…¶ä»–ä»£è¡¨å½“æ—¶æœ€å…ˆè¿›ç§‘æŠ€çš„â€œè´¡å“â€ã€‚è€Œä¹¾éš†çš‡å¸å‰‡è¡¨ç¤ºï¼šæˆ‘å¤§å¤©æœå¯Œæœ‰å››æµ·ï¼Œè±ˆéœ€è¦è€Œå°åœ‹è²¨ç‰©å“‰ï¼Ÿç‰¹åˆ¥æ˜¯ç•¶åºšå­åœ‹è®Šä¹‹å¾Œï¼Œå…«åœ‹è¯è»é€²å…¥åŒ—äº¬ï¼Œç™¼ç¾ç•¶åˆé©¬æˆ›å°”å°¼ä½¿å›¢å½“åˆé€ç»™ä¹¾éš†çš‡å¸çš„æ­¥æªæ”¾åœ¨ä»“åº“ä¸­ç”šè‡³éƒ½æ²¡æœ‰æ‰“å¼€è¿‡ï¼Œé«˜å‚²ç„¡çŸ¥å¯è¦‹ä¸€æ–‘ã€‚<br>&emsp;&emsp;è‡³äºç¬¬ä¸€æ¬¡é¸¦ç‰‡æˆ˜äº‰ï¼Œç«™åœ¨ä»Šå¤©äººçš„è§’åº¦çœ‹ï¼Œå…¶ç»“æœä¸è¨€è‡ªæ˜ï¼Œä»¥ä¸€ä¸ªè½åçš„éç°ä»£åŒ–å›½å®¶å’Œä¸€ä¸ªå¼ºå¤§çš„è‹±å¸å›½ä½œæˆ˜ï¼Œå¤±è´¥æ˜¯æ¯«æ— ç–‘é—®çš„ã€‚ä½†æ˜¯å½“æ—¶çš„äººå¹¶æ²¡æœ‰æœºä¼šå¼€å¯â€œä¸Šå¸ä¹‹çœ¼â€ã€‚åœ¨å½“æ—¶é“å…‰çš‡å¸çœ‹ä¾†ï¼Œæˆ‘å¤©æœæ“æœ‰å››è¬è¬åœ‹æ°‘ï¼Œç„‰èƒ½è¼¸çµ¦é åœ¨è¬è£¡ä¹‹é™çš„æ’®å…’å°åœ‹ï¼Ÿå…’åªæœ‰æ—æ–‡å¿ å…¬â€”â€”ä¸­åœ‹è¿‘ä»£é–‹çœ¼çœ‹ä¸–ç•Œçš„ç¬¬ä¸€äººï¼Œåœ¨æˆ°çˆ­é–‹å§‹ä¹‹å¾Œï¼Œæ—å‰‡å¾å‰‡çŸ¥é“é€™æ˜¯ä¸€å ´ä¸å°ç¨±çš„æˆ°çˆ­ï¼Œå¤±æ•—æ˜¯æ²’æœ‰ç–‘å•çš„ï¼Œç„¶è€Œçš‡å¸å …æŒè¦æ‰“ï¼Œä¹Ÿæ˜¯æ¯«ç„¡è¾¦æ³•çš„äº‹æƒ…ã€‚è‡³æ–¼å…’æˆ°å¾Œæ‰€ç°½ç½²çš„ä¸­åœ‹è¿‘ä»£ç¬¬ä¸€å€‹â€œä¸å¹³ç­‰â€æ¢ç´„â€”â€”ã€Šå—äº¬æ¢ç´„ã€‹ï¼Œå¾ä»Šäººçš„è§’åº¦çœ‹ä¾†å¹¶éç‚ºä¸å¹³ç­‰æ¢ç´„ï¼Œæ¯”å¦‚é–‹æ”¾äº”å£é€šå•†ï¼Œæœ‰ä¸€é»ç¶“æ¿Ÿå­¸çŸ¥è­˜çš„äººéƒ½èƒ½å¤ çŸ¥é“ï¼Œç•¶å¸‚å ´è¦†è“‹è¶Šå¤§ï¼Œé‚Šè¶Šèƒ½å¤ ä¿ƒé€²ç”Ÿç”¢åŠ›çš„ç™¼å±•ï¼Œå°è³‡æºçš„å……åˆ†åˆ©ç”¨åŒæ¨£å¤§æœ‰è£¨ç›Šã€‚ç„¶è€Œç«™åœ¨ç•¶æ™‚çš„çµ±æ²»è€…è§’åº¦ï¼Œæˆ‘å¹¶ä¸é¡˜æ„å’Œä½ å€‘é€šå•†ï¼Œä½ å¼·è¿«æˆ‘ï¼Œé‚£å°±æ˜¯ä¸å¹³ç­‰ã€‚ æœ€çµ‚ï¼Œä¸ç®¡ä½ é¡˜æ„ä¸é¡˜æ„ï¼Œå€‘æ˜¯è¢«ä¸€å¹«å¤–ä¾†è€…ç ¸å‡ºäº†ä¸€å€‹å¤§å£å­ï¼Œå†ä¹Ÿä¸èƒ½ç¨å–„å…¶èº«äº†ã€‚<br>&emsp;&emsp;åœ¨ç¬¬äºŒæ¬¡é´‰ç‰‡æˆ°çˆ­ä¹‹å‰ï¼Œé‚„ç™¼ç”Ÿäº†è®“ä¸­åœ‹äººå£æ¸›å°‘ä¸Šå„„äººå£çš„å¤ªå¹³å¤©åœ‹é‹å‹•ï¼Œåœ¨ç‹æœçµ±æ²»çš„æœ«å¹´ï¼Œçµ±æ²»æ©Ÿå™¨å·²ç¶“è…æœ½ä¸å ªï¼Œå°åº•å±¤è€ç™¾å§“ç„¡æ³•å¯¦ç¾æœ‰æ•ˆçµ±æ²»ï¼Œç”šè‡³æœ‰ç½ä¸è³‘ï¼Œé‚£éº¼åº•å±¤è€ç™¾å§“ä¹Ÿå°±åªèƒ½é€ åäº†ã€‚ä½œè€…åœ¨æ›¸ä¸­è©³ç´°ä»‹ç´¹äº†æ´ªç§€å…¨æœ¬äººçš„ç”Ÿå¹³ï¼Œå’Œæ­·å²ä¸Šå¾ˆå¤šè¾²æ°‘èµ·ç¾©é¡ä¼¼ï¼Œåº•å±¤è¾²æ°‘èµ·ç¾©ç„¡éå°±æ˜¯ç‚ºäº†é‡‘å­ã€å¥³äººè€Œå·²ï¼Œä¸€æ—¦ç²å¾—äº†ä¸å—é™åˆ¶çš„æ¬Šåˆ©ï¼Œé‚£éº¼è€ç™¾å§“å°±è¦é­æ®ƒäº† ï¼ï¼ï¼<br>&emsp;&emsp;éš¨ä¹‹è€Œä¾†çš„å°±æ˜¯ç¬¬äºŒæ¬¡é´‰ç‰‡æˆ°çˆ­ï¼Œé€™æ¬¡è‹±æ³•è¯è»æ”»ç ´é¦–éƒ½â€”â€”åŒ—äº¬ï¼Œé€™ä¹Ÿæ˜¯è¿‘ä»£ç¬¬ä¸€æ¬¡å¤©æœç¬¬ä¸€æ¬¡é¦–éƒ½è¢«æ”»é™·ï¼Œå’¸è±çš‡å¸è·‘åˆ°æ‰¿å¾·é¿æš‘å±±èŠï¼Œè‹±æ³•è¯è»ç«ç‡’åœ“æ˜åœ’ï¼Œæ­¤ä¹ƒæ˜¯å¸åœ‹ä¸­é†«ä¾µç•¥ä¸­åœ‹çš„æœ€é‡è¦ç½ªè­‰ä¹‹ä¸€ï¼Œä»Šæ—¥æ¯å€‹ä¸­åœ‹äººæåˆ°æ­¤äº‹ä»ç„¶è¦å’¬ç‰™åˆ‡é½’çš„ç½µä¸Šå…©å¥ã€‚ä½†æ˜¯è¦çŸ¥é“ï¼Œåœ¨é€™æ¬¡æˆ°çˆ­ä¹‹å‰ï¼Œæ…ˆç¦§å¤ªåå°‡38åå¤–åœ‹ä½¿è‡£æ®ºé ­ã€å›šç¦åœ¨åœ“æ˜åœ’å…§ï¼Œè‡´ä½¿æœ€å¾Œåƒ…åƒ…åå¹¾ä½é‚„æ´»è‘—ï¼ŒåŠ ä¸Šç¬¬ä¸€æ¬¡é´‰ç‰‡æˆ°çˆ­æ‰€ç°½ç½²çš„ã€Šå—äº¬æ¢ç´„ã€‹ä¸­æ–¹ä¸€è‡´æ¨è«‰ï¼Œä¸å…è¨±å¤–åœ‹äººâ€œå…¥å¢ƒâ€ã€‚å¤šå€‹åŸå› ä¹‹ä¸‹ï¼Œç™¼ç”Ÿäº†ç¬¬äºŒæ¬¡é´‰ç‰‡æˆ°çˆ­ã€‚æ­¸æ ¹åˆ°åº•ï¼Œé‚„æ˜¯é€™å€‹é¾å¤§çš„å¸åœ‹æ²’æœ‰åˆ‡æ›æ€è·¯ï¼Œç„¶å¾Œæ˜¯ä¿ç•™è‘—å—å®³è€…å¿ƒæ…‹ã€ä¸­å­¸ç‚ºé«”è¥¿å­¸ç‚ºç”¨çš„ä¿å®ˆæ€æƒ³ï¼Œè¦çŸ¥é“æ—©åœ¨å¤§èˆªæµ·æ™‚ä»£å°±å·²ç¶“é€²è¡Œçš„å…¨çƒèåˆè±ˆæ˜¯ä½ å¤§æ¸…åœ‹èƒ½å¤ é˜»æ“‹çš„ï¼Ÿä¹Ÿè¨±åœ¨ç•¶æ™‚çš„çµ±æ²»è€…ä¾†èªªï¼Œæˆ‘å€‘ä¸¦æ²’æœ‰éŒ¯å•Šã€‚æ˜¯çš„ï¼Œé€™å°±æ˜¯å¤©ä¸‹å¤§å‹¢ï¼Œä¸æœƒä»¥å€‹äººã€åœ‹å®¶è€Œæ”¹è®Šã€‚<br>&emsp;&emsp;è¦èªªæ¸…ä»£æœ«å¹´æœ€é‡è¦çš„æˆ°çˆ­ï¼Œé™¤äº†ç¬¬ä¸€æ¬¡é´‰ç‰‡æˆ°çˆ­ï¼Œå¯èƒ½å°±æ˜¯ç”²åˆä¸­æ—¥æˆ°çˆ­äº†ã€‚é€™æ¬¡å’Œæˆ‘å€‘æ±é‚Šçš„è€é„°å±…ã€â€œæ’®å…’å°åœ‹â€â€”â€” æ—¥æœ¬çš„æˆ°çˆ­ã€‚å¹¾ä¹æ˜¯å°è‡´å¤§æ¸…å¸åœ‹è§£é«”æœ€é‡è¦çš„ä¸€æ“Šäº†ã€‚æœ¬ä¾†å·²ç¶“åœ¨ç¬¬äºŒæ¬¡é´‰ç‰‡æˆ°çˆ­ä¹‹å¾Œçš„ä¸‰åå¹´æœ‰ä¸­èˆˆä¹‹è±¡ï¼Œç„¶è€Œä¸€æˆ°æˆ³ç ´æ‰€æœ‰å¹»æƒ³ã€‚ä¸–ç•Œç¬¬å…«çš„æµ·è»è¼¸çµ¦ä¸–ç•Œåå››çš„æ—¥æœ¬ï¼Œæ‰€æœ‰çš„æ°‘æ—è‡ªå°Šå¿ƒè¢«æ“Šç¢ã€ç›´è‡³ä»Šæ—¥ä»æ˜¯å¦‚æ­¤ã€‚æ›¸ä¸­è®€åˆ°é€™æ®µæ­·å²çš„æ™‚å€™æ„Ÿæ…¨é —å¤šï¼Œä¸€å€‹åœ‹å®¶çš„â€œåœ‹é‹â€å¾€ä¸Šèµ°çš„æ™‚å€™ï¼ŒçœŸå¯¦ä¸€é †ç™¾é †ï¼›è‹¥æ˜¯â€œåœ‹é‹â€å¾€ä¸‹èµ°çš„æ™‚å€™ï¼Œä¾¿ä¸æ˜¯äººåŠ›æ‰€èƒ½æ”¹è®Šçš„äº†ã€‚æƒ³æƒ³ç•¶åˆæ—¥æœ¬äººç«‹å¿—æƒ³è¦æ‰“é€ æµ·è»ï¼Œä¸Šè¬æ—¥æœ¬å©¦å¥³å€‘ç‚ºäº†åœ‹å®¶ä¸‹å—æ´‹è³£æ·«ä¾†ç±Œé›†è»è²»ï¼Œè€Œæˆ‘å€‘çš„è€ä½›çˆºé‚„è¦æŒªç”¨ä¸Šåƒè¬çš„è»è²»ä¾†å»ºé€ è‡ªå·±é€€ä¼‘çš„åœ’å­â€”â€”é ¤å’Œåœ’ã€‚ä¹Ÿè¨±çœ‹åˆ°é€™è£¡ï¼Œä¹Ÿå°±ä¸éœ€è¦åœ¨å»é—œæ³¨æˆ°çˆ­æœ¬èº«çš„ç´°ç¯€äº†ï¼Œå‹è² å…¶å¯¦æ—©åœ¨æˆ°çˆ­ä¹‹å‰å°±å·²ç¶“è¨»å®šäº†ï¼Œç„¡éœ€å¤šè¨€ã€‚<br>&emsp;&emsp;æ™‚é‡æ’¥åˆ°1900å¹´ï¼Œä¹Ÿå°±æ˜¯åºšå­å¹´ã€‚é€™ä¸€æ¬¡å…«åœ‹è¯è»ä¾µè¯åˆæ˜¯ç”±æ–¼ç¾©å’Œåœ˜å°æ´‹äººçš„æ”»æ“Šè€Œç›´æ¥å°è‡´ã€‚åŠè©­çš„æ˜¯ï¼Œç¾©å’Œåœ˜ç”¢ç”Ÿçš„ä¸€å€‹é‡è¦åŸå› ä¾¿æ˜¯æ´‹äººåœ¨ä¸­åœ‹çš„ä½œå¨ä½œç¦ï¼Œå’Œåº•å±¤è€ç™¾å§“ç™¼ç”Ÿæ²–çªçš„æ™‚å€™åœ°æ–¹å®˜åºœæ ¹æœ¬å°æ´‹äººç„¡å¯å¥ˆä½•ï¼Œåƒè™§çš„åªèƒ½æ˜¯ä¸­åœ‹çš„è€ç™¾å§“ã€‚å›ä¸çŸ¥ï¼Œç•¶æ™‚ä¸€å€‹ä¸»æ•™å’Œä¸€æ–¹å¤§å“¡çš„å·¡æ’«ã€ç¸½ç£è™•æ–¼åŒä¸€ç´šåˆ¥ï¼ æ–¼æ˜¯ä¸€å¹«å«ç¾©å’Œæ‹³çš„ç¾¤é«”æ¼¸æ¼¸æˆé•·èµ·ä¾†ï¼Œä»–å€‘çš„å£è™Ÿæ˜¯â€œæ‰¶æ¸…æ»…æ´‹â€ã€‚ç•¶æ™‚çš„æ…ˆç¦§è€å¤ªå¤ªç•¶ç„¶ä¹ŸçŸ¥é“é€™å¹«äººä¸éæ˜¯è™›å¼µè²å‹¢çš„ä¸€å¹«çƒåˆä¹‹çœ¾ï¼Œä½†æ˜¯â€œå…¶å¿ƒå¯ç”¨â€ã€‚ ä½†æ˜¯çœŸæ­£è®“æ…ˆç¦§ä¸‹æ±ºå¿ƒå‘åä¸€åœ‹å®£æˆ°çš„çœŸæ­£åŸå› ä¹ƒæ˜¯â€œè”£å¹¹å·æ›¸â€ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€æ¢æ˜¯è®“æ…ˆç¦§é‚„æ”¿äºå…‰ç·’çš‡å¸ã€‚å›ä¸è¦‹ï¼Œç¨è£è€…æœ€æ€•çš„æ°¸é éƒ½æ˜¯å¤±å»æ¬Šåˆ©ï¼Œè€Œåœ‹å®¶çš„èˆˆäº¡ã€æ™®é€šè€ç™¾å§“çš„æ­»æ´»ä¸åœ¨å¥¹çš„è€ƒæ…®ç¯„åœå…§ï¼Œå¦‚æ­¤å²ä¸Šâ€œæœ€å‹‡æ•¢â€çš„è€å¤ªå¤ªä¾¿èª•ç”Ÿäº†ï¼Œä»¥å·²éä¹‹åŠ›ï¼Œå‘æ‰€æœ‰é‚¦äº¤åœ‹å®£æˆ°ï¼Œè¦çŸ¥é“æ‹¿ç ´å´™ã€å¸Œç‰¹å‹’ã€æ–¯å¤§æ—éƒ½æ²’é€™æ¨£â€œå‹‡æ•¢â€éã€‚çµæœä¹Ÿæ˜¯ä¸å‡ºæ„æ–™ï¼Œå¹¾è¬é›œç‰Œè¯è»åœ¨å¾ˆçŸ­çš„æ™‚é–“å…§é‚Šæ”»ç ´åŒ—äº¬ï¼Œå¸åœ‹çš„é¦–éƒ½ä¾¿å†ä¸€æ¬¡è¢«è¹‚èºªï¼Œé­æ®ƒçš„ç•¶ç„¶é‚„æ˜¯å¸éƒ½çš„è€ç™¾å§“ã€‚<br>&emsp;&emsp;è‡³æ–¼å¾Œé‚Šçš„è¾›äº¥é©å‘½å‰‡æ˜¯å£“æ­»é§±é§çš„æœ€å¾Œä¸€æ ¹ç¨»è‰ï¼Œæ„å‘³è‘—2000å¤šå¹´çš„å¸åœ‹çµ±æ²»çš„çµæŸã€‚ç„¶å¾Œå¾1912å¹´åˆ°ä»Šå¤©ï¼Œæ•´æ•´100å¤šå¹´éå»äº†ï¼Œæˆ‘å€‘çš„â€œä¸­å¤æ–‡åŒ–ç¾ä»£åŒ–â€å°±å®Œæˆäº†å—ï¼Ÿåœ¨å”å…ˆç”Ÿçš„è§€é»é–‹ä¾†ï¼Œå¤§æ¦‚è¦ç­‰åˆ°2040å¹´ï¼Œå…·é«”ç¬¬ä¸€æ¬¡é´‰ç‰‡æˆ°çˆ­200å¹´æ–¹èƒ½å®Œæˆã€‚é€™å€‹è§€é»åœ¨æˆ‘æœ‰é™çš„èªçŸ¥è£¡é‚Šæ˜¯è®šæˆçš„ï¼Œä»Šæ—¥ä¹‹ä¸­åœ‹çœ‹ä¼¼åŒ…è‘—ä¸€å€‹ç¾ä»£åŒ–åœ‹å®¶çš„å¤–è¡£ï¼Œéª¨å­é‡Œé‚„æ˜¯å¸ç‹çš„é‚£ä¸€å¥—ã€‚æ­£å¥½æ­¤æ™‚æ­¤åˆ»æ­£åœ¨å—ç¾æ´²-é˜¿æ ¹å»·å¬é–‹çš„G20å³°æœƒæ­£åœ¨èˆ‰è¡Œï¼Œæœ€é‡è¦çš„ä¸­ç¾å…ƒé¦–æœƒé¢ä¹Ÿå°‡åœ¨åå¹¾å€‹å°æ™‚ä¹‹å¾Œé€²è¡Œï¼Œé€™æ¬¡æœƒé¢ä¹Ÿè¨±æ˜¯ä¸€å€‹è½‰æŠ˜é»ï¼Œæ±ºå®šä¸­ç¾æ˜¯å¦èƒ½å¦ç·©å’Œé—œä¿‚ï¼Œé‚„æ˜¯ç¹¼çºŒå‡ç´šå°æŠ—ï¼Œé‚Šæ‹­ç›®ä»¥å¾…å§ã€‚<br>&emsp;&emsp;æ­·å²å¾ˆå¤šæ™‚å€™å°±æ˜¯â€œä¸è­˜å»¬å±±çœŸé¢ç›®ï¼Œåªç·£èº«åœ¨æ­¤å±±ä¸­â€ï¼Œä»Šæ—¥æ‰€ç™¼ç”Ÿçš„å¾ˆå¤šäº‹æƒ…ï¼Œæˆ‘å€‘æ²’æœ‰è¾¦æ³•å»è­‰å¯¦ã€å¼„æ˜ç™½èƒŒå¾ŒçœŸæ­£çš„ç·£ç”±ï¼Œå¥½åœ¨æ­·å²æœ‰å…¶è‡ªèº«çš„é‚è¼¯ï¼Œä»Šæ—¥ä¹‹äº‹æœƒåœ¨æœªä¾†æœ‰ä¸€å€‹æ¸…æ¥šçš„äº¤ä»£ã€‚<br>                   </p><p align="right">2018/12/1</p>  <p></p>
]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
  </entry>
  <entry>
    <title>å¦‚ä½•å°†github pagesæ˜ å°„åˆ°åŸŸåä¸Š</title>
    <url>/2018/03/17/%E5%A6%82%E4%BD%95%E5%B0%86github%20pages%E6%98%A0%E5%B0%84%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9F%9F%E5%90%8D/</url>
    <content><![CDATA[<blockquote>
<p>ä½¿ç”¨github pageså’Œhexoå¯ä»¥è½»æ¾æ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„åšå®¢ï¼Œä½†æ˜¯è¿™ä¸ªåšå®¢çš„åŸŸåæ˜¯ä¸€ä¸ª<strong>github.io</strong>ç»“å°¾çš„ã€‚çœ‹ç€ä¸çˆ½ï¼Œä¸‹é¢è®²ä¸€ä¸‹å…·ä½“çš„æ­¥éª¤ã€‚å…³äºå¦‚ä½•ä½¿ç”¨github pageså’Œhexoæ­å»ºåšå®¢ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚</p>
</blockquote>
<p><strong>å°†username.github.ioè§£æåˆ°è‡ªå·±çš„åŸŸåä¸Šï¼Œé¦–å…ˆéœ€è¦å°†åŸŸåè§£æåˆ°github pagesçš„ipä¸Šï¼Œç„¶ååœ¨githubçš„settingsä¸­æ·»åŠ ä¸€ä¸ªCNAMEæ–‡ä»¶ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹</strong></p>
<h3 id="æ³¨å†ŒåŸŸå"><a href="#æ³¨å†ŒåŸŸå" class="headerlink" title="æ³¨å†ŒåŸŸå"></a>æ³¨å†ŒåŸŸå</h3><p>å¯ä»¥å»è…¾è®¯äº‘ä¸Šè¾¹ä¹°ä¸€ä¸ªåŸŸåï¼Œä¾¿å®œç‚¹çš„å°±è¡Œã€‚</p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1521195447/github1_l9ffvx.png" width="100%" height="100%"></p>
<h3 id="è§£æåŸŸå"><a href="#è§£æåŸŸå" class="headerlink" title="è§£æåŸŸå"></a>è§£æåŸŸå</h3><p>åŸŸåå…¶å®å°±æ˜¯ä¸€ä¸ªipçš„é‡å‘½åè€Œå·²ï¼Œæ‰€ä»¥è§£æå°±ç›¸å½“äºå°†åŸŸåç»‘å®šåˆ°ä¸€ä¸ªipï¼Œé‚£ä¹ˆä»¥åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ç”¨åŸŸåæ¥è®¿é—®é‚£ä¸ªipå¯¹åº”çš„æœåŠ¡å™¨çš„æœåŠ¡ã€‚</p>
<p>è¿™é‡Œç›´æ¥ä½¿ç”¨è…¾è®¯æä¾›çš„å¿«é€Ÿè§£ææ–¹æ³•,å°†githubæä¾›çš„ä¸¤ä¸ªipä¸­çš„ä¸€ä¸ªåŠ å…¥å°±è¡Œ</p>
<ul>
<li>192.30.252.153</li>
<li>192.30.252.154</li>
</ul>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1521195771/github2_wtaleu.png" width="100%" height="100%"></p>
<h3 id="åˆ›å»ºCNAMEæ–‡ä»¶"><a href="#åˆ›å»ºCNAMEæ–‡ä»¶" class="headerlink" title="åˆ›å»ºCNAMEæ–‡ä»¶"></a>åˆ›å»ºCNAMEæ–‡ä»¶</h3><p>  æˆ‘ä»¬æ‰“å¼€åœ¨githubä¸­çš„åšå®¢ç›®å½•ä¸­çš„<code>settings</code>ï¼Œå¡«å…¥è‡ªå·±çš„åŸŸåï¼Œç„¶å<code>save</code>ã€‚å°±å¯ä»¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­çœ‹åˆ°ä¸€ä¸ª<code>CNAME</code>çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å°±å·²ç»å¡«å…¥äº†æˆ‘ä»¬çš„åŸŸåï¼Œä½†æ˜¯å½“æˆ‘ä»¬é‡æ–°å‘å¸ƒä¹‹åè¿™ä¸ª<code>CNAME</code>æ–‡ä»¶ä¼šè¢«è¦†ç›–ï¼Œæ‰€ä»¥éœ€è¦<code>source</code>ç›®å½•ä¸‹åˆ›å»ºåŒæ ·çš„ä¸€ä¸ª<code>CNAME</code>çš„æ–‡ä»¶ã€‚</p>
<p>  <img src="http://res.cloudinary.com/leon824/image/upload/v1521270864/github3_nqeg25.png" width="100%" height="100%"></p>
<p>æœ€åè®¿é—®è‡ªå·±çš„åŸŸåï¼Œå°±èƒ½ç›´æ¥è®¿é—®åˆ°åšå®¢äº†ã€‚</p>
]]></content>
      <categories>
        <category>åšå®¢</category>
      </categories>
  </entry>
  <entry>
    <title>å¦‚ä½•è§£å†³â€œéWeChatå®˜æ–¹ç½‘é¡µï¼Œç»§ç»­è®¿é—®å°†è½¬æ¢æˆ.....â€çš„é—®é¢˜</title>
    <url>/2017/10/18/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E2%80%9C%E9%9D%9EWeChat%E5%AE%98%E6%96%B9%E7%BD%91%E9%A1%B5%EF%BC%8C%E7%BB%A7%E7%BB%AD%E8%AE%BF%E9%97%AE%E5%B0%86%E8%BD%AC%E6%8D%A2%E6%88%90......%E2%80%9D%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<blockquote>
<p>æˆ‘ä»¬åœ¨å¼€å‘å¾®ä¿¡å…¬ä¼—å·æ—¶ï¼Œä½¿ç”¨ç½‘é¡µå·¥å…·ç”Ÿæˆè‡ªå®šä¹‰èœå•ï¼Œå…³è”åˆ°æŸä¸€ä¸ªç½‘ç«™ï¼Œå½“æˆ‘ä»¬è®¿é—®è¿™ä¸ªç½‘é¡µçš„æ—¶å€™å°±ä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š</p>
</blockquote>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1508378939/wechat_jrovnj.png" width="60%" height="60%"></p>
<h4 id="è¦è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š"><a href="#è¦è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š" class="headerlink" title="è¦è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š"></a><strong>è¦è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</strong></h4><p>  1ã€ç™»å½•å¾®ä¿¡å…¬ä¼—å·ï¼Œè¿›å…¥å…¬ä¼—å·è®¾ç½® â€“&gt; åŠŸèƒ½è®¾ç½®ï¼Œè¿›å…¥åˆ°ä¸‹é¢çš„é¡µé¢ä¸­ï¼Œç„¶åç‚¹å‡»è®¾ç½®ã€‚</p>
<p> <img src="http://res.cloudinary.com/leon824/image/upload/v1508337927/WX20171018-224506_2x_vuyytg.png" width="100%" height="100%"></p>
<p>  ç„¶åæœ€ç»ˆè¿›å…¥åˆ°è®¾ç½®çš„é¡µé¢ã€‚æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šï¼ˆ1ï¼‰é¦–å…ˆè¦ç¡®ä¿è®¾ç½®çš„åŸŸåå¿…é¡»æ˜¯å¤‡è¿‡æ¡ˆçš„ã€‚ï¼ˆ2ï¼‰åŒæ—¶è¿˜éœ€è¦ä¸‹è½½MP_verify_zvHGyljL5rHLDOB1.txtæ–‡ä»¶åˆ°èƒ½å¤Ÿè®¿é—®çš„ç›®å½•ã€‚</p>
<p>   <img src="http://res.cloudinary.com/leon824/image/upload/v1508337467/WX20171018-223644_2x_ejzxrr.png" width="100%" height="100%"></p>
<p>  å‡è®¾æ˜¯java webçš„é¡¹ç›®ï¼Œå¤‡æ¡ˆçš„urlå¯ä»¥å…·ä½“åˆ°è®¿é—®çš„é¦–é¡µç›®å½•ï¼ˆWebContentç›®å½•ä¸‹ï¼‰ï¼Œé‚£ä¹ˆä¹Ÿå°±å¯ä»¥å°†MP_verify_zvHGyljL5rHLDOB1.txtæ–‡ä»¶æ”¾ç½®åˆ°WebContentç›®å½•ä¸‹ã€‚<br>  é€šè¿‡ä»¥ä¸Šçš„è®¾ç½®ï¼Œè¿‡ä¸€æ®µæ—¶é—´ç”Ÿæ•ˆä¹‹åï¼Œå°±ä¸ä¼šåœ¨å‡ºç°å®‰å…¨æç¤ºäº†ã€‚</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ</title>
    <url>/2018/01/14/%E5%AE%8C%E6%95%B4%E6%8F%8F%E8%BF%B0%E4%B8%80%E6%AC%A1URL%E8%AE%BF%E9%97%AE%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E5%88%B0%E5%BA%95%E9%83%BD%E7%BB%8F%E5%8E%86%E4%BA%86%E4%BA%9B%E4%BB%80%E4%B9%88/</url>
    <content><![CDATA[<h1 id="ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ"><a href="#ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ" class="headerlink" title="ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ"></a>ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ</h1><blockquote>
<p>&emsp;&emsp;å¹³æ—¶æˆ‘ä»¬æ€»æ˜¯ä¹ æƒ¯äº†è¾“å…¥ä¸€ä¸ªç½‘å€ï¼Œç„¶åå°±é™é™çš„ç­‰å¾…ç€å„ç§æ¼‚äº®çš„ç½‘é¡µå±•ç¤ºåœ¨æˆ‘ä»¬çš„é¢å‰ï¼Œä½†æ˜¯å¯èƒ½å¤§å¤šæ•°äººéƒ½æ²¡æœ‰å…³æ³¨è¿™å…¶ä¸­éƒ½ç»å†äº†å“ªäº›ä»€ä¹ˆã€‚ä¸‹é¢å¤§è‡´åšä¸€ä¸ªæ€»ç»“ã€‚</p>
</blockquote>
<h2 id="ä¸€ã€é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹OSIä¸ƒå±‚æ¨¡å‹ï¼š"><a href="#ä¸€ã€é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹OSIä¸ƒå±‚æ¨¡å‹ï¼š" class="headerlink" title="ä¸€ã€é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹OSIä¸ƒå±‚æ¨¡å‹ï¼š"></a>ä¸€ã€é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹OSIä¸ƒå±‚æ¨¡å‹ï¼š</h2><blockquote>
<p>&emsp;&emsp;å¼€æ”¾å¼ç³»ç»Ÿäº’è”é€šä¿¡å‚è€ƒæ¨¡å‹ï¼ˆè‹±è¯­ï¼šOpen System Interconnection Reference Modelï¼Œç¼©å†™ä¸º OSIï¼‰ï¼Œç®€ç§°ä¸ºOSIæ¨¡å‹ï¼ˆOSI modelï¼‰ï¼Œä¸€ç§æ¦‚å¿µæ¨¡å‹ï¼Œç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰æå‡ºï¼Œä¸€ä¸ªè¯•å›¾ä½¿å„ç§è®¡ç®—æœºåœ¨ä¸–ç•ŒèŒƒå›´å†…äº’è¿ä¸ºç½‘ç»œçš„æ ‡å‡†æ¡†æ¶ã€‚</p>
</blockquote>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1516269244/20180118-2_fqphi5.png" alt></p>
<p>å…¶ä¸­å„å±‚çš„è¯¦ç»†å†…å®¹å¤§å®¶å¯ä»¥å‚è€ƒ<a href="https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p>
<ul>
<li>OSIæ˜¯ä¸€ä¸ªç†æƒ³çš„åˆ†å±‚æ¨¡å‹ï¼Œå¾ˆå°‘æœ‰å®Œå…¨éµå®ˆè¿™æ ·çš„åˆ†å±‚ï¼Œåªä¼šä½¿ç”¨å…¶ä¸­çš„å‡ å±‚è€Œå·²ã€‚</li>
</ul>
<h2 id="äºŒã€ä»è®¿é—®googleè¯´èµ·"><a href="#äºŒã€ä»è®¿é—®googleè¯´èµ·" class="headerlink" title="äºŒã€ä»è®¿é—®googleè¯´èµ·"></a>äºŒã€ä»è®¿é—®googleè¯´èµ·</h2><p><em>è¿™é‡Œå°±ä¸è®¨è®ºæˆ‘ä»¬ä¼Ÿå¤§çš„é˜²ç«é•¿åŸäº†ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œè¿™æ˜¯åŸºæœ¬æŠ€èƒ½</em></p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1516268792/20180118-1_lxqlaf.png" alt></p>
<p>å½“ä½ å•å‡»å›è½¦é”®ï¼Œå°±æ„å‘³ç€ä½ éœ€è¦å‘googleçš„æœåŠ¡å™¨å‘é€ä¸€æ¬¡ç½‘é¡µè¯·æ±‚çš„æ•°æ®åŒ…ã€‚ä¸‹é¢ä»æ¶‰åŠåˆ°çš„åè®®æˆ–è€…æœåŠ¡è¯´èµ·ã€‚</p>
<h4 id="1ã€DNSåè®®"><a href="#1ã€DNSåè®®" class="headerlink" title="1ã€DNSåè®®"></a>1ã€DNSåè®®</h4><p>&emsp;&emsp;å½“æˆ‘ä»¬è¦è®¿é—®<a href="https://www.google.co.jp/æ—¶ï¼Œå¿…é¡»è¦çŸ¥é“ipåœ°å€ï¼Œä½†è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¹¶ä¸çŸ¥é“ipæ˜¯å¤šå°‘ã€‚DNSæœåŠ¡å°±å¯ä»¥å¸®æˆ‘ä»¬é€šè¿‡åŸŸåæ‰¾åˆ°ipåœ°å€ã€‚å®ƒæ˜¯ä¸€ä¸ªå­˜å‚¨ç€ipå’ŒåŸŸåæ˜ å°„çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚GFWå…¶ä¸­å°±æœ‰é€šè¿‡dnsæ±¡æŸ“å’ŒdnsåŠ«æŒçš„æ–¹å¼ä½¿å¾—æˆ‘ä»¬æ— æ³•è®¿é—®åˆ°å›½å¤–çš„æŸäº›â€œfdâ€ç½‘ç«™ã€‚" target="_blank" rel="noopener">https://www.google.co.jp/æ—¶ï¼Œå¿…é¡»è¦çŸ¥é“ipåœ°å€ï¼Œä½†è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¹¶ä¸çŸ¥é“ipæ˜¯å¤šå°‘ã€‚DNSæœåŠ¡å°±å¯ä»¥å¸®æˆ‘ä»¬é€šè¿‡åŸŸåæ‰¾åˆ°ipåœ°å€ã€‚å®ƒæ˜¯ä¸€ä¸ªå­˜å‚¨ç€ipå’ŒåŸŸåæ˜ å°„çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚GFWå…¶ä¸­å°±æœ‰é€šè¿‡dnsæ±¡æŸ“å’ŒdnsåŠ«æŒçš„æ–¹å¼ä½¿å¾—æˆ‘ä»¬æ— æ³•è®¿é—®åˆ°å›½å¤–çš„æŸäº›â€œfdâ€ç½‘ç«™ã€‚</a></p>
<p>  è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œipå’ŒåŸŸåå¹¶éä¸€å¯¹ä¸€çš„å…³ç³»ã€‚è€Œæ˜¯å¤šå¯¹å¤šï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªipå¯ä»¥ç»‘å®šå¤šä¸ªåŸŸåï¼Œä¸€ä¸ªåŸŸåä¹Ÿå¯ä»¥ç»‘å®šå¤šä¸ªipï¼Œä½†åŒä¸€æ—¶åˆ»åªèƒ½æ˜¯ä¸€å¯¹ä¸€çš„ã€‚</p>
<p>okï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†ipåœ°å€ã€‚</p>
<h4 id="2ã€-å­ç½‘æ©ç "><a href="#2ã€-å­ç½‘æ©ç " class="headerlink" title="2ã€ å­ç½‘æ©ç "></a>2ã€ å­ç½‘æ©ç </h4><p> &emsp;&emsp;å…¨ä¸–ç•Œè¿™ä¹ˆå¤šè®¡ç®—æœºï¼Œå½“ç„¶ä¸å¯èƒ½éƒ½åœ¨åŒä¸€ä¸ªå­ç½‘é‡Œã€‚é‚£è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç¡®è®¤googleæœåŠ¡å™¨å’Œæˆ‘ä»¬æœ¬æœºæ˜¯å¦åœ¨åœ¨åŒä¸€ä¸ªå­ç½‘é‡Œï¼Œè¿™é‡Œç”¨åˆ°äº†å­ç½‘æ©ç ã€‚</p>
<p> &emsp;&emsp;å­ç½‘æ©ç å’Œipåœ°å€ä¸€æ ·ï¼Œéƒ½æ˜¯32ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œé€šå¸¸ç”¨4æ®µå¼è¡¨ç¤ºï¼Œç½‘ç»œä½å…¨ä¸º1ï¼Œä¸»æœºä½å…¨ä¸º0ã€‚å°†æˆ‘ä»¬çš„ç›®æ ‡åœ°å€å’Œæœ¬æœºåœ°å€åˆ†åˆ«ä¸å­ç½‘æ©ç æŒ‰ä½åšandæ“ä½œã€‚å¦‚æœæœ€ç»ˆç»“æœç›¸åŒé‚£ä¹ˆåœ¨åŒä¸€å­ç½‘ä¸­ã€‚ä¸éœ€è¦å°†æ•°æ®åŒ…è½¬å‘åˆ°ç½‘å…³ã€‚å¦åˆ™ï¼Œå°†æ•°æ®åŒ…è½¬å‘åˆ°ç½‘å…³å¤„ç†ã€‚</p>
<p> ä¾‹å¦‚ï¼š</p>
<ul>
<li>DNS: 255.255.255.0</li>
<li>ä¸»æœºipï¼š10.20.0.121</li>
<li><p>googleï¼š216.239.34.10</p>
<p>æ˜æ˜¾ä¸åœ¨åŒä¸€ä¸ªå­ç½‘ä¸­</p>
</li>
</ul>
<h4 id="3ã€http-httpsåè®®"><a href="#3ã€http-httpsåè®®" class="headerlink" title="3ã€http/httpsåè®®"></a>3ã€http/httpsåè®®</h4><p>æµè§ˆå™¨è®¿é—®ç½‘é¡µä½¿ç”¨çš„æ˜¯httpåè®®ï¼Œåœ¨OSIåè®®ä¸­å±äºåº”ç”¨å±‚åè®®ã€‚<br> httpè¯·æ±‚çš„æŠ¥æ–‡æ ¼å¼ï¼š å¤´éƒ¨ï¼ˆrequest line + headerï¼‰ + æ•°æ®ï¼ˆdataï¼‰</p>
<p>å…¶ä¸­çš„è¯·æ±‚è¡Œï¼ˆrequest lineï¼‰åŒ…æ‹¬è¯·æ±‚æ–¹æ³•å­—æ®µã€URLå­—æ®µå’ŒHTTPåè®®çš„ç‰ˆæœ¬ä¸‰ä¸ªå­—æ®µç»„æˆ</p>
<p> GET/index.html HTTP/1.1<br> ç›®å‰å¤§å¤šæ•°HTTPè¯·æ±‚ä½¿ç”¨çš„æ˜¯é•¿è¿æ¥ï¼ˆHTTP/1.1é»˜è®¤keep-aliveä¸ºtrueï¼‰ï¼Œè€Œé•¿è¿æ¥æ„å‘³ç€ï¼Œä¸€ä¸ªTCPçš„socketåœ¨å½“å‰è¯·æ±‚ç»“æŸåï¼Œå¦‚æœæ²¡æœ‰æ–°çš„è¯·æ±‚åˆ°æ¥ï¼Œsocketä¸ä¼šç«‹é©¬é‡Šæ”¾ï¼Œè€Œæ˜¯ç­‰timeoutåå†é‡Šæ”¾ã€‚</p>
<p> è¯·æ±‚æ–¹æ³•å­—æ®µæœ‰ï¼šGETã€POSTã€HEADã€PUTã€DELETEã€TRACE, è¿™äº›å­—æ®µåœ¨REST fulé£æ ¼ä¸­èƒ½å¤Ÿè¢«å……åˆ†åˆ©ç”¨ï¼Œè€Œä¸åœ¨ä½¿ç”¨URLæ¥è¡¨è¾¾ç›®çš„åŠ¨ä½œã€‚</p>
<p>  <img src="http://res.cloudinary.com/leon824/image/upload/v1516271797/20180128-3_fntrcj.png" width="40%" height="40%"></p>
<p> ç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">alt-svc:hq=":443"; ma=2592000; quic=51303431; quic=51303339; quic=51303338; quic=51303337; quic=51303335,quic=":443"; ma=2592000; v="41,39,38,37,35"</span><br><span class="line">cache-control:private, max-age=0</span><br><span class="line"><span class="attribute">content-encoding:br</span></span><br><span class="line">content-type:text/html; charset=UTF-8</span><br><span class="line">date:Thu, 18 Jan 2018 10:37:50 GMT</span><br><span class="line"><span class="attribute">expires:-1</span></span><br><span class="line">p3p:CP="This is not a P3P policy! See g.co/p3phelp for more info."</span><br><span class="line"><span class="attribute">server:gws</span></span><br><span class="line">set-cookie:1P_JAR=2018-01-18-10; expires=Sat, 17-Feb-2018 10:37:50 GMT; path=/; domain=.google.co.jp</span><br><span class="line">set-cookie:NID=*, 20-Jul-2018 10:37:50 GMT; path=/; domain=.google.co.jp; HttpOnly</span><br><span class="line"><span class="attribute">status:200</span></span><br><span class="line">strict-transport-security:max-age=3600</span><br><span class="line"><span class="attribute">x-frame-options:SAMEORIGIN</span></span><br><span class="line">x-xss-protection:1; mode=block</span><br><span class="line">Request Headers</span><br></pre></td></tr></table></figure>
<h4 id="4ã€tcpã€udpåè®®"><a href="#4ã€tcpã€udpåè®®" class="headerlink" title="4ã€tcpã€udpåè®®"></a>4ã€tcpã€udpåè®®</h4><p> tcpåè®®æ˜¯è¾“å…¥ä¼ è¾“å±‚çš„åè®®ï¼Œä¸»è¦ä½œç”¨æ˜¯å»ºç«‹ç«¯å£åˆ°ç«¯å£çš„é€šä¿¡ï¼ŒåŒæ—¶ä¿è¯æ•°æ®çš„æ­£ç¡®ä¼ è¾“å’Œå·®é”™å¤„ç†ã€‚</p>
<p> åŒæ—¶å’ŒtcpåŒå‡ºäºä¼ è¾“å±‚åè®®çš„è¿˜æœ‰udpï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ï¼Œè¿™ä¸ªåè®®æ¯”è¾ƒç®€å•ï¼Œä¸ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œæ•°æ®ä¸€æ—¦å‘å‡ºæ— æ³•çŸ¥é“å¯¹æ–¹æ˜¯å¦æ”¶åˆ°ã€‚ä½†æ˜¯ä¼˜ç‚¹æ˜¯è¿‡ç¨‹ç®€å•ï¼ŒèŠ‚çœèµ„æºã€‚</p>
<p> æ— è®ºæ˜¯tcpè¿˜æ˜¯udpåè®®ï¼Œhttpçš„æ•°æ®åŒ…éƒ½æ˜¯åŠ å…¥åˆ°ä»–ä»¬çš„æ•°æ®æ®µä¸­ã€‚</p>
<p>   <img src="http://res.cloudinary.com/leon824/image/upload/v1516273282/20180118-4_zzq5ot.png" width="50%" height="80%"></p>
<p><strong>ä¸‰æ¬¡æ¡æ‰‹é—®é¢˜ï¼š</strong>æ‰€è°“ä¸‰æ¬¡æ¡æ‰‹ï¼ˆThree-Way Handshakeï¼‰å³å»ºç«‹TCPè¿æ¥ï¼Œå°±æ˜¯æŒ‡å»ºç«‹ä¸€ä¸ªTCPè¿æ¥æ—¶ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ€»å…±å‘é€3ä¸ªåŒ…ä»¥ç¡®è®¤è¿æ¥çš„å»ºç«‹ã€‚åœ¨socketç¼–ç¨‹ä¸­ï¼Œè¿™ä¸€è¿‡ç¨‹ç”±å®¢æˆ·ç«¯æ‰§è¡Œconnectæ¥è§¦å‘ã€‚</p>
<p>  <img src="http://res.cloudinary.com/leon824/image/upload/v1516273442/20180118-5_kmqhvo.png" width="80%" height="80%"></p>
<p> ï¼ˆ1ï¼‰ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClientå°†æ ‡å¿—ä½SYNç½®ä¸º1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=Jï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒClientè¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…Serverç¡®è®¤ã€‚</p>
<p>ï¼ˆ2ï¼‰ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šServeræ”¶åˆ°æ•°æ®åŒ…åç”±æ ‡å¿—ä½SYN=1çŸ¥é“Clientè¯·æ±‚å»ºç«‹è¿æ¥ï¼ŒServerå°†æ ‡å¿—ä½SYNå’ŒACKéƒ½ç½®ä¸º1ï¼Œack=J+1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=Kï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Clientä»¥ç¡®è®¤è¿æ¥è¯·æ±‚ï¼ŒServerè¿›å…¥SYN_RCVDçŠ¶æ€ã€‚</p>
<p>ï¼ˆ3ï¼‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClientæ”¶åˆ°ç¡®è®¤åï¼Œæ£€æŸ¥ackæ˜¯å¦ä¸ºJ+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­£ç¡®åˆ™å°†æ ‡å¿—ä½ACKç½®ä¸º1ï¼Œack=K+1ï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒServeræ£€æŸ¥ackæ˜¯å¦ä¸ºK+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­£ç¡®åˆ™è¿æ¥å»ºç«‹æˆåŠŸï¼ŒClientå’ŒServerè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼ŒéšåClientä¸Serverä¹‹é—´å¯ä»¥å¼€å§‹ä¼ è¾“æ•°æ®äº†ã€‚</p>
<p>ç™½è¯ä¸€ç‚¹å°±æ˜¯ï¼š</p>
<ul>
<li>ä¸»æœºï¼š ä½ å¥½ï¼Œæˆ‘æƒ³è®¤è¯†ä½ </li>
<li>æœåŠ¡å™¨ï¼šå¥½çš„ï¼Œæˆ‘ä¹Ÿæƒ³è®¤è¯†ä½ </li>
<li>ä¸»æœºï¼šå¾ˆé«˜å…´è®¤è¯†ä½ </li>
</ul>
<p>é‚£ä¸ºä»€ä¹ˆä¸€å®šè¦ä¸‰æ¬¡æ¡æ‰‹è€Œä¸æ˜¯ä¸¤æ¬¡å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å‡è®¾æœ‰ä¸‹é¢çš„è¿™ç§æƒ…å†µï¼š</p>
<blockquote>
<p>&emsp;&emsp;å½“å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯ç”±äºæ­¤æ—¶ç½‘ç»œæ‹¥å¡è¿™ä¸ªåŒ…æš‚æ—¶æ²¡æœ‰åˆ°è¾¾æœåŠ¡å™¨ï¼Œ å®¢æˆ·ç«¯ç­‰å¾…è¶…æ—¶ä¹‹ååˆé‡æ–°å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ­¤æ—¶æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°äº†ï¼Œå¹¶æ­£ç¡®åº”ç­”ï¼ŒåŒæ–¹å¼€å§‹é€šä¿¡ï¼Œé€šä¿¡ç»“æŸåé‡Šæ”¾socketè¿æ¥ã€‚<br>ä½†è¿™ä¸ªæ—¶å€™ï¼Œé‚£ä¸ªè¢«æ‹¥å¡çš„è¿æ¥æ­¤æ—¶åˆ°è¾¾äº†æœåŠ¡å™¨ï¼Œå¦‚ä½•tcpæ˜¯é‡‡ç”¨ä¸¤æ¬¡æ¡æ‰‹çš„æ–¹å¼ï¼Œé‚£ä¹ˆæ­¤æ—¶æœåŠ¡å™¨ä»¥ä¸ºå®¢æˆ·ç«¯åˆå‘èµ·äº†ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œç„¶åè¿”å›ç¡®è®¤è¯·æ±‚ï¼Œæ­¤æ—¶è¿æ¥å°±å·²ç»å»ºç«‹å¥½äº†ã€‚æœåŠ¡å™¨çŠ¶æ€ä¸ºESTABLISHEDï¼Œç­‰å¾…ç€å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œä½†ç”±äºæ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥äº†closeçŠ¶æ€ï¼Œå°†å¯¼è‡´æœåŠ¡å™¨ç­‰å¾…ä¸‹å»ï¼Œæµªè´¹èµ„æºã€‚</p>
</blockquote>
<p><strong>å››æ¬¡æŒ¥æ‰‹ï¼š</strong><br> é¦–å…ˆéœ€è¦çŸ¥é“çš„æ˜¯tcpæ˜¯å…¨åŒå·¥é€šä¿¡çš„ï¼Œé‚£ä¹ˆå…³é—­å°±åªèƒ½ä¸€ä¸ªä¸€ä¸ªå…³é—­ã€‚<br> å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€è¦å…³é—­socketæ—¶ï¼ˆsocketç¿»è¯‘æˆå¥—æ¥å­—å¹¶ä¸æ°å½“ï¼ŒæŠŠå®ƒå½“åšâ€œæ’åº§â€ä¹Ÿè®¸æ›´å®¹æ˜“ç†è§£ï¼‰ï¼Œå…·ä½“çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p> <img src="http://res.cloudinary.com/leon824/image/upload/v1516285581/20180118-6_rvpdmv.png" width="80%" height="80%"></p>
<ul>
<li>å‡è®¾è¿™ä¸ªæ—¶å€™clientå‘èµ·è¯·æ±‚ä¸­æ–­çš„è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å‘é€FinæŠ¥æ–‡ï¼Œå‘Šè¯‰serverï¼šâ€œæˆ‘æ²¡æœ‰æ•°æ®å‘ç»™ä½ äº†ï¼Œä½†å¦‚æœä½ è¿˜æœ‰æ•°æ®è¦å‘ç»™æˆ‘ï¼Œé‚£å°±å…ˆä¸ç”¨å…³é—­socketï¼Œå‘é€å®Œæ¯•åœ¨å‘Šè¯‰æˆ‘â€ï¼Œæ­¤æ—¶clientå¤„äºFIN_WAIT1ã€‚</li>
<li>å½“serveræ¥æ”¶åˆ°äº†ä¹‹åå‘é€ackç»™clientï¼šâ€œä½ çš„è¯·æ±‚æˆ‘æ”¶åˆ°äº†ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¯·ç»§ç»­ç­‰æˆ‘æ¶ˆæ¯â€æ­¤æ—¶clientè¿›å…¥FIN_WAIT2çŠ¶æ€ã€‚</li>
<li>å½“serverç«¯ç¡®è®¤æ•°æ®å‘é€å®Œæ¯•äº†ï¼Œå°±å‘Šè¯‰clientï¼šâ€œå¥½äº†ï¼Œæˆ‘è¿™è¾¹æ•°æ®å‘å®Œäº†ï¼Œå‡†å¤‡å¥½å…³é—­è¿æ¥äº†â€ã€‚</li>
<li>ä½†æ˜¯è¿™ä¸ªæ—¶å€™clientå¹¶ä¸ç›¸ä¿¡ç½‘ç»œï¼Œæ€•serverç«¯ä¸çŸ¥é“è¦å…³é—­ï¼Œæ‰€ä»¥è¿›å…¥TIME_WAIT,å¦‚æœserverç«¯æ²¡æœ‰æ”¶åˆ°ackåˆ™å¯ä»¥é‡ä¼ ï¼Œserverç«¯æ”¶åˆ°ackåå°±çŸ¥é“å¯ä»¥æ–­å¼€äº†ï¼Œclientç­‰å¾…2MSL(æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)ä¹‹åè¿˜æ²¡æœ‰æ”¶åˆ°å›å¤ï¼Œé‚£ä¹ˆä¹…è®¤ä¸ºserverç«¯æ­£å¸¸å…³é—­äº†ï¼Œclientä¹Ÿå¯ä»¥å…³é—­äº†ã€‚</li>
</ul>
<p>&emsp;&emsp;åœ¨è¿™é‡Œéœ€è¦æ³¨æ„æœ€åclientç­‰å¾…2MSL(æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)ï¼Œè™½ç„¶æŒ‰é“ç†ï¼Œå››ä¸ªæŠ¥æ–‡éƒ½å‘é€å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›å…¥CLOSEçŠ¶æ€äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»å‡è±¡ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæœ‰å¯ä»¥æœ€åä¸€ä¸ªACKä¸¢å¤±ã€‚æ‰€ä»¥TIME_WAITçŠ¶æ€å°±æ˜¯ç”¨æ¥é‡å‘å¯èƒ½ä¸¢å¤±çš„ACKæŠ¥æ–‡ã€‚</p>
<h3 id="5ã€IPåè®®ï¼Œç½‘ç»œå±‚"><a href="#5ã€IPåè®®ï¼Œç½‘ç»œå±‚" class="headerlink" title="5ã€IPåè®®ï¼Œç½‘ç»œå±‚"></a>5ã€IPåè®®ï¼Œç½‘ç»œå±‚</h3><p> åœ¨ä¸ƒå±‚ç½‘ç»œåˆ†å±‚ä¸­ï¼Œç½‘ç»œå±‚æ˜¯æœ€å¤æ‚çš„ã€‚è´Ÿè´£ä¸»æœºåˆ°ä¸»æœºé—´çš„é€šä¿¡ï¼Œå…¶ä¸­ipåè®®æ˜¯æœ€é‡è¦çš„ã€‚</p>
<blockquote>
<p>è®¡ç®—æœºè‹¥åœ¨åŒä¸€ä¸ªå­ç½‘é‡Œè¾¹ï¼Œå®Œå…¨å¯ä»¥åªéœ€è¦macåœ°å€å°±å¯ä»¥é€šä¿¡ï¼Œä¸»æœºAæƒ³å’Œä¸»æœºBé€šä¿¡ï¼Œé‚£ä¹ˆåªéœ€è¦å°†è¯·æ±‚å¹¿æ’­åˆ°æ•´ä¸ªå­ç½‘ï¼Œç„¶åå„å°è®¡ç®—æœºæ‹¿å‡ºç›®çš„macåœ°å€å’Œè‡ªå·±çš„macåœ°å€ç›¸å¯¹æ¯”ï¼Œå¦‚æœç›¸åŒï¼Œä¸¤å°ä¸»æœºè¿›è¡Œé€šä¿¡ã€‚ä½†æ˜¯è®¡ç®—æœºéå¸ƒå…¨ä¸–ç•Œï¼Œä¸å¯èƒ½éƒ½åœ¨ä¸€ä¸ªå­ç½‘é‡Œè¾¹ï¼Œè‹¥åœ¨å…¶ä»–å­ç½‘é‡Œè¾¹æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
</blockquote>
<p>&emsp;&emsp;è¿™ä¸ªæ—¶å€™å°±å¿…é¡»ç”¨åˆ°ipåœ°å€äº†ã€‚ç”±äºipåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ç½‘ç»œæ®µï¼Œä¸€éƒ¨åˆ†æ˜¯ä¸»æœºæ®µã€‚ç½‘ç»œæ®µå†³å®šå¤„äºå“ªä¸€ä¸ªå­ç½‘ï¼Œä¸»æœºæ®µå†³å®šæ˜¯å­ç½‘çš„é‚£ä¸€å°æœºå™¨ã€‚<br>å½“æˆ‘ä»¬è¦è®¿é—®googleçš„æœåŠ¡å™¨ipæ˜¯216.239.34.10æ—¶ï¼Œç”±äºä¸åœ¨åŒä¸€ä¸ªå­ç½‘ä¸­ï¼Œéœ€è¦å°†æ•°æ®æŠ¥è½¬å‘ç»™ç½‘å…³ï¼Œç„¶åå†é€šè¿‡å¤æ‚çš„è·¯ç”±ï¼Œæœ€ç»ˆåˆ°è¾¾æœåŠ¡å™¨ã€‚</p>
<p>ipæŠ¥æ–‡å°†tcpçš„æŠ¥æ–‡åµŒå…¥åœ¨æ•°æ®å—ä¸­</p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1516288184/20180118-7_gihylp.png" width="60%" height="80%"></p>
<h3 id="6ã€ARPåè®®ã€ä»¥å¤ªç½‘åè®®"><a href="#6ã€ARPåè®®ã€ä»¥å¤ªç½‘åè®®" class="headerlink" title="6ã€ARPåè®®ã€ä»¥å¤ªç½‘åè®®"></a>6ã€ARPåè®®ã€ä»¥å¤ªç½‘åè®®</h3><blockquote>
<p> æœ€åï¼Œipæ•°æ®åŒ…åµŒå…¥åˆ°ä»¥å¤ªç½‘æ•°æ®æŠ¥ï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…éœ€è¦è®¾ç½®é€šä¿¡åŒæ–¹çš„macåœ°å€ï¼Œå‘é€æ–¹ä¸ºæœ¬æœºçš„macåœ°å€ï¼Œæ¥æ”¶æ–¹ç½‘å¡216.239.34.1çš„macåœ°å€éœ€è¦ç”¨ARPåè®®å¾—åˆ°ã€‚</p>
</blockquote>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1516290169/20180118-8_kd50wc.png" width="60%" height="100%"></p>
<p>&emsp;&emsp;æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œèƒ½å¤Ÿä»IPåœ°å€å¾—åˆ°MACåœ°å€ã€‚<br>è¿™é‡Œåˆå¯ä»¥åˆ†æˆä¸¤ç§æƒ…å†µã€‚ç¬¬ä¸€ç§æƒ…å†µï¼Œå¦‚æœä¸¤å°ä¸»æœºä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œé‚£ä¹ˆäº‹å®ä¸Šæ²¡æœ‰åŠæ³•å¾—åˆ°å¯¹æ–¹çš„MACåœ°å€ï¼Œåªèƒ½æŠŠæ•°æ®åŒ…ä¼ é€åˆ°ä¸¤ä¸ªå­ç½‘ç»œè¿æ¥å¤„çš„â€ç½‘å…³â€ï¼ˆgatewayï¼‰ï¼Œè®©ç½‘å…³å»å¤„ç†ã€‚</p>
<p>&emsp;&emsp;ç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æœä¸¤å°ä¸»æœºåœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ARPåè®®ï¼Œå¾—åˆ°å¯¹æ–¹çš„MACåœ°å€ã€‚ARPåè®®ä¹Ÿæ˜¯å‘å‡ºä¸€ä¸ªæ•°æ®åŒ…ï¼ˆåŒ…å«åœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…ä¸­ï¼‰ï¼Œå…¶ä¸­åŒ…å«å®ƒæ‰€è¦æŸ¥è¯¢ä¸»æœºçš„IPåœ°å€ï¼Œåœ¨å¯¹æ–¹çš„MACåœ°å€è¿™ä¸€æ ï¼Œå¡«çš„æ˜¯FF:FF:FF:FF:FF:FFï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªâ€å¹¿æ’­â€åœ°å€ã€‚å®ƒæ‰€åœ¨å­ç½‘ç»œçš„æ¯ä¸€å°ä¸»æœºï¼Œéƒ½ä¼šæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œä»ä¸­å–å‡ºIPåœ°å€ï¼Œä¸è‡ªèº«çš„IPåœ°å€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼Œéƒ½åšå‡ºå›å¤ï¼Œå‘å¯¹æ–¹æŠ¥å‘Šè‡ªå·±çš„MACåœ°å€ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚</p>
<p>æ€»ä¹‹ï¼Œæœ‰äº†ARPåè®®ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°åŒä¸€ä¸ªå­ç½‘ç»œå†…çš„ä¸»æœºMACåœ°å€ï¼Œå¯ä»¥æŠŠæ•°æ®åŒ…å‘é€åˆ°ä»»æ„ä¸€å°ä¸»æœºä¹‹ä¸Šäº†ã€‚</p>
<h3 id="7ã€æœåŠ¡å™¨å“åº”"><a href="#7ã€æœåŠ¡å™¨å“åº”" class="headerlink" title="7ã€æœåŠ¡å™¨å“åº”"></a>7ã€æœåŠ¡å™¨å“åº”</h3><p> ç»è¿‡å¤šä¸ªç½‘å…³çš„è½¬å‘ï¼ŒGoogleçš„æœåŠ¡å™¨216.239.34.10ï¼Œæ”¶åˆ°æ•°æ®åŒ…ä¹‹åé€šè¿‡è§£æï¼Œå–å‡ºå…¶ä¸­çš„è¯·æ±‚request lineï¼Œåšå‡ºå“åº”ï¼Œå°è£…æˆresponseè¿”å›ç»™æµè§ˆå™¨ã€‚</p>
<h3 id="8ã€æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢"><a href="#8ã€æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢" class="headerlink" title="8ã€æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢"></a>8ã€æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</h3><p>æµè§ˆå™¨åœ¨æ”¶åˆ°HTML,CSS,JSæ–‡ä»¶åï¼Œå®ƒæ˜¯å¦‚ä½•æŠŠé¡µé¢å‘ˆç°åˆ°å±å¹•ä¸Šçš„ï¼Ÿä¸‹å›¾å¯¹åº”çš„å°±æ˜¯WebKitæ¸²æŸ“çš„è¿‡ç¨‹ã€‚<br><img src="http://res.cloudinary.com/leon824/image/upload/v1516290657/20180118-9_jr7agq.png" width="80%" height="100%"></p>
<blockquote>
<p>ç”±äºæ¶‰åŠåˆ°å¾ˆå¤šçš„å†…å®¹ï¼Œéš¾å…æœ‰åå·®çš„åœ°æ–¹ï¼Œè¿˜è¯·è§è°…ã€‚</p>
</blockquote>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B</a></li>
<li><a href="http://blog.csdn.net/whuslei/article/details/6667471" target="_blank" rel="noopener">http://blog.csdn.net/whuslei/article/details/6667471</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2012/06/internet_protocol_suite_part_ii.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2012/06/internet_protocol_suite_part_ii.html</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html</a></li>
</ul>
]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
  </entry>
  <entry>
    <title>çˆ¬å–çŒ«çœ¼ç”µå½±æ•°æ®ï¼ˆä¸€ï¼‰</title>
    <url>/2017/09/24/%E7%88%AC%E5%8F%96%E7%8C%AB%E7%9C%BC%E7%94%B5%E5%BD%B1%E6%95%B0%E6%8D%AE-1/</url>
    <content><![CDATA[<h1 id="çˆ¬å–çŒ«çœ¼ç”µå½±æ•°æ®-ä¸€"><a href="#çˆ¬å–çŒ«çœ¼ç”µå½±æ•°æ®-ä¸€" class="headerlink" title="çˆ¬å–çŒ«çœ¼ç”µå½±æ•°æ®(ä¸€)"></a>çˆ¬å–çŒ«çœ¼ç”µå½±æ•°æ®(ä¸€)</h1><blockquote>
<p>æ¦‚è¿°ï¼šè¿‘æœŸç”±äºä¸šåŠ¡éœ€è¦ï¼Œéœ€è¦å°†çˆ¬å–çŒ«çœ¼ç½‘ç«™ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºå…¬ä¼—å·æ•°æ®æºï¼ŒçŒ«çœ¼çš„ç”µå½±æ•°æ®ç›¸å½“ä¹‹å…¨å¤‡ï¼Œå¤§æ¦‚æ”¶å½•äº†å‡ åä¸‡éƒ¨ç”µå½±ã€‚å½“ç„¶è¿™äº›æ•°æ®æˆ‘ä»¬ä¹Ÿæ²¡é‚£ä¹ˆå®¹æ˜“å°±èƒ½çˆ¬å–åˆ°çš„ã€‚é‚å°†æ•´ä¸ªçˆ¬å–è¿‡ç¨‹è®°å½•å¦‚ä¸‹ã€‚</p>
</blockquote>
<p>1ã€ä½¿ç”¨chromeè¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼Œè§‚å¯Ÿhtmlç»“æ„ã€å…ƒç´ ï¼Œæ‰¾åˆ°æˆ‘ä»¬æ‰€éœ€æ•°æ®ï¼Œç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦ç°è·å–æ¯ä¸€ä¸ªç”µå½±çš„è¯¦æƒ…é¡µé¢urlã€‚</p>
<p> <img src="http://res.cloudinary.com/leon824/image/upload/v1506261484/1_b4qehh.png" width="100%" height="100%"></p>
<blockquote>
<p><strong>æ³¨æ„ï¼Œåœ¨çˆ¬å–çŒ«çœ¼çš„ç”µå½±æ•°æ®æ—¶å¹¶ä¸éœ€è¦ç™»å½•å’Œæºå¸¦cookieå»è¯·æ±‚html</strong></p>
</blockquote>
<p>2ã€ è¿™é‡Œæˆ‘ä»¬ç»“åˆBeautifulSoupå’Œxpathæ¥å®ç°å¯¹æ•°æ®çš„è¿‡æ»¤ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_detail_url</span><span class="params">(self, targetUrl)</span>:</span></span><br><span class="line">    <span class="string">"""ä»æ¦‚è§ˆé¡µé¢ä¸­å»è·å–å‰§é€å½±ç‰‡çš„è¯¦æƒ…é¡µé¢"""</span></span><br><span class="line">    html = self.getHtml(targetUrl) </span><br><span class="line">    <span class="keyword">print</span> html</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">    urls = soup.find_all(<span class="string">'a'</span>, attrs=&#123;<span class="string">'data-act'</span>:<span class="string">'movie-click'</span>&#125;)</span><br><span class="line">    dd = soup.find_all(<span class="string">'dd'</span>) </span><br><span class="line">    <span class="keyword">print</span> dd</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        detailPath = etree.HTML(str(url))</span><br><span class="line">        detail_url = detailPath.xpath(<span class="string">r'//a/@href'</span>)</span><br><span class="line">        <span class="keyword">for</span> durl <span class="keyword">in</span> detail_url:</span><br><span class="line">            self.getContents(<span class="string">'https://maoyan.com'</span> + durl, proxys)</span><br></pre></td></tr></table></figure>
<p>ç„¶åè·å–åˆ°å¯¹åº”æ¯ä¸€ä¸ªç”µå½±çš„è¯¦æƒ…urlï¼Œè¿›å…¥è¯¦æƒ…é¡µï¼Œåˆ†ææ‰€éœ€æ•°æ®å¯¹åº”htmlå…ƒç´ ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬åªéœ€è¦ä¸‰ä¸ªå­—æ®µã€ç”µå½±åç§°ã€ç”µå½±æµ·æŠ¥urlã€ç”µå½±ä¸Šæ˜ æ—¶é—´ã€‚</p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1506262397/3_yrxyxr.png" width="100%" height="100%"></p>
<blockquote>
<p>æç¤º:<em>ä½¿ç”¨xpathæ—¶ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯åœ¨chromeä¸­ç‚¹å‡»é€‰ä¸­å…·ä½“æŸä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå³é”®â€”â€”&gt; copy â€“&gt; copy xpathå°±èƒ½è·å–åˆ°å¯¹åº”çš„xpathè·¯å¾„</em><br><img src="http://res.cloudinary.com/leon824/image/upload/v1506263006/4_bsgqfg.png" width="100%" height="100%"></p>
</blockquote>
<p>å®ç°ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getContents</span><span class="params">(self, url, proxys)</span>:</span></span><br><span class="line">        <span class="string">"""ä»è¯¦æƒ…é¡µé¢ä¸­è·å–æ‰€éœ€data"""</span></span><br><span class="line">        html  = self.getHtml(url,proxys)</span><br><span class="line">        detailPath = etree.HTML(html)</span><br><span class="line">        <span class="comment">#ç”µå½±åç§°</span></span><br><span class="line">        film_name = detailPath.xpath(<span class="string">r'/html/body/div[3]/div/div[2]/div[1]/h3/text()'</span>) </span><br><span class="line">			<span class="comment">#å›¾ç‰‡url</span></span><br><span class="line">        pic_url = detailPath.xpath(<span class="string">r'/html/body/div[3]/div/div[1]/div/img/@src'</span>)</span><br><span class="line">         <span class="comment">#ä¸Šæ˜ æ—¶é—´   </span></span><br><span class="line">        release_time = detailPath.xpath(<span class="string">r'/html/body/div[3]/div/div[2]/div[1]/ul/li[3]/text()'</span>)</span><br></pre></td></tr></table></figure>
<p>3ã€ è¿™ä¸ªæ—¶å€™è·å–åˆ°æ•°æ®äº†ï¼Œå°±è¯¥å­˜åº“äº†ã€‚å—¯ï¼Œå°±å­˜åˆ°mysqlä¸­å§ã€‚æ²¡å•¥è¯´çš„ï¼Œä¸Šä»£ç ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insertData</span><span class="params">(self, my_dict)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">            cols = <span class="string">', '</span>.join(my_dict.keys())</span><br><span class="line">            <span class="keyword">print</span> cols</span><br><span class="line">            values = <span class="string">'","'</span>.join(my_dict.values())</span><br><span class="line">            <span class="keyword">print</span> values</span><br><span class="line">            sql = <span class="string">"INSERT INTO  maoyan (%s) VALUES (%s)"</span> % (cols, <span class="string">'"'</span> + values + <span class="string">'"'</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = self.cur.execute(sql)</span><br><span class="line">                insert_id = self.db.insert_id()</span><br><span class="line">                self.db.commit()</span><br><span class="line">                <span class="comment"># åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒæˆåŠŸ</span></span><br><span class="line">                <span class="keyword">if</span> result:</span><br><span class="line">                    <span class="keyword">return</span> insert_id</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            <span class="keyword">except</span> MySQLdb.Error, e:</span><br><span class="line">                <span class="comment"># å‘ç”Ÿé”™è¯¯æ—¶å›æ»š</span></span><br><span class="line">                self.db.rollback()</span><br><span class="line">                <span class="comment"># ä¸»é”®å”¯ä¸€ï¼Œæ— æ³•æ’å…¥</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">"key 'PRIMARY'"</span> <span class="keyword">in</span> e.args[<span class="number">1</span>]:</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(), <span class="string">"æ•°æ®å·²å­˜åœ¨ï¼Œæœªæ’å…¥æ•°æ®"</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(), <span class="string">"æ’å…¥æ•°æ®å¤±è´¥ï¼ŒåŸå›  %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">except</span> MySQLdb.Error, e:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">"æ•°æ®åº“é”™è¯¯ï¼ŒåŸå› %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dealData</span><span class="params">(self, my_dict)</span>:</span></span><br><span class="line">        <span class="string">"""å…ˆä»æ•°æ®åº“ä¸­æŸ¥è¯¢è¿™ä¸ªå½±ç‰‡åçš„è®°å½•ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥æ’å…¥ï¼›</span></span><br><span class="line"><span class="string">        è‹¥æ˜¯æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨æ•°æ®ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸åš"""</span></span><br><span class="line">        self.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">        filmTitile = my_dict.get(<span class="string">'film_title'</span>)</span><br><span class="line">        result = self.findFilmByfilmTitle(filmTitile)</span><br><span class="line">        <span class="keyword">if</span> len(result) == <span class="number">0</span>:</span><br><span class="line">            self.insertData(my_dict)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findFilmByfilmTitle</span><span class="params">(self, filmTitile)</span>:</span></span><br><span class="line">        <span class="string">"""é€šè¿‡å½±ç‰‡åç§°å»æ•°æ®åº“ä¸­æŸ¥è¯¢"""</span></span><br><span class="line">        self.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">        sql = <span class="string">"select * from maoyan where film_title='%s'"</span> % (filmTitile)</span><br><span class="line">        self.cur.execute(sql)</span><br><span class="line">        results = self.cur.fetchall()</span><br><span class="line">        self.db.commit()</span><br><span class="line">        <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>
<p>4ã€ ä¸‡äº‹ä¿±å¤‡åªæ¬ å¯åŠ¨äº†ï¼Œè·‘å•Šè·‘å•Šã€‚æƒ³å¿…å¤§å®¶éƒ½æƒ³åˆ°äº†ï¼ŒçŒ«çœ¼è‚¯å®šæ˜¯ä¸å¯èƒ½éšä¾¿è®©äººè¿™æ ·çˆ¬å–ä»–ä»¬çš„æ•°æ®ï¼Œè€Œä¸”çŸ­æ—¶é—´å¤§é‡çš„è¯·æ±‚å¯¹æœåŠ¡å™¨çš„è´Ÿè½½ä¹Ÿæ˜¯ç›¸å½“å¤§çš„ï¼Œä¸å‡ºæ„æ–™çˆ¬å–äº†ä¸åˆ°300æ¡æ•°æ®ï¼Œå°±è¢«åœæ­¢äº†ã€‚(à²¥ _ à²¥)<br>å¤„ç†è¿™ç§æƒ…å†µä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§é€šè¿‡å»¶ç¼“è¯·æ±‚ï¼Œä¸€ç§æ˜¯é€šè¿‡ä»£ç†ipçš„æ–¹å¼ã€‚ç¬¬ä¸€ç§æˆ‘å°è¯•å»¶ç¼“5ã€10sï¼Œä½†å¹¶æ²¡æœ‰ç”¨ã€‚å› è€Œå°è¯•ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œä»£ç†ipæ± çš„æ–¹å¼ã€‚<strong>ä»£ç†ipå¦‚ä½•ä½¿ç”¨åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è®°å½•ã€‚</strong></p>
<p>ä¸‹é¢æ˜¯æœ¬æ¬¡çš„å®Œæˆä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf8'</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">"""çŒ«çœ¼ä¸éœ€è¦httpè¯·æ±‚çš„å¤´éƒ¨ä¿¡æ¯ï¼Œæ·»åŠ ä¸Šåè€Œä¼šå‡ºé”™"""</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Maoyan</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>, time.localtime(time.time()))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.time = time</span><br><span class="line">        self.base_url = <span class="string">"https://maoyan.com/films?showType=1&amp;sortId=2"</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.db = MySQLdb.connect(<span class="string">'localhost'</span>, <span class="string">'flyer_user'</span>, <span class="string">'Tu4a0X9hOPKz6jS!e'</span>, <span class="string">'flyer_db'</span>,charset=<span class="string">'utf8'</span>)</span><br><span class="line">            self.cur = self.db.cursor()</span><br><span class="line">        <span class="keyword">except</span> MySQLdb.Error, e:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">"è¿æ¥æ•°æ®åº“é”™è¯¯ï¼ŒåŸå› %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ’å…¥æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insertData</span><span class="params">(self, my_dict)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">            cols = <span class="string">', '</span>.join(my_dict.keys())</span><br><span class="line">            <span class="keyword">print</span> cols</span><br><span class="line">            values = <span class="string">'","'</span>.join(my_dict.values())</span><br><span class="line">            <span class="keyword">print</span> values</span><br><span class="line">            sql = <span class="string">"INSERT INTO  maoyan (%s) VALUES (%s)"</span> % (cols, <span class="string">'"'</span> + values + <span class="string">'"'</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = self.cur.execute(sql)</span><br><span class="line">                insert_id = self.db.insert_id()</span><br><span class="line">                self.db.commit()</span><br><span class="line">                <span class="comment"># åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒæˆåŠŸ</span></span><br><span class="line">                <span class="keyword">if</span> result:</span><br><span class="line">                    <span class="keyword">return</span> insert_id</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            <span class="keyword">except</span> MySQLdb.Error, e:</span><br><span class="line">                <span class="comment"># å‘ç”Ÿé”™è¯¯æ—¶å›æ»š</span></span><br><span class="line">                self.db.rollback()</span><br><span class="line">                <span class="comment"># ä¸»é”®å”¯ä¸€ï¼Œæ— æ³•æ’å…¥</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">"key 'PRIMARY'"</span> <span class="keyword">in</span> e.args[<span class="number">1</span>]:</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(), <span class="string">"æ•°æ®å·²å­˜åœ¨ï¼Œæœªæ’å…¥æ•°æ®"</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(), <span class="string">"æ’å…¥æ•°æ®å¤±è´¥ï¼ŒåŸå›  %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">except</span> MySQLdb.Error, e:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">"æ•°æ®åº“é”™è¯¯ï¼ŒåŸå› %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dealData</span><span class="params">(self, my_dict)</span>:</span></span><br><span class="line">        <span class="string">"""å…ˆä»æ•°æ®åº“ä¸­æŸ¥è¯¢è¿™ä¸ªå½±ç‰‡åçš„è®°å½•ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥æ’å…¥ï¼›</span></span><br><span class="line"><span class="string">        è‹¥æ˜¯æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨æ•°æ®ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸åš"""</span></span><br><span class="line">        self.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">        filmTitile = my_dict.get(<span class="string">'film_title'</span>)</span><br><span class="line">        result = self.findFilmByfilmTitle(filmTitile)</span><br><span class="line">        <span class="keyword">if</span> len(result) == <span class="number">0</span>:</span><br><span class="line">            self.insertData(my_dict)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findFilmByfilmTitle</span><span class="params">(self, filmTitile)</span>:</span></span><br><span class="line">        <span class="string">"""é€šè¿‡å½±ç‰‡åç§°å»æ•°æ®åº“ä¸­æŸ¥è¯¢"""</span></span><br><span class="line">        self.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">        sql = <span class="string">"select * from maoyan where film_title='%s'"</span> % (filmTitile)</span><br><span class="line">        self.cur.execute(sql)</span><br><span class="line">        results = self.cur.fetchall()</span><br><span class="line">        self.db.commit()</span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getHtml</span><span class="params">(self,url,proxys)</span>:</span></span><br><span class="line">        <span class="string">"""è·å–html"""</span></span><br><span class="line">        req = urllib2.Request(url)</span><br><span class="line">        html = urllib2.urlopen(req).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_detail_url</span><span class="params">(self, targetUrl, proxys)</span>:</span></span><br><span class="line">        <span class="string">"""ä»æ¦‚è§ˆé¡µé¢ä¸­å»è·å–å‰§é€å½±ç‰‡çš„è¯¦æƒ…é¡µé¢"""</span></span><br><span class="line">        html = self.getHtml(targetUrl, proxys)</span><br><span class="line">        <span class="keyword">print</span> html</span><br><span class="line">        soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">        urls = soup.find_all(<span class="string">'a'</span>, attrs=&#123;<span class="string">'data-act'</span>:<span class="string">'movie-click'</span>&#125;)</span><br><span class="line">        dd = soup.find_all(<span class="string">'dd'</span>)</span><br><span class="line">        <span class="keyword">print</span> dd</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">            detailPath = etree.HTML(str(url))</span><br><span class="line">            detail_url = detailPath.xpath(<span class="string">r'//a/@href'</span>)</span><br><span class="line">            <span class="keyword">for</span> durl <span class="keyword">in</span> detail_url:</span><br><span class="line">                self.getContents(<span class="string">'https://maoyan.com'</span> + durl, proxys)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getContents</span><span class="params">(self, url, proxys)</span>:</span></span><br><span class="line">        <span class="string">"""ä»è¯¦æƒ…é¡µé¢ä¸­è·å–æ‰€éœ€data"""</span></span><br><span class="line">        tmp1 = []</span><br><span class="line">        tmp2 = []</span><br><span class="line">        html  = self.getHtml(url,proxys)</span><br><span class="line">        detailPath = etree.HTML(html)</span><br><span class="line">        film_name = detailPath.xpath(<span class="string">r'/html/body/div[3]/div/div[2]/div[1]/h3/text()'</span>)</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> film_name:</span><br><span class="line">            tmp1.append(<span class="string">"film_title"</span>)</span><br><span class="line">            tmp2.append(name)</span><br><span class="line"></span><br><span class="line">        pic_url = detailPath.xpath(<span class="string">r'/html/body/div[3]/div/div[1]/div/img/@src'</span>)</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> pic_url:</span><br><span class="line">            strs = url.split(<span class="string">'@'</span>)</span><br><span class="line">            tmp1.append(<span class="string">"pic_url"</span>)</span><br><span class="line">            tmp2.append(strs[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        release_time = detailPath.xpath(<span class="string">r'/html/body/div[3]/div/div[2]/div[1]/ul/li[3]/text()'</span>)</span><br><span class="line">        <span class="keyword">for</span> time <span class="keyword">in</span> release_time:</span><br><span class="line">            tmp1.append(<span class="string">"release_time"</span>)</span><br><span class="line">            tmp2.append(time[:<span class="number">10</span>])</span><br><span class="line">        <span class="comment">#å°†ä¸¤ä¸ªåˆ—è¡¨è½¬æ¢ä¸ºå­—å…¸ï¼Œæ–¹ä¾¿æ’å…¥æ•°æ®åº“</span></span><br><span class="line">        result_dict = dict(zip(tmp1, tmp2))</span><br><span class="line">        self.dealData(result_dict)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.get_detail_url(self.base_url, proxys)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">            targetUrl = self.base_url + <span class="string">'&amp;offset='</span> + str((i+<span class="number">1</span>)*<span class="number">30</span>)</span><br><span class="line">            self.get_detail_url(targetUrl, proxys)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    maoyan = Maoyan()</span><br><span class="line">    maoyan.main()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>æµ…æjavaè¯­è¨€ä¸­é”æœºåˆ¶</title>
    <url>/2018/03/17/%E6%B5%85%E6%9E%90java%E8%AF%AD%E8%A8%80%E4%B8%AD%E9%94%81%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h1 id="æµ…æjavaè¯­è¨€ä¸­é”æœºåˆ¶"><a href="#æµ…æjavaè¯­è¨€ä¸­é”æœºåˆ¶" class="headerlink" title="æµ…æjavaè¯­è¨€ä¸­é”æœºåˆ¶"></a>æµ…æjavaè¯­è¨€ä¸­é”æœºåˆ¶</h1><blockquote>
<p>&emsp;&emsp;å¤šä»»åŠ¡å¹¶å‘å·²ç»æ˜¯è®¡ç®—æœºä¸­ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†äº†ï¼Œå¾ˆå¤šæ—¶å€™è®©è®¡ç®—æœºåŒä¸€æ—¶åˆ»åšå‡ ä»¶äº‹ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºè¿ç®—èƒ½åŠ›æé«˜äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦åŸå› å°±æ˜¯<code>cpu</code>çš„è¿ç®—é€Ÿåº¦å’Œå­˜å‚¨ã€é€šä¿¡å­ç³»ç»Ÿé€Ÿåº¦å·®å¼‚å¤ªå¤§ã€‚æ‰€ä»¥ä¸å¾—ä¸â€œå‹æ¦¨â€è¿ç®—èƒ½åŠ›ã€‚<br> è€Œå‹æ¦¨è¿ç®—èƒ½åŠ›å°±ä¸å¾—ä¸ç”¨åˆ°å¤šçº¿ç¨‹ï¼Œåœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹è¿ç®—ç¯å¢ƒè¾ƒä¸ºç®€å•ï¼Œè€Œåˆ°äº†å¤šçº¿ç¨‹æƒ…å†µä¸‹åˆ™ä¼šäº§ç”Ÿå¾ˆå¤šæ„æƒ³ä¸åˆ°çš„ç»“æœã€‚è¦ä¿è¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å„ä¸ªçº¿ç¨‹â€œç›¸å®‰æ— äº‹â€çš„è¿è¡Œï¼Œåˆ™å¿…é¡»ç”¨åˆ°é”æœºåˆ¶ã€‚</p>
</blockquote>
<h2 id="javaå†…å­˜æ¨¡å‹"><a href="#javaå†…å­˜æ¨¡å‹" class="headerlink" title="javaå†…å­˜æ¨¡å‹"></a>javaå†…å­˜æ¨¡å‹</h2><p>åœ¨è®²é”æœºåˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆäº†è§£<code>jvm</code>çš„å†…å­˜æ¨¡å‹ã€‚ æ¨¡å‹å›¾å¦‚ä¸‹</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1536114662/pic93_wxozba.png" width="90%" height="90%"></p>
<p>&emsp;&emsp;javaçº¿ç¨‹è¯»å†™æ•°æ®æ˜¯ç›´æ¥è¯»å†™å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œå·¥ä½œå†…å­˜å¯èƒ½å¹¶éæ˜¯ç‰©ç†å†…å­˜ï¼Œä¸ºäº†æ€§èƒ½å¾ˆå¤§å¯èƒ½æ˜¯é«˜é€Ÿç¼“å­˜å’Œå¯„å­˜å™¨ã€‚çº¿ç¨‹é—´é€šä¿¡å¿…é¡»é€šè¿‡å†…å†…å­˜æ¥å®ç°ã€‚å‡è®¾åˆå§‹å€¼x = 0ï¼Œ ç„¶åçº¿ç¨‹Aå°†xå€¼ä¿®æ”¹ä¸º1ï¼Œ é‚£ä¹ˆBè¦çŸ¥é“æ­¤æ—¶Aä¿®æ”¹è¿‡åçš„å€¼å°±å¿…é¡»æ˜¯Açº¿ç¨‹å…ˆå°†å€¼ä»å·¥ä½œå†…å­˜ä¸­å†™å…¥åˆ°ä¸»å†…å­˜ï¼Œç„¶åçº¿ç¨‹Bå†ä»ä¸»å†…å­˜ä¸­è¯»å–xçš„å€¼ï¼Œå¦‚æ­¤å®Œæˆçº¿ç¨‹é—´çš„é€šä¿¡â€“å…±äº«å†…å­˜çš„æ–¹å¼ã€‚</p>
<p>JVMå†…å­˜æ¨¡å‹å›´ç»•ä¸‰ä¸ªç‚¹è¿›è¡Œï¼š åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ã€‚</p>
<p>åŸå­æ€§ï¼šä¸å¯åˆ†å‰²ï¼Œjavaä¸­çš„åŸºæœ¬ç±»å‹çš„è¯»å†™åŸºæœ¬å¯ä»¥è®¤ä¸ºæ˜¯åŸå­æ“ä½œï¼Œå¦‚æœè¦åœ¨æ›´å¤§èŒƒå›´å†…ä¿è¯åŸå­æ€§ï¼Œå¯ä»¥æ˜¯ç”¨<code>synchronized</code>æ¥ä¿è¯åŸå­æ€§ã€‚</p>
<p>å¯è§æ€§ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªå˜åŒ–ã€‚<code>volatile</code>ã€<code>synchronized</code>ã€<code>final</code>éƒ½èƒ½å¤Ÿä¿è¯å†…å­˜å¯è§æ€§ã€‚<code>volatile</code>èƒ½å¤Ÿä¿è¯ä¸€ä¸ªè¢«ä¿®æ”¹ä¹‹åç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œç„¶åå…¶ä»–çº¿ç¨‹ä½¿ç”¨åˆ°è¢«<code>volatile</code>ä¿®é¥°çš„å˜é‡æ—¶ï¼Œå¿…é¡»å…ˆä»ä¸»å†…å­˜ä¸­åŒæ­¥åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚<code>synchronized</code>ä¿è¯å¯è§æ€§æ˜¯ä¸€ä¸ªçº¿ç¨‹<code>unlock</code>æ—¶ï¼Œå¿…é¡»å°†ä¿®æ”¹çš„å€¼åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œä¸‹ä¸€ä¸ªè·å–åˆ°lockçš„çº¿ç¨‹å¿…é¡»å…ˆåŒæ­¥ä¸»å†…å­˜æ•°æ®ï¼Œä»è€Œä¿è¯å¯è§æ€§ã€‚</p>
<p>æœ‰åºæ€§ï¼šå¦‚æœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚ å‰é¢åŠå¥æ„æ€æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…è¡¨ç°ä¸ºä¸²è¡Œçš„è¯­ä¹‰ï¼ŒååŠå¥æ˜¯â€œæŒ‡ä»¤é‡æ’åºâ€ç°è±¡å’Œâ€œå·¥ä½œå†…å­˜ä¸ä¸»å†…å­˜ä¹‹é—´å»¶è¿Ÿâ€ç°è±¡ã€‚</p>
<p>å…ˆè¡Œå‘ç”Ÿï¼šæŒ‡çš„æ˜¯å¦‚æœAå…ˆè¡Œå‘ç”ŸäºBï¼Œé‚£ä¹ˆæ“ä½œAçš„å½±å“èƒ½å¤Ÿè¢«æ“ä½œBè§‚å¯Ÿåˆ°ï¼Œâ€œå½±å“â€åŒ…æ‹¬ä¿®æ”¹äº†å…±äº«å†…å­˜å˜é‡çš„å€¼ã€å‘é€çš„æ¶ˆæ¯ã€è°ƒç”¨æ–¹æ³•ç­‰ã€‚ç”±äºä¼˜åŒ–é‡æ’åºçš„åŸå› ï¼Œæ“ä½œä¹‹é—´çš„æ—¶é—´ä¸Šå…ˆåæ‰§è¡Œå’Œâ€œå…ˆè¡Œå‘ç”Ÿâ€å¹¶æ²¡æœ‰å…³ç³»ã€‚</p>
<h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><p>  éœ€è¦æ³¨æ„çš„æ˜¯volatileå¹¶ä¸æ˜¯é”ï¼Œå®ƒæ˜¯jvmæä¾›çš„æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚å¤§å¤šæ•°äººå¯¹volatileçš„åŸç†å’Œä½¿ç”¨å¹¶ä¸æ¸…æ¥šã€‚volatileä¸»è¦å…·å¤‡ä¸¤ä¸ªç‰¹æ€§ï¼š</p>
<ul>
<li>ä¿è¯å†…å­˜å¯è§æ€§</li>
<li>ç¦æ­¢æŒ‡ä»¤é‡æ’åº </li>
</ul>
<h3 id="å†…å­˜å¯è§æ€§"><a href="#å†…å­˜å¯è§æ€§" class="headerlink" title="å†…å­˜å¯è§æ€§"></a>å†…å­˜å¯è§æ€§</h3><p>&emsp;&emsp;è¢«<code>volatile</code>ä¿®é¥°çš„å˜é‡ï¼Œè¢«çº¿ç¨‹ä¿®æ”¹ä¹‹åä¼šç«‹å³ä»å·¥ä½œå†…å­˜ä¸­åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹è‹¥è¦è¯»è¢«volatileä¿®é¥°çš„å˜é‡åˆ™å¿…é¡»å…ˆä»ä¸»å†…å­˜ä¸­åŒæ­¥æœ€æ–°çš„å€¼ï¼Œè¿™æ ·å°±ä¿è¯äº†çº¿ç¨‹ä¹‹é—´å˜é‡çš„åŒæ­¥ã€‚ä½†æ˜¯çº¿ç¨‹ä¹‹é—´å˜é‡çš„å€¼å¹¶éç«‹å³åŒæ­¥çš„ï¼Œå„ä¸ªçº¿ç¨‹ä¹‹é—´çš„å€¼å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯ç”±äºæ¯ä¸€æ¬¡è¯»çš„æ—¶å€™éƒ½ä»ä¸»å†…å­˜ä¸­æ›´æ–°ï¼Œå› æ­¤ä¹Ÿä¸è®¤ä¸ºå­˜æœ‰ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>
<p>ä½†æ˜¯ç”±äºvolatileåªèƒ½ä¿è¯å¯è§æ€§ï¼Œå¹¶ä¸ä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥åœ¨ä¸ç¬¦åˆä¸‹é¢çš„ä¸¤ç§æƒ…å†µè¿˜æ˜¯éœ€è¦é€šè¿‡<strong>åŠ é”</strong>æ¥ä¿è¯åŸå­æ€§ã€‚</p>
<ul>
<li><p>è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å½“å‰å€¼</p>
<p>  ä¾‹å¦‚ï¼š a++ ã€ b += 3</p>
</li>
<li><p>å˜é‡ä¸éœ€è¦å‚åŠ å…¶ä»–çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸã€‚</p>
<p>   ä¾‹å¦‚ï¼š low &lt; up</p>
</li>
</ul>
<h3 id="ç¦æ­¢æŒ‡ä»¤é‡æ’åº"><a href="#ç¦æ­¢æŒ‡ä»¤é‡æ’åº" class="headerlink" title="ç¦æ­¢æŒ‡ä»¤é‡æ’åº"></a>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</h3><p> &emsp;&emsp;ç°ä»£cpuä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œä¸€ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œè¢«åˆ†æˆï¼šå–æŒ‡ã€è¯‘ç ã€è®¿å­˜ã€æ‰§è¡Œã€å†™å›ã€ç­‰è‹¥å¹²ä¸ªé˜¶æ®µã€‚ç„¶åï¼Œå¤šæ¡æŒ‡ä»¤å¯ä»¥åŒæ—¶å­˜åœ¨äºæµæ°´çº¿ä¸­ï¼ŒåŒæ—¶è¢«æ‰§è¡Œã€‚ä½†æ˜¯æ— è®ºæ€æ ·é‡æ’åºå¿…é¡»è¦æ»¡è¶³<code>as-if-serial</code>è¯­ä¹‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹ç¼–ç¨‹å¹¶ä¸éœ€è¦è€ƒè™‘ä»£ç æ‰§è¡Œé¡ºåºçš„é—®é¢˜ï¼Œå› ä¸ºæ— è®ºæ€æ ·æ’åºï¼Œæœ€åæ‰§è¡Œçš„ç»“æœæ€»æ˜¯å’Œé¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´ã€‚</p>
<p>&emsp;&emsp;&ensp; ç¦æ­¢é‡æ’åºæ—¶å€™é€šè¿‡å†…å­˜å±éšœæ¥å®ç°çš„ï¼Œå³æ˜¯è¯´é‡æ’åºæ—¶ä¸èƒ½è®²åé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ã€‚è‹¥åªæœ‰ä¸€ä¸ªcpuè®¿é—®å†…å­˜æ—¶å¹¶ä¸éœ€è¦å†…å­˜å±éšœï¼Œè‹¥å¤šä¸ªcpuè®¿é—®å†…å­˜æ—¶ï¼Œå¹¶ä¸”ä¸€ä¸ªæ­£åœ¨è§‚å¯Ÿå¦å¤–ä¸€ä¸ªæ—¶ï¼Œå°±éœ€è¦å†…å­˜å±éšœæ¥ä¿è¯ä¸€è‡´æ€§ã€‚</p>
<p> &emsp;&emsp;&ensp; ä¸‹é¢æ‘˜è‡ªã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼š<br>  â€œè§‚å¯ŸåŠ å…¥<code>volatile</code>å…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥<code>volatile</code>å…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å‘ç°ï¼ŒåŠ å…¥<code>volatile</code>å…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ª<code>lock</code>å‰ç¼€æŒ‡ä»¤â€<br>lockå‰ç¼€æŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœï¼ˆä¹Ÿæˆå†…å­˜æ …æ ï¼‰ï¼Œå†…å­˜å±éšœä¼šæä¾›3ä¸ªåŠŸèƒ½ï¼š</p>
<ul>
<li><p>1ã€å®ƒç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ä¸ä¼šæŠŠå…¶åé¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœçš„åé¢ï¼›å³åœ¨æ‰§è¡Œåˆ°å†…å­˜å±éšœè¿™å¥æŒ‡ä»¤æ—¶ï¼Œåœ¨å®ƒå‰é¢çš„æ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼›</p>
</li>
<li><p>2ï¼‰å®ƒä¼šå¼ºåˆ¶å°†å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼›</p>
</li>
<li><p>3ï¼‰å¦‚æœæ˜¯å†™æ“ä½œï¼Œå®ƒä¼šå¯¼è‡´å…¶ä»–CPUä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚</p>
</li>
</ul>
<h2 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h2><blockquote>
<p>synchronizedæ˜¯æˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„åŠ é”æ–¹å¼ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„æ–¹å¼ã€‚</p>
</blockquote>
<p>&emsp;&emsp;<code>synchronized</code>æœ€å¸¸ç”¨çš„äº’æ–¥æœ‰æ®µï¼Œ<code>synchronized</code>ç»è¿‡ç¼–è¯‘ä¹‹åï¼Œä¼šåœ¨åŒæ­¥å—å‰ååˆ†åˆ«å½¢æˆ<code>monitorenter</code>å’Œ<code>monitorexit</code>ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ã€‚è¿™ä¸¤ä¸ªæŒ‡ä»¤éƒ½éœ€è¦æ˜ç¡®æŒ‡å®šä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å¯¹è±¡å‚æ•°æ¥ç¡®å®šéœ€è¦é”å®šå’Œè§£é”çš„å¯¹è±¡ã€‚</p>
<p>&emsp;&emsp;&ensp; æ ¹æ®è™šæ‹Ÿæœºçš„è§„èŒƒè¦æ±‚ï¼Œåœ¨æ‰§è¡Œ<em>monitorenter</em>æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆè¦å°è¯•è·å–å¯¹è±¡çš„é”ï¼Œå¦‚æœå¯¹è±¡æ²¡æœ‰è¢«é”å®šï¼Œæˆ–è€…å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰é‚£ä¸ªå¯¹è±¡çš„é”ï¼ŒæŠŠé”çš„è®¡æ•°å™¨åŠ 1ï¼Œç›¸åº”çš„ï¼Œå¦‚æœæ‰§è¡Œ<em>monitorexit</em>æŒ‡ä»¤å°±ä¼šå°†é”è®¡æ•°å™¨å‡1ï¼Œå½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œé”å°±è¢«é‡Šæ”¾ã€‚å¦‚æœè·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±è¦ä¸€ç›´é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å¯¹è±¡é”è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚åŒæ—¶<code>Synchronized</code>é”æ˜¯å¯é‡å…¥çš„ï¼Œå‡è®¾å¯¹è±¡<code>person</code>æœ‰ä¸¤ä¸ªè¢«<code>Synchronized</code>ä¿®é¥°çš„åŒæ­¥æ–¹æ³•Mã€Nï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®ŒMä¹‹åè¿˜å¯ä»¥æ¥ç€æ‰§è¡ŒNï¼Œæ‰€ä»¥è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…äº†æ­»é”ï¼Œ</p>
<p>å¦‚ä½•ä¿è¯å¯è§æ€§ï¼Ÿ</p>
<p>&emsp;&emsp;&ensp; å½“ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®ä»å·¥ä½œå†…å­˜æ›´æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œè·å–é”é‚£ä¸ªçº¿ç¨‹ä¹Ÿä¼šå…ˆå°†ä¸»å†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°ä¸»æœºçš„å·¥ä½œå†…å­˜ä¸­ï¼Œå¦‚æ­¤å°±ä¿è¯äº†<strong>å†…å­˜å¯è§æ€§</strong>ã€‚</p>
<h2 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h2><blockquote>
<p> <code>ReentrantLock</code> ç±»å®ç°äº†<code>Lock</code>ï¼Œå®ƒæ‹¥æœ‰ä¸ <code>synchronized</code>ç›¸åŒçš„å¹¶å‘æ€§å’Œå†…å­˜è¯­ä¹‰ï¼Œä½†æ˜¯æ·»åŠ äº†ç±»ä¼¼å…¬å¹³é”ã€è½®è¯¢é”ã€å®šæ—¶é”ç­‰å€™å’Œå¯ä¸­æ–­é”ç­‰å€™çš„ä¸€äº›ç‰¹æ€§ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æä¾›äº†åœ¨æ¿€çƒˆäº‰ç”¨æƒ…å†µä¸‹æ›´ä½³çš„æ€§èƒ½ã€‚</p>
</blockquote>
<p>&emsp;&emsp;&ensp; ä½†ç›¸æ¯”<code>synchronized</code>é”æ¥è¯´ï¼Œ<code>Lock</code>é”ä½¿ç”¨éœ€è¦æ‰‹åŠ¨è·å–ã€æ‰‹åŠ¨é‡Šæ”¾ã€‚æˆ‘ä»¬åœ¨åˆ›å»º<code>Lock</code>å®ä¾‹çš„æ—¶å€™å¯ä»¥æŒ‡å®šä½¿ç”¨å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œéå…¬å¹³é”æ€§èƒ½ä¼šæ›´å¥½ä¸€ä¸‹(å…¬å¹³é”éœ€è¦ç»´æŠ¤å…¬å¹³æ‰€éœ€è¦çš„è®°è´¦å’ŒåŒæ­¥)ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸æ—¶å€™æ—¶éƒ½æ˜¯ç”¨éå…¬å¹³é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ReentrantLock</span><span class="params">(<span class="keyword">boolean</span> fair)</span> </span>&#123;</span><br><span class="line">       sync = fair ? <span class="keyword">new</span> FairSync() : <span class="keyword">new</span> NonfairSync();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ<code>FairSync</code>å’Œ<code>NonfairSync</code>éƒ½ç»§æ‰¿äº†<code>Sync</code>ã€‚è€Œå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«åœ¨äºè·å–é”çš„æ–¹å¼ã€‚<br>éå…¬å¹³é”ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="comment">// å…ˆåˆ¤æ–­æ­¤æ—¶é”æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œæ²¡æœ‰çš„è¯é€šè¿‡CASæ›´æ–°é”çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>)) </span><br><span class="line">                setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                acquire(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h2><blockquote>
<p>Javaçš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ï¼Œå¦‚æœè¦é˜»å¡æˆ–å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿæ¥å¸®å¿™å®Œæˆï¼Œè¿™å°±éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ä¸­ï¼Œå› æ­¤çŠ¶æ€è£…æ¢éœ€è¦è€—è´¹å¾ˆå¤šçš„å¤„ç†å™¨æ—¶é—´ï¼Œå¯¹äºä»£ç ç®€å•çš„åŒæ­¥å—çŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿ã€‚</p>
</blockquote>
<p>&emsp;&emsp;&ensp; é‚£ä¹ˆå°±å¯ä»¥é‡‡ç”¨è‡ªæ—‹é”çš„æ–¹å¼ï¼Œå‡è®¾è¿™ä¸ªæ—¶å€™æœ‰Açº¿ç¨‹æŒæœ‰é”ï¼ŒBçº¿ç¨‹ç­‰å¾…é”ï¼Œè‹¥æ˜¯Açº¿ç¨‹æŒæœ‰é”çš„æ—¶é—´å¹¶ä¸é•¿ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™Bçº¿ç¨‹ä¸ä¼šè¢«é˜»å¡è€Œæ˜¯é‡‡ç”¨â€œå¿™ç­‰â€çš„æ–¹å¼ç­‰å¾…é”è¢«é‡Šæ”¾ã€‚ä»è€Œé¿å…äº†æ“ä½œç³»ç»Ÿåˆ‡æ¢ç”¨æˆ·æ€ã€å†…æ ¸æ€çš„æ¶ˆè€—ã€‚</p>
<h3 id="å¸¦æ¥çš„é—®é¢˜ï¼š"><a href="#å¸¦æ¥çš„é—®é¢˜ï¼š" class="headerlink" title="å¸¦æ¥çš„é—®é¢˜ï¼š"></a>å¸¦æ¥çš„é—®é¢˜ï¼š</h3><p>1ã€å¯èƒ½å ç”¨å¤ªå¤šcpuèµ„æºï¼š</p>
<p>&emsp;&emsp;&ensp; è‹¥æ˜¯Açº¿ç¨‹åœ¨çŸ­æ—¶é—´å†…å¹¶ä¸é‡Šæ”¾é”ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å¯èƒ½å ç”¨å¤ªå¤šcpuæ—¶é—´ï¼Œå¯¼è‡´cpuèµ„æºæµªè´¹ã€‚å› æ­¤jvmæœ‰ä¸€ä¸ªé»˜è®¤è‡ªæ—‹æ¬¡æ•°é™åˆ¶ï¼ˆé»˜è®¤æ˜¯10æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨-XX:PreBlockSpinæ¥æ›´æ”¹ï¼‰ï¼Œè‹¥è¿˜æ˜¯æ²¡æœ‰è·å–åˆ°é”ï¼Œé‚£å°±åº”è¯¥ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼å»æŒ‚èµ·çº¿ç¨‹äº†ã€‚</p>
<p>2ã€æ­»é”é—®é¢˜<br> &emsp;&emsp;&ensp; å‡è®¾æœ‰æœ‰ä¸€ä¸ªçº¿ç¨‹è¿è¡Œåœ¨ä¸€ä¸ªå¤„ç†å™¨ä¸Šï¼Œ è€Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æƒ³è·å–è¿™ä¸ªå¤„ç†å™¨çš„é”ï¼Œ é‚£ä¹ˆä»–å°†ä¸€ç›´æŒæœ‰è¿™ä¸ªcpuè¿›è¡Œè‡ªæ—‹æ“ä½œï¼Œä½ çš„çº¿ç¨‹ä»£ç åˆ™æ°¸è¿œæ— æ³•è·å¾—æœºä¼šé‡Šæ”¾é”ï¼Œäºæ˜¯é™·å…¥æ­»é”ã€‚</p>
<h3 id="è‡ªé€‚åº”è‡ªæ—‹"><a href="#è‡ªé€‚åº”è‡ªæ—‹" class="headerlink" title="è‡ªé€‚åº”è‡ªæ—‹"></a>è‡ªé€‚åº”è‡ªæ—‹</h3><p>&emsp;&emsp;&ensp;  åœ¨jdk1.6ä¸­å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸åœ¨å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å®ç°ã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡åˆšåˆšæˆåŠŸè·å–åˆ°äº†é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆ<code>jvm</code>ä¹…è®¤ä¸ºè¿™æ¬¡ä¹Ÿèƒ½å¤Ÿè·å–æˆåŠŸï¼Œé‚£ä¹ˆä¹…å¯èƒ½å¤šå°è¯•å‡ æ¬¡æ¥è·å–ï¼Œæ¯”æ–¹è¯´50æ¬¡ã€‚è‹¥æ˜¯å¯¹äºæŸä¸€ä¸ªé”ï¼Œè‡ªé€‚åº”é”å¾ˆå°‘æˆåŠŸè¿‡ï¼Œé‚£ä¹ˆ<code>jvm</code>å¯èƒ½å°±å¿½ç•¥æ‰è‡ªæ—‹çš„è¿‡ç¨‹è€Œç›´æ¥æŒ‚èµ·ã€‚</p>
<h2 id="é”æ¶ˆé™¤"><a href="#é”æ¶ˆé™¤" class="headerlink" title="é”æ¶ˆé™¤"></a>é”æ¶ˆé™¤</h2><blockquote>
<p>é”æ¶ˆé™¤æ˜¯Javaè™šæ‹Ÿæœºåœ¨<code>JIT</code>ç¼–è¯‘æ˜¯ï¼Œé€šè¿‡å¯¹è¿è¡Œä¸Šä¸‹æ–‡çš„æ‰«æï¼Œå»é™¤ä¸å¯èƒ½å­˜åœ¨å…±äº«èµ„æºç«äº‰çš„é”ï¼Œé€šè¿‡é”æ¶ˆé™¤ï¼Œå¯ä»¥èŠ‚çœæ¯«æ— æ„ä¹‰çš„è¯·æ±‚é”æ—¶é—´ã€‚</p>
</blockquote>
<p>&emsp;&emsp;&ensp; åœ¨åŠ¨æ€ç¼–è¯‘åŒæ­¥å—çš„æ—¶å€™ï¼ŒJITç¼–è¯‘å™¨å¯ä»¥å€ŸåŠ©ä¸€ç§è¢«ç§°ä¸ºé€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰çš„æŠ€æœ¯æ¥åˆ¤æ–­åŒæ­¥å—æ‰€ä½¿ç”¨çš„é”å¯¹è±¡æ˜¯å¦åªèƒ½å¤Ÿè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®è€Œæ²¡æœ‰è¢«å‘å¸ƒåˆ°å…¶ä»–çº¿ç¨‹ã€‚å¦‚æœåŒæ­¥å—æ‰€ä½¿ç”¨çš„é”å¯¹è±¡é€šè¿‡è¿™ç§åˆ†æè¢«è¯å®åªèƒ½å¤Ÿè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆJITç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿™ä¸ªåŒæ­¥å—çš„æ—¶å€™å¹¶ä¸ç”Ÿæˆ<code>synchronized</code>æ‰€è¡¨ç¤ºçš„é”çš„ç”³è¯·ä¸é‡Šæ”¾å¯¹åº”çš„æœºå™¨ç ï¼Œè€Œä»…ç”ŸæˆåŸä¸´ç•ŒåŒºä»£ç å¯¹åº”çš„æœºå™¨ç ï¼Œè¿™å°±é€ æˆäº†è¢«åŠ¨æ€ç¼–è¯‘çš„å­—èŠ‚ç å°±åƒæ˜¯ä¸åŒ…å«<code>monitorenter</code>ï¼ˆç”³è¯·é”ï¼‰å’Œ<code>monitorexit</code>ï¼ˆé‡Šæ”¾é”ï¼‰è¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ä¸€æ ·ï¼Œå³æ¶ˆé™¤äº†é”çš„ä½¿ç”¨ã€‚è¿™ç§ç¼–è¯‘å™¨ä¼˜åŒ–å°±è¢«ç§°ä¸ºé”æ¶ˆé™¤ï¼ˆ<code>Lock Elision</code>ï¼‰ï¼Œå®ƒä½¿å¾—ç‰¹å®šæƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å®Œå…¨æ¶ˆé™¤é”çš„å¼€é”€ã€‚</p>
<p>ç¤ºæ„å›¾ï¼š</p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1517466723/jvmsuo_ber7ev.png" width="100%" height="100%"></p>
<h2 id="é”ç²—åŒ–"><a href="#é”ç²—åŒ–" class="headerlink" title="é”ç²—åŒ–"></a>é”ç²—åŒ–</h2><blockquote>
<p>é”ç²—åŒ–ï¼ˆLock Coarsening/Lock Mergingï¼‰æ˜¯JITç¼–è¯‘å™¨å¯¹å†…éƒ¨é”çš„å…·ä½“å®ç°æ‰€åšçš„ä¸€ç§ä¼˜åŒ–ã€‚</p>
</blockquote>
<p>&emsp;&emsp;ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åŠ é”ä¼šå°½é‡é”ä½æ›´å°çš„ä»£ç å—ï¼Œ è¿™æ ·ä½¿å¾—éœ€è¦åŒæ­¥çš„æ“ä½œæ•°é‡å°½å¯èƒ½å°ï¼Œå¦‚æœå­˜åœ¨ç«äº‰é‚£ä¹ˆä¹Ÿèƒ½å°½å¿«æ‹¿åˆ°é”ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹è¿™éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å¦‚æœåå¤å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œç”šè‡³åŠ é”æ“ä½œå‡ºç°åœ¨äº†å¾ªç¯ä½“ä¸­ï¼Œé¢‘ç¹çš„è¿›è¡Œäº’æ–¥æ“ä½œä¹Ÿä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ã€‚<br>å¦‚æœè™šæ‹Ÿæœºæ¢æµ‹åˆ°æœ‰è¿™æ ·çš„æƒ…å†µçš„è¯ï¼Œä¼šæŠŠåŠ é”åŒæ­¥çš„èŒƒå›´æ‰©å±•åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ï¼Œè¿™æ ·çš„ä¸€ä¸ªé”èŒƒå›´æ‰©å±•çš„æ“ä½œå°±ç§°ä¹‹ä¸ºé”ç²—åŒ–ã€‚</p>
<h2 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h2><blockquote>
<p>å®ƒçš„ç›®çš„æ˜¯æ¶ˆé™¤æ•°æ®åœ¨æ— ç«äº‰æƒ…å†µä¸‹çš„åŒæ­¥åŸè¯­ï¼Œè¿›ä¸€æ­¥æé«˜ç¨‹åºæ€§èƒ½ã€‚å¦‚æœè¯´è½»é‡çº§é”æ˜¯åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹ä½¿ç”¨<code>CAS</code>æ“ä½œå»æ¶ˆé™¤åŒæ­¥ä½¿ç”¨çš„äº’æ–¥é‡ï¼Œé‚£åå‘é”å°±æ˜¯åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹æŠŠæ•´ä¸ªåŒæ­¥éƒ½æ¶ˆé™¤æ‰ï¼Œè¿CASéƒ½ä¸åšã€‚</p>
</blockquote>
<p>&emsp;&emsp;åå‘é”ä¼šåå‘äºç¬¬ä¸€ä¸ªè·å¾—å®ƒçš„çº¿ç¨‹ï¼Œå¦‚æœåœ¨æ¥ä¸‹æ¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯¥é”æ²¡æœ‰è¢«å…¶ä»–çš„çº¿ç¨‹è·å–ï¼Œåˆ™æŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦åŒæ­¥ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½è€Œå¼•å…¥äº†åå‘é”ã€‚</p>
<p>&emsp;&emsp;å½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«çº¿ç¨‹è·å–çš„æ—¶å€™ï¼Œçº¿ç¨‹ä½¿ç”¨<code>CAS</code>æ“ä½œæŠŠè¿™ä¸ªé”çš„çº¿ç¨‹<code>ID</code>è®°å½•å†å¯¹è±¡<code>Mark Word</code>ä¹‹ä¸­ï¼ŒåŒæ—¶ç½®åå‘æ ‡å¿—ä½1ã€‚ä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡Œ<code>CAS</code>æ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€è¦ç®€å•åœ°æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„<code>Mark Word</code>é‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”</p>
<p>å‚è€ƒï¼š</p>
<p>-ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹</p>
<p><a href="http://blog.csdn.net/u013256816/article/details/51008443" target="_blank" rel="noopener">http://blog.csdn.net/u013256816/article/details/51008443</a></p>
<p><a href="https://segmentfault.com/a/1190000009828216" target="_blank" rel="noopener">https://segmentfault.com/a/1190000009828216</a></p>
<p><a href="https://www.jianshu.com/p/dfbe0ebfec95" target="_blank" rel="noopener">https://www.jianshu.com/p/dfbe0ebfec95</a></p>
<p><a href="http://www.importnew.com/19472.html" target="_blank" rel="noopener">http://www.importnew.com/19472.html</a></p>
<p><a href="http://traxexer.iteye.com/blog/1846344" target="_blank" rel="noopener">http://traxexer.iteye.com/blog/1846344</a></p>
<p><a href="http://www.broadview.com.cn/article/789" target="_blank" rel="noopener">http://www.broadview.com.cn/article/789</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>ç±»unixå¹³å°ä¸­å‡ ä¸ªå¤§æ€å™¨æŒ‡ä»¤</title>
    <url>/2017/12/14/%E7%B1%BBunix%E5%B9%B3%E5%8F%B0%E4%B8%AD%E5%87%A0%E4%B8%AA%E5%A4%A7%E6%9D%80%E5%99%A8%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="ç±»unixå¹³å°ä¸­å‡ ä¸ªå¤§æ€å™¨æŒ‡ä»¤"><a href="#ç±»unixå¹³å°ä¸­å‡ ä¸ªå¤§æ€å™¨æŒ‡ä»¤" class="headerlink" title="ç±»unixå¹³å°ä¸­å‡ ä¸ªå¤§æ€å™¨æŒ‡ä»¤"></a>ç±»unixå¹³å°ä¸­å‡ ä¸ªå¤§æ€å™¨æŒ‡ä»¤</h2><blockquote>
<p>ä¸‹è¾¹ä»‹ç»å‡ ä¸ªâ€œå¾ˆå¼ºåŠ¿â€çš„å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼Œèƒ½å¤§å¤§æé«˜æˆ‘ä»¬çš„å·¥ä½œç”Ÿäº§æ•ˆç‡ã€‚ä½¿ç”¨macOS Sierraä½œä¸ºæ¼”ç¤ºç¯å¢ƒã€‚</p>
</blockquote>
<h4 id="1ã€autojump"><a href="#1ã€autojump" class="headerlink" title="1ã€autojump"></a>1ã€autojump</h4><p>  é€šå¸¸æˆ‘ä»¬åœ¨ç±»<code>unix</code>æ“ä½œç³»ç»Ÿä¸­åˆ‡æ¢ç›®å½•éƒ½æ˜¯ä½¿ç”¨cdï¼Œä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤å¦‚æœè¦åˆ‡æ¢åˆ°å¾ˆæ·±çš„ç›®å½•ï¼Œæ˜¯å¾ˆçƒ¦æ¼çš„ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™<code>autojump</code>å°±æ˜¯å¤§æ€å™¨ã€‚</p>
<p>1ã€ åœ¨<code>mac</code>ä¸­å®‰è£…<code>autojump</code>æ¯”è¾ƒç®€å•ï¼š<br> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew install autojump</span><br></pre></td></tr></table></figure></p>
<p> ä½†æ˜¯éœ€è¦æ³¨æ„å®‰è£…å®Œå¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚åœ¨æˆ‘ä»¬å®‰è£…çš„è¿‡ç¨‹ä¸­ä¼šæœ‰å¦‚ä¸‹çš„æç¤ºï¼š</p>
<p> <img src="https://res.cloudinary.com/leon824/image/upload/v1513176176/autojump_efiljd.png" width="100%" height="100%"><br> æˆ‘ä»¬åªéœ€è¦æŒ‰ç…§æ­¥éª¤æ“ä½œå°±å¥½ï¼š<br><br>ï¼ˆ1ï¼‰ å…ˆåœ¨~/.zshrcæ–‡ä»¶æˆ–è€…~/.bash_profileä¸­æ·»åŠ </p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ -f /usr/local/etc/profile.d/autojump.sh ] &amp;&amp; . /usr/local/etc/profile.d/autojump.sh</span><br></pre></td></tr></table></figure>
<p> (2) ç„¶åsourceç›¸åº”çš„æ–‡ä»¶ï¼Œé‡æ–°æ‰“å¼€ä¸€ä¸ªçª—å£ã€‚å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
<h4 id="ç®€å•ä»‹ç»ä¸€ä¸‹autojumpçš„ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä»‹ç»ä¸€ä¸‹autojumpçš„ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä»‹ç»ä¸€ä¸‹autojumpçš„ç®€å•ä½¿ç”¨"></a>ç®€å•ä»‹ç»ä¸€ä¸‹<code>autojump</code>çš„ç®€å•ä½¿ç”¨</h4><p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªç›®å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> autojump -a [ç›®å½•]</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ çªç„¶æƒ³è¦æŠŠå½“å‰ç›®å½•å˜æˆä½ çš„æœ€çˆ±å’Œä½¿ç”¨æœ€é¢‘ç¹çš„æ–‡ä»¶å¤¹ï¼Œä½ å¯ä»¥åœ¨è¯¥ç›®å½•é€šè¿‡å‘½ä»¤çš„å‚æ•° i æ¥æ‰‹å·¥å¢åŠ å®ƒçš„æƒé‡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> autojump -i [æƒé‡]</span><br></pre></td></tr></table></figure>
<p>è¿™å°†ä½¿å¾—è¯¥ç›®å½•æ›´å¯èƒ½è¢«é€‰æ‹©è·³è½¬ã€‚ç›¸åçš„ä¾‹å­æ˜¯åœ¨è¯¥ç›®å½•ä½¿ç”¨å‚æ•° d æ¥å‡å°‘æƒé‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> autojump -d [æƒé‡]</span><br></pre></td></tr></table></figure>
<p>è¦è·Ÿè¸ªæ‰€æœ‰è¿™äº›æ”¹å˜ï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span>  autojump -s</span><br></pre></td></tr></table></figure>
<h4 id="2ã€mycli"><a href="#2ã€mycli" class="headerlink" title="2ã€mycli"></a>2ã€mycli</h4><blockquote>
<p>&emsp;&emsp; å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œæ•°æ®åº“å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ›´å–œæ¬¢ç”¨å‘½ä»¤è¡Œæ¥è®¿é—®æ•°æ®åº“ï¼Œä½†æ˜¯é»˜è®¤è‡ªå¸¦çš„<code>mysql</code>å¯¹æ“ä½œå¹¶ä¸æ˜¯ååˆ†å‹å¥½ï¼Œä¸èƒ½è‡ªåŠ¨è¡¥å…¨ï¼Œæ²¡æœ‰è¯­æ³•é«˜äº®ã€‚<br>è¿™ä¸ªæ—¶å€™ä½¿ç”¨<code>mycli</code>å°±å†åˆé€‚ä¸è¿‡äº†ã€‚</p>
</blockquote>
<p>1ã€ å…ˆå®‰è£…ï¼Œä¾æ—§ä½¿ç”¨<code>brew</code>æ¥å®‰è£…ç®¡ç†<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew install mycli</span><br></pre></td></tr></table></figure></p>
<p> ç„¶åä½¿ç”¨<code>mycli -u username</code>è¿›å…¥æ•°æ®åº“ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œä¸éœ€è¦-på‚æ•°ã€‚<br> å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p> <img src="https://res.cloudinary.com/leon824/image/upload/v1513176886/mycli_heofoa.png" width="100%" height="100%"></p>
<h4 id="3ã€screen"><a href="#3ã€screen" class="headerlink" title="3ã€screen"></a>3ã€screen</h4><blockquote>
<p>å½“æˆ‘ä»¬åœ¨é€šè¿‡<code>ssh</code>è¿æ¥è¿œç«¯æœºå™¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œæ—¶é—´ç›¸å¯¹æ¯”è¾ƒçŸ­è¿˜å¥½ï¼Œå¦‚æœæ˜¯æ‰§è¡Œ<code>hadoop</code>çš„ä»»åŠ¡ï¼Œå¾ˆå¤šæ—¶å€™å›è¶…è¿‡å‡ ä¸ªå°æ—¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å¦‚æœ<code>ssh</code>è¿æ¥ä¸­æ–­äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡ä¹Ÿä¼šå¤±è´¥ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™<code>screen</code>å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> brew install screen</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥åå°æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> screen</span><br></pre></td></tr></table></figure>
<p>å½“å¼€å§‹æ‰§è¡Œä»»åŠ¡ä¹‹åä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤é€€å‡ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> control + A + D</span><br></pre></td></tr></table></figure>
<p>å°†æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡åˆ—ä¸¾å‡ºæ¥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> screen -ls</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œè¿›åº¦ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> screen -r è¿›ç¨‹å·</span><br></pre></td></tr></table></figure>
<p>è¿˜åŒ…æ‹¬<code>axel</code>ã€<code>fasd</code>ã€m-cliç­‰ç­‰æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªå·±ç ”ç©¶ã€‚</p>
]]></content>
      <categories>
        <category>macOS</category>
      </categories>
  </entry>
  <entry>
    <title>è®°å½•sparkä¸€æ¬¡è¸©å‘</title>
    <url>/2017/11/27/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1spark%E8%B8%A9%E5%9D%91/</url>
    <content><![CDATA[<h2 id="Application-has-been-killed-Reason-Master-removed-our-application-FAILED"><a href="#Application-has-been-killed-Reason-Master-removed-our-application-FAILED" class="headerlink" title="Application has been killed. Reason: Master removed our application: FAILED"></a>Application has been killed. Reason: Master removed our application: FAILED</h2><p> sparkä»äº”æœˆä»½å¼€å§‹è·‘åˆ°11æœˆä»½ä¸€ç›´æ­£å¸¸ï¼Œä½†æ˜¯åœ¨æœ€è¿‘ä¸¤å¤©æŠ¥å¦‚ä¸‹çš„é”™è¯¯ã€‚</p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1511777579/spark2_mkrjds.png" width="100%" height="100%"></p>
<p>æŸ¥çœ‹workerè¿è¡Œçš„logï¼Œå‘ç°ä¸‹é¢çš„é—®é¢˜ã€‚</p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1511777840/spark3_g4xgox.png" width="100%" height="100%"></p>
<p>ç„¶åè¿›å…¥åˆ°/opt/soft/spark/workç›®å½•å‘ç°å½“å‰æœ‰31999ä¸ªæ–‡ä»¶ï¼Œ</p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1511777578/spark1_mzgwvz.png" width="100%" height="100%"></p>
<p>è€Œåœ¨linuxæ–‡ä»¶ç³»ç»Ÿä¸­ä¸€ä¸ªæ–‡ä»¶å¤¹æœ€å¤šèƒ½å¤Ÿ32000ä¸ªå­æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå½“å‰ç›®å½•ã€çˆ¶çº§ç›®å½•ï¼Œé‚£ä¹ˆæ“ä½œè¿™ä¸ªæ•°å°±æ— æ³•åœ¨è¿™ä¸ªç›®å½•ä¸­å†™å…¥æ–‡ä»¶ã€‚åœ¨linux å†…æ ¸ä¸­æœ‰ä¸‹é¢çš„å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">include/linux/ext2_fs.h:<span class="meta">#<span class="meta-keyword">define</span> EXT2_LINK_MAX           32000</span></span><br><span class="line">include/linux/ext3_fs.h:<span class="meta">#<span class="meta-keyword">define</span> EXT3_LINK_MAX           32000</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ï¼Œåªèƒ½å°†ç”Ÿæˆçš„å¤šä½™ä¸´æ—¶æ–‡ä»¶åˆ é™¤äº†ã€‚åŠ¨æ‰‹ingâ€¦.</p>
<p>åˆ é™¤ä¹‹åï¼Œé‡æ–°æäº¤sparkä»»åŠ¡ï¼Œæ²¡æœ‰é—®é¢˜ã€‚<br><img src="http://res.cloudinary.com/leon824/image/upload/v1511778332/spark4_vnexdx.png" width="100%" height="100%"></p>
]]></content>
      <categories>
        <category>spark</category>
      </categories>
  </entry>
  <entry>
    <title>pythonçˆ¬è™«å¦‚ä½•è·å–åˆ°åªéœ€è¦çš„æ•°æ®</title>
    <url>/2017/09/18/python%E7%88%AC%E8%99%AB%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%88%B0%E5%8F%AA%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<h3 id="pythonçˆ¬è™«å¦‚ä½•è·å–åˆ°åªéœ€è¦çš„æ•°æ®"><a href="#pythonçˆ¬è™«å¦‚ä½•è·å–åˆ°åªéœ€è¦çš„æ•°æ®" class="headerlink" title="pythonçˆ¬è™«å¦‚ä½•è·å–åˆ°åªéœ€è¦çš„æ•°æ®"></a>pythonçˆ¬è™«å¦‚ä½•è·å–åˆ°åªéœ€è¦çš„æ•°æ®</h3><blockquote>
<p>æ¦‚è¿°ï¼šåœ¨çˆ¬è™«çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæœ€éº»çƒ¦çš„ä¹Ÿè®¸å°±æ˜¯å¦‚ä½•ä»ä¸€å¤§å †htmlæ ‡ç­¾ä¸­è¿‡æ»¤å‡ºæˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œåœ¨è¿™é‡Œæœ‰ä¸‰ç§æ–¹æ³•ï¼šreæ­£åˆ™è¡¨è¾¾å¼ã€BeautifulSoupã€ä½¿ç”¨lxmlä¸­çš„xpathã€‚</p>
</blockquote>
<h4 id="1-ã€å…ˆä»‹ç»å¦‚ä½•ä½¿ç”¨lxmlä¸­çš„xpath"><a href="#1-ã€å…ˆä»‹ç»å¦‚ä½•ä½¿ç”¨lxmlä¸­çš„xpath" class="headerlink" title="1 ã€å…ˆä»‹ç»å¦‚ä½•ä½¿ç”¨lxmlä¸­çš„xpath"></a>1 ã€å…ˆä»‹ç»å¦‚ä½•ä½¿ç”¨lxmlä¸­çš„xpath</h4><p>(1)  æˆ‘ä»¬éœ€è¦å®‰è£…ç›¸åº”çš„ä¾èµ–ï¼Œç„¶ååœ¨é¡¹ç›®ä¸­å¯¼å…¥ç›¸åº”çš„æ¨¡å—</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">from lxml import etree</span><br><span class="line">import lxml</span><br></pre></td></tr></table></figure>
<p>(2) ä¹‹åå†ä»£ç ä¸­è½¬åŒ–æˆxpath<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">detailPath = etree.HTML(html)</span><br><span class="line">        questions_titile = detailPath.xpath(<span class="string">'//ul[@class="list-group"]/li/div/div[@class="question-title"]/a/text()'</span>)</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ä¸Šè¾¹çš„ä¸¤ä¸ªå•å¼•å·ä¹‹é—´çš„ä¸€ä¸²ï¼Œå‰é¢ä¸¤ä¸ªâ€™//â€˜æ˜¯è¡¨ç¤ºä»è¿™é‡Œå¼€å§‹ï¼Œç„¶åä¸€çº§ä¸€çº§çš„å»å¯»æ‰¾æ‰€éœ€è¦çš„å…ƒç´ ï¼Œå¦‚æœæƒ³è·å–å±æ€§å€¼ï¼Œä¾‹å¦‚æ˜¯å›¾ç‰‡çš„urlï¼Œæœ€åå¯ä»¥ä½¿ç”¨<br>@hrefï¼Œå¦‚æœæƒ³è·å–é‡Œè¾¹çš„æ–‡æœ¬å€¼ï¼Œé‚£å°±ä½¿ç”¨text()ã€‚</p>
<p>(3) ç‰¹æ®Šç”¨æ³•<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from lxml import etree</span><br><span class="line">html=&quot;&quot;&quot;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id=&quot;aa&quot;&gt;aa&lt;/div&gt;</span><br><span class="line">        &lt;div id=&quot;ab&quot;&gt;ab&lt;/div&gt;</span><br><span class="line">        &lt;div id=&quot;ac&quot;&gt;ac&lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">selector=etree.HTML(html)</span><br><span class="line">content=selector.xpath(&apos;//div[starts-with(@id,&quot;a&quot;)]/text()&apos;) #è¿™é‡Œä½¿ç”¨starts-withæ–¹æ³•æå–divçš„idæ ‡ç­¾å±æ€§å€¼å¼€å¤´ä¸ºaçš„divæ ‡ç­¾</span><br></pre></td></tr></table></figure></p>
<p>è¿™ç¯‡æ–‡ç« æœ‰ç®€å•åº”ç”¨ï¼š<a href="http://blog.csdn.net/winterto1990/article/details/47903653ä»‹ç»" target="_blank" rel="noopener">http://blog.csdn.net/winterto1990/article/details/47903653ä»‹ç»</a>    </p>
<p><strong>æœ€åä¸€ä¸ªå¤§ç»æ‹›ï¼šç›´æ¥åœ¨chromeä¸­å¼€å‘è€…æ¨¡å¼ï¼Œå³é”®æ‰¾åˆ°ä½ æƒ³å¯»æ‰¾çš„å…ƒç´ æ ‡ç­¾ï¼Œcopy xpathå°±èƒ½å°†è¿™ä¸ªå…ƒç´ å¯¹åº”çš„xpathæ‰¾åˆ°ï¼</strong>    </p>
<h4 id="1-ã€pythonä¸­æä¾›çš„reæ¨¡å—"><a href="#1-ã€pythonä¸­æä¾›çš„reæ¨¡å—" class="headerlink" title="1 ã€pythonä¸­æä¾›çš„reæ¨¡å—"></a>1 ã€pythonä¸­æä¾›çš„reæ¨¡å—</h4><blockquote>
<p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç§æ›´ä¸ºå¼ºå¤§çš„å­—ç¬¦ä¸²åŒ¹é…ã€å­—ç¬¦ä¸²æŸ¥æ‰¾ã€å­—ç¬¦ä¸²æ›¿æ¢ç­‰æ“ä½œå·¥å…·ã€‚ä¸Šç¯‡è®²è§£äº†æ­£åˆ™è¡¨è¾¾å¼çš„åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•ä»¥åŠreæ¨¡å—çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼Œè¿™èŠ‚æ¥è¯¦ç»†è¯´è¯´ re æ¨¡å—ä½œä¸º Python æ­£åˆ™è¡¨è¾¾å¼å¼•æ“æä¾›äº†å“ªäº›ä¾¿åˆ©æ€§æ“ä½œã€‚<br>æ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯å›´ç»•ç€åŒ¹é…å¯¹è±¡(Match)è¿›è¡Œçš„ï¼Œåªæœ‰è¡¨è¾¾å¼ä¸å­—ç¬¦ä¸²åŒ¹é…æ‰æœ‰å¯èƒ½è¿›è¡Œåç»­æ“ä½œã€‚åˆ¤æ–­åŒ¹é…ä¸å¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ re.match() å’Œ re.search()ï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
</blockquote>
<p>åŒºåˆ«ï¼š<br>match æ–¹æ³•ä»å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®å¼€å§‹æ£€æŸ¥ï¼Œå¦‚æœåˆšå¥½æœ‰ä¸€ä¸ªå­å­—ç¬¦ä¸²ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…ï¼Œåˆ™è¿”å›ä¸€ä¸ªMatchå¯¹è±¡ï¼Œåªè¦èµ·å§‹ä½ç½®ä¸åŒ¹é…åˆ™é€€å‡ºï¼Œä¸å†å¾€åæ£€æŸ¥äº†ï¼Œè¿”å› None</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; re.match(r&quot;b.r&quot;, &quot;foobar&quot;)   # ä¸åŒ¹é…</span><br><span class="line">&gt;&gt;&gt; re.match(r&quot;b.r&quot;, &quot;barfoo&quot;)   # åŒ¹é…</span><br><span class="line">&lt;_sre.SRE_Match object at 0x102f05b28&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>search æ–¹æ³•è™½ç„¶ä¹Ÿæ˜¯ä»èµ·å§‹ä½ç½®å¼€å§‹æ£€æŸ¥ï¼Œä½†æ˜¯å®ƒåœ¨èµ·å§‹ä½ç½®ä¸åŒ¹é…çš„æ—¶å€™ä¼šä¸€ç›´å°è¯•å¾€åæ£€æŸ¥ï¼Œç›´åˆ°åŒ¹é…ä¸ºæ­¢ï¼Œå¦‚æœåˆ°å­—ç¬¦ä¸²çš„æœ«å°¾è¿˜æ²¡æœ‰åŒ¹é…ï¼Œåˆ™è¿”å› None<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; re.search(r&quot;b.r&quot;, &quot;foobar&quot;) # åŒ¹é…</span><br><span class="line">&lt;_sre.SRE_Match object at 0x000000000254D578&gt;</span><br><span class="line">&gt;&gt;&gt; re.match(r&quot;b.r&quot;, &quot;foobr&quot;)  # ä¸åŒ¹é…</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯äºŒè€…éƒ½æ˜¯åŒ¹é…åˆ°å°±åœæ­¢åŒ¹é…äº†ï¼Œå“ªæ€•è¿˜æœ‰æ›´å¤šèƒ½åŒ¹é…çš„ä¹Ÿä¸ç®¡ã€‚</p>
<p>å‚è€ƒï¼š<a href="https://foofish.net/re-tutorial.html" target="_blank" rel="noopener">https://foofish.net/re-tutorial.html</a>    ã€<a href="https://foofish.net/crawler-re-second.html" target="_blank" rel="noopener">https://foofish.net/crawler-re-second.html</a></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>java å·¥ç¨‹å¸ˆæˆç¥ä¹‹è·¯(è½¬è½½)</title>
    <url>/2018/06/28/java%20%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%88%90%E7%A5%9E%E4%B9%8B%E8%B7%AF(%E8%BD%AC%E8%BD%BD)/</url>
    <content><![CDATA[<blockquote>
<p>ä»Šå¤©åœ¨è®ºå›ä¸Šçœ‹åˆ°çš„ä¸€ä¸ªå¸–å­ï¼Œä¸Šè¾¹æåˆ°çš„å†…å®¹æä¸ºå®½æ³›ï¼Œå¯èƒ½åœ¨çŸ­æ—¶é—´å†…ä¸å¯èƒ½å®Œå…¨åšåˆ°æåˆ°çš„æ‰€æœ‰å†…å®¹ï¼Œä½†ä¹Ÿä¸å¦¨ä½œä¸ºä¸€ä¸ªå­¦ä¹ çš„ç›®æ ‡ã€‚<br><a href="https://www.v2ex.com/t/466451#reply2" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
</blockquote>
<h3 id="åŸºç¡€ç¯‡"><a href="#åŸºç¡€ç¯‡" class="headerlink" title="åŸºç¡€ç¯‡"></a>åŸºç¡€ç¯‡</h3><h4 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h4><h5 id="JVMå†…å­˜ç»“æ„"><a href="#JVMå†…å­˜ç»“æ„" class="headerlink" title="JVMå†…å­˜ç»“æ„"></a>JVMå†…å­˜ç»“æ„</h5><p>å †ã€æ ˆã€æ–¹æ³•åŒºã€ç›´æ¥å†…å­˜ã€å †å’Œæ ˆåŒºåˆ«</p>
<h5 id="Java-å†…å­˜æ¨¡å‹"><a href="#Java-å†…å­˜æ¨¡å‹" class="headerlink" title="Java å†…å­˜æ¨¡å‹"></a>Java å†…å­˜æ¨¡å‹</h5><p>å†…å­˜å¯è§æ€§ã€é‡æ’åºã€é¡ºåºä¸€è‡´æ€§ã€volatileã€é”ã€final</p>
<h5 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h5><p>å†…å­˜åˆ†é…ç­–ç•¥ã€åƒåœ¾æ”¶é›†å™¨ï¼ˆ G1 ï¼‰ã€GC ç®—æ³•ã€GC å‚æ•°ã€å¯¹è±¡å­˜æ´»çš„åˆ¤å®š</p>
<h5 id="JVM-å‚æ•°åŠè°ƒä¼˜"><a href="#JVM-å‚æ•°åŠè°ƒä¼˜" class="headerlink" title="JVM å‚æ•°åŠè°ƒä¼˜"></a>JVM å‚æ•°åŠè°ƒä¼˜</h5><h5 id="Java-å¯¹è±¡æ¨¡å‹"><a href="#Java-å¯¹è±¡æ¨¡å‹" class="headerlink" title="Java å¯¹è±¡æ¨¡å‹"></a>Java å¯¹è±¡æ¨¡å‹</h5><p>oop-klassã€å¯¹è±¡å¤´</p>
<h5 id="HotSpot"><a href="#HotSpot" class="headerlink" title="HotSpot"></a>HotSpot</h5><p>å³æ—¶ç¼–è¯‘å™¨ã€ç¼–è¯‘ä¼˜åŒ–</p>
<h5 id="ç±»åŠ è½½æœºåˆ¶"><a href="#ç±»åŠ è½½æœºåˆ¶" class="headerlink" title="ç±»åŠ è½½æœºåˆ¶"></a>ç±»åŠ è½½æœºåˆ¶</h5><p>classLoaderã€ç±»åŠ è½½è¿‡ç¨‹ã€åŒäº²å§”æ´¾ï¼ˆç ´ååŒäº²å§”æ´¾ï¼‰ã€æ¨¡å—åŒ–ï¼ˆ jboss modulesã€osgiã€jigsaw ï¼‰</p>
<h5 id="è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·"><a href="#è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·" class="headerlink" title="è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·"></a>è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·</h5><p> jps, jstack, jmapã€jstat, jconsole, jinfo, jhat, javap, btraceã€TProfiler</p>
<p>ç¼–è¯‘ä¸åç¼–è¯‘</p>
<p>javacã€javapã€jadã€CRF</p>
<h4 id="Java-åŸºç¡€çŸ¥è¯†"><a href="#Java-åŸºç¡€çŸ¥è¯†" class="headerlink" title="Java åŸºç¡€çŸ¥è¯†"></a>Java åŸºç¡€çŸ¥è¯†</h4><h6 id="é˜…è¯»æºä»£ç "><a href="#é˜…è¯»æºä»£ç " class="headerlink" title="é˜…è¯»æºä»£ç "></a>é˜…è¯»æºä»£ç </h6><p>Stringã€Integerã€Longã€Enumã€BigDecimalã€ThreadLocalã€ClassLoader &amp; URLClassLoaderã€ArrayList &amp; LinkedListã€HashMap &amp; LinkedHashMap &amp; TreeMap &amp; CouncurrentHashMapã€HashSet &amp; LinkedHashSet &amp; TreeSet</p>
<h5 id="Javaä¸­å„ç§å˜é‡ç±»å‹"><a href="#Javaä¸­å„ç§å˜é‡ç±»å‹" class="headerlink" title="Javaä¸­å„ç§å˜é‡ç±»å‹"></a>Javaä¸­å„ç§å˜é‡ç±»å‹</h5><h5 id="ç†Ÿæ‚‰-Java-String-çš„ä½¿ç”¨ï¼Œç†Ÿæ‚‰-String-çš„å„ç§å‡½æ•°"><a href="#ç†Ÿæ‚‰-Java-String-çš„ä½¿ç”¨ï¼Œç†Ÿæ‚‰-String-çš„å„ç§å‡½æ•°" class="headerlink" title="ç†Ÿæ‚‰ Java String çš„ä½¿ç”¨ï¼Œç†Ÿæ‚‰ String çš„å„ç§å‡½æ•°"></a>ç†Ÿæ‚‰ Java String çš„ä½¿ç”¨ï¼Œç†Ÿæ‚‰ String çš„å„ç§å‡½æ•°</h5><p>JDK 6 å’Œ JDK 7 ä¸­ substring çš„åŸç†åŠåŒºåˆ«ã€</p>
<p>replaceFirstã€replaceAllã€replace åŒºåˆ«ã€</p>
<p>String å¯¹â€œ+â€çš„é‡è½½ã€</p>
<p>String.valueOf å’Œ Integer.toString çš„åŒºåˆ«ã€</p>
<p>å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§</p>
<p>è‡ªåŠ¨æ‹†è£…ç®±</p>
<p>Integer çš„ç¼“å­˜æœºåˆ¶</p>
<h5 id="ç†Ÿæ‚‰-Java-ä¸­å„ç§å…³é”®å­—"><a href="#ç†Ÿæ‚‰-Java-ä¸­å„ç§å…³é”®å­—" class="headerlink" title="ç†Ÿæ‚‰ Java ä¸­å„ç§å…³é”®å­—"></a>ç†Ÿæ‚‰ Java ä¸­å„ç§å…³é”®å­—</h5><p>transientã€instanceofã€volatileã€synchronizedã€finalã€staticã€const åŸç†åŠç”¨æ³•ã€‚</p>
<h5 id="é›†åˆç±»"><a href="#é›†åˆç±»" class="headerlink" title="é›†åˆç±»"></a>é›†åˆç±»</h5><p>å¸¸ç”¨é›†åˆç±»çš„ä½¿ç”¨ã€ArrayList å’Œ LinkedList å’Œ Vector çš„åŒºåˆ« ã€SynchronizedList å’Œ Vector çš„åŒºåˆ«ã€HashMapã€HashTableã€ConcurrentHashMap åŒºåˆ«ã€Java 8 ä¸­ stream ç›¸å…³ç”¨æ³•ã€apache é›†åˆå¤„ç†å·¥å…·ç±»çš„ä½¿ç”¨ã€ä¸åŒç‰ˆæœ¬çš„ JDK ä¸­ HashMap çš„å®ç°çš„åŒºåˆ«ä»¥åŠåŸå› </p>
<h5 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h5><p>æšä¸¾çš„ç”¨æ³•ã€æšä¸¾ä¸å•ä¾‹ã€Enum ç±»</p>
<h5 id="Java-IO-amp-Java-NIOï¼Œå¹¶å­¦ä¼šä½¿ç”¨"><a href="#Java-IO-amp-Java-NIOï¼Œå¹¶å­¦ä¼šä½¿ç”¨" class="headerlink" title="Java IO&amp;Java NIOï¼Œå¹¶å­¦ä¼šä½¿ç”¨"></a>Java IO&amp;Java NIOï¼Œå¹¶å­¦ä¼šä½¿ç”¨</h5><p>bioã€nio å’Œ aio çš„åŒºåˆ«ã€ä¸‰ç§ IO çš„ç”¨æ³•ä¸åŸç†ã€netty</p>
<h5 id="Java-åå°„ä¸-javassist"><a href="#Java-åå°„ä¸-javassist" class="headerlink" title="Java åå°„ä¸ javassist"></a>Java åå°„ä¸ javassist</h5><p>åå°„ä¸å·¥å‚æ¨¡å¼ã€ java.lang.reflect.*</p>
<h5 id="Java-åºåˆ—åŒ–"><a href="#Java-åºåˆ—åŒ–" class="headerlink" title="Java åºåˆ—åŒ–"></a>Java åºåˆ—åŒ–</h5><p>ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€ä¸ºä»€ä¹ˆåºåˆ—åŒ–ã€åºåˆ—åŒ–åº•å±‚åŸç†ã€åºåˆ—åŒ–ä¸å•ä¾‹æ¨¡å¼ã€protobufã€ä¸ºä»€ä¹ˆè¯´åºåˆ—åŒ–å¹¶ä¸å®‰å…¨</p>
<h5 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h5><p>å…ƒæ³¨è§£ã€è‡ªå®šä¹‰æ³¨è§£ã€Java ä¸­å¸¸ç”¨æ³¨è§£ä½¿ç”¨ã€æ³¨è§£ä¸åå°„çš„ç»“åˆ</p>
<h5 id="JMS"><a href="#JMS" class="headerlink" title="JMS"></a>JMS</h5><p>ä»€ä¹ˆæ˜¯ Java æ¶ˆæ¯æœåŠ¡ã€JMS æ¶ˆæ¯ä¼ é€æ¨¡å‹</p>
<h5 id="JMX"><a href="#JMX" class="headerlink" title="JMX"></a>JMX</h5><p>java.lang.management.<em>ã€ javax.management.</em></p>
<h4 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h4><p>æ³›å‹ä¸ç»§æ‰¿ã€ç±»å‹æ“¦é™¤ã€æ³›å‹ä¸­ K T V E ï¼Ÿ object ç­‰çš„å«ä¹‰ã€æ³›å‹å„ç§ç”¨æ³•</p>
<h5 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h5><p>junitã€mockã€mockitoã€å†…å­˜æ•°æ®åº“ï¼ˆ h2 ï¼‰</p>
<h5 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h5><p>java.lang.util.regex.*</p>
<h5 id="å¸¸ç”¨çš„-Java-å·¥å…·åº“"><a href="#å¸¸ç”¨çš„-Java-å·¥å…·åº“" class="headerlink" title="å¸¸ç”¨çš„ Java å·¥å…·åº“"></a>å¸¸ç”¨çš„ Java å·¥å…·åº“</h5><p>commons.lang, commons.*â€¦ guava-libraries netty</p>
<h5 id="ä»€ä¹ˆæ˜¯-API-amp-SPI"><a href="#ä»€ä¹ˆæ˜¯-API-amp-SPI" class="headerlink" title="ä»€ä¹ˆæ˜¯ API&amp;SPI"></a>ä»€ä¹ˆæ˜¯ API&amp;SPI</h5><h5 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h5><p>å¼‚å¸¸ç±»å‹ã€æ­£ç¡®å¤„ç†å¼‚å¸¸ã€è‡ªå®šä¹‰å¼‚å¸¸</p>
<h5 id="æ—¶é—´å¤„ç†"><a href="#æ—¶é—´å¤„ç†" class="headerlink" title="æ—¶é—´å¤„ç†"></a>æ—¶é—´å¤„ç†</h5><p>æ—¶åŒºã€æ—¶ä»¤ã€Java ä¸­æ—¶é—´ API</p>
<h5 id="ç¼–ç æ–¹å¼"><a href="#ç¼–ç æ–¹å¼" class="headerlink" title="ç¼–ç æ–¹å¼"></a>ç¼–ç æ–¹å¼</h5><p>è§£å†³ä¹±ç é—®é¢˜ã€å¸¸ç”¨ç¼–ç æ–¹å¼</p>
<h5 id="è¯­æ³•ç³–"><a href="#è¯­æ³•ç³–" class="headerlink" title="è¯­æ³•ç³–"></a>è¯­æ³•ç³–</h5><p>Java ä¸­è¯­æ³•ç³–åŸç†ã€è§£è¯­æ³•ç³–</p>
<h4 id="Java-å¹¶å‘ç¼–ç¨‹"><a href="#Java-å¹¶å‘ç¼–ç¨‹" class="headerlink" title="Java å¹¶å‘ç¼–ç¨‹"></a>Java å¹¶å‘ç¼–ç¨‹</h4><h5 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œä¸è¿›ç¨‹çš„åŒºåˆ«"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œä¸è¿›ç¨‹çš„åŒºåˆ«" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œä¸è¿›ç¨‹çš„åŒºåˆ«"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œä¸è¿›ç¨‹çš„åŒºåˆ«</h5><h5 id="é˜…è¯»æºä»£ç ï¼Œå¹¶å­¦ä¼šä½¿ç”¨"><a href="#é˜…è¯»æºä»£ç ï¼Œå¹¶å­¦ä¼šä½¿ç”¨" class="headerlink" title="é˜…è¯»æºä»£ç ï¼Œå¹¶å­¦ä¼šä½¿ç”¨"></a>é˜…è¯»æºä»£ç ï¼Œå¹¶å­¦ä¼šä½¿ç”¨</h5><p>Threadã€Runnableã€Callableã€ReentrantLockã€ReentrantReadWriteLockã€Atomic*ã€Semaphoreã€CountDownLatchã€ã€ConcurrentHashMapã€Executors</p>
<h5 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h5><p>è‡ªå·±è®¾è®¡çº¿ç¨‹æ± ã€submit() å’Œ execute()</p>
<h5 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h5><p>æ­»é”ã€æ­»é”å¦‚ä½•æ’æŸ¥ã€Java çº¿ç¨‹è°ƒåº¦ã€çº¿ç¨‹å®‰å…¨å’Œå†…å­˜æ¨¡å‹çš„å…³ç³»</p>
<h5 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h5><p>CASã€ä¹è§‚é”ä¸æ‚²è§‚é”ã€æ•°æ®åº“ç›¸å…³é”æœºåˆ¶ã€åˆ†å¸ƒå¼é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ã€monitorã€é”ä¼˜åŒ–ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€è‡ªæ—‹é”ã€å¯é‡å…¥é”ã€é˜»å¡é”ã€æ­»é”</p>
<h5 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h5><h5 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h5><h5 id="happens-beforeã€ç¼–è¯‘å™¨æŒ‡ä»¤é‡æ’å’Œ-CPU-æŒ‡ä»¤é‡"><a href="#happens-beforeã€ç¼–è¯‘å™¨æŒ‡ä»¤é‡æ’å’Œ-CPU-æŒ‡ä»¤é‡" class="headerlink" title="happens-beforeã€ç¼–è¯‘å™¨æŒ‡ä»¤é‡æ’å’Œ CPU æŒ‡ä»¤é‡"></a>happens-beforeã€ç¼–è¯‘å™¨æŒ‡ä»¤é‡æ’å’Œ CPU æŒ‡ä»¤é‡</h5><h5 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h5><p>synchronized æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ synchronized å’Œ lock ä¹‹é—´å…³ç³»ã€ä¸ä½¿ç”¨ synchronized å¦‚ä½•å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹</p>
<h5 id="sleep-å’Œ-wait"><a href="#sleep-å’Œ-wait" class="headerlink" title="sleep å’Œ wait"></a>sleep å’Œ wait</h5><h5 id="wait-å’Œ-notify"><a href="#wait-å’Œ-notify" class="headerlink" title="wait å’Œ notify"></a>wait å’Œ notify</h5><h5 id="notify-å’Œ-notifyAll"><a href="#notify-å’Œ-notifyAll" class="headerlink" title="notify å’Œ notifyAll"></a>notify å’Œ notifyAll</h5><h5 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h5><h5 id="å†™ä¸€ä¸ªæ­»é”çš„ç¨‹åº"><a href="#å†™ä¸€ä¸ªæ­»é”çš„ç¨‹åº" class="headerlink" title="å†™ä¸€ä¸ªæ­»é”çš„ç¨‹åº"></a>å†™ä¸€ä¸ªæ­»é”çš„ç¨‹åº</h5><h5 id="å†™ä»£ç æ¥è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜"><a href="#å†™ä»£ç æ¥è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜" class="headerlink" title="å†™ä»£ç æ¥è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜"></a>å†™ä»£ç æ¥è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</h5><h5 id="å®ˆæŠ¤çº¿ç¨‹"><a href="#å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹"></a>å®ˆæŠ¤çº¿ç¨‹</h5><h5 id="å®ˆæŠ¤çº¿ç¨‹å’Œéå®ˆæŠ¤çº¿ç¨‹çš„åŒºåˆ«ä»¥åŠç”¨æ³•"><a href="#å®ˆæŠ¤çº¿ç¨‹å’Œéå®ˆæŠ¤çº¿ç¨‹çš„åŒºåˆ«ä»¥åŠç”¨æ³•" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹å’Œéå®ˆæŠ¤çº¿ç¨‹çš„åŒºåˆ«ä»¥åŠç”¨æ³•"></a>å®ˆæŠ¤çº¿ç¨‹å’Œéå®ˆæŠ¤çº¿ç¨‹çš„åŒºåˆ«ä»¥åŠç”¨æ³•</h5><h3 id="è¿›é˜¶ç¯‡"><a href="#è¿›é˜¶ç¯‡" class="headerlink" title="è¿›é˜¶ç¯‡"></a>è¿›é˜¶ç¯‡</h3><h4 id="Java-åº•å±‚çŸ¥è¯†"><a href="#Java-åº•å±‚çŸ¥è¯†" class="headerlink" title="Java åº•å±‚çŸ¥è¯†"></a>Java åº•å±‚çŸ¥è¯†</h4><h5 id="å­—èŠ‚ç ã€class-æ–‡ä»¶æ ¼å¼"><a href="#å­—èŠ‚ç ã€class-æ–‡ä»¶æ ¼å¼" class="headerlink" title="å­—èŠ‚ç ã€class æ–‡ä»¶æ ¼å¼"></a>å­—èŠ‚ç ã€class æ–‡ä»¶æ ¼å¼</h5><h5 id="CPU-ç¼“å­˜ï¼ŒL1ï¼ŒL2ï¼ŒL3-å’Œä¼ªå…±äº«"><a href="#CPU-ç¼“å­˜ï¼ŒL1ï¼ŒL2ï¼ŒL3-å’Œä¼ªå…±äº«" class="headerlink" title="CPU ç¼“å­˜ï¼ŒL1ï¼ŒL2ï¼ŒL3 å’Œä¼ªå…±äº«"></a>CPU ç¼“å­˜ï¼ŒL1ï¼ŒL2ï¼ŒL3 å’Œä¼ªå…±äº«</h5><h5 id="å°¾é€’å½’"><a href="#å°¾é€’å½’" class="headerlink" title="å°¾é€’å½’"></a>å°¾é€’å½’</h5><h5 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h5><h5 id="ç”¨ä½è¿ç®—å®ç°åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–ä½™"><a href="#ç”¨ä½è¿ç®—å®ç°åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–ä½™" class="headerlink" title="ç”¨ä½è¿ç®—å®ç°åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–ä½™"></a>ç”¨ä½è¿ç®—å®ç°åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–ä½™</h5><h4 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h4><h5 id="äº†è§£-23-ç§è®¾è®¡æ¨¡å¼"><a href="#äº†è§£-23-ç§è®¾è®¡æ¨¡å¼" class="headerlink" title="äº†è§£ 23 ç§è®¾è®¡æ¨¡å¼"></a>äº†è§£ 23 ç§è®¾è®¡æ¨¡å¼</h5><p>ä¼šä½¿ç”¨å¸¸ç”¨è®¾è®¡æ¨¡å¼<br>å•ä¾‹ã€ç­–ç•¥ã€å·¥å‚ã€é€‚é…å™¨ã€è´£ä»»é“¾ã€‚</p>
<h5 id="å®ç°-AOP"><a href="#å®ç°-AOP" class="headerlink" title="å®ç° AOP"></a>å®ç° AOP</h5><h5 id="å®ç°-IOC"><a href="#å®ç°-IOC" class="headerlink" title="å®ç° IOC"></a>å®ç° IOC</h5><h5 id="ä¸ç”¨-synchronized-å’Œ-lockï¼Œå®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼"><a href="#ä¸ç”¨-synchronized-å’Œ-lockï¼Œå®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼" class="headerlink" title="ä¸ç”¨ synchronized å’Œ lockï¼Œå®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼"></a>ä¸ç”¨ synchronized å’Œ lockï¼Œå®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼</h5><h5 id="nio-å’Œ-reactor-è®¾è®¡æ¨¡å¼"><a href="#nio-å’Œ-reactor-è®¾è®¡æ¨¡å¼" class="headerlink" title="nio å’Œ reactor è®¾è®¡æ¨¡å¼"></a>nio å’Œ reactor è®¾è®¡æ¨¡å¼</h5><h4 id="ç½‘ç»œç¼–ç¨‹çŸ¥è¯†"><a href="#ç½‘ç»œç¼–ç¨‹çŸ¥è¯†" class="headerlink" title="ç½‘ç»œç¼–ç¨‹çŸ¥è¯†"></a>ç½‘ç»œç¼–ç¨‹çŸ¥è¯†</h4><h5 id="tcpã€udpã€httpã€https-ç­‰å¸¸ç”¨åè®®"><a href="#tcpã€udpã€httpã€https-ç­‰å¸¸ç”¨åè®®" class="headerlink" title="tcpã€udpã€httpã€https ç­‰å¸¸ç”¨åè®®"></a>tcpã€udpã€httpã€https ç­‰å¸¸ç”¨åè®®</h5><p>ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡å…³é—­ã€æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ã€OSI ä¸ƒå±‚æ¨¡å‹ã€tcp ç²˜åŒ…ä¸æ‹†åŒ…</p>
<h5 id="http-1-0-http-1-1-http-2-ä¹‹å‰çš„åŒºåˆ«"><a href="#http-1-0-http-1-1-http-2-ä¹‹å‰çš„åŒºåˆ«" class="headerlink" title="http/1.0 http/1.1 http/2 ä¹‹å‰çš„åŒºåˆ«"></a>http/1.0 http/1.1 http/2 ä¹‹å‰çš„åŒºåˆ«</h5><h5 id="Java-RMIï¼ŒSocketï¼ŒHttpClient"><a href="#Java-RMIï¼ŒSocketï¼ŒHttpClient" class="headerlink" title="Java RMIï¼ŒSocketï¼ŒHttpClient"></a>Java RMIï¼ŒSocketï¼ŒHttpClient</h5><h5 id="cookie-ä¸-session"><a href="#cookie-ä¸-session" class="headerlink" title="cookie ä¸ session"></a>cookie ä¸ session</h5><p>cookie è¢«ç¦ç”¨ï¼Œå¦‚ä½•å®ç° session</p>
<h5 id="ç”¨-Java-å†™ä¸€ä¸ªç®€å•çš„é™æ€æ–‡ä»¶çš„-HTTP-æœåŠ¡å™¨"><a href="#ç”¨-Java-å†™ä¸€ä¸ªç®€å•çš„é™æ€æ–‡ä»¶çš„-HTTP-æœåŠ¡å™¨" class="headerlink" title="ç”¨ Java å†™ä¸€ä¸ªç®€å•çš„é™æ€æ–‡ä»¶çš„ HTTP æœåŠ¡å™¨"></a>ç”¨ Java å†™ä¸€ä¸ªç®€å•çš„é™æ€æ–‡ä»¶çš„ HTTP æœåŠ¡å™¨</h5><p>å®ç°å®¢æˆ·ç«¯ç¼“å­˜åŠŸèƒ½ï¼Œæ”¯æŒè¿”å› 304 å®ç°å¯å¹¶å‘ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ ä½¿ç”¨ nio å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ æ”¯æŒç®€å•çš„ rewrite è§„åˆ™ ä¸Šè¿°åŠŸèƒ½åœ¨å®ç°çš„æ—¶å€™éœ€è¦æ»¡è¶³â€œå¼€é—­åŸåˆ™â€</p>
<h5 id="äº†è§£-nginx-å’Œ-apache-æœåŠ¡å™¨çš„ç‰¹æ€§å¹¶æ­å»ºä¸€ä¸ªå¯¹åº”çš„æœåŠ¡å™¨"><a href="#äº†è§£-nginx-å’Œ-apache-æœåŠ¡å™¨çš„ç‰¹æ€§å¹¶æ­å»ºä¸€ä¸ªå¯¹åº”çš„æœåŠ¡å™¨" class="headerlink" title="äº†è§£ nginx å’Œ apache æœåŠ¡å™¨çš„ç‰¹æ€§å¹¶æ­å»ºä¸€ä¸ªå¯¹åº”çš„æœåŠ¡å™¨"></a>äº†è§£ nginx å’Œ apache æœåŠ¡å™¨çš„ç‰¹æ€§å¹¶æ­å»ºä¸€ä¸ªå¯¹åº”çš„æœåŠ¡å™¨</h5><h5 id="ç”¨-Java-å®ç°-FTPã€SMTP-åè®®"><a href="#ç”¨-Java-å®ç°-FTPã€SMTP-åè®®" class="headerlink" title="ç”¨ Java å®ç° FTPã€SMTP åè®®"></a>ç”¨ Java å®ç° FTPã€SMTP åè®®</h5><h5 id="è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼"><a href="#è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼" class="headerlink" title="è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼"></a>è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼</h5><h5 id="ä»€ä¹ˆæ˜¯-CDN-ï¼Ÿå¦‚æœå®ç°ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-CDN-ï¼Ÿå¦‚æœå®ç°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ CDN ï¼Ÿå¦‚æœå®ç°ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ CDN ï¼Ÿå¦‚æœå®ç°ï¼Ÿ</h5><h5 id="ä»€ä¹ˆæ˜¯-DNS-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-DNS-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ DNS ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ DNS ï¼Ÿ</h5><h5 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h5><h4 id="æ¡†æ¶çŸ¥è¯†"><a href="#æ¡†æ¶çŸ¥è¯†" class="headerlink" title="æ¡†æ¶çŸ¥è¯†"></a>æ¡†æ¶çŸ¥è¯†</h4><h5 id="Servlet-çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#Servlet-çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="Servlet çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>Servlet çº¿ç¨‹å®‰å…¨é—®é¢˜</h5><h5 id="Servlet-ä¸­çš„-filter-å’Œ-listener"><a href="#Servlet-ä¸­çš„-filter-å’Œ-listener" class="headerlink" title="Servlet ä¸­çš„ filter å’Œ listener"></a>Servlet ä¸­çš„ filter å’Œ listener</h5><h5 id="Hibernate-çš„ç¼“å­˜æœºåˆ¶"><a href="#Hibernate-çš„ç¼“å­˜æœºåˆ¶" class="headerlink" title="Hibernate çš„ç¼“å­˜æœºåˆ¶"></a>Hibernate çš„ç¼“å­˜æœºåˆ¶</h5><h5 id="Hiberate-çš„æ‡’åŠ è½½"><a href="#Hiberate-çš„æ‡’åŠ è½½" class="headerlink" title="Hiberate çš„æ‡’åŠ è½½"></a>Hiberate çš„æ‡’åŠ è½½</h5><h5 id="Spring-Bean-çš„åˆå§‹åŒ–"><a href="#Spring-Bean-çš„åˆå§‹åŒ–" class="headerlink" title="Spring Bean çš„åˆå§‹åŒ–"></a>Spring Bean çš„åˆå§‹åŒ–</h5><h5 id="Spring-çš„-AOP-åŸç†"><a href="#Spring-çš„-AOP-åŸç†" class="headerlink" title="Spring çš„ AOP åŸç†"></a>Spring çš„ AOP åŸç†</h5><h5 id="è‡ªå·±å®ç°-Spring-çš„-IOC"><a href="#è‡ªå·±å®ç°-Spring-çš„-IOC" class="headerlink" title="è‡ªå·±å®ç° Spring çš„ IOC"></a>è‡ªå·±å®ç° Spring çš„ IOC</h5><h5 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h5><h5 id="Spring-Boot2-0"><a href="#Spring-Boot2-0" class="headerlink" title="Spring Boot2.0"></a>Spring Boot2.0</h5><h5 id="Spring-Boot-çš„-starter-åŸç†ï¼Œè‡ªå·±å®ç°ä¸€ä¸ª-starter"><a href="#Spring-Boot-çš„-starter-åŸç†ï¼Œè‡ªå·±å®ç°ä¸€ä¸ª-starter" class="headerlink" title="Spring Boot çš„ starter åŸç†ï¼Œè‡ªå·±å®ç°ä¸€ä¸ª starter"></a>Spring Boot çš„ starter åŸç†ï¼Œè‡ªå·±å®ç°ä¸€ä¸ª starter</h5><h5 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h5><p>åº”ç”¨æœåŠ¡å™¨çŸ¥è¯†</p>
<h5 id="JBoss"><a href="#JBoss" class="headerlink" title="JBoss"></a>JBoss</h5><h5 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h5><h5 id="jetty"><a href="#jetty" class="headerlink" title="jetty"></a>jetty</h5><h5 id="Weblogic"><a href="#Weblogic" class="headerlink" title="Weblogic"></a>Weblogic</h5><h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><h5 id="git-amp-svn"><a href="#git-amp-svn" class="headerlink" title="git &amp; svn"></a>git &amp; svn</h5><h5 id="maven-amp-gradle"><a href="#maven-amp-gradle" class="headerlink" title="maven &amp; gradle"></a>maven &amp; gradle</h5><h4 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h4><h3 id="é«˜çº§ç¯‡"><a href="#é«˜çº§ç¯‡" class="headerlink" title="é«˜çº§ç¯‡"></a>é«˜çº§ç¯‡</h3><h4 id="æ–°æŠ€æœ¯"><a href="#æ–°æŠ€æœ¯" class="headerlink" title="æ–°æŠ€æœ¯"></a>æ–°æŠ€æœ¯</h4><h5 id="java8"><a href="#java8" class="headerlink" title="java8"></a>java8</h5><p> lambda è¡¨è¾¾å¼ã€Stream APIã€</p>
<h5 id="Java-9"><a href="#Java-9" class="headerlink" title="Java 9"></a>Java 9</h5><p>Jigsawã€Jshellã€Reactive Streams</p>
<h5 id="Java-10"><a href="#Java-10" class="headerlink" title="Java 10"></a>Java 10</h5><p>å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­ã€G1 çš„å¹¶è¡Œ Full GCã€ThreadLocal æ¡æ‰‹æœºåˆ¶</p>
<h5 id="Spring-5"><a href="#Spring-5" class="headerlink" title="Spring 5"></a>Spring 5</h5><p>å“åº”å¼ç¼–ç¨‹</p>
<h5 id="Spring-Boot-2-0"><a href="#Spring-Boot-2-0" class="headerlink" title="Spring Boot 2.0"></a>Spring Boot 2.0</h5><p>æ€§èƒ½ä¼˜åŒ–<br>ä½¿ç”¨å•ä¾‹ã€ä½¿ç”¨ Future æ¨¡å¼ã€ä½¿ç”¨çº¿ç¨‹æ± ã€é€‰æ‹©å°±ç»ªã€å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ã€å‡å°‘é”ç²’åº¦ã€æ•°æ®å‹ç¼©ã€ç»“æœç¼“å­˜</p>
<h4 id="çº¿ä¸Šé—®é¢˜åˆ†æ"><a href="#çº¿ä¸Šé—®é¢˜åˆ†æ" class="headerlink" title="çº¿ä¸Šé—®é¢˜åˆ†æ"></a>çº¿ä¸Šé—®é¢˜åˆ†æ</h4><h5 id="dump-è·å–"><a href="#dump-è·å–" class="headerlink" title="dump è·å–"></a>dump è·å–</h5><p>çº¿ç¨‹ Dumpã€å†…å­˜ Dumpã€gc æƒ…å†µ</p>
<h5 id="dump-åˆ†æ"><a href="#dump-åˆ†æ" class="headerlink" title="dump åˆ†æ"></a>dump åˆ†æ</h5><p>åˆ†ææ­»é”ã€åˆ†æå†…å­˜æ³„éœ²</p>
<h5 id="è‡ªå·±ç¼–å†™å„ç§-outofmemoryï¼Œstackoverflow-ç¨‹åº"><a href="#è‡ªå·±ç¼–å†™å„ç§-outofmemoryï¼Œstackoverflow-ç¨‹åº" class="headerlink" title="è‡ªå·±ç¼–å†™å„ç§ outofmemoryï¼Œstackoverflow ç¨‹åº"></a>è‡ªå·±ç¼–å†™å„ç§ outofmemoryï¼Œstackoverflow ç¨‹åº</h5><p>HeapOutOfMemoryã€Young OutOfMemoryã€MethodArea OutOfMemoryã€ConstantPool OutOfMemoryã€DirectMemory OutOfMemoryã€Stack OutOfMemory Stack OverFlow</p>
<h5 id="å¸¸è§é—®é¢˜è§£å†³æ€è·¯"><a href="#å¸¸è§é—®é¢˜è§£å†³æ€è·¯" class="headerlink" title="å¸¸è§é—®é¢˜è§£å†³æ€è·¯"></a>å¸¸è§é—®é¢˜è§£å†³æ€è·¯</h5><p>å†…å­˜æº¢å‡ºã€çº¿ç¨‹æ­»é”ã€ç±»åŠ è½½å†²çª</p>
<h5 id="ä½¿ç”¨å·¥å…·å°è¯•è§£å†³ä»¥ä¸‹é—®é¢˜ï¼Œå¹¶å†™ä¸‹æ€»ç»“"><a href="#ä½¿ç”¨å·¥å…·å°è¯•è§£å†³ä»¥ä¸‹é—®é¢˜ï¼Œå¹¶å†™ä¸‹æ€»ç»“" class="headerlink" title="ä½¿ç”¨å·¥å…·å°è¯•è§£å†³ä»¥ä¸‹é—®é¢˜ï¼Œå¹¶å†™ä¸‹æ€»ç»“"></a>ä½¿ç”¨å·¥å…·å°è¯•è§£å†³ä»¥ä¸‹é—®é¢˜ï¼Œå¹¶å†™ä¸‹æ€»ç»“</h5><p>å½“ä¸€ä¸ª Java ç¨‹åºå“åº”å¾ˆæ…¢æ—¶å¦‚ä½•æŸ¥æ‰¾é—®é¢˜ã€</p>
<p>å½“ä¸€ä¸ª Java ç¨‹åºé¢‘ç¹ FullGC æ—¶å¦‚ä½•è§£å†³é—®é¢˜ã€</p>
<p>å¦‚ä½•æŸ¥çœ‹åƒåœ¾å›æ”¶æ—¥å¿—ã€</p>
<p>å½“ä¸€ä¸ª Java åº”ç”¨å‘ç”Ÿ OutOfMemory æ—¶è¯¥å¦‚ä½•è§£å†³ã€</p>
<p>å¦‚ä½•åˆ¤æ–­æ˜¯å¦å‡ºç°æ­»é”ã€</p>
<p>å¦‚ä½•åˆ¤æ–­æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²</p>
<h4 id="ç¼–è¯‘åŸç†çŸ¥è¯†"><a href="#ç¼–è¯‘åŸç†çŸ¥è¯†" class="headerlink" title="ç¼–è¯‘åŸç†çŸ¥è¯†"></a>ç¼–è¯‘åŸç†çŸ¥è¯†</h4><h5 id="ç¼–è¯‘ä¸åç¼–è¯‘"><a href="#ç¼–è¯‘ä¸åç¼–è¯‘" class="headerlink" title="ç¼–è¯‘ä¸åç¼–è¯‘"></a>ç¼–è¯‘ä¸åç¼–è¯‘</h5><h5 id="Java-ä»£ç çš„ç¼–è¯‘ä¸åç¼–è¯‘"><a href="#Java-ä»£ç çš„ç¼–è¯‘ä¸åç¼–è¯‘" class="headerlink" title="Java ä»£ç çš„ç¼–è¯‘ä¸åç¼–è¯‘"></a>Java ä»£ç çš„ç¼–è¯‘ä¸åç¼–è¯‘</h5><h5 id="Java-çš„åç¼–è¯‘å·¥å…·"><a href="#Java-çš„åç¼–è¯‘å·¥å…·" class="headerlink" title="Java çš„åç¼–è¯‘å·¥å…·"></a>Java çš„åç¼–è¯‘å·¥å…·</h5><h5 id="è¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æï¼ˆ-LL-ç®—æ³•ï¼Œé€’å½’ä¸‹é™ç®—æ³•ï¼ŒLR-ç®—æ³•ï¼‰ï¼Œè¯­ä¹‰åˆ†æï¼Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œä¸­é—´ä»£ç ï¼Œä»£ç ç”Ÿæˆï¼Œä»£ç ä¼˜åŒ–"><a href="#è¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æï¼ˆ-LL-ç®—æ³•ï¼Œé€’å½’ä¸‹é™ç®—æ³•ï¼ŒLR-ç®—æ³•ï¼‰ï¼Œè¯­ä¹‰åˆ†æï¼Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œä¸­é—´ä»£ç ï¼Œä»£ç ç”Ÿæˆï¼Œä»£ç ä¼˜åŒ–" class="headerlink" title="è¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æï¼ˆ LL ç®—æ³•ï¼Œé€’å½’ä¸‹é™ç®—æ³•ï¼ŒLR ç®—æ³•ï¼‰ï¼Œè¯­ä¹‰åˆ†æï¼Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œä¸­é—´ä»£ç ï¼Œä»£ç ç”Ÿæˆï¼Œä»£ç ä¼˜åŒ–"></a>è¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æï¼ˆ LL ç®—æ³•ï¼Œé€’å½’ä¸‹é™ç®—æ³•ï¼ŒLR ç®—æ³•ï¼‰ï¼Œè¯­ä¹‰åˆ†æï¼Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œä¸­é—´ä»£ç ï¼Œä»£ç ç”Ÿæˆï¼Œä»£ç ä¼˜åŒ–</h5><h4 id="æ“ä½œç³»ç»ŸçŸ¥è¯†"><a href="#æ“ä½œç³»ç»ŸçŸ¥è¯†" class="headerlink" title="æ“ä½œç³»ç»ŸçŸ¥è¯†"></a>æ“ä½œç³»ç»ŸçŸ¥è¯†</h4><h5 id="Linux-çš„å¸¸ç”¨å‘½ä»¤"><a href="#Linux-çš„å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Linux çš„å¸¸ç”¨å‘½ä»¤"></a>Linux çš„å¸¸ç”¨å‘½ä»¤</h5><h5 id="è¿›ç¨‹åŒæ­¥"><a href="#è¿›ç¨‹åŒæ­¥" class="headerlink" title="è¿›ç¨‹åŒæ­¥"></a>è¿›ç¨‹åŒæ­¥</h5><h5 id="ç¼“å†²åŒºæº¢å‡º"><a href="#ç¼“å†²åŒºæº¢å‡º" class="headerlink" title="ç¼“å†²åŒºæº¢å‡º"></a>ç¼“å†²åŒºæº¢å‡º</h5><h5 id="åˆ†æ®µå’Œåˆ†é¡µ"><a href="#åˆ†æ®µå’Œåˆ†é¡µ" class="headerlink" title="åˆ†æ®µå’Œåˆ†é¡µ"></a>åˆ†æ®µå’Œåˆ†é¡µ</h5><h5 id="è™šæ‹Ÿå†…å­˜ä¸ä¸»å­˜"><a href="#è™šæ‹Ÿå†…å­˜ä¸ä¸»å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜ä¸ä¸»å­˜"></a>è™šæ‹Ÿå†…å­˜ä¸ä¸»å­˜</h5><h4 id="æ•°æ®åº“çŸ¥è¯†"><a href="#æ•°æ®åº“çŸ¥è¯†" class="headerlink" title="æ•°æ®åº“çŸ¥è¯†"></a>æ•°æ®åº“çŸ¥è¯†</h4><h5 id="MySql-æ‰§è¡Œå¼•æ“"><a href="#MySql-æ‰§è¡Œå¼•æ“" class="headerlink" title="MySql æ‰§è¡Œå¼•æ“"></a>MySql æ‰§è¡Œå¼•æ“</h5><h5 id="MySQL-æ‰§è¡Œè®¡åˆ’"><a href="#MySQL-æ‰§è¡Œè®¡åˆ’" class="headerlink" title="MySQL æ‰§è¡Œè®¡åˆ’"></a>MySQL æ‰§è¡Œè®¡åˆ’</h5><h5 id="å¦‚ä½•æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚ä½•æ ¹æ®æ‰§è¡Œè®¡åˆ’è¿›è¡Œ-SQL-ä¼˜åŒ–"><a href="#å¦‚ä½•æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚ä½•æ ¹æ®æ‰§è¡Œè®¡åˆ’è¿›è¡Œ-SQL-ä¼˜åŒ–" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚ä½•æ ¹æ®æ‰§è¡Œè®¡åˆ’è¿›è¡Œ SQL ä¼˜åŒ–"></a>å¦‚ä½•æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚ä½•æ ¹æ®æ‰§è¡Œè®¡åˆ’è¿›è¡Œ SQL ä¼˜åŒ–</h5><h4 id="SQL-ä¼˜åŒ–"><a href="#SQL-ä¼˜åŒ–" class="headerlink" title="SQL ä¼˜åŒ–"></a>SQL ä¼˜åŒ–</h4><h5 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h5><p>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€äº‹åŠ¡èƒ½ä¸èƒ½å®ç°é”çš„åŠŸèƒ½</p>
<h5 id="æ•°æ®åº“é”"><a href="#æ•°æ®åº“é”" class="headerlink" title="æ•°æ®åº“é”"></a>æ•°æ®åº“é”</h5><p>è¡Œé”ã€è¡¨é”ã€ä½¿ç”¨æ•°æ®åº“é”å®ç°ä¹è§‚é”ã€</p>
<h5 id="æ•°æ®åº“ä¸»å¤‡æ­å»º"><a href="#æ•°æ®åº“ä¸»å¤‡æ­å»º" class="headerlink" title="æ•°æ®åº“ä¸»å¤‡æ­å»º"></a>æ•°æ®åº“ä¸»å¤‡æ­å»º</h5><h5 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h5><h5 id="å†…å­˜æ•°æ®åº“"><a href="#å†…å­˜æ•°æ®åº“" class="headerlink" title="å†…å­˜æ•°æ®åº“"></a>å†…å­˜æ•°æ®åº“</h5><p>h2</p>
<h5 id="å¸¸ç”¨çš„-nosql-æ•°æ®åº“"><a href="#å¸¸ç”¨çš„-nosql-æ•°æ®åº“" class="headerlink" title="å¸¸ç”¨çš„ nosql æ•°æ®åº“"></a>å¸¸ç”¨çš„ nosql æ•°æ®åº“</h5><p>redisã€memcached</p>
<h5 id="åˆ†åˆ«ä½¿ç”¨æ•°æ®åº“é”ã€NoSql-å®ç°åˆ†å¸ƒå¼é”"><a href="#åˆ†åˆ«ä½¿ç”¨æ•°æ®åº“é”ã€NoSql-å®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†åˆ«ä½¿ç”¨æ•°æ®åº“é”ã€NoSql å®ç°åˆ†å¸ƒå¼é”"></a>åˆ†åˆ«ä½¿ç”¨æ•°æ®åº“é”ã€NoSql å®ç°åˆ†å¸ƒå¼é”</h5><h5 id="æ€§èƒ½è°ƒä¼˜"><a href="#æ€§èƒ½è°ƒä¼˜" class="headerlink" title="æ€§èƒ½è°ƒä¼˜"></a>æ€§èƒ½è°ƒä¼˜</h5><h4 id="æ•°æ®ç»“æ„ä¸ç®—æ³•çŸ¥è¯†"><a href="#æ•°æ®ç»“æ„ä¸ç®—æ³•çŸ¥è¯†" class="headerlink" title="æ•°æ®ç»“æ„ä¸ç®—æ³•çŸ¥è¯†"></a>æ•°æ®ç»“æ„ä¸ç®—æ³•çŸ¥è¯†</h4><h5 id="ç®€å•çš„æ•°æ®ç»“æ„"><a href="#ç®€å•çš„æ•°æ®ç»“æ„" class="headerlink" title="ç®€å•çš„æ•°æ®ç»“æ„"></a>ç®€å•çš„æ•°æ®ç»“æ„</h5><h5 id="æ ˆã€é˜Ÿåˆ—ã€é“¾è¡¨ã€æ•°ç»„ã€å“ˆå¸Œè¡¨ã€"><a href="#æ ˆã€é˜Ÿåˆ—ã€é“¾è¡¨ã€æ•°ç»„ã€å“ˆå¸Œè¡¨ã€" class="headerlink" title="æ ˆã€é˜Ÿåˆ—ã€é“¾è¡¨ã€æ•°ç»„ã€å“ˆå¸Œè¡¨ã€"></a>æ ˆã€é˜Ÿåˆ—ã€é“¾è¡¨ã€æ•°ç»„ã€å“ˆå¸Œè¡¨ã€</h5><h5 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h5><p>äºŒå‰æ ‘ã€å­—å…¸æ ‘ã€å¹³è¡¡æ ‘ã€æ’åºæ ‘ã€B æ ‘ã€B+æ ‘ã€R æ ‘ã€å¤šè·¯æ ‘ã€çº¢é»‘æ ‘</p>
<h5 id="æ’åºç®—æ³•"><a href="#æ’åºç®—æ³•" class="headerlink" title="æ’åºç®—æ³•"></a>æ’åºç®—æ³•</h5><p>å„ç§æ’åºç®—æ³•å’Œæ—¶é—´å¤æ‚åº¦ æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆæœç´¢ å…¨æ’åˆ—ã€è´ªå¿ƒç®—æ³•ã€KMP ç®—æ³•ã€hash ç®—æ³•ã€æµ·é‡æ•°æ®å¤„ç†</p>
<h4 id="å¤§æ•°æ®çŸ¥è¯†"><a href="#å¤§æ•°æ®çŸ¥è¯†" class="headerlink" title="å¤§æ•°æ®çŸ¥è¯†"></a>å¤§æ•°æ®çŸ¥è¯†</h4><h5 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h5><p>åŸºæœ¬æ¦‚å¿µã€å¸¸è§ç”¨æ³•</p>
<h5 id="Solrï¼ŒLuceneï¼ŒElasticSearch"><a href="#Solrï¼ŒLuceneï¼ŒElasticSearch" class="headerlink" title="Solrï¼ŒLuceneï¼ŒElasticSearch"></a>Solrï¼ŒLuceneï¼ŒElasticSearch</h5><p>åœ¨ linux ä¸Šéƒ¨ç½² solrï¼Œsolrcloudï¼Œï¼Œæ–°å¢ã€åˆ é™¤ã€æŸ¥è¯¢ç´¢å¼•</p>
<h5 id="Stormï¼Œæµå¼è®¡ç®—ï¼Œäº†è§£-Sparkï¼ŒS4"><a href="#Stormï¼Œæµå¼è®¡ç®—ï¼Œäº†è§£-Sparkï¼ŒS4" class="headerlink" title="Stormï¼Œæµå¼è®¡ç®—ï¼Œäº†è§£ Sparkï¼ŒS4"></a>Stormï¼Œæµå¼è®¡ç®—ï¼Œäº†è§£ Sparkï¼ŒS4</h5><p>åœ¨ linux ä¸Šéƒ¨ç½² stormï¼Œç”¨ zookeeper åšåè°ƒï¼Œè¿è¡Œ storm hello worldï¼Œlocal å’Œ remote æ¨¡å¼è¿è¡Œè°ƒè¯• storm topologyã€‚</p>
<h5 id="Hadoopï¼Œç¦»çº¿è®¡ç®—"><a href="#Hadoopï¼Œç¦»çº¿è®¡ç®—" class="headerlink" title="Hadoopï¼Œç¦»çº¿è®¡ç®—"></a>Hadoopï¼Œç¦»çº¿è®¡ç®—</h5><p>HDFSã€MapReduce</p>
<h5 id="åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†-flumeï¼Œkafkaï¼Œlogstash"><a href="#åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†-flumeï¼Œkafkaï¼Œlogstash" class="headerlink" title="åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›† flumeï¼Œkafkaï¼Œlogstash"></a>åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›† flumeï¼Œkafkaï¼Œlogstash</h5><h5 id="æ•°æ®æŒ–æ˜ï¼Œmahout"><a href="#æ•°æ®æŒ–æ˜ï¼Œmahout" class="headerlink" title="æ•°æ®æŒ–æ˜ï¼Œmahout"></a>æ•°æ®æŒ–æ˜ï¼Œmahout</h5><h4 id="ç½‘ç»œå®‰å…¨çŸ¥è¯†"><a href="#ç½‘ç»œå®‰å…¨çŸ¥è¯†" class="headerlink" title="ç½‘ç»œå®‰å…¨çŸ¥è¯†"></a>ç½‘ç»œå®‰å…¨çŸ¥è¯†</h4><h5 id="ä»€ä¹ˆæ˜¯-XSS"><a href="#ä»€ä¹ˆæ˜¯-XSS" class="headerlink" title="ä»€ä¹ˆæ˜¯ XSS"></a>ä»€ä¹ˆæ˜¯ XSS</h5><p>XSS çš„é˜²å¾¡</p>
<h5 id="ä»€ä¹ˆæ˜¯-CSRF"><a href="#ä»€ä¹ˆæ˜¯-CSRF" class="headerlink" title="ä»€ä¹ˆæ˜¯ CSRF"></a>ä»€ä¹ˆæ˜¯ CSRF</h5><h5 id="ä»€ä¹ˆæ˜¯æ³¨å…¥æ”»å‡»"><a href="#ä»€ä¹ˆæ˜¯æ³¨å…¥æ”»å‡»" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³¨å…¥æ”»å‡»"></a>ä»€ä¹ˆæ˜¯æ³¨å…¥æ”»å‡»</h5><p>SQL æ³¨å…¥ã€XML æ³¨å…¥ã€CRLF æ³¨å…¥</p>
<h5 id="ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ æ¼æ´</h5><h5 id="åŠ å¯†ä¸è§£å¯†"><a href="#åŠ å¯†ä¸è§£å¯†" class="headerlink" title="åŠ å¯†ä¸è§£å¯†"></a>åŠ å¯†ä¸è§£å¯†</h5><p>MD5ï¼ŒSHA1ã€DESã€AESã€RSAã€DSA</p>
<h5 id="ä»€ä¹ˆæ˜¯-DOS-æ”»å‡»å’Œ-DDOS-æ”»å‡»"><a href="#ä»€ä¹ˆæ˜¯-DOS-æ”»å‡»å’Œ-DDOS-æ”»å‡»" class="headerlink" title="ä»€ä¹ˆæ˜¯ DOS æ”»å‡»å’Œ DDOS æ”»å‡»"></a>ä»€ä¹ˆæ˜¯ DOS æ”»å‡»å’Œ DDOS æ”»å‡»</h5><p>memcached ä¸ºä»€ä¹ˆå¯ä»¥å¯¼è‡´ DDos æ”»å‡»ã€ä»€ä¹ˆæ˜¯åå°„å‹ DDoS</p>
<h5 id="SSLã€TLSï¼ŒHTTPS"><a href="#SSLã€TLSï¼ŒHTTPS" class="headerlink" title="SSLã€TLSï¼ŒHTTPS"></a>SSLã€TLSï¼ŒHTTPS</h5><h5 id="å¦‚ä½•é€šè¿‡-Hash-ç¢°æ’è¿›è¡Œ-DOS-æ”»å‡»"><a href="#å¦‚ä½•é€šè¿‡-Hash-ç¢°æ’è¿›è¡Œ-DOS-æ”»å‡»" class="headerlink" title="å¦‚ä½•é€šè¿‡ Hash ç¢°æ’è¿›è¡Œ DOS æ”»å‡»"></a>å¦‚ä½•é€šè¿‡ Hash ç¢°æ’è¿›è¡Œ DOS æ”»å‡»</h5><h5 id="ç”¨-openssl-ç­¾ä¸€ä¸ªè¯ä¹¦éƒ¨ç½²åˆ°-apache-æˆ–-nginx"><a href="#ç”¨-openssl-ç­¾ä¸€ä¸ªè¯ä¹¦éƒ¨ç½²åˆ°-apache-æˆ–-nginx" class="headerlink" title="ç”¨ openssl ç­¾ä¸€ä¸ªè¯ä¹¦éƒ¨ç½²åˆ° apache æˆ– nginx"></a>ç”¨ openssl ç­¾ä¸€ä¸ªè¯ä¹¦éƒ¨ç½²åˆ° apache æˆ– nginx</h5><h3 id="å››ã€æ¶æ„ç¯‡"><a href="#å››ã€æ¶æ„ç¯‡" class="headerlink" title="å››ã€æ¶æ„ç¯‡"></a>å››ã€æ¶æ„ç¯‡</h3><h5 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h5><p>æ•°æ®ä¸€è‡´æ€§ã€æœåŠ¡æ²»ç†ã€æœåŠ¡é™çº§</p>
<h5 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h5><p>2PCã€3PCã€CAPã€BASEã€ å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ã€æœ€å¤§åŠªåŠ›é€šçŸ¥ã€TCC</p>
<h5 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h5><p>æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ï¼ŒæœåŠ¡æ²»ç†</p>
<h5 id="åˆ†å¸ƒå¼æ•°æ®åº“"><a href="#åˆ†å¸ƒå¼æ•°æ®åº“" class="headerlink" title="åˆ†å¸ƒå¼æ•°æ®åº“"></a>åˆ†å¸ƒå¼æ•°æ®åº“</h5><p>æ€æ ·æ‰“é€ ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ã€ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†å¸ƒå¼æ•°æ®åº“ã€mycatã€otterã€HBase</p>
<h5 id="åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ"><a href="#åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ"></a>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</h5><p>mfsã€fastdfs</p>
<h5 id="åˆ†å¸ƒå¼ç¼“å­˜"><a href="#åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜"></a>åˆ†å¸ƒå¼ç¼“å­˜</h5><p>ç¼“å­˜ä¸€è‡´æ€§ã€ç¼“å­˜å‘½ä¸­ç‡ã€ç¼“å­˜å†—ä½™</p>
<h4 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h4><p>SOAã€åº·å¨å®šå¾‹</p>
<h5 id="ServiceMesh"><a href="#ServiceMesh" class="headerlink" title="ServiceMesh"></a>ServiceMesh</h5><h5 id="Docker-amp-Kubernets"><a href="#Docker-amp-Kubernets" class="headerlink" title="Docker &amp; Kubernets"></a>Docker &amp; Kubernets</h5><h5 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h5><h5 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h5><h4 id="é«˜å¹¶å‘"><a href="#é«˜å¹¶å‘" class="headerlink" title="é«˜å¹¶å‘"></a>é«˜å¹¶å‘</h4><h5 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h5><h5 id="åˆ†åº“åˆ†è¡¨-1"><a href="#åˆ†åº“åˆ†è¡¨-1" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h5><h5 id="CDN-æŠ€æœ¯"><a href="#CDN-æŠ€æœ¯" class="headerlink" title="CDN æŠ€æœ¯"></a>CDN æŠ€æœ¯</h5><h5 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h5><p>ActiveMQã€RabbitMQã€Kafka</p>
<h4 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h4><h5 id="ç›‘æ§ä»€ä¹ˆ"><a href="#ç›‘æ§ä»€ä¹ˆ" class="headerlink" title="ç›‘æ§ä»€ä¹ˆ"></a>ç›‘æ§ä»€ä¹ˆ</h5><p>CPUã€å†…å­˜ã€ç£ç›˜ I/Oã€ç½‘ç»œ I/O ç­‰</p>
<h5 id="ç›‘æ§æ‰‹æ®µ"><a href="#ç›‘æ§æ‰‹æ®µ" class="headerlink" title="ç›‘æ§æ‰‹æ®µ"></a>ç›‘æ§æ‰‹æ®µ</h5><p>è¿›ç¨‹ç›‘æ§ã€è¯­ä¹‰ç›‘æ§ã€æœºå™¨èµ„æºç›‘æ§ã€æ•°æ®æ³¢åŠ¨</p>
<h5 id="ç›‘æ§æ•°æ®é‡‡é›†"><a href="#ç›‘æ§æ•°æ®é‡‡é›†" class="headerlink" title="ç›‘æ§æ•°æ®é‡‡é›†"></a>ç›‘æ§æ•°æ®é‡‡é›†</h5><p>æ—¥å¿—ã€åŸ‹ç‚¹</p>
<h5 id="Dapper"><a href="#Dapper" class="headerlink" title="Dapper"></a>Dapper</h5><h5 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h5><p>tomcat è´Ÿè½½å‡è¡¡ã€Nginx è´Ÿè½½å‡è¡¡</p>
<h5 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h5><p>DNS åŸç†ã€DNS çš„è®¾è®¡</p>
<h5 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h5><h5 id="æ•°æ®ä¸€è‡´æ€§"><a href="#æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§"></a>æ•°æ®ä¸€è‡´æ€§</h5><h3 id="äº”ã€-æ‰©å±•ç¯‡"><a href="#äº”ã€-æ‰©å±•ç¯‡" class="headerlink" title="äº”ã€ æ‰©å±•ç¯‡"></a>äº”ã€ æ‰©å±•ç¯‡</h3><h4 id="äº‘è®¡ç®—"><a href="#äº‘è®¡ç®—" class="headerlink" title="äº‘è®¡ç®—"></a>äº‘è®¡ç®—</h4><p>IaaSã€SaaSã€PaaSã€è™šæ‹ŸåŒ–æŠ€æœ¯ã€openstackã€Serverlsess</p>
<h5 id="æœç´¢å¼•æ“"><a href="#æœç´¢å¼•æ“" class="headerlink" title="æœç´¢å¼•æ“"></a>æœç´¢å¼•æ“</h5><p>Solrã€Luceneã€Nutchã€Elasticsearch</p>
<h5 id="æƒé™ç®¡ç†"><a href="#æƒé™ç®¡ç†" class="headerlink" title="æƒé™ç®¡ç†"></a>æƒé™ç®¡ç†</h5><p>Shiro</p>
<h5 id="åŒºå—é“¾"><a href="#åŒºå—é“¾" class="headerlink" title="åŒºå—é“¾"></a>åŒºå—é“¾</h5><p>å“ˆå¸Œç®—æ³•ã€Merkle æ ‘ã€å…¬é’¥å¯†ç ç®—æ³•ã€å…±è¯†ç®—æ³•ã€Raft åè®®ã€Paxos ç®—æ³•ä¸ Raft ç®—æ³•ã€æ‹œå åº­é—®é¢˜ä¸ç®—æ³•ã€æ¶ˆæ¯è®¤è¯ç ä¸æ•°å­—ç­¾å</p>
<h5 id="æ¯”ç‰¹å¸"><a href="#æ¯”ç‰¹å¸" class="headerlink" title="æ¯”ç‰¹å¸"></a>æ¯”ç‰¹å¸</h5><p>æŒ–çŸ¿ã€å…±è¯†æœºåˆ¶ã€é—ªç”µç½‘ç»œã€ä¾§é“¾ã€çƒ­ç‚¹é—®é¢˜ã€åˆ†å‰</p>
<h5 id="ä»¥å¤ªåŠ"><a href="#ä»¥å¤ªåŠ" class="headerlink" title="ä»¥å¤ªåŠ"></a>ä»¥å¤ªåŠ</h5><p>è¶…çº§è´¦æœ¬<br>äººå·¥æ™ºèƒ½<br>æ•°å­¦åŸºç¡€ã€æœºå™¨å­¦ä¹ ã€äººå·¥ç¥ç»ç½‘ç»œã€æ·±åº¦å­¦ä¹ ã€åº”ç”¨åœºæ™¯ã€‚</p>
<h5 id="å¸¸ç”¨æ¡†æ¶"><a href="#å¸¸ç”¨æ¡†æ¶" class="headerlink" title="å¸¸ç”¨æ¡†æ¶"></a>å¸¸ç”¨æ¡†æ¶</h5><p>TensorFlowã€DeepLearning4J</p>
<h5 id="å…¶ä»–è¯­è¨€"><a href="#å…¶ä»–è¯­è¨€" class="headerlink" title="å…¶ä»–è¯­è¨€"></a>å…¶ä»–è¯­è¨€</h5><p>Groovyã€Pythonã€Goã€NodeJsã€Swiftã€Rust</p>
<h3 id="å…­ã€-æ¨èä¹¦ç±"><a href="#å…­ã€-æ¨èä¹¦ç±" class="headerlink" title="å…­ã€ æ¨èä¹¦ç±"></a>å…­ã€ æ¨èä¹¦ç±</h3><p>ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ ã€Š Effective Java ã€‹ ã€Šæ·±å…¥åˆ†æ Java Web æŠ€æœ¯å†…å¹•ã€‹ ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ã€‹ ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹ ã€Š Head First è®¾è®¡æ¨¡å¼ã€‹ ã€Š maven å®æˆ˜ã€‹ ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹ ã€Š Java å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ ã€Šé¸Ÿå“¥çš„ Linux ç§æˆ¿èœã€‹ ã€Šä» Paxos åˆ° Zookeeper ã€‹ ã€Šæ¶æ„å³æœªæ¥ã€‹</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>ä¸Šä¼ æœ¬åœ°jaråŒ…åˆ°nexusä»“åº“ä¸­</title>
    <url>/2017/09/16/%E4%B8%8A%E4%BC%A0%E6%9C%AC%E5%9C%B0jar%E5%8C%85%E5%88%B0nexus%E4%BB%93%E5%BA%93%E4%B8%AD/</url>
    <content><![CDATA[<p>#ä¸Šä¼ æœ¬åœ°jaråŒ…åˆ°nexusä»“åº“ä¸­</p>
<blockquote>
<p>æ¦‚è¿°ï¼šæœ‰æ—¶åœ¨æˆ‘ä»¬çš„nexusä»“åº“ä¸­æ²¡æœ‰é¡¹ç›®ä¸­æ‰€éœ€çš„jaråŒ…ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä»ç½‘ç»œä¸­ä¸‹è½½ï¼Œç„¶åä¸Šä¼ åˆ°nexusä»“åº“ä¸­ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å—¨æ£®çš„æ•²ä»£ç å•¦ã€‚</p>
</blockquote>
<h4 id="1ã€é¦–å…ˆéœ€è¦æ˜¯å¯¹åº”çš„repositoryæœ‰ä¸Šä¼ çš„æƒé™"><a href="#1ã€é¦–å…ˆéœ€è¦æ˜¯å¯¹åº”çš„repositoryæœ‰ä¸Šä¼ çš„æƒé™" class="headerlink" title="1ã€é¦–å…ˆéœ€è¦æ˜¯å¯¹åº”çš„repositoryæœ‰ä¸Šä¼ çš„æƒé™"></a>1ã€é¦–å…ˆéœ€è¦æ˜¯å¯¹åº”çš„repositoryæœ‰ä¸Šä¼ çš„æƒé™</h4><p><img src="http://res.cloudinary.com/leon824/image/upload/v1505547143/haha_zqbfpz.png" alt></p>
<h4 id="2ã€æˆ‘ä»¬è¿™é‡Œè®²jaråŒ…ä¸Šä¼ åˆ°3rd-partyä»“åº“ä¸­ã€‚å…ˆç‚¹å‡»artifact-uploadç„¶åé€‰æ‹©GAV-definitionï¼Œæ‰‹åŠ¨å°†group-idã€artifactã€versionå¡«å…¥ï¼Œç„¶åpackagingé€‰æ‹©jarã€‚"><a href="#2ã€æˆ‘ä»¬è¿™é‡Œè®²jaråŒ…ä¸Šä¼ åˆ°3rd-partyä»“åº“ä¸­ã€‚å…ˆç‚¹å‡»artifact-uploadç„¶åé€‰æ‹©GAV-definitionï¼Œæ‰‹åŠ¨å°†group-idã€artifactã€versionå¡«å…¥ï¼Œç„¶åpackagingé€‰æ‹©jarã€‚" class="headerlink" title="2ã€æˆ‘ä»¬è¿™é‡Œè®²jaråŒ…ä¸Šä¼ åˆ°3rd partyä»“åº“ä¸­ã€‚å…ˆç‚¹å‡»artifact uploadç„¶åé€‰æ‹©GAV definitionï¼Œæ‰‹åŠ¨å°†group idã€artifactã€versionå¡«å…¥ï¼Œç„¶åpackagingé€‰æ‹©jarã€‚"></a>2ã€æˆ‘ä»¬è¿™é‡Œè®²jaråŒ…ä¸Šä¼ åˆ°3rd partyä»“åº“ä¸­ã€‚å…ˆç‚¹å‡»artifact uploadç„¶åé€‰æ‹©GAV definitionï¼Œæ‰‹åŠ¨å°†group idã€artifactã€versionå¡«å…¥ï¼Œç„¶åpackagingé€‰æ‹©jarã€‚</h4><p><img src="http://res.cloudinary.com/leon824/image/upload/v1505547985/4B23709_hwgqem.png" width="100%" height="100%"></p>
<h4 id="3ã€ç„¶åç‚¹å‡»select-artifactï¼ˆsï¼‰-to-uploadå°†æœ¬åœ°çš„jaråŠ å…¥ï¼Œç‚¹å‡»add-artifactï¼Œç„¶åç‚¹å‡»upload-artifactã€‚"><a href="#3ã€ç„¶åç‚¹å‡»select-artifactï¼ˆsï¼‰-to-uploadå°†æœ¬åœ°çš„jaråŠ å…¥ï¼Œç‚¹å‡»add-artifactï¼Œç„¶åç‚¹å‡»upload-artifactã€‚" class="headerlink" title="3ã€ç„¶åç‚¹å‡»select artifactï¼ˆsï¼‰ to uploadå°†æœ¬åœ°çš„jaråŠ å…¥ï¼Œç‚¹å‡»add artifactï¼Œç„¶åç‚¹å‡»upload artifactã€‚"></a>3ã€ç„¶åç‚¹å‡»select artifactï¼ˆsï¼‰ to uploadå°†æœ¬åœ°çš„jaråŠ å…¥ï¼Œç‚¹å‡»add artifactï¼Œç„¶åç‚¹å‡»upload artifactã€‚</h4><p><img src="http://res.cloudinary.com/leon824/image/upload/v1505547145/sb_pmqkdu.png" width="100%" height="100%"></p>
<h4 id="4ã€æœ€ååˆ·æ–°å°±èƒ½çœ‹åˆ°åˆšæ‰åŠ å…¥çš„jaråŒ…ã€‚"><a href="#4ã€æœ€ååˆ·æ–°å°±èƒ½çœ‹åˆ°åˆšæ‰åŠ å…¥çš„jaråŒ…ã€‚" class="headerlink" title="4ã€æœ€ååˆ·æ–°å°±èƒ½çœ‹åˆ°åˆšæ‰åŠ å…¥çš„jaråŒ…ã€‚"></a>4ã€æœ€ååˆ·æ–°å°±èƒ½çœ‹åˆ°åˆšæ‰åŠ å…¥çš„jaråŒ…ã€‚</h4><p><img src="http://res.cloudinary.com/dxxvv37m3/image/upload/v1505547145/sb28F42D_beaise.png" width="100%" height="100%"></p>
<p><strong>æ­¤å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°†å…¥åˆ°3rdä»“åº“ä¹‹åå¯èƒ½å¯¹åº”çš„åæ ‡ä¼šå‘ç”Ÿå˜åŒ–ã€‚å¦‚æœå‰ååæ ‡æ²¡æœ‰å¯¹åº”ä¸Šï¼Œé‚£ä¹ˆåœ¨pomæ–‡ä»¶ä¸­è¿˜æ˜¯æ‰¾ä¸åˆ°ç›¸åº”çš„ä¾èµ–ã€‚</strong></p>
<p>&lt;img src=â€<a href="http://res.cloudinary.com/leon824/image/upload/v1505547143/jiang58A_vvzx28.png&quot;width=&quot;100%&quot;" target="_blank" rel="noopener">http://res.cloudinary.com/leon824/image/upload/v1505547143/jiang58A_vvzx28.png&quot;width=&quot;100%&quot;</a> height=â€100%â€&gt;</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>å¦‚ä½•åœ¨ubuntu16.04ä¸­æ­å»ºredisé›†ç¾¤</title>
    <url>/2018/04/01/%E5%A6%82%E4%BD%95%E5%9C%A8ubuntu16.04%E4%B8%AD%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4/</url>
    <content><![CDATA[<h2 id="å¦‚ä½•åœ¨ubuntu16-04ä¸­æ­å»ºredisé›†ç¾¤"><a href="#å¦‚ä½•åœ¨ubuntu16-04ä¸­æ­å»ºredisé›†ç¾¤" class="headerlink" title="å¦‚ä½•åœ¨ubuntu16.04ä¸­æ­å»ºredisé›†ç¾¤"></a>å¦‚ä½•åœ¨ubuntu16.04ä¸­æ­å»ºredisé›†ç¾¤</h2><blockquote>
<p>è¦æƒ³æ­å»ºä¸€ä¸ªæœ€ç®€å•çš„Redisé›†ç¾¤ï¼Œé‚£ä¹ˆè‡³å°‘éœ€è¦6ä¸ªèŠ‚ç‚¹ï¼š3ä¸ªMasterå’Œ3ä¸ªSlaveã€‚</p>
</blockquote>
<h3 id="åœ¨ubuntu16-04ä¸­å®‰è£…redis"><a href="#åœ¨ubuntu16-04ä¸­å®‰è£…redis" class="headerlink" title="åœ¨ubuntu16.04ä¸­å®‰è£…redis"></a>åœ¨ubuntu16.04ä¸­å®‰è£…redis</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">//ä¸‹è½½</span><br><span class="line">axel -n 5 http://download.redis.io/releases/redis-4.0.9.tar.gz</span><br><span class="line"></span><br><span class="line">//è§£å‹</span><br><span class="line">tar -zxvf redis-4.0.9.tar.gz</span><br><span class="line"></span><br><span class="line">ç¼–è¯‘</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">//ä¸ºäº†æ–¹ä¾¿å¯åŠ¨redisï¼Œåœ¨profileä¸­æ·»åŠ PATH</span><br><span class="line"><span class="meta">#</span>SET REDIS_HOME</span><br><span class="line">export REDIS_HOME=/opt/local/software/redis-4.0.9</span><br><span class="line">export PATH=$PATH:$REDIS_HOME/src</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°è¯•å¯åŠ¨redisæ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸï¼Œè‹¥å‡ºç°ä¸‹é¢çš„å†…å®¹è¯´æ˜å®‰è£…æˆåŠŸã€‚</p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1522566992/redis1_cklmlm.png" width="100%" height="100%"></p>
<h3 id="é…ç½®redisé›†ç¾¤"><a href="#é…ç½®redisé›†ç¾¤" class="headerlink" title="é…ç½®redisé›†ç¾¤"></a>é…ç½®redisé›†ç¾¤</h3><p>ç”±äºç”µè„‘é…ç½®æœ‰é™ï¼Œä¸å¤§å¯èƒ½å®‰è£…é‚£ä¹ˆå¤šè™šæ‹Ÿæœºã€‚å¯ä»¥åœ¨ä¸€å°è™šæ‹Ÿæœºä¸­å¼€å¯å¤šä¸ªrediså®ä¾‹ï¼Œå°†è¿™å¤šä¸ªå®ä¾‹ç»„å»ºæˆä¸€ä¸ªredisé›†ç¾¤ã€‚é¦–å…ˆåˆ›å»ºå…­ä¸ªæ–‡ä»¶å¤¹ï¼Œå°†redis-confæ–‡ä»¶copyåˆ°æ¯ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚</p>
<p><img src="http://res.cloudinary.com/leon824/image/upload/v1522566990/redis2_yejm3q.png" width="100%" height="60%"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp ../redis-4.0.9/redis.conf ./8001</span><br><span class="line">cp ../redis-4.0.9/redis.conf ./8002</span><br><span class="line">cp ../redis-4.0.9/redis.conf ./8003</span><br><span class="line">cp ../redis-4.0.9/redis.conf ./8004</span><br><span class="line">cp ../redis-4.0.9/redis.conf ./8005</span><br><span class="line">cp ../redis-4.0.9/redis.conf ./8006</span><br></pre></td></tr></table></figure>
<h4 id="redisé…ç½®æ–‡ä»¶"><a href="#redisé…ç½®æ–‡ä»¶" class="headerlink" title="redisé…ç½®æ–‡ä»¶"></a>redisé…ç½®æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># redis æä¾›æœåŠ¡æ—¶ç»‘å®šçš„æœ¬æœºç½‘ç»œåœ°å€ï¼Œå¯ä»¥æ˜¯å¤šä¸ªæ»¡è¶³å¤šå—ç½‘å¡åˆ†åˆ«å¯¹å¤–ç½‘å†…ç½‘çš„è®¿é—®, æŒ‰éœ€è¦æ”¹</span><br><span class="line">bind 127.0.0.1</span><br><span class="line"># æä¾›æœåŠ¡çš„ç«¯å£, ä¾›å®¢æˆ·ç«¯è¿æ¥</span><br><span class="line">port 8001</span><br><span class="line"># å¯åŠ¨redisæœåŠ¡æ—¶,è¿›ç¨‹pidå­˜å‚¨ä½ç½®</span><br><span class="line">pidfile /opt/local/software/redis-node/8001/redis.pid</span><br><span class="line"># redis æ—¥å¿—æ–‡ä»¶æ‰€åœ¨</span><br><span class="line">logfile &quot;/opt/local/software/redis-node/8001/log.txt&quot;</span><br><span class="line"># æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨ç›®å½•</span><br><span class="line">dir /opt/local/software/redis-node/8001</span><br><span class="line"># å¼€å¯é›†ç¾¤æ¨¡å¼</span><br><span class="line">cluster-enabled yes</span><br><span class="line"># é›†ç¾¤æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹é…ç½®ä¿¡æ¯</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line"># é›†ç¾¤ä¸­å„èŠ‚ç‚¹é—´è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"># å…è®¸æ•°æ®æŒä¹…åŒ–è¿½åŠ </span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ ¹æ®ä¸Šé¢çš„é…ç½®æ–‡ä»¶å°†æ¯ä¸€ä¸ªrediså®ä¾‹çš„ç«¯å£å·ã€ç›®å½•ã€æ—¥å¿—æ–‡ä»¶ç­‰ç­‰æŒ‰ç…§å…·ä½“çš„æƒ…å†µè®¾ç½®ã€‚</p>
<h4 id="å¯åŠ¨redis"><a href="#å¯åŠ¨redis" class="headerlink" title="å¯åŠ¨redis"></a>å¯åŠ¨redis</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis-server 8001/redis.conf</span><br><span class="line">redis-server 8002/redis.conf</span><br><span class="line">redis-server 8003/redis.conf</span><br><span class="line">redis-server 8004/redis.conf</span><br><span class="line">redis-server 8005/redis.conf</span><br><span class="line">redis-server 8006/redis.conf</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨å®Œæˆä¹‹åå…ˆæŸ¥çœ‹ä¸€ä¸‹å„ä¸ªèŠ‚ç‚¹æ˜¯å¦å¯åŠ¨æˆåŠŸ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">leon at leon_ubuntu in /opt/local/software/redis-node </span><br><span class="line">$ ps aux | grep redis</span><br><span class="line">leon      15499  0.0  0.1  50908  5580 pts/19   Sl+  14:22   0:02 redis-server 127.0.0.1:8001 [cluster]</span><br><span class="line">leon      15506  0.0  0.1  50908  5580 pts/4    Sl+  14:22   0:02 redis-server 127.0.0.1:8002 [cluster]</span><br><span class="line">leon      15511  0.0  0.1  50908  5536 pts/18   Sl+  14:23   0:02 redis-server 127.0.0.1:8003 [cluster]</span><br><span class="line">leon      15516  0.0  0.1  50908  5320 pts/21   Sl+  14:23   0:02 redis-server 127.0.0.1:8004 [cluster]</span><br><span class="line">leon      15521  0.0  0.1  50908  5436 pts/20   Sl+  14:23   0:02 redis-server 127.0.0.1:8005 [cluster]</span><br><span class="line">leon      15526  0.0  0.1  50908  5464 pts/22   Sl+  14:23   0:02 redis-server 127.0.0.1:8006 [cluster]</span><br><span class="line">leon      15536  0.0  0.0  14352  2624 pts/23   S+   14:23   0:00 redis-cli -c -p 8001</span><br><span class="line">leon      15886  0.0  0.0  14224   936 pts/25   S+   15:05   0:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn redis</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„å‡ ä¸ªèŠ‚ç‚¹éƒ½å·²ç»å¯åŠ¨æˆåŠŸäº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç»„å»ºæˆä¸ºé›†ç¾¤ï¼Œè¦æƒ³ç»„å»ºä¸€ä¸ªé›†ç¾¤è¿˜éœ€è¦ä½¿ç”¨redis-trib.rbå·¥å…·å°†ä¸Šé¢å…­ä¸ªèŠ‚ç‚¹è¿æ¥èµ·æ¥ã€‚ä½†æ˜¯å®ƒéœ€è¦åœ¨rubyçš„ç¯å¢ƒä¸‹è¿è¡Œå¹¶ä¸”åœ¨è¿™ä¸ªç¯å¢ƒä¸‹å®‰è£…å¯¹åº”çš„redisæ’ä»¶ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo gem install redis</span><br></pre></td></tr></table></figure></p>
<p>å®‰è£…å®Œæˆä¹‹åæ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤å°†rediså®ä¾‹ç»„å»ºæˆä¸€ä¸ªé›†ç¾¤<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redis-trib.rb create --replicas 1 127.0.0.1:8001 127.0.0.1:8002 127.0.0.1:8003 127.0.0.1:8004 127.0.0.1:8005 127.0.0.1:8006</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">leon at leon_ubuntu in /opt/local/software/redis-4.0.9/src </span><br><span class="line">$ redis-trib.rb create --replicas 1 127.0.0.1:8001 127.0.0.1:8002 127.0.0.1:8003 127.0.0.1:8004 127.0.0.1:8005 127.0.0.1:8006</span><br><span class="line">&gt;&gt;&gt; Creating cluster</span><br><span class="line">&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...</span><br><span class="line">Using 3 masters:</span><br><span class="line">127.0.0.1:8001</span><br><span class="line">127.0.0.1:8002</span><br><span class="line">127.0.0.1:8003</span><br><span class="line">Adding replica 127.0.0.1:8005 to 127.0.0.1:8001</span><br><span class="line">Adding replica 127.0.0.1:8006 to 127.0.0.1:8002</span><br><span class="line">Adding replica 127.0.0.1:8004 to 127.0.0.1:8003</span><br><span class="line">&gt;&gt;&gt; Trying to optimize slaves allocation for anti-affinity</span><br><span class="line">[WARNING] Some slaves are in the same host as their master</span><br><span class="line">M: 1bc512b4d4b5d0c73a72d97e7d70ea307db7ae96 127.0.0.1:8001</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">M: b9b6ff12c2a788a708a5fc754ee6e9add83ef089 127.0.0.1:8002</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">M: 01742676bd6bb86313c44365df28328a383a007f 127.0.0.1:8003</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">S: 5d3d629269a52017f0e1fb5d043f5797319aa306 127.0.0.1:8004</span><br><span class="line">   replicates 1bc512b4d4b5d0c73a72d97e7d70ea307db7ae96</span><br><span class="line">S: ab65c3dd627b885d60e7f01d69acc7fbd1db50b0 127.0.0.1:8005</span><br><span class="line">   replicates b9b6ff12c2a788a708a5fc754ee6e9add83ef089</span><br><span class="line">S: 2487d2d01333914e7d407a7fe89ddfa2f12884a9 127.0.0.1:8006</span><br><span class="line">   replicates 01742676bd6bb86313c44365df28328a383a007f</span><br><span class="line">Can I set the above configuration? (type &apos;yes&apos; to accept): yes</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting for the cluster to join..</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:8001)</span><br><span class="line">M: 1bc512b4d4b5d0c73a72d97e7d70ea307db7ae96 127.0.0.1:8001</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: b9b6ff12c2a788a708a5fc754ee6e9add83ef089 127.0.0.1:8002</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 2487d2d01333914e7d407a7fe89ddfa2f12884a9 127.0.0.1:8006</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 01742676bd6bb86313c44365df28328a383a007f</span><br><span class="line">S: 5d3d629269a52017f0e1fb5d043f5797319aa306 127.0.0.1:8004</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 1bc512b4d4b5d0c73a72d97e7d70ea307db7ae96</span><br><span class="line">M: 01742676bd6bb86313c44365df28328a383a007f 127.0.0.1:8003</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: ab65c3dd627b885d60e7f01d69acc7fbd1db50b0 127.0.0.1:8005</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates b9b6ff12c2a788a708a5fc754ee6e9add83ef089</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check for open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ—¥å¿—æ‰“å°çœ‹å‡ºå·²ç»æˆåŠŸå°†6ä¸ªèŠ‚ç‚¹å…¨éƒ¨ç»„å»ºæˆä¸€ä¸ªredisé›†ç¾¤äº†ï¼ŒåŒæ—¶å°†[8001,8002,8003]ä½œä¸ºmasterï¼Œ[8004ï¼Œ8005ï¼Œ8006]ä¸ºå‰é¢ä¸‰ä¸ªçš„å¤åˆ¶èŠ‚ç‚¹ã€‚</p>
<p>è‡³æ­¤redisé›†ç¾¤æ­å»ºå®Œæˆã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a href="https://www.jianshu.com/p/0dc64585a2a9" target="_blank" rel="noopener">ubuntuå®‰è£…redisé›†ç¾¤
</a></p>
<p><a href="https://www.howtoing.com/how-to-configure-a-redis-cluster-on-ubuntu-14-04" target="_blank" rel="noopener">å¦‚ä½•åœ¨Ubuntu 14.04é…ç½®çš„Redisé›†ç¾¤</a></p>
<p><a href="https://www.linuxidc.com/Linux/2017-03/141683.htm" target="_blank" rel="noopener">Linuxä¸‹Redisé›†ç¾¤å®‰è£…éƒ¨ç½²åŠä½¿ç”¨è¯¦è§£</a></p>
]]></content>
      <categories>
        <category>ä¸­é—´ä»¶</category>
      </categories>
  </entry>
  <entry>
    <title>æµ…è°ˆè®¡ç®—æœºé¢†åŸŸçš„ç¼“å­˜</title>
    <url>/2020/07/07/%E6%B5%85%E8%B0%88%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%A2%86%E5%9F%9F%E7%9A%84%E7%BC%93%E5%AD%98/</url>
    <content><![CDATA[<h1 id="æµ…è°ˆè®¡ç®—æœºé¢†åŸŸçš„ç¼“å­˜"><a href="#æµ…è°ˆè®¡ç®—æœºé¢†åŸŸçš„ç¼“å­˜" class="headerlink" title="æµ…è°ˆè®¡ç®—æœºé¢†åŸŸçš„ç¼“å­˜"></a><center>æµ…è°ˆè®¡ç®—æœºé¢†åŸŸçš„ç¼“å­˜</center></h1><p><img src="https://res.cloudinary.com/leon824/image/upload/v1594113581/it_photo_113632_qkdoaw.jpg" alt></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç¼“å­˜å¯ä»¥è¯´åœ¨è®¡ç®—æœºé¢†åŸŸæ— å¤„ä¸è§ï¼Œåº•å±‚ç¡¬ä»¶çš„<strong>Cpué«˜é€Ÿç¼“å­˜</strong>ã€<strong>ç£ç›˜ç¼“å­˜</strong>ï¼›å¤„äºç½‘è·¯è¾¹ç¼˜çš„<strong>Dnsç¼“å­˜</strong>ã€<strong>Webç¼“å­˜</strong>ã€<strong>Httpç¼“å­˜</strong>ã€<strong>DNS</strong>ï¼›åº”ç”¨æœåŠ¡ä¸­çš„<strong>æ•°æ®åº“ç¼“å­˜</strong>ã€<strong>åˆ†å¸ƒå¼ç¼“å­˜</strong>ã€<strong>æœ¬åœ°ç¼“å­˜</strong>ç­‰ç­‰ã€‚è¿™äº›ç¼“å­˜éƒ½æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿä¸ºä»€ä¹ˆç¼“å­˜è¢«å¤§é‡ä½¿ç”¨ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿä»Šå¤©æˆ‘ä»¬ä»æ¨ªå‘åˆ†ç±»å½’çº³çš„æ–¹å¼æ¥æ¢è®¨ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ï¼Ÿ"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ï¼Ÿ" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ï¼Ÿ"></a>ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ï¼Ÿ</h2><p>åœ¨æ¢è®¨ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å…·ä½“çš„å‡ ä¸ªä¾‹å­ï¼Œçœ‹çœ‹ç¼“å­˜åœ¨å®é™…åœºæ™¯ä¸­ç»™æˆ‘ä»¬è§£å†³äº†å“ªäº›é—®é¢˜ã€‚</p>
<h4 id="1ã€CPUé«˜é€Ÿç¼“å­˜"><a href="#1ã€CPUé«˜é€Ÿç¼“å­˜" class="headerlink" title="1ã€CPUé«˜é€Ÿç¼“å­˜"></a>1ã€CPUé«˜é€Ÿç¼“å­˜</h4><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ç§æƒ…å†µï¼Œä¼—æ‰€å‘¨çŸ¥ï¼ŒCPUå¯ä»¥ç›´æ¥è®¿é—®çš„å­˜å‚¨è®¾å¤‡åªæœ‰<strong>å†…å­˜</strong>å’Œ<strong>å†…ç½®çš„å¯„å­˜å™¨</strong>ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å¤„äºè¿™äº›å­˜å‚¨è®¾å¤‡ä¸­ï¼Œé‚£ä¹ˆéœ€è¦å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒCPUæ‰èƒ½ç›´æ¥è®¿é—®ã€‚<br>CPUè®¿é—®å†…ç½®å¯„å­˜å™¨é€šå¸¸åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸä¾¿å¯å®Œæˆã€‚è€Œå¯¹äºå†…å­˜æ¥è¯´å°±ä¸è¡Œäº†ï¼Œå®Œæˆä¸€æ¬¡å†…å­˜è®¿é—®é€šå¸¸éœ€è¦å¤šä¸ªæ—¶é’Ÿå‘¨æœŸæ‰èƒ½å®Œæˆï¼Œé‚£ä¹ˆç”±äºæ²¡æœ‰æ•°æ®ä»¥ä¾¿å®Œæˆæ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ï¼ŒCPUé€šå¸¸éœ€è¦<strong>æš‚åœï¼ˆstallï¼‰</strong>ï¼Œè€Œä¸”ç”±äºå†…å­˜è®¿é—®éå¸¸é¢‘ç¹ï¼ˆç›¸å¯¹å¯„å­˜å™¨ï¼Œå†…å­˜çš„å®¹é‡å¤§å¾—å¤šï¼‰ï¼Œæ‰€æœ‰è¿™ç§æƒ…å†µæ˜¯æ— æ³•å®¹å¿çš„ã€‚</p>
<p>è§£å†³ä¸Šè¾¹CPUé¢‘ç¹æš‚åœçš„åŠæ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ç­”æ¡ˆå°±æ˜¯é€šè¿‡å¢åŠ <strong>é«˜é€Ÿç¼“å­˜</strong>ï¼ˆCPUè®¿é—®é€Ÿåº¦æ¯”å†…å­˜å¿«å¾ˆå¤šï¼‰æ¥<strong>è°ƒå’ŒCPUè®¿é—®å†…å­˜è¿‡æ…¢çš„é—®é¢˜</strong>ã€‚å…·ä½“åŸç†å¯ä»¥å‚è€ƒcoolshellçš„<a href="https://coolshell.cn/articles/20793.html" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a></p>
<p>ä¸æ­¤ç±»ä¼¼çš„åœºæ™¯è¿˜æœ‰<strong>ç£ç›˜ç¼“å­˜</strong>ï¼ŒåŒæ ·æ˜¯ä¸ºäº†è°ƒå’Œå†…å­˜ä¸ç£ç›˜ä¹‹é—´é€Ÿåº¦çš„å·®å¼‚ã€‚</p>
<h4 id="2ã€Webç¼“å­˜"><a href="#2ã€Webç¼“å­˜" class="headerlink" title="2ã€Webç¼“å­˜"></a>2ã€Webç¼“å­˜</h4><p>å‡è®¾å°æ˜ä½¿ç”¨æµè§ˆå™¨æ­£åœ¨è¯·æ±‚ä¸‹è½½ä¸€ä¸ªæœ€æ–°çš„Ubuntu ISOï¼Œé“¾æ¥ä¸º<code>https://releases.ubuntu.com/20.04/ubuntu-20.04-desktop-amd64.iso</code>ï¼Œè‹¥èµ„æºçš„æœåŠ¡å™¨åœ°å€åœ¨ç¾å›½ï¼Œé‚£ä¹ˆç”±äºé“¾è·¯è¿‡é•¿ï¼Œè€Œ<strong>ä¸‹è½½çš„é€Ÿåº¦ç”±æ•´ä¸ªé“¾è·¯çš„ç“¶é¢ˆå†³å®šçš„</strong>ï¼Œæ‰€ä»¥æ•´ä¸ªä¸‹è½½é€Ÿåº¦å°†å—åˆ°å¾ˆå¤šå› ç´ å½±å“ï¼›äºæ­¤åŒæ—¶ï¼Œå’Œä½ å¤„äºåŒä¸€ä¸ªå±€åŸŸç½‘çš„å¦å¤–ä¸€ä¸ªäººï¼Œä¹Ÿæƒ³ä¸‹è½½åŒä¸€ä¸ªèµ„æºï¼Œé‚£ä¹ˆä»–ä¹Ÿä¸å¾—ä¸é‡æ–°å‘èµ·ä¸€ä¸ªä¸‹è½½è¯·æ±‚ï¼Œå¿å—å¾ˆæ…¢çš„ä¸‹è½½é€Ÿåº¦ï¼Œä¸”äº’è”ç½‘çš„å¸¦å®½æ˜¯æœ‰ä¸Šé™çš„ï¼Œ<strong>å¤§é‡é‡å¤çš„æ•°æ®ä¼ è¾“å°†å¤§å¤§å¢åŠ é“¾è·¯çš„æ‹¥å¡ï¼Œä»è€Œå¯¼è‡´æ•´ä½“ä¸‹è¡Œé€Ÿåº¦æ›´æ…¢</strong>ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å°±æ˜¯åœ¨ç”¨æˆ·å’Œç›®æ ‡èµ„æºæœåŠ¡å™¨ä¹‹é—´å¢å‡<strong>WEBç¼“å­˜</strong>ï¼Œèµ„æºé¦–æ¬¡è®¿é—®ä¹‹åï¼Œå°†ä¼šç¼“å­˜åˆ°<strong>Webç¼“å­˜å™¨</strong>ï¼ˆæ‹¥æœ‰è‡ªå·±çš„ç£ç›˜å­˜å‚¨ç©ºé—´ï¼‰ä¸­ï¼Œ<strong>åœ¨ä¸€æ®µæ—¶é—´å†…</strong>ç›¸åŒåŒºåŸŸå†…çš„ç”¨æˆ·ä¹Ÿéœ€è¦ä¸‹è½½åŒæ ·çš„èµ„æºçš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥åœ¨Webç¼“å­˜ä¸­è·å–åˆ°èµ„æºï¼Œè€Œä¸éœ€è¦å»è®¿é—®è¿œç«¯çš„èµ„æºã€‚<strong>ä»è€Œå‡å°‘å› ç‰¹ç½‘ä¸­çš„é€šä¿¡é‡ï¼Œå¹¶ä¸”å¤§å¤§å‡å°‘ç”¨æˆ·çš„è¯·æ±‚æ—¶é—´</strong>ã€‚å¦‚ä¸‹å›¾ï¼š<br><img src="https://res.cloudinary.com/leon824/image/upload/v1593178231/catch-1_bzmvew.png" alt></p>
<h2 id="äºŒã€ç¼“å­˜çš„åˆ†ç±»"><a href="#äºŒã€ç¼“å­˜çš„åˆ†ç±»" class="headerlink" title="äºŒã€ç¼“å­˜çš„åˆ†ç±»"></a>äºŒã€ç¼“å­˜çš„åˆ†ç±»</h2><p>ä¸Šè¾¹çš„å¯¹äº<strong>CPUé«˜é€Ÿç¼“å­˜</strong>å’Œ<strong>Webç¼“å­˜</strong>çš„ä¸¤ç§åœºæ™¯ä¸‹ç¼“å­˜çš„ä½¿ç”¨ï¼Œæˆ‘å°†ç¼“å­˜åˆ†ä¸ºä¸¤ç§ç±»å‹ã€‚</p>
<h3 id="1ã€è°ƒå’Œé€Ÿåº¦å·®å¼‚å‹"><a href="#1ã€è°ƒå’Œé€Ÿåº¦å·®å¼‚å‹" class="headerlink" title="1ã€è°ƒå’Œé€Ÿåº¦å·®å¼‚å‹"></a>1ã€è°ƒå’Œé€Ÿåº¦å·®å¼‚å‹</h3><p>è§åçŸ¥æ„ï¼Œè¿™ç±»ç¼“å­˜ä¸»è¦çš„ä¸»è¦ä½œç”¨å°±æ˜¯<strong>è°ƒå’Œä¸¤ç§èµ„æºä¹‹é—´é€Ÿåº¦çš„å·®å¼‚</strong>ï¼Œä»è€Œå‡å°‘é«˜é€Ÿè®¾å¤‡çš„ç­‰å¾…æ—¶é—´ï¼Œæœ€ç»ˆå®ç°æ•´ä½“æ€§èƒ½çš„æå‡ã€‚ä¾‹å¦‚<strong>Cpué«˜é€Ÿç¼“å­˜</strong>ã€<strong>ç£ç›˜ç¼“å­˜</strong>ã€<strong>åˆ†å¸ƒå¼ç¼“å­˜</strong>ç­‰ç­‰ï¼Œéƒ½æ˜¯æ­¤ç±»ç›®çš„ã€‚å…³äºCpué«˜é€Ÿç¼“å­˜çš„å…·ä½“åŸç†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒç»´åŸº<a href="https://zh.wikipedia.org/wiki/CPU%E7%BC%93%E5%AD%98#:~:text=%E5%9C%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%AD%EF%BC%8CCPU,%E5%86%85%E6%98%AF%E5%90%A6%E6%9C%89%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E3%80%82" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a></p>
<h3 id="2ã€é™ä½æˆæœ¬å‹"><a href="#2ã€é™ä½æˆæœ¬å‹" class="headerlink" title="2ã€é™ä½æˆæœ¬å‹"></a>2ã€é™ä½æˆæœ¬å‹</h3><p>aã€æ­¤ç±»å‹å¯èƒ½æ›´å¤šçš„ç”¨äº<strong>â€œç½‘ç»œè¾¹ç¼˜â€è®¾å¤‡</strong>ï¼Œä¾‹å¦‚ä¸Šè¾¹ä»‹ç»çš„Webç¼“å­˜ã€‚ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†é™ä½<strong>ä½¿ç”¨æˆæœ¬</strong>ï¼Œå½“æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªèµ„æºä¹‹åå°†ç¼“å­˜åˆ°è·ç¦»æˆ‘ä»¬æ›´è¿‘çš„webç¼“å­˜æœåŠ¡å™¨ä¸­ï¼Œå½“æˆ‘ä»¬ä¸‹æ¬¡è®¿é—®åˆ™å¯ä»¥ç›´æ¥å‘½ä¸­å±€åŸŸç½‘å†…å·²ç»ç¼“å­˜çš„èµ„æºï¼Œè¾¾åˆ°ç›´æ¥é™ä½ä½¿ç”¨æˆæœ¬çš„ç›®çš„ã€‚</p>
<p>bã€è¿˜æœ‰ä¾‹å¦‚æˆ‘ä»¬ä½¿ç”¨Mysqlæ•°æ®åº“æ—¶ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªSqlæŸ¥è¯¢è¯­å¥ï¼Œæ•°æ®åº“å¹¶ä¸ä¼šç«‹å³å»è§£æè¯­æ³•æ ‘ã€æ‰§è¡Œsqlè¿™äº›åŠ¨ä½œï¼Œ<strong>è€Œæ˜¯å…ˆå°†è®¡ç®—æ­¤Sqlçš„Hashå€¼ï¼Œç„¶åé€šè¿‡è¿™ä¸ªHashå€¼å»ç¼“å­˜ä¸­æŸ¥è¯¢æ˜¯å¦å·²ç»ç¼“å­˜ï¼Œè‹¥å‘½ä¸­ç›´æ¥è¿”å›ä¹‹å‰å·²ç»ç¼“å­˜çš„ç»“æœç»™ç”¨æˆ·</strong>ï¼Œè¿™å°±èƒ½æå¤§åœ°é™ä½æŸ¥è¯¢æˆæœ¬ã€‚</p>
<p>cã€æˆ‘ä»¬åœ¨ç¨‹åºä¸­é€šå¸¸ä¼šå°†è®¡ç®—/è·å–æˆæœ¬è¾ƒé«˜çš„æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œä»¥å¤‡ä¸‹ä¸€æ¬¡ä½¿ç”¨æ—¶ç›´æ¥åœ¨å†…å­˜ä¸­è®¿é—®ï¼Œé™ä½å“åº”æ—¶é—´ã€æé«˜æœåŠ¡çš„ååé‡ã€‚</p>
<hr>
<p>ä½¿ç”¨ç¼“å­˜çš„åœºæ™¯éå¸¸éå¸¸å¤šï¼Œä½†å¤§ä½“ç¦»ä¸å¼€è¿™ä¸¤ç§ç±»å‹ã€‚æœ‰æ—¶å€™ç¼“å­˜<strong>å…¼å…·ä»¥ä¸Šä¸¤ç§ç±»å‹çš„ç‰¹å¾</strong>ï¼Œä¾‹å¦‚ä½¿ç”¨Redisåšåˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ—¢å¯ä»¥ä¸ºè°ƒå’Œæ•°æ®åº“èµ„æºã€è®¿é—®é€Ÿåº¦æœ‰é™çš„é—®é¢˜ï¼›åŒæ—¶ä¹Ÿå¯å°†åº”ç”¨ä¸­éœ€è¦é¢‘ç¹ä½¿ç”¨ä¸”è®¡ç®—æˆæœ¬é«˜çš„æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œå®ç°é™ä½ä½¿ç”¨æˆæœ¬çš„ç›®çš„ã€‚</p>
<h2 id="ä¸‰ã€ä½¿ç”¨ç¼“å­˜éœ€è¦æ³¨æ„çš„é—®é¢˜"><a href="#ä¸‰ã€ä½¿ç”¨ç¼“å­˜éœ€è¦æ³¨æ„çš„é—®é¢˜" class="headerlink" title="ä¸‰ã€ä½¿ç”¨ç¼“å­˜éœ€è¦æ³¨æ„çš„é—®é¢˜"></a>ä¸‰ã€ä½¿ç”¨ç¼“å­˜éœ€è¦æ³¨æ„çš„é—®é¢˜</h2><p>é€šè¿‡ä¸Šè¾¹çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ç¼“å­˜ç»™æˆ‘ä»¬å¸¦æ¥ç³»ç»Ÿæ€§èƒ½ä¸Šçš„æå¤§æå‡ï¼Œä½†æ˜¯ä½¿ç”¨ç¼“å­˜ä¹Ÿéœ€è¦æ³¨æ„ä¸‹è¾¹çš„ä¸¤ä¸ªé—®é¢˜ï¼Œå¦åˆ™â€œç†æƒ³æ˜¯ç¾å¥½çš„ï¼Œç°å®æ˜¯éª¨æ„Ÿçš„â€ã€‚</p>
<h3 id="1ã€å¦‚ä½•è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Ÿ"><a href="#1ã€å¦‚ä½•è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="1ã€å¦‚ä½•è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Ÿ"></a>1ã€å¦‚ä½•è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Ÿ</h3><p>é¦–å…ˆåœ¨è¿™é‡Œæˆ‘ä»¬ä»¥<strong>â€å¾®è§‚â€œ</strong>çš„è§’åº¦æ¥åˆ†æ<strong>å¤šæ ¸CPUç¼“å­˜ä¸€è‡´æ€§</strong>å’Œæ¥æ¢è®¨ã€‚</p>
<h4 id="å¤šæ ¸CPUç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"><a href="#å¤šæ ¸CPUç¼“å­˜ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="å¤šæ ¸CPUç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"></a>å¤šæ ¸CPUç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</h4><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œå‡è®¾<code>cpuã€cacheã€main memory</code>çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1594101087/cpu-3_vbqxpx.png" alt></p>
<p>ä¸¤ä¸ªcpuå…±äº«åŒä¸€ä¸ªç¼“å­˜ï¼Œè¿™æ ·å½“ç¼“å­˜ä¸­çš„æ•°æ®æ›´æ–°ä¹‹åï¼Œ<strong>cpu-0ã€cpu-1è¯»å–åˆ°çš„æ•°æ®è‡ªç„¶æ˜¯ç›¸åŒçš„ï¼Œæ­¤æ—¶ä¸å­˜åœ¨ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</strong>ï¼Œä½†æ˜¯ç”±äºæ­¤æ—¶ç¼“å­˜å±äº<strong>â€œä¸´ç•ŒåŒºèµ„æºâ€</strong>ï¼Œä¸ºäº†é¿å…å¤šæ ¸CPUåŒæ—¶è¯»å†™è€Œäº§ç”Ÿçš„<strong>ä¸´ç•ŒåŒºèµ„æºå®‰å…¨</strong>çš„é—®é¢˜ï¼Œé‚£ä¹ˆå°±éœ€è¦åŠ é”ï¼Œé‚£æ­¤æ—¶ä¹Ÿå°±æå¤§åœ°é™ä½äº†ç³»ç»Ÿçš„è¿ç®—é€Ÿåº¦ï¼Œå› ä¸ºå¾ˆå¤šCPUéƒ½åœ¨æ’é˜Ÿç­‰å¾…ç¼“å­˜å¯ç”¨ã€‚æ‰€ä»¥ç°ä»£CPUçš„æ¶æ„éƒ½æ˜¯æ¯ä¸€ä¸ªCPUéƒ½æœ‰å±äºè‡ªå·±çš„ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ç¼“å­˜ä¸€è‡´æ€§æ˜¯å¤šç¼“å­˜å¼•èµ·çš„ï¼Œè€Œä¸æ˜¯å¤šCPUå¸¦æ¥çš„ã€‚</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1594028869/cache-1_sx4psn.png" alt></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œå‡è®¾ä¸€ä¸ªæ¶ˆæ¯mï¼Œæ›´æ–°åˆ°<code>cache-0</code>ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä¹Ÿéœ€è¦ç«‹å³å°†mæ›´æ–°åˆ°<code>cache-1</code>ä¸­ï¼Œè¿™å°±å±äºCPUç¼“å­˜ä¸€è‡´æ€§é—®é¢˜äº†ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨CPUç¡¬ä»¶ä¸Šï¼Œä¼šæœ‰ä¸¤ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<ul>
<li><p>Directory åè®®ï¼šè¿™ç§æ–¹æ³•çš„å…¸å‹å®ç°æ˜¯è¦è®¾è®¡ä¸€ä¸ª<strong>é›†ä¸­å¼æ§åˆ¶å™¨</strong>ï¼Œå®ƒæ˜¯ä¸»å­˜å‚¨å™¨æ§åˆ¶å™¨çš„ä¸€éƒ¨åˆ†ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªç›®å½•å­˜å‚¨åœ¨ä¸»å­˜å‚¨å™¨ä¸­ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³å„ç§æœ¬åœ°ç¼“å­˜å†…å®¹çš„å…¨å±€çŠ¶æ€ä¿¡æ¯ã€‚å½“å•ä¸ªCPU Cacheå‘å‡ºè¯»å†™è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªé›†ä¸­å¼æ§åˆ¶å™¨ä¼šæ£€æŸ¥å¹¶å‘å‡ºå¿…è¦çš„å‘½ä»¤ï¼Œä»¥åœ¨ä¸»å­˜å’ŒCPU Cacheä¹‹é—´æˆ–åœ¨CPU Cacheè‡ªèº«ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥å’Œä¼ è¾“ã€‚</p>
</li>
<li><p>Snoopy åè®®ã€‚è¿™ç§åè®®æ›´åƒæ˜¯ä¸€ç§<strong>æ•°æ®é€šçŸ¥çš„æ€»çº¿å‹</strong>çš„æŠ€æœ¯ã€‚<code>CPU Cache</code>é€šè¿‡è¿™ä¸ªåè®®å¯ä»¥è¯†åˆ«å…¶å®ƒCacheä¸Šçš„æ•°æ®çŠ¶æ€ã€‚å¦‚æœæœ‰æ•°æ®å…±äº«çš„è¯ï¼Œå¯ä»¥é€šè¿‡å¹¿æ’­æœºåˆ¶å°†å…±äº«æ•°æ®çš„çŠ¶æ€é€šçŸ¥ç»™å…¶å®ƒ<code>CPU Cache</code>ã€‚è¿™ä¸ªåè®®è¦æ±‚æ¯ä¸ª<code>CPU Cache</code>éƒ½å¯ä»¥â€œçª¥æ¢â€æ•°æ®äº‹ä»¶çš„é€šçŸ¥å¹¶åšå‡ºç›¸åº”çš„ååº”ã€‚</p>
</li>
</ul>
<p>ä»ä¸Šè¾¹ä¸¤ç§åè®®çš„æè¿°æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼ŒDirectoryåè®®æ˜¯ä¸­å¿ƒå¼çš„ï¼Œä¼šæœ‰æ€§èƒ½ç“¶é¢ˆï¼Œè€Œä¸”ä¼šå¢åŠ æ•´ä½“è®¾è®¡çš„å¤æ‚åº¦ã€‚è€ŒSnoopyåè®®æ›´åƒæ˜¯<strong>å¾®æœåŠ¡+æ¶ˆæ¯é€šè®¯</strong>ï¼Œæ‰€ä»¥ï¼Œç°åœ¨åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨Snoopyçš„æ€»çº¿çš„è®¾è®¡ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æˆ‘ä»¬ä¸€èˆ¬ç”¨Paxos/Raftè¿™æ ·çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„ç®—æ³•ã€‚è€Œåœ¨CPUçš„å¾®è§‚ä¸–ç•Œé‡Œï¼Œåˆ™ä¸å¿…ä½¿ç”¨è¿™æ ·çš„ç®—æ³•ï¼ŒåŸå› æ˜¯å› ä¸º<strong>CPUçš„å¤šä¸ªæ ¸çš„ç¡¬ä»¶ä¸å¿…è€ƒè™‘ç½‘ç»œä¼šæ–­ä¼šå»¶è¿Ÿçš„é—®é¢˜</strong>ã€‚æ‰€ä»¥ï¼ŒCPUçš„å¤šæ ¸å¿ƒç¼“å­˜é—´çš„åŒæ­¥çš„æ ¸å¿ƒå°±æ˜¯è¦ç®¡ç†å¥½<strong>æ•°æ®çš„çŠ¶æ€</strong>å°±å¥½äº†ã€‚</p>
<p>å¯¹äºæ•°æ®çŠ¶æ€ç®¡ç†çš„åè®®ä¸»è¦æœ‰ï¼šMESIåè®®ã€MOESIåè®®ç­‰ç­‰ï¼Œå…·ä½“å¯ä»¥å‚è€ƒç»´åŸºç™¾ç§‘çš„ä¸¤ç¯‡æ–‡ç« ï¼š<a href="https://zh.wikipedia.org/wiki/MESI%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">MESIåè®®</a>ã€<a href="https://en.wikipedia.org/wiki/MOESI_protocol" target="_blank" rel="noopener">MOESI protocol</a></p>
<h3 id="2ã€å¦‚ä½•æé«˜å‘½ä¸­ç‡ï¼Ÿ"><a href="#2ã€å¦‚ä½•æé«˜å‘½ä¸­ç‡ï¼Ÿ" class="headerlink" title="2ã€å¦‚ä½•æé«˜å‘½ä¸­ç‡ï¼Ÿ"></a>2ã€å¦‚ä½•æé«˜å‘½ä¸­ç‡ï¼Ÿ</h3><p>åœ¨ä½¿ç”¨ç¼“å­˜çš„åœºæ™¯ä¸­ï¼Œåœ¨å¦‚ä½•æé«˜å‘½ä¸­ç‡è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«çš„é‡è§†ï¼Œè¾ƒé«˜çš„ç¼“å­˜å‘½ä¸­ç‡å¯ä»¥å¤§å¹…çš„æé«˜æˆ‘ä»¬ç³»ç»Ÿçš„ååé‡ï¼Œé™ä½å“åº”æ—¶é—´ã€‚è¿™é‡Œæˆ‘ä»¬ä»<strong>å®è§‚</strong>è§’åº¦æ¥åˆ†æï¼Œè¿™é‡Œä»¥Redisä¸ºä¾‹ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å½±å“ç¼“å­˜å‘½ä¸­ç‡çš„å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ul>
<li><p>1ã€ä¸šåŠ¡åœºæ™¯ï¼šæˆ‘ä»¬åœ¨ç¼“å­˜æ•°æ®ä¹‹å‰è¦ç¡®è®¤ï¼Œå½“å‰çš„æ•°æ®æ˜¯å¦ä¸º<strong>â€œè¯»å¤šå†™å°‘â€ </strong>ï¼Ÿè‹¥ç›¸åï¼Œåˆ™æ²¡æœ‰å¿…è¦ä½¿ç”¨ç¼“å­˜æ¥å¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œç›´æ¥æŸ¥åº“å³å¯ã€‚</p>
</li>
<li><p>2ã€æ•°æ®ç²’åº¦ï¼šé€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ç¼“å­˜æ•°æ®çš„<strong>ç²’åº¦</strong>ç›¸å¯¹å°çš„æ—¶å€™ï¼Œè¢«å‘½ä¸­çš„æ¦‚ç‡ä¼šæ¯”è¾ƒé«˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬ç¼“å­˜ç­çº§é‡ŒæŸä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯å’Œç¼“å­˜æ•´ä¸ªç­çº§çš„ä¿¡æ¯ç›¸æ¯”ï¼Œè¿™ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯åœ¨åŒæ ·çš„æ—¶é—´èŒƒå›´å†…è¢«ä¿®æ”¹çš„æ¦‚ç‡è‚¯å®šæ˜¯è¦å°äºç­çº§é‡Œä»»æ„ä¸€ä¸ªäººè¢«ä¿®æ”¹çš„æ¦‚ç‡ï¼Œè€Œæ•°æ®æ•°æ®ä¸€æ—¦è¢«ä¿®æ”¹ï¼Œæ­¤æ—¶ç¼“å­˜å¤±æ•ˆï¼Œéœ€è¦é‡æ–°ä»DBä¸­åŠ è½½æ•°æ®å—ï¼Œç¼“å­˜ä¹Ÿéšä¹‹å¤±æ•ˆã€‚</p>
</li>
<li><p>3ã€ç¼“å­˜å®¹é‡å’ŒåŸºç¡€è®¾æ–½ï¼šRedisç¼“å­˜ä¹‹æ‰€ä»¥èƒ½å¤Ÿç›¸æ¯”DBå—ï¼Œæ˜¯å› ä¸ºç¼“å­˜ä¸­çš„æ•°æ®åœ¨å†…å­˜ä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å†…å­˜å®¹é‡ç›¸å¯¹ç£ç›˜æ˜¯å¾ˆæœ‰é™çš„ï¼Œæ‰€ä»¥ç¼“å­˜ä¸å¯èƒ½ä¸€ç›´åœ¨å†…å­˜ä¸­é©»ç•™ï¼Œé‚£ä¹ˆå°±éœ€è¦å®šä¹‰<strong>è¶…æ—¶æ—¶é—´</strong>å’Œç¼“å­˜æ•°æ®æ·˜æ±°ç®—æ³•ï¼ˆç›®å‰å¤§å¤šæ•°éƒ½é‡‡ç”¨LRUæ¥ä½œä¸ºæ·˜æ±°ç®—æ³•ï¼‰ã€‚ä¸ºæ•°æ®é¡¹å®šä¹‰åˆç†çš„å¤±æ•ˆæ—¶é—´å’Œæ·˜æ±°ç®—æ³•å¯¹æé«˜å‘½ä¸­ç‡ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚</p>
</li>
</ul>
<p>åŒæ—¶ï¼Œç¼“å­˜çš„æŠ€æœ¯é€‰å‹ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ï¼Œæ¯”å¦‚é‡‡ç”¨åº”ç”¨å†…ç½®çš„æœ¬åœ°ç¼“å­˜å°±æ¯”è¾ƒå®¹æ˜“å‡ºç°å•æœºç“¶é¢ˆï¼Œè€Œé‡‡ç”¨åˆ†å¸ƒå¼ç¼“å­˜åˆ™æ¯•ç«Ÿå®¹æ˜“æ‰©å±•ã€‚æ‰€ä»¥éœ€è¦åšå¥½ç³»ç»Ÿå®¹é‡è§„åˆ’ï¼Œå¹¶è€ƒè™‘æ˜¯å¦å¯æ‰©å±•ã€‚æ­¤å¤–ï¼Œä¸åŒçš„ç¼“å­˜æ¡†æ¶æˆ–ä¸­é—´ä»¶ï¼Œå…¶æ•ˆç‡å’Œç¨³å®šæ€§ä¹Ÿæ˜¯å­˜åœ¨å·®å¼‚çš„ã€‚</p>
<p>è¦æé«˜ç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ä¸šåŠ¡åœºæ™¯ã€ç²’åº¦å’Œç­–ç•¥ã€ç¼“å­˜å®¹é‡å’ŒåŸºç¡€è®¾æ–½é€‰å‹è¿™å‡ ä¸ªæ–¹é¢å»å…¨é¢åˆ†æã€å¦¥åï¼Œè¾¾åˆ°ä¸€ä¸ªç»¼åˆæ•ˆæœæœ€å¥½çš„ç›®çš„ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><p>ã€Šæ“ä½œç³»ç»Ÿæ¦‚å¿µã€‹</p>
</li>
<li><p>ã€Šè®¡ç®—æœºç½‘ç»œâ€”â€”è‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹</p>
</li>
<li><p><a href="https://zh.wikipedia.org/wiki/%E7%BC%93%E5%AD%98" target="_blank" rel="noopener">ç¼“å­˜</a></p>
</li>
<li><p><a href="https://tech.meituan.com/2017/03/17/cache-about.html" target="_blank" rel="noopener">ç¼“å­˜é‚£äº›äº‹</a></p>
</li>
<li><p><a href="https://developer.aliyun.com/article/248256" target="_blank" rel="noopener">å¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>è®¡ç®—æœºåŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title>ESæ•°æ®è¿ç§»ç­–ç•¥ï¼ˆESç³»åˆ—äºŒï¼‰</title>
    <url>/2020/07/22/ES%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E7%AD%96%E7%95%A5%EF%BC%88ES%E7%B3%BB%E5%88%97%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://juejin.im/post/5f06eb2be51d453480767b88" target="_blank" rel="noopener">åˆè¯†ES</a>ä¸­æˆ‘ä»¬ä»‹ç»äº†ESä¼˜åŠ¿ã€ä½¿ç”¨åœºæ™¯ä»¥åŠç›¸å…³çš„æ ¸å¿ƒæ¦‚å¿µã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ç»§ç»­æ¢è®¨å¦‚ä½•å°†æ•°æ®ä»Mysqlè¿ç§»åˆ°ESä¸­ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼ŒLogstashå’ŒESçš„ç‰ˆæœ¬å‡ä¸º7.3</p>
<h2 id="ä¸€ã€å…¨é‡æ•°æ®è¿ç§»"><a href="#ä¸€ã€å…¨é‡æ•°æ®è¿ç§»" class="headerlink" title="ä¸€ã€å…¨é‡æ•°æ®è¿ç§»"></a>ä¸€ã€å…¨é‡æ•°æ®è¿ç§»</h2><p>åœ¨å°†ä¸šåŠ¡è¿ç§»åˆ°ESçš„è¿‡ç¨‹ä¸­é¦–å…ˆå°±éœ€è¦å°†æ•°æ®å…¨é‡è¿ç§»åˆ°ESä¸­ï¼Œè¿™æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œåœ¨è°ƒç ”çš„è¿‡ç¨‹ä¸­ä¸»è¦è€ƒè™‘äº†å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆã€‚</p>
<h3 id="1ã€go-mysql-elasticsearch"><a href="#1ã€go-mysql-elasticsearch" class="headerlink" title="1ã€go-mysql-elasticsearch"></a>1ã€go-mysql-elasticsearch</h3><p>go-mysql-elasticsearch is a service syncing your MySQL data into Elasticsearch automatically. It uses mysqldump to fetch the origin data at first, then syncs data incrementally with binlog.</p>
<p>go-mysql-elasticsearchæ˜¯ä¸€ä¸ªå¼€æºçš„Mysql -&gt; ESçš„åŒæ­¥å·¥å…·ï¼Œä½¿ç”¨mysqldumpçš„æ–¹å¼å°†æ•°æ®æ‹‰ä¸‹æ¥ï¼Œç„¶ååŒæ­¥å¢åŠ åˆ°binlogä¸­æ¥å®ç°æ•°æ®åŒæ­¥ï¼Œä½†æ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼çš„é™åˆ¶å¾ˆå¤šï¼Œè€Œä¸”åŸºæœ¬ä¸æ€ä¹ˆç»´æŠ¤ï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹æ¡ˆã€‚</p>
<h3 id="2ã€ES-BulkRequest"><a href="#2ã€ES-BulkRequest" class="headerlink" title="2ã€ES BulkRequest"></a>2ã€ES BulkRequest</h3><p>ESç»™æˆ‘ä»¬æä¾›äº†æ‰¹é‡æ’å…¥çš„APIï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åœ¨Mysqlä¸­åˆ†é¡µæŸ¥è¯¢ï¼Œç„¶åæ‰¹é‡æ’å…¥åˆ°ESä¸­ï¼Œç±»ä¼¼ä¸‹è¾¹çš„ä»£ç å¯ä»¥å®ç°è¿™æ ·çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BulkRequest bulkRequest = <span class="keyword">new</span> BulkRequest(<span class="string">"your index name"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Order item : orderList )&#123;</span><br><span class="line">            Map&lt;String, Object&gt; itemMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">            itemMap.put(id, item.getId());</span><br><span class="line">            itemMap.put(orderCode, item.getOrderCode());</span><br><span class="line">            itemMap.put(orderName, item.getOrderName());</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> IndexRequest(<span class="string">"your index name"</span>).id(item.getId().toString()).source(itemMap));</span><br><span class="line">        &#125;</span><br><span class="line">        BulkResponse bulkResponse;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bulkResponse = remoteHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">"Insert batch execution failed: &#123;&#125;"</span>, e.getMessage(), e);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥å®ç°å…¨é‡åŒæ­¥çš„ï¼Œä½†æ˜¯é—®é¢˜æ˜¯<strong>æ‰§è¡Œæ‰¹é‡æ’å…¥çš„é€Ÿåº¦å¤ªæ…¢</strong>ï¼Œè‹¥æˆ‘ä»¬çš„æ•°æ®è¾¾åˆ°ä¸Šåƒä¸‡çº§ï¼ŒåŒæ­¥çš„æ—¶é—´å°†ä¼šéå¸¸æ¼«é•¿ã€‚</p>
<h3 id="3ã€é˜¿é‡Œäº‘DTS"><a href="#3ã€é˜¿é‡Œäº‘DTS" class="headerlink" title="3ã€é˜¿é‡Œäº‘DTS"></a>3ã€é˜¿é‡Œäº‘DTS</h3><p>è‹¥æ˜¯ç”Ÿäº§ç¯å¢ƒå‡è´­ä¹°é˜¿é‡Œäº‘çš„ELKæœåŠ¡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨DTSæœåŠ¡æ¥å®ç°Mysqlå’ŒESçš„æ•°æ®åŒæ­¥ï¼ŒDTSçš„å…¨é‡åŒæ­¥åŸç†æ¶æ„å›¾å¦‚ä¸‹ï¼š<br><img src="https://res.cloudinary.com/leon824/image/upload/v1595426140/es4_lqfyib.png" alt><br>æ³¨ï¼šå›¾ç‰‡æ¥è‡ª<a href="https://help.aliyun.com/document_detail/26598.html?spm=a2c4g.11186623.6.550.79f51797WZSaOm" target="_blank" rel="noopener">é˜¿é‡Œäº‘å®˜æ–¹</a></p>
<p><strong>DTSå®ç°äº†åœ¨å…¨é‡åŒæ­¥çš„æ—¶å€™å¯ä»¥ä¸åœæœ</strong>ï¼Œåœ¨å…¨é‡æ•°æ®è¿ç§»ä¹‹å‰ä¼šå¯åŠ¨å¢é‡æ•°æ®æ‹‰å–æ¨¡å—ï¼Œå¢é‡æ•°æ®æ‹‰å–æ¨¡å—ä¼šæ‹‰å–æºå®ä¾‹çš„å¢é‡æ›´æ–°æ•°æ®ï¼Œå¹¶è§£æã€å°è£…ã€å­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨ä¸­ã€‚å½“å…¨é‡æ•°æ®è¿ç§»å®Œæˆåï¼ŒDTSä¼šå¯åŠ¨å¢é‡æ—¥å¿—å›æ”¾æ¨¡å—ï¼Œå¢é‡æ—¥å¿—å›æ”¾æ¨¡å—ä¼šä»å¢é‡æ—¥å¿—è¯»å–æ¨¡å—ä¸­è·å–å¢é‡æ•°æ®ï¼Œç»è¿‡åè§£æã€è¿‡æ»¤ã€å°è£…åè¿ç§»åˆ°ç›®æ ‡å®ä¾‹ï¼Œä»è€Œå®ç°å¢é‡æ•°æ®è¿ç§»ã€‚</p>
<p>ä½†æ˜¯DTSæˆªæ­¢ç›®å‰å¯¹äºESçš„æ”¯æŒä»…é™åœ¨&lt;=6.7ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<code>ES7.3</code>ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä¹Ÿæš‚æ—¶ä¸è€ƒè™‘ã€‚</p>
<h3 id="4ã€Logstash"><a href="#4ã€Logstash" class="headerlink" title="4ã€Logstash"></a>4ã€Logstash</h3><p>æ’é™¤äº†ä¸Šè¾¹ä¸‰ç§æ–¹æ¡ˆä¹‹åï¼Œçœ‹ä¼¼åªå‰©ä¸‹logstashèƒ½æ»¡è¶³æˆ‘ä»¬ç›®å‰çš„éœ€æ±‚äº†ã€‚Logstashæ˜¯ELKæŠ€æœ¯æ ˆçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒLogstashæ˜¯å¼€æºçš„ã€æ‹¥æœ‰å®æ—¶ç®¡é“å¤„ç†èƒ½åŠ›çš„æ•°æ®æ”¶é›†å¼•æ“ã€‚inputæ¨¡å—æ”¯æŒå¤šç§è¾“å…¥æºï¼ˆkafkaã€mysqlã€filebeatç­‰ç­‰ï¼‰ï¼Œfilteræ¨¡å—æ”¯æŒæ­£åˆ™ã€rubyç­‰ç­‰å·¥å…·æ¥å®ç°å¼ºå¤§çš„æ•°æ®è¿‡æ»¤ï¼Œæ•°æ®ç±»å‹è½¬æ¢ç­‰ç­‰åŠŸèƒ½ï¼Œæœ€ç»ˆå°†ç®¡é“å¤„ç†å®Œæˆçš„æ•°æ®ç”¨outputæ¨¡å—è¾“å‡ºåˆ°æŒ‡å®šçš„ç›®çš„åœ°ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<a href="https://www.elastic.co/guide/en/logstash/7.4/plugins-inputs-jdbc.html" target="_blank" rel="noopener">Jdbc input plugin</a>æ¥å®ç°å¯¹Mysqlçš„æŸ¥è¯¢ã€ESä½œä¸ºæœ€ç»ˆçš„è¾“å‡ºç›®çš„åœ°æ¥å®ç°å…¨é‡æ•°æ®çš„è¿ç§»ï¼Œå…ˆæ¥çœ‹Logstashå®˜æ–¹å¯¹å®ƒçš„æè¿°ï¼š</p>
<p>â€œDescription This plugin was created as a way to ingest data in any database with a JDBC interface into Logstash. You can periodically schedule ingestion using a cron syntax (see schedule setting) or run the query one time to load data into Logstash. Each row in the resultset becomes a single event. Columns in the resultset are converted into fields in the event.â€</p>
<p>å¤§æ„å°±æ˜¯è¿™ä¸ªæ’ä»¶ä¼šåˆ›å»ºä¸€ç§æ–¹å¼ï¼Œç”¨jdbcæ¥å£ä»ä»»ä½•æ•°æ®åº“ä¸­æ‹‰å–æ•°æ®åˆ°logstashï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>cron</code>çš„æ–¹å¼å®šæœŸæ‹‰å–æ•°æ®ï¼Œæˆ–æ‰§è¡Œä¸€æ¬¡æŸ¥è¯¢å°†æ•°æ®åŠ è½½åˆ°Logstashã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªLogstashçš„ç®¡é“é…ç½®ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  jdbc &#123;</span><br><span class="line">    jdbc_driver_library =&gt; <span class="string">"/opt/soft/mysql-connector-java-5.1.45.jar"</span> </span><br><span class="line">    jdbc_driver_class =&gt; <span class="string">"com.mysql.jdbc.Driver"</span></span><br><span class="line">    jdbc_connection_string =&gt; <span class="string">"jdbc:mysql://localhost:3306/database_name"</span></span><br><span class="line">    jdbc_user =&gt; <span class="string">"root"</span></span><br><span class="line">    jdbc_password =&gt; <span class="string">"**************"</span></span><br><span class="line">    jdbc_paging_enabled =&gt; <span class="literal">true</span></span><br><span class="line">    jdbc_page_size =&gt; <span class="number">10000</span></span><br><span class="line">    clean_run =&gt; <span class="literal">true</span></span><br><span class="line">    last_run_metadata_path =&gt; <span class="string">"/opt/soft/elk7.3/logstash/.log_last_run"</span></span><br><span class="line">   statement =&gt; <span class="string">"select id, order_code as orderCode, order_name as orderName, create_time as createTime, update_time as updateTime from es_order"</span></span><br><span class="line">    schedule =&gt; <span class="string">"* * * * *"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    copy =&gt; &#123; <span class="string">"id"</span> =&gt; <span class="string">"[@metadata][_id]"</span>&#125;</span><br><span class="line">    remove_field =&gt; [<span class="string">"@version"</span>, <span class="string">"_score"</span>, <span class="string">"_type"</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    user =&gt; admin </span><br><span class="line">    password =&gt; <span class="string">"********"</span> </span><br><span class="line">    index =&gt; <span class="string">"es_order_index"</span></span><br><span class="line">    document_id =&gt; <span class="string">"%&#123;[@metadata][_id]&#125;"</span></span><br><span class="line">    hosts =&gt; [<span class="string">"http://localhost:9200"</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  stdout&#123;</span><br><span class="line">  codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šè¾¹çš„ç®¡é“é…ç½®ä¸­ï¼Œæœ‰ä¸‹é¢å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š</p>
<h4 id="inputæ¨¡å—"><a href="#inputæ¨¡å—" class="headerlink" title="inputæ¨¡å—"></a>inputæ¨¡å—</h4><ul>
<li><strong>jdbc_driver_library</strong>ï¼šæŒ‡å®šçš„Mysqlé©±åŠ¨ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯è‹¥ç‰ˆæœ¬é‡‡ç”¨8.0ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°<strong>è¿ç§»å…¨é‡æ•°æ®é—æ¼çš„é—®é¢˜</strong>ï¼Œå¯¼è‡´æ€»ä¼šæœ‰ä¸€éƒ¨åˆ†æ•°æ®åŒæ­¥å¤±è´¥ï¼Œå®šä½è¿ç§»å¤±è´¥åŸå› éå¸¸éº»çƒ¦ã€‚</li>
<li><strong>jdbc_paging_enabled</strong>ï¼šæŒ‡å®šå¼€å¯æŸ¥è¯¢åˆ†é¡µ</li>
<li><strong>jdbc_page_size</strong>ï¼šæŒ‡å®šæ¯æ¬¡åˆ†é¡µæŸ¥è¯¢çš„å¤§å°</li>
<li><strong>statement</strong>ï¼šæˆ‘ä»¬æŒ‡å®šæŸ¥è¯¢è¯­å¥ï¼ŒLogstashå°†æ ¹æ®è¿™é‡Œçš„Sqlå‘èµ·æŸ¥è¯¢ï¼Œè‹¥sqlè¾ƒä¸ºå¤æ‚å¯ä»¥ä½¿ç”¨<code>statement_filepath</code>å‚æ•°æŒ‡å®šSqlæ–‡ä»¶çš„ç›®å½•ã€‚</li>
<li><strong>schedule</strong>ï¼šé€šè¿‡è®¾ç½®Cronï¼ŒLogstashå‘¨æœŸæ€§çš„æ‰§è¡Œä»»åŠ¡ï¼Œæ­¤å‚æ•°æ²¡æœ‰é»˜è®¤å€¼ï¼Œæ— æ²¡æœ‰é…ç½®ï¼Œåˆ™åªæ‰§è¡Œä¸€æ¬¡ï¼›è¿™é‡Œé…ç½®çš„<code>&quot;* * * * *&quot;</code>ï¼Œä»£è¡¨ç€æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚</li>
</ul>
<h4 id="filteræ¨¡å—"><a href="#filteræ¨¡å—" class="headerlink" title="filteræ¨¡å—"></a>filteræ¨¡å—</h4><p>è¿™é‡Œçš„è¿‡æ»¤æ¨¡å—è¾ƒä¸ºç®€å•ï¼Œå› ä¸ºMysqlä¸­çš„æ•°æ®éƒ½æ˜¯å·²ç»ç»“æ„åŒ–çš„ã€‚</p>
<ul>
<li><strong>copy</strong>ï¼šåœ¨ESä¸­æ¯ä¸€ä¸ªæ–‡æ¡£ï¼ˆæ¦‚å¿µåœ¨ä¸Šä¸€ç¯‡å·²ç»è®²è¿‡äº†ï¼‰ï¼Œæ˜¯ç”±<code>index</code>ã€<code>_type</code>ã€<code>_id</code>ä¸‰ä¸ªå‚æ•°å…±åŒæ ‡è¯†çš„ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªæ–‡æ¡£å¿…é¡»æ‹¥æœ‰ä¸€ä¸ª_idä½œä¸º<code>metadata</code>ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬<strong>ä½¿ç”¨<code>Mysql</code>çš„ä¸»é”®å¤åˆ¶åˆ°ESä¸­çš„_idå­—æ®µ</strong>ï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨ä½¿ç”¨åè¾¹çš„å¢åˆ æ”¹æŸ¥ã€‚å¦åˆ™ï¼Œåˆ™ESä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªBase64çš„å­—ç¬¦ä¸²èµ‹å€¼ç»™<code>_id</code>ã€‚</li>
<li><strong>remove_field</strong>ï¼šè¿™é‡Œå¯ä»¥æŒ‡å®šæˆ‘ä»¬è¦åˆ é™¤çš„çš„å­—æ®µ</li>
</ul>
<h4 id="outputæ¨¡å—"><a href="#outputæ¨¡å—" class="headerlink" title="outputæ¨¡å—"></a>outputæ¨¡å—</h4><ul>
<li><strong>document_id =&gt; â€œ%{[@metadata][_id]}</strong>â€œï¼šè¿™ä¸€è¡Œå³æ˜¯å°†æˆ‘ä»¬åœ¨filteræ¨¡å—ä¸­å¤åˆ¶ä¸»é”®idçš„å€¼æå–å‡ºæ¥è®¾ç½®åˆ°document_idä¸­ã€‚</li>
<li><strong>codec =&gt; rubydebug</strong>ï¼šåœ¨æµ‹è¯•é˜¶æ®µï¼Œæˆ‘ä»¬å°†Logstashçš„æ‰§è¡Œæ—¥å¿—æ‰“å°å‡ºæ¥ã€‚</li>
</ul>
<p>åœ¨é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨çš„æ—¶å€™é€šè¿‡æŒ‡å®šåˆšåˆšåˆ›å»ºçš„ç®¡é“æ¥å®ç°å…¨é‡è¿ç§»ã€‚ç»è¿‡æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒçš„æµ‹è¯•ï¼Œè¿ç§»äº”ç™¾ä¸‡æ•°æ®å¤§æ¦‚åœ¨äºŒååˆ†é’Ÿå·¦å³ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§æ•°æ®è¿ç§»çš„è¿‡ç¨‹ä¸­ä½¿ç”¨è¿™ç§æ–¹å¼éœ€è¦å°†è¿ç§»è¡¨å†™å…¥ã€ä¿®æ”¹æ“ä½œåœæ­¢ã€‚ä¸ºäº†é¿å…åœæ­¢æ•´ä¸ªæœåŠ¡ï¼Œå¯ä»¥åœ¨é…ç½®ä¸­å¿ƒé…ç½®å¼€å…³æ¥æ§åˆ¶æ•°æ®çš„å†™å…¥ï¼Œè¿ç§»å®Œæˆä¹‹åæ‰“å¼€ï¼Œä»¥å‡å°å¯¹ä¸šåŠ¡çš„å½±å“ã€‚</p>
<h2 id="äºŒã€å¢é‡æ•°æ®åŒæ­¥"><a href="#äºŒã€å¢é‡æ•°æ®åŒæ­¥" class="headerlink" title="äºŒã€å¢é‡æ•°æ®åŒæ­¥"></a>äºŒã€å¢é‡æ•°æ®åŒæ­¥</h2><p>åœ¨ä¸Šä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ¢è®¨äº†å¦‚ä½•å¯¹æ•°æ®çš„å…¨é‡è¿ç§»ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ç€æ¢è®¨å¦‚ä½•å®ç°å¯¹å¢é‡æ•°æ®çš„åŒæ­¥ã€‚è¿™é‡Œå®è´¨ä¸Šå°±æ˜¯æƒ³å®ç°Mysql-ESçš„æ•°æ®ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬çŸ¥é“æ•°æ®ä¸€è‡´æ€§å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯å¼ºä¸€è‡´æ€§ï¼Œä¸€ç§æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<h3 id="1ã€å¼ºä¸€è‡´æ€§å®ç°"><a href="#1ã€å¼ºä¸€è‡´æ€§å®ç°" class="headerlink" title="1ã€å¼ºä¸€è‡´æ€§å®ç°"></a>1ã€å¼ºä¸€è‡´æ€§å®ç°</h3><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè‹¥è¦å®ç°å¼ºä¸€è‡´æ€§ï¼Œå¾€å¾€ä¼šç‰ºç‰²è¾ƒå¤šçš„æ€§èƒ½æ¥å®ç°ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨â€œ<strong>åŒæ­¥åŒå†™</strong>â€æ¥å®ç°äº‹åŠ¡ã€‚å½“æœ‰å†™å…¥è¯·æ±‚è¿›æ¥æ—¶ï¼Œæˆ‘ä»¬å…ˆå†™å…¥åˆ°ESä¸­ï¼ŒESå†™å…¥å¤±è´¥åˆ™æ­¤æ¬¡æ’å…¥å¤±è´¥ï¼Œæˆ–è€…é‡æ–°å‘èµ·è¯·æ±‚å†™å…¥ï¼›å¾…ESå†™å…¥æˆåŠŸä¹‹åï¼Œå†å†™Mysqlï¼ŒæˆåŠŸåˆ™äº‹åŠ¡å®Œæˆï¼Œåä¹‹éœ€è¦å›æ»šESå·²ç»å†™å…¥çš„å†…å®¹ï¼Œå¦åˆ™åŒæ–¹æ•°æ®å°†å‡ºç°ä¸ä¸€è‡´ã€‚<br>ä»ä¸Šè¾¹çš„æµç¨‹æ¥çœ‹ï¼Œå¯èƒ½æ¶‰åŠåˆ°çš„è¿œç¨‹è°ƒç”¨è¾ƒå¤šã€ç½‘ç»œIOå°†æ‹–æ…¢æ¥å£çš„å“åº”é€Ÿåº¦ï¼Œä½¿å¾—ç³»ç»Ÿååé‡é™ä½â€¦æ‰€ä»¥æƒ³å®ç°å¼ºä¸€è‡´æ€§æˆæœ¬æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹å®ç°æœ€ç»ˆä¸€è‡´æ€§çš„æ–¹æ¡ˆã€‚</p>
<h3 id="2ã€æœ€ç»ˆä¸€è‡´æ€§"><a href="#2ã€æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="2ã€æœ€ç»ˆä¸€è‡´æ€§"></a>2ã€æœ€ç»ˆä¸€è‡´æ€§</h3><p>å®ç°æœ€ç»ˆä¸€è‡´æ€§çš„æ–¹æ¡ˆä¹‹é—´ä¹Ÿæœ‰è¾ƒå¤§çš„åŒºåˆ†ã€‚ä¸‹è¾¹ä¸»è¦ä»‹ç»ä¸¤ç§æ–¹å¼æ¥å®ç°ï¼šå¼‚æ­¥MQåŒæ­¥ã€å‚¨å­˜å±‚é¢å®ç°æœ€ç»ˆä¸€è‡´æ€§</p>
<h4 id="aã€å¼‚æ­¥MQåŒæ­¥"><a href="#aã€å¼‚æ­¥MQåŒæ­¥" class="headerlink" title="aã€å¼‚æ­¥MQåŒæ­¥"></a>aã€å¼‚æ­¥MQåŒæ­¥</h4><p>æ–¹æ¡ˆæè¿°ï¼šå‡è®¾ä¸šåŠ¡å…¥å£åœ¨å¾®æœåŠ¡Aä¸­ï¼Œå¯¹ESçš„å°è£…åœ¨å¾®æœåŠ¡Bä¸­ï¼Œå¦‚ä¸‹å›¾:</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1595492799/es-3_gnvfgz.png" alt></p>
<ul>
<li>1ã€ä¸šåŠ¡è¯·æ±‚åˆ°AæœåŠ¡ä¸­ï¼Œè‹¥æœ‰å¯¹æ•°æ®çš„å†™ï¼Œå…ˆå†™å…¥åˆ°Mysqlä¸­ï¼Œç„¶åå°†å†™çš„<strong>åŠ¨ä½œå’Œdata</strong>æ‰”åˆ°MQã€‚</li>
<li>2ã€BæœåŠ¡ç›‘å¬å¯¹åº”çš„<code>Topic</code>ï¼Œæ ¹æ®â€œ<strong>ç›¸åº”çš„åŠ¨ä½œ</strong>â€å¯¹ESå‘èµ·å†™è¯·æ±‚</li>
<li>3ã€è‹¥å†™å…¥å¤±è´¥ï¼ŒBæœåŠ¡å°†å‘èµ·é‡è¯•æ¶ˆè´¹ï¼ˆå¯è®¾ç½®é‡è¯•<em>ä¸Šé™æ¬¡æ•°</em>ï¼‰ï¼Œç›´åˆ°æˆåŠŸã€‚</li>
<li>4ã€è‹¥é‡è¯•æ¬¡æ•°è¶…è¿‡ä¸Šé™ï¼Œåˆ™å‘èµ·æŠ¥è­¦ï¼Œæˆ‘ä»¬å¯ä»¥è§¦å‘ä¸šåŠ¡è¡¥å¿æ¥å®ç°æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ã€‚</li>
</ul>
<p>ä¸Šè¿°çš„æ–¹æ¡ˆé€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æ•°æ®ä¸€è‡´æ€§çš„å‹åŠ›ä»AæœåŠ¡è½¬ç§»ç»™BæœåŠ¡ï¼Œä»è€Œæœ€å¤§ç¨‹åº¦é™ä½å¯¹AæœåŠ¡æ€§èƒ½çš„å½±å“ã€‚</p>
<h4 id="bã€å‚¨å­˜å±‚é¢å®ç°æœ€ç»ˆä¸€è‡´æ€§"><a href="#bã€å‚¨å­˜å±‚é¢å®ç°æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="bã€å‚¨å­˜å±‚é¢å®ç°æœ€ç»ˆä¸€è‡´æ€§"></a>bã€å‚¨å­˜å±‚é¢å®ç°æœ€ç»ˆä¸€è‡´æ€§</h4><p>åœ¨åˆ†å¸ƒå¼é¢†åŸŸï¼Œæ•°æ®ä¸€è‡´æ€§è‹¥æ˜¯èƒ½å¤Ÿåœ¨å­˜å‚¨å±‚é¢æ¥è§£å†³æ˜¯ç›¸å¯¹ç†æƒ³çš„æƒ…å†µï¼Œä¸šåŠ¡ä¸å‚ä¸æ•°æ®ä¸€è‡´æ€§çš„å·¥ä½œï¼Œå¯¹äºä¸šåŠ¡æ–¹æ¥è¯´è¯»Mysqlå’ŒESæ°¸è¿œéƒ½èƒ½æ‹¿åˆ°ä¸€æ ·çš„ç»“æœï¼Œå½“ç„¶è¿™æ˜¯ä¸€ç§ç†æƒ³çŠ¶æ€ã€‚<br>ç°å®ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Logstashæ¥å®ç°æ•°æ®çš„åŒæ­¥ï¼Œä»è€Œæ•°æ®ä¸€è‡´æ€§å¯¹äºä¸šåŠ¡æ¥è¯´æ˜¯é€æ˜çš„ï¼Œä½†æ˜¯ç”±äºèµ„æºçš„é™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•åšåˆ°<strong>å®Œå…¨Real-time</strong>ã€‚</p>
<h4 id="cã€Logstashå¢é‡åŒæ­¥"><a href="#cã€Logstashå¢é‡åŒæ­¥" class="headerlink" title="cã€Logstashå¢é‡åŒæ­¥"></a>cã€Logstashå¢é‡åŒæ­¥</h4><p>åœ¨å‰è¾¹å…¨é‡æ•°æ®è¿ç§»çš„éƒ¨åˆ†æˆ‘ä»¬å·²ç»ä½¿ç”¨Logstashæ¥å®ç°äº†ï¼Œåœ¨å¢é‡åŒæ­¥åŒæ ·å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œæ¥æ¥çœ‹å¢é‡åŒæ­¥çš„ç®¡é“è„šæœ¬ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  jdbc &#123;</span><br><span class="line">    jdbc_driver_library =&gt; <span class="string">"/opt/soft/mysql-connector-java-5.1.47.jar"</span></span><br><span class="line">    jdbc_driver_class =&gt; <span class="string">"com.mysql.jdbc.Driver"</span></span><br><span class="line">    jdbc_connection_string =&gt; <span class="string">"jdbc:mysql://localhost:3306/database_name"</span></span><br><span class="line">    jdbc_user =&gt; <span class="string">"root"</span></span><br><span class="line">    jdbc_password =&gt; <span class="string">"********"</span></span><br><span class="line">    tracking_column =&gt; <span class="string">"unix_ts_in_secs"</span></span><br><span class="line">    use_column_value =&gt; <span class="literal">true</span></span><br><span class="line">    tracking_column_type =&gt; <span class="string">"numeric"</span></span><br><span class="line">    clean_run =&gt; <span class="literal">true</span></span><br><span class="line">    statement =&gt; <span class="string">"id, order_code as orderCode, order_name as orderName, create_time as createTime, update_time as updateTime, UNIX_TIMESTAMP(update_time) AS unix_ts_in_secs FROM es_order WHERE (UNIX_TIMESTAMP(update_time) &gt; :sql_last_value AND update_time &lt; NOW()) ORDER BY update_time ASC"</span></span><br><span class="line">    schedule =&gt; <span class="string">"*/30 * * * * *"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    copy =&gt; &#123;<span class="string">"id"</span> =&gt; <span class="string">"[@metadata][_id]"</span>&#125;</span><br><span class="line">    remove_field =&gt; [<span class="string">"@version"</span>, <span class="string">"unix_ts_in_secs"</span>, <span class="string">"myid"</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    index =&gt; <span class="string">"es_order_index"</span></span><br><span class="line">    document_id =&gt; <span class="string">"%&#123;[@metadata][_id]&#125;"</span></span><br><span class="line">    user =&gt; admin</span><br><span class="line">    password =&gt; <span class="string">"**********"</span></span><br><span class="line">    hosts =&gt; [<span class="string">"http://localhost:9200"</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šä¸€éƒ¨åˆ†æˆ‘ä»¬å·²ç»åˆ†æäº†ä¸€éƒ¨åˆ†å‚æ•°çš„å«ä¹‰ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ç€çœ‹æ–°å‡ºç°çš„å±æ€§å€¼</p>
<ul>
<li><p><strong>tracking_column</strong>ï¼šç”¨äºè·Ÿè¸ªLogstashä»MySQLè¯»å–çš„æœ€åä¸€ä¸ªæ–‡æ¡£ï¼Œä¸‹é¢ä¼šè¿›è¡Œæè¿°ï¼‰ï¼Œå®ƒå­˜å‚¨åœ¨.logstash_jdbc_last_runä¸­çš„ç£ç›˜ä¸Šã€‚è¯¥å€¼å°†ä¼šç”¨æ¥ç¡®å®šLogstashåœ¨å…¶è½®è¯¢å¾ªç¯çš„ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­æ‰€è¯·æ±‚æ–‡æ¡£çš„èµ·å§‹å€¼ã€‚</p>
</li>
<li><p><strong>unix_ts_in_secsï¼š<code>unix_ts_in_secs</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç”±ä¸Šè¿° SELECT è¯­å¥ç”Ÿæˆçš„å­—æ®µï¼ŒåŒ…å«å¯ä½œä¸ºæ ‡å‡†<code>Unix</code>æ—¶é—´æˆ³ï¼ˆè‡ªEpochèµ·ç§’æ•°ï¼‰çš„ â€œmodification_timeâ€ã€‚æˆ‘ä»¬åˆšè®¨è®ºçš„ â€œtracking columnâ€ ä¼šå¼•ç”¨è¯¥å­—æ®µã€‚Unix æ—¶é—´æˆ³ç”¨äºè·Ÿè¸ªè¿›åº¦ï¼Œè€Œéä½œä¸ºç®€å•çš„æ—¶é—´æˆ³ï¼›å¦‚å°†å…¶ä½œä¸ºç®€å•æ—¶é—´æˆ³ï¼Œå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ï¼Œå› ä¸ºåœ¨UMTså’Œæœ¬åœ°æ—¶åŒºä¹‹é—´æ­£ç¡®åœ°æ¥å›è½¬æ¢æ˜¯ä¸€ä¸ªååˆ†å¤æ‚çš„è¿‡ç¨‹ã€‚</p>
</li>
<li><strong>sql_last_value</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå†…ç½®å‚æ•°ï¼ŒåŒ…æ‹¬Logstashè½®è¯¢å¾ªç¯ä¸­å½“å‰è¿­ä»£çš„èµ·å§‹ç‚¹ï¼Œä¸Šé¢ JDBC è¾“å…¥é…ç½®ä¸­çš„ SELECT è¯­å¥ä¾¿ä¼šå¼•ç”¨è¿™ä¸€å‚æ•°ã€‚è¯¥å­—æ®µä¼šè®¾ç½®ä¸ºâ€œunix_ts_in_secsâ€ï¼ˆè¯»å–è‡ª .logstash_jdbc_last_runï¼‰çš„æœ€æ–°å€¼ã€‚åœ¨<code>Logstash</code>è½®è¯¢å¾ªç¯å†…æ‰€æ‰§è¡Œçš„<code>MySQL</code>æŸ¥è¯¢ä¸­ï¼Œå…¶ä¼šç”¨ä½œæ‰€è¿”å›æ–‡æ¡£çš„èµ·ç‚¹ã€‚é€šè¿‡åœ¨æŸ¥è¯¢ä¸­åŠ å…¥è¿™ä¸€å˜é‡ï¼Œèƒ½å¤Ÿç¡®ä¿ä¸ä¼šå°†ä¹‹å‰ä¼ æ’­åˆ°<code>Elasticsearch</code>çš„æ’å…¥æˆ–æ›´æ–°å†…å®¹é‡æ–°å‘é€åˆ°<code>Elasticsearch</code>ã€‚</li>
<li><strong>modification_time &lt; NOW()</strong>ï¼šæŸ¥è¯¢è¯­å¥ä¸­çš„è¿™ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªè¾ƒéš¾è§£é‡Šçš„æ¦‚å¿µã€‚</li>
</ul>
<p>æ³¨ï¼šå¼•ç”¨è‡ª<a href="https://www.elastic.co/cn/blog/how-to-keep-elasticsearch-synchronized-with-a-relational-database-using-logstash" target="_blank" rel="noopener">è¿™é‡Œ</a> </p>
<p>å¯¹äºSQLè¯­å¥çš„æ­£ç¡®æ€§åˆ†æï¼Œåœ¨ä¸Šè¾¹å¼•ç”¨çš„æ–‡ç« å·²ç»æœ‰æ¯”è¾ƒè¯¦ç»†çš„æè¿°ï¼Œè¿™é‡Œä¸å†é‡è¿°ã€‚</p>
<p>è¿™ç§æ–¹æ¡ˆçš„é—®é¢˜åœ¨äºâ€”â€”<strong>ç‰¹åˆ«åƒèµ„æº</strong>ï¼Œç‰¹åˆ«æ˜¯å¦‚æœ<code>schedule</code>è®¾ç½®çš„å®šæ—¶æ‰§è¡Œæ—¶é—´é—´éš”å¤ªçŸ­å¹¶ä¸”æœ‰å¤šä¸ªè¡¨éœ€è¦åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œç”±äºè¿™ç§Sqlå±äº<strong>èŒƒå›´åŒºé—´æŸ¥è¯¢åŒæ—¶å¸¦æœ‰æ’åºï¼Œæ— æ³•è®©æŸ¥è¯¢èµ°ç´¢å¼•</strong>ï¼Œæ‰€ä»¥Mysqlå°†ä¼šæ‰¿å—å¾ˆå¤§çš„å‹åŠ›ã€‚æ‰€ä»¥å¤§å®¶åœ¨é€‰æ‹©è¿™ç§æ–¹æ¡ˆçš„æ—¶å€™å¿…é¡»å¿ƒä¸­æœ‰æ•°ï¼Œè™½ç„¶è§£æ”¾äº†åº”ç”¨å±‚ï¼Œä½†æ˜¯æ•°æ®å­˜å‚¨å±‚å°†ä¼šæ‰¿å—è¾ƒå¤§çš„å‹åŠ›ã€‚</p>
<h4 id="dã€Binlogå¢é‡åŒæ­¥"><a href="#dã€Binlogå¢é‡åŒæ­¥" class="headerlink" title="dã€Binlogå¢é‡åŒæ­¥"></a>dã€Binlogå¢é‡åŒæ­¥</h4><p>è¿™ç§ç±»å‹çš„æ–¹æ¡ˆæ›´åŠ é€‚åˆæ•°æ®çš„å¢é‡åŒæ­¥ï¼Œå®ƒåŒæ—¶èƒ½å¤Ÿé¿å…ä¸Šè¿°ä¸¤ç§æ–¹æ¡ˆçš„é—®é¢˜ï¼š1ã€ä¸šåŠ¡å‚ä¸è§£å†³æ•°æ•°æ®ä¸€è‡´æ€§ï¼Œ2ã€å¯¹å­˜å‚¨æºå‹åŠ›è¿‡å¤§ã€‚</p>
<h5 id="Canal"><a href="#Canal" class="headerlink" title="Canal"></a>Canal</h5><p>canalæ˜¯é˜¿é‡Œå¼€æºçš„ç»„ä»¶ï¼Œå®ƒæ˜¯åŸºäºMySQLæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…å’Œæ¶ˆè´¹ï¼Œæ¶ˆè´¹ç«¯å…¶ä¸­å°±åŒ…æ‹¬ESã€‚å¦‚ä¸‹å›¾</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1595574185/es-7_t20xku.png" alt></p>
<p>è¿™ç§æ–¹æ¡ˆæš‚æ—¶è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªå·±å°è¯•åœ°å€åœ¨è¿™å„¿<a href="https://github.com/alibaba/canal/wiki" target="_blank" rel="noopener">Home</a></p>
<h5 id="DTS"><a href="#DTS" class="headerlink" title="DTS"></a>DTS</h5><p>åœ¨ä¸Šè¾¹çš„å…¨é‡æ•°æ®è¿ç§»ä¹Ÿæåˆ°è¿‡è¿™ç§æ–¹æ¡ˆï¼Œå’ŒCanalä¸€æ ·éƒ½æ˜¯ä½¿ç”¨Binlogçš„æ–¹å¼æ¥å®ç°ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æˆ‘ä»¬å…ˆä»‹ç»äº†å…¨é‡æ•°æ®åŒæ­¥çš„æ–¹å¼ï¼ŒåŒ…æ‹¬ä½¿ç”¨go-mysql-elasticsearchã€ES BulkRequestã€é˜¿é‡Œäº‘DTSå’ŒLogstashçš„æ–¹å¼ï¼Œè¿™é‡Œ<strong>æœ€æ¨èçš„è¿˜æ˜¯Logstashæ¥å®ç°å…¨é‡åŒæ­¥</strong>ï¼Œå½“ç„¶æœ‰æ¡ä»¶çš„å¯ä»¥ä½¿ç”¨DTSæ¥å®ç°ã€‚</p>
<p>åè¾¹æˆ‘ä»¬æ¢è®¨å®ç°å¢é‡åŒæ­¥çš„é›†ä¸­æ–¹æ³•ï¼Œå¢é‡åŒæ­¥æˆ‘ä»¬åˆ†ä¸ºå¼ºä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼Œå¼ºä¸€è‡´æ€§å®ç°æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼›æˆ‘ä»¬ä¸»è¦åˆ†æäº†æœ€ç»ˆä¸€è‡´æ€§çš„å‡ ç§æ–¹å¼ï¼Œè‹¥æ˜¯æ•°æ®åº“èµ„æºè¾ƒä¸ºå……è£•ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Logstashæ¥å®ç°å¢é‡åŒæ­¥ï¼Œå¦åˆ™å¯ä»¥é‡‡ç”¨å¼‚æ­¥MQçš„æ–¹å¼æ¥å®ç°ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µæ¥é€‰æ‹©å¢é‡çš„åŒæ­¥æ–¹å¼ã€‚</p>
<p>ä¸‹ä¸€éƒ¨åˆ†æˆ‘ä»¬ç»§ç»­åˆ†äº«å¦‚ä½•ä½¿ç”¨<code>Java High Level REST Client</code>æ¥å®ç°å¯¹ESçš„æ“ä½œã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://help.aliyun.com/document_detail/26598.html?spm=a2c4g.11186623.6.550.79f51797WZSaOm" target="_blank" rel="noopener">äº§å“æ¶æ„åŠåŠŸèƒ½åŸç†</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html" target="_blank" rel="noopener">Elasticsearch Reference [7.8] Â» REST APIs Â» Document APIs Â» Bulk API</a></li>
<li><a href="https://www.elastic.co/cn/blog/how-to-keep-elasticsearch-synchronized-with-a-relational-database-using-logstash" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨ Logstash å’Œ JDBC ç¡®ä¿ Elasticsearch ä¸å…³ç³»å‹æ•°æ®åº“ä¿æŒåŒæ­¥</a></li>
</ul>
]]></content>
      <categories>
        <category>elasticsearch</category>
      </categories>
  </entry>
  <entry>
    <title>åˆè¯†ESï¼ˆESç³»åˆ—ä¸€ï¼‰</title>
    <url>/2020/07/22/ES%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote>
<p>â€œè¿™ä¸ªä¸–ç•Œå·²ç„¶è¢«æ•°æ®æ·¹æ²¡ã€‚å¤šå¹´æ¥ï¼Œæˆ‘ä»¬ç³»ç»Ÿé—´æµè½¬å’Œäº§ç”Ÿçš„å¤§é‡æ•°æ®å·²è®©æˆ‘ä»¬ä¸çŸ¥æ‰€æªã€‚ ç°æœ‰çš„æŠ€æœ¯éƒ½é›†ä¸­åœ¨å¦‚ä½•è§£å†³æ•°æ®ä»“åº“å­˜å‚¨ä»¥åŠå¦‚ä½•ç»“æ„åŒ–è¿™äº›æ•°æ®ã€‚ è¿™äº›çœ‹ä¸Šå»éƒ½æŒºç¾å¥½ï¼Œç›´åˆ°ä½ å®é™…éœ€è¦åŸºäºè¿™äº›æ•°æ®å®æ—¶åšå†³ç­–åˆ†æçš„æ—¶å€™æ‰å‘ç°æ ¹æœ¬ä¸æ˜¯é‚£ä¹ˆä¸€å›äº‹ã€‚Elasticsearchæ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼ã€å¯æ‰©å±•ã€å®æ—¶çš„æœç´¢ä¸æ•°æ®åˆ†æå¼•æ“</strong>ã€‚æ— è®ºä½ æ˜¯éœ€è¦<strong>å…¨æ–‡æœç´¢</strong>ï¼Œè¿˜æ˜¯<strong>ç»“æ„åŒ–æ•°æ®çš„å®æ—¶ç»Ÿè®¡</strong>ï¼Œæˆ–è€…ä¸¤è€…ç»“åˆï¼ŒElasticsearchä¸ä»…ä»…åªæ˜¯å…¨æ–‡æœç´¢ï¼Œæˆ‘ä»¬è¿˜å°†ä»‹ç»<strong>ç»“æ„åŒ–æœç´¢ã€æ•°æ®åˆ†æã€å¤æ‚çš„äººç±»è¯­è¨€å¤„ç†ã€åœ°ç†ä½ç½®å’Œå¯¹è±¡é—´å…³è”å…³ç³»</strong>ç­‰â€ã€‚<br>                    â€“ <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/cn/preface.html" target="_blank" rel="noopener">Elasticsearch: æƒå¨æŒ‡å— Â» å‰è¨€</a></p>
</blockquote>
<p>ä¸Šè¾¹ä¸€æ®µæ‘˜å½•è‡ª<code>Elasticsearch: æƒå¨æŒ‡å—</code>ï¼Œå‘Šè¯‰äº†æˆ‘ä»¬ESæ‹¥æœ‰çš„è¶…å¼ºèƒ½åŠ›ã€‚è¿™ä¸ªç³»åˆ—æ–‡ç« ä¸»è¦æ˜¯æ ¹æ®åœ¨å·¥ä½œä¸­çš„å®æˆ˜æ€»ç»“ï¼Œ<strong>æœ€ç»ˆç›®çš„æ˜¯æ¢è®¨ä¸€ä¸‹å¦‚ä½•æ ¹æ®ç°æœ‰çš„ä¸šåŠ¡éœ€æ±‚å¹³æ»‘çš„è¿ç§»åˆ°ESï¼ˆä½¿ç”¨javaæŠ€æœ¯æ ˆï¼‰ï¼Œå»å¼¥è¡¥å…³ç³»å‹æ•°æ®åº“çš„å±€é™æ€§ï¼Œæé«˜æˆ‘ä»¬çš„å¤„ç†æ•°æ®çš„èƒ½åŠ›ã€‚</strong></p>
<p>æœ¬ç³»åˆ—æš‚æ—¶è§„åˆ’ä¸ºå››ä¸ªéƒ¨åˆ†</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†ï¼šè°ˆè°ˆä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨ESï¼Œä»¥åŠç›¸å…³åŸºæœ¬æ¦‚å¿µ</li>
<li>ç¬¬äºŒéƒ¨åˆ†ï¼šæˆ‘ä»¬è®¨è®ºMysql -&gt; ESæ•°æ®çš„è¿ç§»ç­–ç•¥ã€æŠ€æœ¯é€‰å‹ï¼Œä»¥åŠåœ¨å„ç§åœºæ™¯ä¸‹é€‰æ‹©çš„åŒæ­¥ç­–ç•¥ã€‚</li>
<li>ç¬¬ä¸‰éƒ¨åˆ†ï¼š æˆ‘ä»¬å°†å®ç°spring bootä¸ESçš„é›†æˆï¼Œä»¥åŠä½¿ç”¨ESæä¾›çš„APIå»â€œ<strong>ç¿»è¯‘sql</strong>â€</li>
<li>ç¬¬å››éƒ¨åˆ†ï¼šæˆ‘ä»¬ä»¥å‰è¾¹çš„æŠ€æœ¯åŸºç¡€ï¼Œå»å°è¯•è§£å†³ä¸€ä¸ªç°å®ä¸­RDBMSå•è¡¨æ•°æ®é‡åƒä¸‡çº§ï¼ŒåŒæ—¶è¿˜æœ‰å¤šè¡¨joinçš„æƒ…å†µä¸‹å¦‚ä½•ä½¿ç”¨ESå»è§£å†³è¿™ä¸ªä»¤äººå¤´ç—›çš„éš¾é¢˜ã€‚</li>
</ul>
<hr>
<p>è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ESã€‚</p>
<h2 id="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦-Elasticsearch"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦-Elasticsearch" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Elasticsearch"></a>ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Elasticsearch</h2><h4 id="1ã€å¿«ï¼Œå°±æ˜¯å¿«"><a href="#1ã€å¿«ï¼Œå°±æ˜¯å¿«" class="headerlink" title="1ã€å¿«ï¼Œå°±æ˜¯å¿«"></a>1ã€å¿«ï¼Œå°±æ˜¯å¿«</h4><p>æˆ‘ä»¬ä½¿ç”¨ESæœ€ä¸»è¦çš„åŸå› å°±æ˜¯å› ä¸ºESé€Ÿåº¦å¿«ã€‚ç‰¹åˆ«æ˜¯å½“æ•°æ®é‡åˆ°è¾¾åƒä¸‡çº§ä»¥ä¸Šçš„æ—¶å€™ï¼Œå…³ç³»å‹æ•°æ®åº“å•è¡¨æ— è®ºæ˜¯é€šè¿‡å¢åŠ ç´¢å¼•ã€åˆ†åº“åˆ†è¡¨æ¥ä¼˜åŒ–ï¼Œæœ€ç»ˆèƒ½å¤Ÿä¼˜åŒ–çš„æ•ˆæœå¾€å¾€ä¸å¦‚äººæ„ï¼ˆä¸”åˆ†åº“åˆ†è¡¨å¤æ‚åº¦è¾ƒé«˜ï¼‰ï¼Œè€ŒESå¯ä»¥è½»æ¾holdä½åƒä¸‡ã€äº¿çº§æ•°æ®é‡ã€‚</p>
<p>ä¸ºäº†è¾¾åˆ°è¿™æ ·çš„é€Ÿåº¦ï¼ŒESä½¿ç”¨äº†<strong>æœ‰é™çŠ¶æ€è½¬æ¢å™¨</strong>å®ç°äº†ç”¨äºå…¨æ–‡æ£€ç´¢çš„<strong>å€’æ’ç´¢å¼•</strong>ï¼Œå®ç°äº†ç”¨äºå­˜å‚¨æ•°å€¼æ•°æ®å’Œåœ°ç†ä½ç½®æ•°æ®çš„<strong>BKDæ ‘</strong>ï¼Œä»¥åŠç”¨äºåˆ†æçš„åˆ—å­˜å‚¨ã€‚å¹¶ä¸”ç”±äºESé»˜è®¤å°±æ˜¯å°†æ‰€æœ‰çš„å­—æ®µå…¨éƒ¨å»ºç«‹ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™å¯ä»¥å®æ—¶åœ°æ£€ç´¢åˆ°æ•°æ®ã€‚</p>
<h4 id="2ã€ä¸åªæ˜¯å…¨æ–‡æ£€ç´¢"><a href="#2ã€ä¸åªæ˜¯å…¨æ–‡æ£€ç´¢" class="headerlink" title="2ã€ä¸åªæ˜¯å…¨æ–‡æ£€ç´¢"></a>2ã€ä¸åªæ˜¯å…¨æ–‡æ£€ç´¢</h4><p>è¿™ä¸€ç‚¹ä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨ESå¾ˆé‡è¦çš„åŸå› ï¼Œåœ¨ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬å¾ˆå¤šä½¿ç”¨éœ€è¦é‡‡ç”¨æ¨¡ç³ŠæŸ¥è¯¢çš„æ–¹å¼æ¥è·å–æƒ³è¦çš„æ•°æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> author <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'%é²è¿…%'</span>.</span><br></pre></td></tr></table></figure>
<p>åœ¨æ•°æ®é‡è¾ƒå¤§çš„æ—¶å€™ï¼Œå°±ç®—æˆ‘ä»¬åœ¨nameå­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼Œä¸Šè¾¹çš„SQLä¹Ÿæ˜¯ä¸ä¼šèµ°ç´¢å¼•çš„ï¼ˆä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™ï¼‰ï¼Œå°†æ‰§è¡Œå…¨è¡¨æ‰«æï¼Œæ€§èƒ½å¯æƒ³è€ŒçŸ¥ã€‚<br>ä½†æ˜¯è‹¥åœ¨ESä¸­å®ç°ä¸Šè¿°çš„æŸ¥è¯¢åˆ™å¾ˆç®€å•ï¼Œç”±äºESé‡‡ç”¨çš„å­˜å‚¨ã€ç´¢å¼•ç­–ç•¥ï¼Œå¯ä»¥å®æ—¶çš„æŸ¥è¯¢åˆ°æƒ³è¦çš„ç»“æœã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œæ— è®ºæ˜¯ç²¾ç¡®æŸ¥è¯¢è¿˜æ˜¯æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæœ¬è´¨ä¸Šæ¥æ—¶â€œä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“â€çš„æ€ç»´ï¼ŒESæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>æœç´¢ã€åˆ†æå¼•æ“</strong>ï¼Œæœç´¢å¼•æ“ä»ä¸€ä¸ªæŠ½è±¡çš„è§’åº¦æ¥è®²ï¼Œå®ƒåšäº†ä¸‰ä»¶äº‹ï¼š<strong>æ”¶é›†æ•°æ®ã€å»ºç«‹æ•°æ®ç´¢å¼•ã€ç›¸å…³åº¦æ’å</strong>ã€‚åœ¨ESä¸­æ”¶é›†æ•°æ®æ˜¯æœ‰æˆ‘ä»¬æ¥å®Œæˆçš„ï¼Œ1ã€æ¯”å¦‚å°†å…³ç³»å‹æ•°æ®åº“ä¸­çš„æ•°æ®åŒæ­¥åˆ°ESä¸­ï¼›2ã€ç„¶åESå°†åŒæ­¥çš„æ•°æ®å»ºç«‹ç´¢å¼•ï¼Œæ–¹ä¾¿ä¹‹åçš„æŸ¥è¯¢ï¼›3ã€æœ€åä¸€æ­¥ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯ç›¸å…³åº¦æ’åï¼Œå¦‚æ­¤å¤§é‡çš„æ•°æ®ï¼Œä¸ä¼šæ˜¯æ‰€æœ‰éƒ½æ‹¥æœ‰ç›¸åŒçš„é‡è¦ç¨‹åº¦ï¼Œæ‰€ä»¥æ’åçš„å¥½åå¯¹äºæœç´¢å¼•æ“æ¥è¯´å¾ˆé‡è¦ï¼Œå®ƒå†³å®šäº†æœç´¢è´¨é‡çš„é«˜ä½ã€‚</p>
<p>åœ¨ESä¸­ä¹Ÿæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æŸ¥è¯¢çš„æ—¶å€™ä¸ä»…ä»…æ˜¯å°†æ•°æ®æŸ¥è¯¢å‡ºæ¥ï¼ŒESè¿˜èƒ½å°†å…³é”®è¯æ£€ç´¢åˆ°çš„æ•°æ®æ ¹æ®<strong>ç›¸å…³åº¦æ’å</strong>ã€‚è¿™ä¹Ÿæ›´ç¬¦åˆæˆ‘ä»¬äººç±»çš„æ€ç»´æ–¹å¼ï¼Œå‡è®¾æˆ‘ä»¬ä½¿ç”¨å…³é”®è¯â€œé²è¿…â€ä¸æ˜¯ä¸ºäº†æŸ¥è¯¢æ‰€æœ‰åŒ…å«é²è¿…å…³é”®è¯çš„æ–‡ç« ã€æŠ¥é“ã€‚è€Œæ˜¯å¸Œæœ›æŠŠå¤§å®¶éƒ½è®¤ä¸ºæœ‰å…³é²è¿…è¿™ä¸ªäººæœ€é‡è¦çš„ä½œå“ã€ä¸ªäººèƒŒæ™¯ã€äººç”Ÿç»å†ã€å†å²è¯„ä»·ç­‰ç­‰ä¿¡æ¯æ ¹æ®ç›¸å…³åº¦æ’åºæ£€ç´¢å‡ºæ¥ã€‚</p>
<p>æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ä¸èƒ½æä¾›çš„åŠŸèƒ½ï¼Œå®ƒâ€ä¼¼ä¹â€œæ›´èƒ½æ‡‚å¾—æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„ç»“æœã€‚</p>
<h4 id="3ã€å®Œæ•´çš„ç”Ÿæ€ç³»ç»Ÿ"><a href="#3ã€å®Œæ•´çš„ç”Ÿæ€ç³»ç»Ÿ" class="headerlink" title="3ã€å®Œæ•´çš„ç”Ÿæ€ç³»ç»Ÿ"></a>3ã€å®Œæ•´çš„ç”Ÿæ€ç³»ç»Ÿ</h4><p>ElasticSearchæ˜¯Elasticå…¬å¸çš„æ ¸å¿ƒæŠ€æœ¯æ ˆï¼Œä»–ä»¬è¿˜åŒ…æ‹¬Logstashã€Filebeatã€Kibanaç­‰ç­‰ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ESæä¾›çš„æŠ€æœ¯æ ˆï¼Œå®ç°å„ç§ç›®çš„ï¼Œæ¯”å¦‚å…¸å‹çš„é‡‡ç”¨ELK + Filebeatæ­å»ºä¸€å¥—åˆ†å¸ƒå¼æ—¥å¿—é‡‡é›†ç³»ç»Ÿï¼Œå°†å„ä¸ªå¾®æœåŠ¡çš„æ—¥å¿—é€šè¿‡Filebeatæ”¶é›†æ¨é€åˆ°Logstashç®¡é“åšå¤„ç†ï¼Œç„¶ålogstashæ¨é€ç»™ESï¼Œæœ€ç»ˆKibanaå±•ç¤ºï¼ŒæŸ¥è¯¢æ—¥å¿—ã€‚</p>
<h4 id="4ã€å¯æ‰©å±•æ€§"><a href="#4ã€å¯æ‰©å±•æ€§" class="headerlink" title="4ã€å¯æ‰©å±•æ€§"></a>4ã€å¯æ‰©å±•æ€§</h4><p>å¯¹äºå¤§å¤šæ•°çš„æ•°æ®åº“è€Œè¨€ï¼Œé€šå¸¸éœ€è¦å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œéå¸¸å¤§çš„æ”¹åŠ¨ï¼Œæ‰èƒ½åˆ©ç”¨ä¸Šæ¨ªå‘æ‰©å®¹çš„æ–°å¢èµ„æºã€‚ ä¸ä¹‹ç›¸åçš„æ˜¯ï¼ŒElastiSearchå¤©ç”Ÿå°±æ˜¯åˆ†å¸ƒå¼çš„ ï¼Œåœ¨ESé›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶å¢åŠ ã€æ‘˜é™¤èŠ‚ç‚¹ï¼Œé›†ç¾¤å°†ä¼šé‡æ–°å¹³å‡åˆ†å¸ƒæ‰€æœ‰çš„æ•°æ®ã€‚å®ƒçŸ¥é“å¦‚ä½•é€šè¿‡ç®¡ç†å¤šèŠ‚ç‚¹æ¥æé«˜æ‰©å®¹æ€§å’Œå¯ç”¨æ€§ã€‚ è¿™ä¹Ÿæ„å‘³ç€ä½ çš„åº”ç”¨æ— éœ€å…³æ³¨è¿™ä¸ªé—®é¢˜ã€‚</p>
<hr>
<p>å½“ç„¶ï¼Œä»»ä½•æŠ€æœ¯éƒ½æœ‰å…¶åˆé€‚çš„åº”ç”¨åœºæ™¯ï¼Œ<strong>ESä¸æ”¯æŒäº‹åŠ¡ã€åŒæ—¶æ›´é€‚åˆæŸ¥å¤šæ”¹å°‘</strong>çš„åœºæ™¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é€‰æ‹©æŠ€æœ¯æ ˆçš„æ—¶å€™éœ€è¦æ³¨æ„è¿™äº›é™åˆ¶ã€‚</p>
<h2 id="äºŒã€æ ¸å¿ƒæ¦‚å¿µ"><a href="#äºŒã€æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="äºŒã€æ ¸å¿ƒæ¦‚å¿µ"></a>äºŒã€æ ¸å¿ƒæ¦‚å¿µ</h2><p>æ— è®ºæˆ‘ä»¬æ˜¯åœ¨å¼€å‘ã€ç»´æŠ¤ESé›†ç¾¤çš„æ—¶å€™ï¼Œå¼„æ¸…æ¥šESä¸­çš„æ ¸å¿ƒæ¦‚å¿µéƒ½æ˜¯é‡è¦çš„ï¼Œä¸‹é¢æˆ‘ä»¬é‡‡ç”¨â€œ<strong>ä»å°åˆ°å¤§</strong>â€çš„æ–¹å¼æ¥ä»‹ç»ESçš„æ ¸å¿ƒæ¦‚å¿µã€‚</p>
<h4 id="1ã€å­—æ®µï¼ˆFieldsï¼‰"><a href="#1ã€å­—æ®µï¼ˆFieldsï¼‰" class="headerlink" title="1ã€å­—æ®µï¼ˆFieldsï¼‰"></a>1ã€å­—æ®µï¼ˆFieldsï¼‰</h4><p>å­—æ®µæ˜¯ESä¸­æœ€å°çš„ç‹¬ç«‹å•å…ƒæ•°æ®ï¼Œæ¯ä¸€ä¸ªå­—æ®µæœ‰è‡ªå·±çš„æ•°æ®ç±»å‹ï¼ˆå¯ä»¥è‡ªå·±å®šä¹‰è¦†ç›–ESè‡ªåŠ¨è®¾ç½®çš„æ•°æ®ç±»å‹ï¼‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å•ä¸ªå­—æ®µè®¾ç½®æ˜¯å¦åˆ†æã€åˆ†è¯å™¨ç­‰ç­‰ã€‚</p>
<p>æ ¸å¿ƒçš„æ•°æ®ç±»å‹æœ‰stringã€Numericã€DateDateã€Booleanã€Binaryã€Rangeç­‰ç­‰ï¼Œå¤æ‚ç±»å‹æœ‰Objectã€Nestedï¼Œè¯¦ç»†çš„å¯ä»¥<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html" target="_blank" rel="noopener">å‚è€ƒå®˜æ–¹çš„ä»‹ç»</a></p>
<h4 id="2ã€æ–‡æ¡£ï¼ˆDocumentsï¼‰"><a href="#2ã€æ–‡æ¡£ï¼ˆDocumentsï¼‰" class="headerlink" title="2ã€æ–‡æ¡£ï¼ˆDocumentsï¼‰"></a>2ã€æ–‡æ¡£ï¼ˆDocumentsï¼‰</h4><p>åœ¨ESä¸­æ–‡æ¡£çš„æ¦‚å¿µç›¸å½“äºRDBMSä¸­çš„ä¸€è¡Œæ•°æ®ï¼Œä¸åŒçš„æ˜¯åœ¨ESä¸­æ–‡æ¡£çš„å­˜å‚¨æ˜¯ç›´æ¥ä½¿ç”¨jsonæ ¼å¼å­˜å‚¨çš„ï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥åµŒå¥—ï¼‰ï¼Œè€Œä¸æ˜¯åƒRDBMSä¸­æŠŠæ•°æ®â€å‹å¹³â€äº†å­˜å‚¨ï¼Œè¿™ä¸€ç‚¹ä¹Ÿæ˜¯Nosqlå’Œå…³ç³»å‹æ•°æ®åº“æ¯”è¾ƒå¤§çš„åŒºåˆ«ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ–‡æ¡£çš„ä¾‹å­</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">"_id"</span>: <span class="number">3</span>,</span><br><span class="line">   â€œ_typeâ€: [â€œyour index typeâ€],</span><br><span class="line">   â€œ_indexâ€: [â€œyour index nameâ€],</span><br><span class="line">   "_source":&#123;</span><br><span class="line">   "age": 28,</span><br><span class="line">   "name": ["danielâ€],</span><br><span class="line">   "year":1989,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3ã€æ˜ å°„ï¼ˆMappingï¼‰"><a href="#3ã€æ˜ å°„ï¼ˆMappingï¼‰" class="headerlink" title="3ã€æ˜ å°„ï¼ˆMappingï¼‰"></a>3ã€æ˜ å°„ï¼ˆMappingï¼‰</h4><p>â€Mapping is the process of defining how a document, and the fields it contains, are stored and indexed.â€œ</p>
<p>ä¹Ÿå°±æ˜¯Mappingæ˜¯å®šä¹‰æ–‡æ¡£å’Œå­—æ®µå¦‚ä½•å­˜å‚¨å’Œç´¢å¼•ï¼Œä½¿ç”¨Mappingå¯ä»¥å®šä¹‰ä¸‹é¢è¿™äº›ä¿¡æ¯</p>
<ul>
<li>å“ªäº›å­—æ®µåº”è¯¥ä½œä¸ºå…¨æ–‡ç´¢å¼•</li>
<li>å“ªäº›å­—æ®µåŒ…æ‹¬numbers, dates, geolocations.</li>
<li>æ—¶é—´ç±»å‹çš„æ ¼å¼</li>
<li>å®šä¹‰è§„åˆ™æ§åˆ¶åŠ¨æ€å¢åŠ å­—æ®µçš„mapping</li>
</ul>
<h4 id="4ã€ç´¢å¼•ï¼ˆIndexï¼‰"><a href="#4ã€ç´¢å¼•ï¼ˆIndexï¼‰" class="headerlink" title="4ã€ç´¢å¼•ï¼ˆIndexï¼‰"></a>4ã€ç´¢å¼•ï¼ˆIndexï¼‰</h4><p>åœ¨ESä¸­æ˜¯æœ€å¤§çš„æ•°æ®å­˜å‚¨æ¦‚å¿µï¼Œ<strong>å®ƒæ˜¯ç”±è®¸å¤šå…·æœ‰ç›¸åŒç‰¹å¾çš„æ–‡æ¡£ç»„æˆçš„ä¸€ä¸ªé›†åˆ</strong>ã€‚ ç”±äºåœ¨ES7.0ä¹‹åé€æ¸åºŸé™¤Typeç±»å‹ï¼Œæ‰€ä»¥Indexä»â€<strong>æ•°æ®åº“</strong>â€œçš„æ¦‚å¿µå˜æˆäº†<em>å®é™…ä¸Š</em>çš„â€<strong>è¡¨</strong>â€œæ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒè¿‘ä¼¼åœ°å½“æˆRDBMSä¸­çš„è¡¨ï¼Œä½†æ˜¯è¦æ³¨æ„Indexåªæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼ŒçœŸå®çš„æ•°æ®æ˜¯åˆ†å¼€å­˜å‚¨åœ¨å„ä¸ªåˆ†ç‰‡ä¸­çš„ã€‚</p>
<h4 id="5ã€åˆ†ç‰‡ï¼ˆShardsï¼‰"><a href="#5ã€åˆ†ç‰‡ï¼ˆShardsï¼‰" class="headerlink" title="5ã€åˆ†ç‰‡ï¼ˆShardsï¼‰"></a>5ã€åˆ†ç‰‡ï¼ˆShardsï¼‰</h4><p>è¿™é‡Œéœ€è¦å¤šè¯´å‡ å¥ï¼Œææ¸…æ¥šåˆ†ç‰‡å¯¹äºç†è§£ESé›†ç¾¤ï¼ˆæ‰©å®¹ã€å®¹é”™ã€è·¯ç”±ï¼‰åŸç†æ˜¯å¾ˆé‡è¦çš„ã€‚</p>
<p>é¦–å…ˆï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½æ˜¯ä¸€ä¸ªLuceneç´¢å¼•å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä½œä¸€ä¸ªç‹¬ç«‹çš„æœç´¢å¼•æ“ï¼Œå®ƒèƒ½å¤Ÿå¯¹Elasticsearché›†ç¾¤ä¸­çš„æ•°æ®å­é›†è¿›è¡Œç´¢å¼•å¹¶å¤„ç†ç›¸å…³æŸ¥è¯¢ã€‚</p>
<p>åˆ†ç‰‡åˆ†ä¸ºä¸¤ç§ï¼š<strong>ä¸»åˆ†ç‰‡ï¼ˆPrimary Shardï¼‰ã€å‰¯æœ¬åˆ†ç‰‡ï¼ˆReplica Shardï¼‰</strong></p>
<ul>
<li><p>ä¸»åˆ†ç‰‡ï¼šç”±äºæ‰€æœ‰çš„æ•°æ®éƒ½ä¼šåœ¨ä¸»åˆ†ç‰‡ä¸­å­˜å‚¨ï¼Œæ‰€ä»¥<strong>ä¸»åˆ†ç‰‡å†³å®šäº†æ–‡æ¡£å­˜å‚¨æ•°é‡çš„ä¸Šé™</strong>ï¼Œä½†æ˜¯ä¸€ä¸ªç´¢å¼•çš„ä¸»åˆ†ç‰‡æ•°åœ¨åˆ›å»ºæ—¶ä¸€æ—¦æŒ‡å®šï¼Œé‚£ä¹ˆä¸»åˆ†ç‰‡çš„æ•°é‡å°±ä¸èƒ½æ”¹å˜ï¼Œè¿™æ˜¯å› ä¸ºå½“ç´¢å¼•ä¸€ä¸ªæ–‡æ¡£æ—¶ï¼Œå®ƒæ˜¯é€šè¿‡å…¶ä¸»é”®ï¼ˆé»˜è®¤ï¼‰Hashåˆ°å¯¹åº”çš„ä¸»åˆ†ç‰‡ä¸Šï¼ˆç±»ä¼¼äºRDBMSåˆ†åº“åˆ†è¡¨è·¯ç”±ç­–ç•¥ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€æ—¦ä¿®æ”¹ä¸»åˆ†ç‰‡æ•°é‡ï¼Œé‚£ä¹ˆå°†æ— æ³•å®šä½åˆ°å…·ä½“çš„ä¸»åˆ†ç‰‡ä¸Šã€‚åœ¨mappingæ—¶æˆ‘ä»¬å¯ä»¥è®¾ç½®<code>number_of_shards</code>å€¼ï¼Œæœ€å¤§å€¼é»˜è®¤ä¸º1024ã€‚å½“ç„¶è¿™ä¸æ˜¯ç»å¯¹çš„ï¼Œå¦‚æœå®åœ¨æƒ³æ‰©å®¹å’‹åŠå‘¢ï¼Ÿç­”æ¡ˆæ˜¯æˆ‘ä»¬å¯ä»¥é‡æ–°åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œç„¶åå°†è€ç´¢å¼•çš„æ•°æ®è¿ç§»åˆ°æ–°çš„ç´¢å¼•ä¸Šï¼ŒESä¸ºäº†æä¾›äº†æ–¹æ³•<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.8/docs-reindex.html" target="_blank" rel="noopener">Reindex API</a></p>
</li>
<li><p>å‰¯æœ¬åˆ†ç‰‡ï¼šæˆ‘ä»¬å¯ä»¥ä¸ºä¸€ä¸ªä¸»åˆ†ç‰‡æ ¹æ®å®é™…çš„ç¡¬ä»¶èµ„æºæŒ‡å®šä»»æ„æ•°é‡çš„å‰¯æœ¬åˆ†ç‰‡ï¼Œä¸Šè¾¹å·²ç»è¯´è¿‡ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½å¯ä»¥å¤„ç†æŸ¥è¯¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥<strong>å¢åŠ å‰¯æœ¬åˆ†ç‰‡çš„èµ„æºï¼ˆç›¸åº”ç¡¬ä»¶èµ„æºæå‡ï¼‰æ¥æå‡ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›</strong>ã€‚åŒæ ·ï¼Œåœ¨mappingæ—¶ï¼Œå¯ä»¥é€šè¿‡<code>number_of_replicas</code>å‚æ•°æ¥è®¾ç½®æ¯ä¸ªä¸»åˆ†ç‰‡çš„å‰¯æœ¬åˆ†ç‰‡æ•°é‡</p>
</li>
</ul>
<p>ä½†æ˜¯è¦æ³¨æ„ï¼Œä¸ºäº†å®¹é”™ï¼ˆèŠ‚ç‚¹ä¸»æœºå®•æœºå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰ï¼Œ<strong>ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ä¸èƒ½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œé˜²æ­¢èŠ‚ç‚¹å®•æœºå¯¼è‡´éƒ¨åˆ†æ•°æ®ä¸¢å¤±</strong>ã€‚</p>
<h4 id="6ã€å®ä¾‹å’ŒèŠ‚ç‚¹ï¼ˆInstances-and-Nodesï¼‰"><a href="#6ã€å®ä¾‹å’ŒèŠ‚ç‚¹ï¼ˆInstances-and-Nodesï¼‰" class="headerlink" title="6ã€å®ä¾‹å’ŒèŠ‚ç‚¹ï¼ˆInstances and Nodesï¼‰"></a>6ã€å®ä¾‹å’ŒèŠ‚ç‚¹ï¼ˆInstances and Nodesï¼‰</h4><p> â€A node is a running instance of Elasticsearch which belongs to a clusterâ€</p>
<p>èŠ‚ç‚¹ä¹Ÿå°±æ˜¯è¿è¡Œçš„ESå®ä¾‹ï¼Œå®ƒéš¶å±äºæŸä¸€ä¸ªé›†ç¾¤ã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šè¾¹éƒ¨ç½²ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æœ‰æ—¶å€™ä¸ºäº†æµ‹è¯•é›†ç¾¤ï¼Œä¹Ÿå¯ä»¥åœ¨å•å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ªèŠ‚ç‚¹æ¥æµ‹è¯•ã€‚å‡è®¾å½“æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹æƒ³åŠ å…¥å·²ç»å­˜åœ¨çš„ä¸€ä¸ªé›†ç¾¤ä¸­æ—¶ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æ”¹é›†ç¾¤çš„åç§°ï¼Œä»¥åŠé€šä¿¡çš„<code>ip + port</code>ï¼ŒESä¼šè‡ªåŠ¨é€šè¿‡â€œ<strong>å•ç‚¹ä¼ é€</strong>â€çš„æ–¹å¼æ¥è‡ªåŠ¨å‘ç°é›†ç¾¤å¹¶å°è¯•åŠ å…¥è¿™ä¸ªé›†ç¾¤ã€‚</p>
<p>èŠ‚ç‚¹åˆ†ä¸ºä¸‹é¢å‡ ç§ç±»å‹:</p>
<ul>
<li>Master-eligible nodeï¼šè´Ÿè´£ç®¡ç†å’Œé…ç½®é›†ç¾¤ï¼Œä¾‹å¦‚å¢åŠ ã€åˆ é™¤èŠ‚ç‚¹ç›¸å…³åŠ¨ä½œã€‚</li>
<li>Data nodeï¼šæ–‡æ¡£å®é™…ä¸Šå°±å­˜å‚¨åœ¨æ•°æ®èŠ‚ç‚¹ï¼Œè´Ÿè´£æ‰§è¡Œç›¸å…³çš„æ“ä½œï¼Œ ä¾‹å¦‚CRUDã€æœç´¢ã€èšåˆç­‰ç­‰æ“ä½œ</li>
<li>Ingest nodeï¼šç”¨äºæ–‡æ¡£åœ¨indexingä¹‹å‰è¿›è¡Œé¢„å¤„ç†</li>
<li>Machine learning nodeï¼šä¸»è¦ç”¨äºæœºå™¨å­¦ä¹ çš„ä»»åŠ¡ï¼Œä½†æ˜¯éœ€è¦<code>Basic License</code>ã€‚</li>
</ul>
<p>å…³äºESèŠ‚ç‚¹çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.8/modules-node.html#modules-node" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>
<h4 id="7ã€é›†ç¾¤ï¼ˆClusterï¼‰"><a href="#7ã€é›†ç¾¤ï¼ˆClusterï¼‰" class="headerlink" title="7ã€é›†ç¾¤ï¼ˆClusterï¼‰"></a>7ã€é›†ç¾¤ï¼ˆClusterï¼‰</h4><ul>
<li>åœ¨ESä¸­ï¼Œé›†ç¾¤æ˜¯ç”±<strong>ä¸€ä¸ªæˆ–å¤šä¸ªESèŠ‚ç‚¹ç»„æˆ</strong>çš„ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§°/æ ‡è¯†ç¬¦ï¼Œç”¨ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„ä¾æ®ã€‚</li>
<li>æ¯ä¸€ä¸ªé›†ç¾¤ä¸­æœ‰ä¸€ä¸ªMasterèŠ‚ç‚¹ï¼Œè‹¥æ˜¯è¿™ä¸ªMasterèŠ‚ç‚¹æŒ‚äº†ï¼Œé›†ç¾¤å¯ä»¥ç”¨å…¶ä»–çš„èŠ‚ç‚¹ä»£æ›¿ã€‚<br>åœ¨ESä¸­è¿˜æ”¯æŒè·¨é›†ç¾¤å¤åˆ¶ã€è·¨é›†ç¾¤æ£€ç´¢ç­‰ç­‰åŠŸèƒ½ï¼Œè¯¦ç»†çš„å¯ä»¥å‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.8/xpack-ccr.html#xpack-ccr" target="_blank" rel="noopener">Cross-cluster replication</a>ï¼Œ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cross-cluster-search.html" target="_blank" rel="noopener">Search across clusters</a></li>
</ul>
<hr>
<p>åœ¨ä¸Šè¾¹çš„ä¸¤èŠ‚ï¼Œæˆ‘ä»¬çŸ¥é“äº†ESæ‹¥æœ‰çš„è¶…å¼ºæ•°æ®å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿäº†è§£äº†ESä¸€äº›åŸºç¡€çš„æ¦‚å¿µã€‚å› ä¸ºç½‘ä¸Šå…³äºESä½¿ç”¨çš„å€’åºç´¢å¼•åŸç†åˆ†æå·²ç»æ¯”è¾ƒå¤šäº†ï¼Œæˆ‘è¿™é‡Œå°±ä¸åœ¨é‡æ–°æè¿°å…¶ä¸­çš„ç»†èŠ‚äº†ï¼Œå…·ä½“åŸç†æ¨èå¤§å®¶ä¸€ç¯‡æ–‡ç« å‚è€ƒï¼š<a href="https://www.infoq.cn/article/database-timestamp-02" target="_blank" rel="noopener">æ—¶é—´åºåˆ—æ•°æ®åº“çš„ç§˜å¯† (2)â€”â€”ç´¢å¼•</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html" target="_blank" rel="noopener">Elasticsearch Reference [7.8] Â» Mapping</a></p>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.8/index-modules.html" target="_blank" rel="noopener">Elasticsearch Reference [7.8] Â» Index modules</a></p>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.8/modules-node.html#modules-node" target="_blank" rel="noopener">Elasticsearch Reference [7.8] Â» Set up Elasticsearch Â» Configuring Elasticsearch Â» Node</a></p>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/glossary.html#glossary-routing" target="_blank" rel="noopener">Elasticsearch Reference [7.8] Â» Glossary of terms</a></p>
</li>
<li><p><a href="https://cloud.tencent.com/developer/article/1558616" target="_blank" rel="noopener">Elasticsearchï¼šæ˜¯ä»€ä¹ˆï¼Ÿä½ ä¸ºä»€ä¹ˆéœ€è¦ä»–ï¼Ÿ</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡å®ç°æ—¥å¿—å®Œæ•´é“¾è·¯è¿½è¸ªï¼ˆlog_trace_idï¼‰è¸©åˆ°çš„å‘</title>
    <url>/2020/07/14/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%9E%E7%8E%B0%E6%97%A5%E5%BF%97%E5%AE%8C%E6%95%B4%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA%EF%BC%88log_trace_id%EF%BC%89%E8%B8%A9%E5%88%B0%E7%9A%84%E5%9D%91/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå¾®æœåŠ¡ä¼—å¤šã€æ—¥å¿—åˆ†æ•£æ˜¯ä¸€ä¸ªä»¤äººå¤´ç–¼çš„é—®é¢˜ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ELKæ¥<strong>å°†å•ä¸ªå¾®æœåŠ¡çš„å„ä¸ªå®¹å™¨èŠ‚ç‚¹æ—¥å¿—æ±‡æ€»åˆ°ä¸€ä¸ªç´¢å¼•ä¸­æ¥é›†ä¸­æŸ¥è¯¢</strong>ï¼Œè¿™ç¡®å®èƒ½å¤Ÿæé«˜æ—¥å¿—æŸ¥è¯¢çš„æ•ˆç‡ã€‚<br>ä½†æ˜¯ï¼Œåœ¨kiabanä¸­æŸ¥è¯¢æ—¥å¿—çš„æ—¶å€™æˆ‘ä»¬ä»ç„¶ä¼šé¢å¯¹å¾ˆå¤šçš„é—®é¢˜ï¼Œè¿™é‡Œå°±æ‹¿ä¸‰ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š</p>
<ul>
<li><p>1ã€[ç”¨æˆ·è¯·æ±‚ -&gt; Gateway -&gt; Microservice]ï¼Œå¾ˆå¤šæ—¶å€™Microserviceå†…éƒ¨è¿˜æœ‰å¾ˆå¤šçš„ç›¸äº’è°ƒç”¨ï¼Œæˆ‘ä»¬å¦‚ä½•å°†ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚åœ¨å¾®æœåŠ¡å†…éƒ¨çš„è°ƒç”¨ä¸²è”èµ·æ¥å‘¢ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½é—®é¢˜ï¼ŸELKçš„æ¶æ„æ˜¯æ— æ³•æ»¡è¶³æˆ‘ä»¬è¿™ä¸ªéœ€æ±‚çš„ã€‚</p>
</li>
<li><p>2ã€MQä¹Ÿæ˜¯å¾®æœåŠ¡å¿…å¤‡çš„æŠ€æœ¯æ ˆï¼Œé€šå¸¸producerå’Œconsumerä¸åœ¨åŒä¸€ä¸ªå¾®æœåŠ¡é‡Œï¼Œå°±ç®—åœ¨åŒä¸€ä¸ªæœåŠ¡é‡Œï¼Œä¹Ÿä¸ä¼šåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬éœ€è¦è¿½è¸ªæŸä¸€æ¡æ¶ˆè´¹ä»ç”Ÿäº§åˆ°æ¶ˆè´¹çš„å®Œæ•´è·¯å¾„æ—¶ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚</p>
</li>
<li><p>3ã€å½“æŸä¸€ä¸ªè¾ƒå¤§çš„ä»»åŠ¡åœ¨æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡‡ç”¨å¤šçº¿ç¨‹çš„ä»»åŠ¡å»æ‰§è¡Œï¼Œé‚£ä¹ˆè¿™äº›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œçš„æƒ…å†µæˆ‘ä»¬è¦å¦‚ä½•å»ä¸²è”åœ¨ä¸€èµ·ï¼Ÿæ–¹ä¾¿æˆ‘ä»¬çœ‹åˆ°æ•´ä½“æ‰§è¡Œæƒ…å†µ ã€‚</p>
</li>
<li><p>4ã€æœ‰æ—¶å€™æˆ‘ä»¬é‡‡ç”¨@Asyncæ³¨è§£ç”¨å¼‚æ­¥çš„æ–¹å¼æ¥è¿è¡ŒæŸäº›ä»»åŠ¡ï¼Œè¿™ä¸ªå¼‚æ­¥ä»»åŠ¡ä¹Ÿä¼šè¿è¡Œåœ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦å¦‚ä½•å°†è°ƒç”¨æ–¹å’Œå¼‚æ­¥ä»»åŠ¡ä¸²è”èµ·æ¥ï¼Ÿ</p>
</li>
</ul>
<p>ä¸Šè¾¹æè¿°çš„ä¸‰ä¸ªé—®é¢˜<strong>å½’æ ¹åˆ°åº•å°±æ˜¯éœ€è¦ç”¨ä¸€ä¸ªâ€œæ ‡è¯†â€å°†ä¸€æ¬¡è¯·æ±‚çš„å®Œæ•´é“¾è·¯å…¨éƒ¨ä¸²è”èµ·æ¥</strong>ï¼Œé‡‡ç”¨log_trace_ldèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ¥å®ç°å…¨é“¾è·¯è¿½è¸ªã€‚</p>
<h2 id="å®ç°ä¸²è”å¾®æœåŠ¡"><a href="#å®ç°ä¸²è”å¾®æœåŠ¡" class="headerlink" title="å®ç°ä¸²è”å¾®æœåŠ¡"></a>å®ç°ä¸²è”å¾®æœåŠ¡</h2><p>åœ¨å‰è¾¹æˆ‘ä»¬æ¢è®¨äº†è¦ä½¿ç”¨log_trace_idçš„åŸå› ï¼Œæ‰€ä»¥å°±å¼€å§‹å‡†å¤‡ç€æ‰‹è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå°†å¾®æœåŠ¡å†…éƒ¨ä¹‹é—´çš„è°ƒç”¨ä¸²è”èµ·æ¥ã€‚</p>
<p>æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>1ã€æˆ‘ä»¬å°†log_reace_idå­—æ®µæ”¾åˆ°Httpè¯·æ±‚å¤´é‡Œè¾¹ï¼Œå¾®æœåŠ¡åœ¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä½¿ç”¨æ‹¦æˆªå™¨æ‹¦æˆªæ¯æ¬¡è¯·æ±‚ï¼Œè‹¥Headerä¸­å·²ç»å­˜åœ¨æ­¤å­—æ®µï¼Œåˆ™è¯´æ˜æ­¤æ¬¡è¯·æ±‚æ—¶å¾®æœåŠ¡å†…éƒ¨çš„è°ƒç”¨ï¼Œåˆ™ç»§ç»­æ²¿ç”¨Headerä¸­çš„log_trace_logï¼Œå¦åˆ™é‡æ–°ç”Ÿæˆlog_trace_idè®¾ç½®åˆ°MDCä¸­ï¼Œä»£ç å¦‚ä¸‹:</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> leon</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/7/14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(RequestInterceptor.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(<span class="string">"Enter Interceptor."</span>);</span><br><span class="line">        String traceId = request.getHeader(LOG_TRACE_ID);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(traceId))&#123;</span><br><span class="line">           traceId = UuidUtil.get32UUID();</span><br><span class="line">        &#125;</span><br><span class="line">        MDC.put(LOG_TRACE_ID, traceId);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MDC.remove(LOG_TRACE_ID);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>2ã€å½“å¾®æœåŠ¡å‘èµ·è¿œç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†log_trace_idè®¾ç½®åˆ°Headerä¸­ï¼Œä¿æŒå®Œæ•´è°ƒç”¨é“¾ä½¿ç”¨åŒä¸€ä¸ªlog_trace_idã€‚å› ä¸ºå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨å…¨éƒ¨ç»Ÿä¸€ä½¿ç”¨Feignæ¥è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨Feignæä¾›çš„<code>RequestInterceptor</code>æ‹¦æˆªå™¨åœ¨Feignå‘èµ·å¾®æœåŠ¡è°ƒç”¨ä¹‹å‰å°†å‚æ•°è®¾ç½®åˆ°è¯·æ±‚å¤´ä¸­ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“å‰æœåŠ¡Feignè¯·æ±‚æ‹¦æˆªå™¨ï¼Œè®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> leon</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/7/14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFeignRequestInterceptor</span> <span class="keyword">implements</span> <span class="title">RequestInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(MyFeignRequestInterceptor.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(RequestTemplate template)</span> </span>&#123;</span><br><span class="line">        String traceId = MDC.get(LOG_TRACE_ID);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(traceId))&#123;</span><br><span class="line">            template.header(LOG_TRACE_ID, traceId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é—®é¢˜æ¥äº†"><a href="#é—®é¢˜æ¥äº†" class="headerlink" title="é—®é¢˜æ¥äº†"></a>é—®é¢˜æ¥äº†</h3><ul>
<li>åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€ä¸ªç°è±¡ï¼Œ<strong>åœ¨æœ‰çš„å¾®æœåŠ¡ä¸­<code>String traceId = MDC.get(LOG_TRACE_ID)</code>è¿™è¡Œä»£ç æ˜¯èƒ½å¤Ÿæ‹¿åˆ°traceIdçš„ï¼Œè€Œæœ‰äº›å¾®æœåŠ¡traceIdå´ä¸ºnull</strong></li>
</ul>
<h2 id="å¡«å‘ä¹‹è·¯"><a href="#å¡«å‘ä¹‹è·¯" class="headerlink" title="å¡«å‘ä¹‹è·¯"></a>å¡«å‘ä¹‹è·¯</h2><p><strong>åœ¨å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¯¹æŸäº›ç°è±¡æ„Ÿåˆ°ç–‘æƒ‘ï¼Œç»å¤§éƒ¨åˆ†æ—¶å€™è¯´æ˜æˆ‘ä»¬æ²¡æœ‰è®¤çœŸçœ‹æ–‡æ¡£ï¼Œæ²¡æœ‰å®Œæ•´çš„æ¦‚å¿µã€åŸç†è®¤çŸ¥æ‰ä¼šå‡ºç°è¿™ç§æƒ…å†µ</strong>ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å¼„æ¸…æ¥š<code>MDC</code>ã€‚åœ¨ä¸Šè¾¹æˆ‘ä»¬ä½¿ç”¨<code>MDC</code>(Mapped Diagnostic Context)è¿™ä¸ªç±»ä¿å­˜traceIdå¹¶åœ¨Feignè¯·æ±‚çš„æ—¶å€™å–å‡ºæ¥è®¾ç½®åˆ°Headerä¸­ã€‚ç®€å•æ¥è¯´ï¼ŒMDCå°±æ˜¯ç”±log4jåº“æä¾›çš„ä¸€ä¸ª<code>InheritableThreadLocal&lt;Map&lt;String, String&gt;&gt;</code>å¯¹è±¡ï¼Œæˆ‘ä»¬å°†traceIdè®¾ç½®åˆ°è¿™ä¸ª<code>InheritableThreadLocal</code>ä¸­ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­/å­çº¿ç¨‹ä¸­èƒ½å¤Ÿè·å–åˆ°ä¹‹å‰æˆ‘ä»¬åœ¨æ‹¦æˆªå™¨çš„K-Vï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­patternä¸­å¼•ç”¨å½“å‰MDCè®¾ç½®çš„å€¼<code>%X{log_trace_id}</code>ï¼Œå¯ä»¥åœ¨æ¯è¡Œæ—¥å¿—ä¸­æ‰“å°traceIdå¯¹åº”çš„å€¼ã€‚</p>
<p>é€šè¿‡ä¸Šè¾¹å¯¹MDCçš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹åœ¨<code>MyFeignRequestInterceptor</code>æ‹¦æˆªç±»çš„çº¿ç¨‹å’Œè¯·æ±‚è¿›å…¥çš„<code>RequestInterceptor</code>æ‹¦æˆªå™¨è®¾ç½®traceIdå¹¶ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œã€‚</p>
<p>ä¸ºäº†éªŒè¯æƒ³æ³•ï¼Œæˆ‘ä»¬å°†çº¿ç¨‹ç»„çš„åç§°ã€å½“å‰çº¿ç¨‹çš„IDã€nameæ‰“å°å‡ºæ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ThreadGroup threadGroup = Thread.currentThread().getThreadGroup();</span><br><span class="line">Thread thread = Thread.currentThread();</span><br><span class="line">log.info(<span class="string">"RequestInterceptor current thread group name: &#123;&#125;, current thread name: &#123;&#125; , id: &#123;&#125;"</span>, threadGroup.getName(), thread.getName(), thread.getId());</span><br><span class="line">        </span><br><span class="line">ThreadGroup threadGroup = Thread.currentThread().getThreadGroup();</span><br><span class="line">Thread thread = Thread.currentThread();</span><br><span class="line">log.info(<span class="string">"MyFeignRequestInterceptor current thread group: &#123;&#125;, name: &#123;&#125; , id: &#123;&#125;"</span>, threadGroup.getName(), thread.getName(), thread.getId());</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹æ—¥å¿—æ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">RequestInterceptor current thread name: XNIO-5 task-1 , id: 187</span><br><span class="line">MyFeignRequestInterceptor current thread name: hystrix-bling-share-xdfproducer-1 , id: 192</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°åœ¨<code>RequestInterceptor</code>æ‹¦æˆªç±»ä¸­çš„çº¿ç¨‹å’Œ<code>MyFeignRequestInterceptor</code>æ‹¦æˆªç±»ä¸­çš„çº¿ç¨‹å¹¶ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿæ²¡æœ‰çˆ¶å­å…³ç³»ï¼Œæ‰€ä»¥åœ¨Feignçš„æ‹¦æˆªç±»æ˜¯æ— æ³•è·å–åˆ°traceIdã€‚</p>
<p><strong>æ‰€ä»¥ç°åœ¨çš„é—®é¢˜æ˜¯å¦‚ä½•è§£å†³ä¸åŒçº¿ç¨‹ä¹‹é—´æ•°æ®å…±äº«çš„é—®é¢˜</strong>ï¼Ÿ</p>
<hr>
<p>åˆ†æï¼šè™½ç„¶å½“å‰è¯·æ±‚çš„ä¸¤ä¸ªæ‹¦æˆªç±»<strong>ä¸å¤„äºåŒä¸€ä¸ªçº¿ç¨‹å†…ï¼Œä½†å´æ˜¯å¤„äºåŒä¸€ä¸ªè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé‚£æˆ‘ä»¬åªè¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æŠŠå˜é‡è®¾ç½®åˆ°ä¸€ä¸ª<code>request scope</code>çš„å…±äº«å˜é‡</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å‘¨æœŸå†…æ— è®ºæœ‰å¤šå°‘ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬è®¾ç½®çš„ä¿¡æ¯å°±éƒ½å¯ä»¥éšæ—¶è¢«è¿™æ¬¡è¯·æ±‚å†…çš„çº¿ç¨‹è·å–åˆ°ï¼Œä¹Ÿå°±é—´æ¥åœ°å®ç°äº†çº¿ç¨‹é—´çš„ä¿¡æ¯å…±äº«ã€‚</p>
<h3 id="HystrixRequestVariableDefault"><a href="#HystrixRequestVariableDefault" class="headerlink" title="HystrixRequestVariableDefault"></a>HystrixRequestVariableDefault</h3><p>â€œDefault implementation of  HystrixRequestVariable. Similar to ThreadLocal but scoped at the user request level. Context is managed via HystrixRequestContextâ€</p>
<p><code>HystrixRequestVariableDefault</code>ç±»æ˜¯Hystrix ConcurrencyåŒ…æä¾›çš„ä¸€ä¸ªç±»ï¼Œç±»ä¼¼äº<code>ThreadLocal</code>ï¼Œ<strong>ä½†æ˜¯å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç”¨æˆ·è¯·æ±‚çº§åˆ«çš„</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥å°è¯•ç”¨å®ƒæ¥è§£å†³åŒä¹‰è¯è¯·æ±‚çº¿ç¨‹é—´æ•°æ®å…±äº«çš„é—®é¢˜ã€‚</p>
<p>åœ¨ä½¿ç”¨HystrixRequestVariableDefaultç±»çš„æ—¶å€™è¦æ³¨æ„ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ•´ä¸ªè¯·æ±‚èŒƒå›´å†…çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªå…¨å±€çš„å˜é‡ï¼ŒåŒæ—¶è¦æ³¨æ„<code>Context is managed via HystrixRequestContext</code>è¿™å¥è¯ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦ä½¿ç”¨HystrixRequestContext.initializeContext()æ¥åˆå§‹åŒ–ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡ºNPEã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªå…¨å±€çš„<code>HystrixRequestVariableDefault&lt;String&gt;</code>å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HystrixCredentialsContext</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> HystrixRequestVariableDefault&lt;String&gt; HYSTRIX_REQUEST_VARIABLE_DEFAULT =</span><br><span class="line">            <span class="keyword">new</span> HystrixRequestVariableDefault&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HystrixRequestVariableDefault&lt;String&gt; <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HYSTRIX_REQUEST_VARIABLE_DEFAULT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰å®Œå…¨å±€å˜é‡ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨è¿‡æ»¤å™¨æ¥å®ç°è¯·æ±‚çš„è¿‡æ»¤ï¼Œè®¾ç½®traceIdã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HystrixRequestContextEnablerFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(HystrixRequestContextEnablerFilter.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HystrixRequestContext context = HystrixRequestContext.initializeContext();</span><br><span class="line">        HttpServletRequest httpRequest = (HttpServletRequest) request;</span><br><span class="line">        String traceId = httpRequest.getHeader(LOG_TRACE_ID);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(traceId))&#123;</span><br><span class="line">            traceId = UuidUtil.get32UUID();</span><br><span class="line">        &#125;</span><br><span class="line">          MDC.put(LOG_TRACE_ID, traceId);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            HystrixCredentialsContext.getInstance().set(traceId);</span><br><span class="line">            log.info(<span class="string">"Set traceId successful: &#123;&#125;"</span>, traceId);</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            MDC.clear();</span><br><span class="line">            context.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œç»è¿‡è¿™ä¸€ç•ªæ”¹é€ ï¼Œæˆ‘ä»¬å†æ¥å°è¯•åœ¨<code>MyFeignRequestInterceptor</code>ç±»ä¸­è·å–log_trace_id.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFeignRequestInterceptor</span> <span class="keyword">implements</span> <span class="title">RequestInterceptor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(MyFeignRequestInterceptor.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(RequestTemplate template)</span> </span>&#123;</span><br><span class="line">           <span class="comment">// è¿™é‡Œä¸å†ä½¿ç”¨MDCæ¥è·å–äº†</span></span><br><span class="line">            String traceId = HystrixCredentialsContext.getInstance().get();</span><br><span class="line">            log.info(<span class="string">"print current thread logTraceId: &#123;&#125;"</span>, traceId);    </span><br><span class="line">           <span class="keyword">if</span> (StringUtils.isNotBlank(traceId))&#123;</span><br><span class="line">            template.header(LOG_TRACE_ID, traceId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ—¥å¿—ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°è¿™æ¬¡ç¡®å®èƒ½å¤Ÿæ‹¿åˆ°<code>traceId</code>äº†ï¼Œè¯´æ˜æˆ‘ä»¬é‡‡ç”¨<code>HystrixRequestVariableDefault</code>æ¥è§£å†³çº¿ç¨‹é—´çš„æ•°æ®å…±äº«æ˜¯æˆåŠŸçš„ã€‚</p>
<h5 id="ä½†æ˜¯ç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡è§£å†³ï¼šä¸ºä»€ä¹ˆæœ‰çš„æœåŠ¡ä¸é‡‡ç”¨HystrixRequestVariableDefaultæ¥å®ç°æ•°æ®å…±äº«ä¹Ÿèƒ½æ‹¿åˆ°traceIdå‘¢ï¼Ÿ"><a href="#ä½†æ˜¯ç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡è§£å†³ï¼šä¸ºä»€ä¹ˆæœ‰çš„æœåŠ¡ä¸é‡‡ç”¨HystrixRequestVariableDefaultæ¥å®ç°æ•°æ®å…±äº«ä¹Ÿèƒ½æ‹¿åˆ°traceIdå‘¢ï¼Ÿ" class="headerlink" title="ä½†æ˜¯ç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡è§£å†³ï¼šä¸ºä»€ä¹ˆæœ‰çš„æœåŠ¡ä¸é‡‡ç”¨HystrixRequestVariableDefaultæ¥å®ç°æ•°æ®å…±äº«ä¹Ÿèƒ½æ‹¿åˆ°traceIdå‘¢ï¼Ÿ"></a>ä½†æ˜¯ç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡è§£å†³ï¼š<strong>ä¸ºä»€ä¹ˆæœ‰çš„æœåŠ¡ä¸é‡‡ç”¨<code>HystrixRequestVariableDefault</code>æ¥å®ç°æ•°æ®å…±äº«ä¹Ÿèƒ½æ‹¿åˆ°traceIdå‘¢</strong>ï¼Ÿ</h5><p>ä¸ºäº†è¡¨è¿°çš„æ–¹ä¾¿ï¼Œè¿™é‡Œä½¿ç”¨Aæ¥ä»£è¡¨<strong>ä¸é‡‡ç”¨</strong><code>HystrixRequestVariableDefault</code>ä¹Ÿèƒ½è·å–åˆ°MDCçš„traceIDçš„å¾®æœåŠ¡ï¼ŒBæ¥ä»£è¡¨<strong>é‡‡ç”¨</strong>è¿™ç§æ–¹å¼çš„å¾®æœåŠ¡ã€‚</p>
<p>ä¸ºäº†å®šä½é—®é¢˜ï¼Œæˆ‘ä»¬åˆ†åˆ«åœ¨ä¸¤ä¸ªå¾®æœåŠ¡çš„è¯·æ±‚è¿‡æ»¤å™¨å’ŒFeignè°ƒç”¨æ‹¦æˆªå™¨ä¸­æ‰“å°å½“å‰çº¿ç¨‹çš„<strong>çº¿ç¨‹ç»„åç§°ã€çº¿ç¨‹åã€çº¿ç¨‹ID</strong>ä¿¡æ¯æ¥å¸®åŠ©å®šä½é—®é¢˜ï¼Œä¸‹é¢æ˜¯æ—¥å¿—æ‰“å°:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AæœåŠ¡ï¼š</span><br><span class="line"> main, thread name: XNIO-5 task-1, thread id: 185</span><br><span class="line"> main, thread name: XNIO-5 task-1, thread id: 185</span><br><span class="line"></span><br><span class="line">BæœåŠ¡ï¼š</span><br><span class="line">main, thread name: XNIO-5 task-1, thread id: 177</span><br><span class="line">main, thread name: hystrix-B-1, thread id: 182</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šè¾¹æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒAæœåŠ¡åœ¨è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨ä¸­å‡ä¸ºåŒä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥æ‰èƒ½é€šè¿‡MDCè·å–åˆ°traceIdï¼Œè€ŒBæœåŠ¡å¹¶éåŒä¸€ä¸ªçº¿ç¨‹ï¼Œè‡ªç„¶æ— æ³•é€šè¿‡MDCæ‹¿åˆ°ã€‚</p>
<p><strong>é‚£ä¹ˆç°åœ¨é—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆAæœåŠ¡ä½¿ç”¨åŒä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™BæœåŠ¡å´æ˜¯ä¸åŒçš„çº¿ç¨‹</strong>ï¼Ÿï¼Ÿ</p>
<p>é€šè¿‡å¯¹æ¯”Aå’ŒBçš„é…ç½®ï¼Œå‘ç°åœ¨Bçš„æœåŠ¡ä¸­é…ç½®äº†<code>feign.hystrix.enabled=true</code>ï¼Œè€ŒAæœåŠ¡å´æ²¡æœ‰é…ç½®ï¼Œç»è¿‡éªŒè¯ä¹‹åç¡®è®¤æ˜¯å› ä¸ºæ­¤é…ç½®å¯¼è‡´Aå’ŒBåœ¨è°ƒç”¨å¾®æœåŠ¡æ—¶ï¼Œ<strong>é‡‡ç”¨äº†ä¸åŒçš„çº¿ç¨‹ç­–ç•¥</strong>ã€‚</p>
<h3 id="Hystrix-feignè¯·æ±‚æµç¨‹"><a href="#Hystrix-feignè¯·æ±‚æµç¨‹" class="headerlink" title="Hystrix feignè¯·æ±‚æµç¨‹"></a>Hystrix feignè¯·æ±‚æµç¨‹</h3><p>åœ¨ä¸Šè¾¹BæœåŠ¡é…ç½®äº†<code>feign.hystrix.enabled=true</code>å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´BæœåŠ¡çš„Feignè°ƒç”¨å¼€å¯äº†ç†”æ–­çš„çš„åŠŸèƒ½ï¼Œå› ä¸ºå¼€å¯äº†ç†”æ–­ï¼Œæ‰€ä»¥å‘èµ·è¿œç¨‹è°ƒç”¨çš„æ—¶å€™Hystrixé‡å¯æ ¹æ®å½“å‰æ‰€è°ƒç”¨çš„å¾®æœåŠ¡ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹å»å¤„ç†è¿œç¨‹è°ƒç”¨ï¼Œä¸‹è¾¹æ˜¯Feignå‘èµ·è¿œç¨‹è°ƒç”¨çš„å®Œæ•´æµç¨‹ã€‚</p>
<p><img src="https://res.cloudinary.com/leon824/image/upload/v1595245562/feign2_upi4wh.png" width="70%" height="70%"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œç¬¬1æ­¥å°±æ˜¯é€šè¿‡JDKåŠ¨æ€ç”Ÿæˆä»£ç†ç±»ä»£ç†ç±»ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯ä¸‹è¾¹è¿™æ®µä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(<span class="keyword">final</span> Object proxy, <span class="keyword">final</span> Method method, <span class="keyword">final</span> Object[] args)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">      .....</span><br><span class="line">    HystrixCommand&lt;Object&gt; hystrixCommand = <span class="keyword">new</span> HystrixCommand&lt;Object&gt;(setterMethodMap.get(method)) &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> Object <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> HystrixInvocationHandler.<span class="keyword">this</span>.dispatch.get(method).invoke(args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">          <span class="keyword">throw</span> (Error) t;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    .......</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­æœ€é‡è¦çš„ä¸€è¡Œä»£ç å°±æ˜¯<code>HystrixInvocationHandler.this.dispatch.get(method).invoke(args);</code>å®ƒå°†ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„<code>hystrixCommand</code>ï¼ŒåŒæ—¶å¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚å…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒè¿™é‡Œ<a href="https://www.programmersought.com/article/68091584946/" target="_blank" rel="noopener">Hystrix feign thread model</a>ã€‚å› ä¸ºç¬¬ä¸€æ­¥å°±åˆ›å»ºäº†æ–°çš„çº¿ç¨‹ï¼Œæ‰€ä»¥åœ¨ä¸Šå›¾ä¸­ç¬¬äº”æ­¥æ‹¦æˆªçš„æ—¶å€™ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹ã€‚</p>
<p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¹Ÿå°±èƒ½è§£é‡Šä¸ºä»€ä¹ˆAæœåŠ¡ä½¿ç”¨äº†åŒä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™BæœåŠ¡å´æ˜¯ä¸åŒçš„çº¿ç¨‹ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://www.programmersought.com/article/68091584946/" target="_blank" rel="noopener">Hystrix feign thread model</a></li>
<li><a href="https://juejin.im/post/5e79bce5e51d4527235b8878" target="_blank" rel="noopener">SpringBoot+MDCå®ç°å…¨é“¾è·¯è°ƒç”¨æ—¥å¿—è·Ÿè¸ª</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1484945" target="_blank" rel="noopener">åœ¨Javaé¡¹ç›®ä¸­ä½¿ç”¨traceIdè·Ÿè¸ªè¯·æ±‚å…¨æµç¨‹æ—¥å¿—</a></li>
<li><a href="https://programming.vip/docs/spring-cloud-openfeign-source-code-analysis.html" target="_blank" rel="noopener">Spring Cloud OpenFeign source code analysis</a></li>
<li><a href="https://juejin.im/post/5df19a4751882512816014e2" target="_blank" rel="noopener">Feignæºç åˆ†æ:è®°åˆæ¬¡ä½¿ç”¨Feignè¸©çš„ä¸€äº›å‘</a></li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
</search>
