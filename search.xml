<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[å•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜]]></title>
    <url>%2F2018%2F09%2F07%2F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[å•ä¾‹æ¨¡å¼å•ä¾‹æ¨¡å¼æ˜¯æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ï¼Œåˆ†ä¸ºä¸¤ç§ï¼šæ‡’æ±‰æ¨¡å¼ã€æ¶æ±‰æ¨¡å¼ æ¶æ±‰æ¨¡å¼åœ¨å±žæ€§ä¸­ç›´æŽ¥åˆ›å»ºå¯¹è±¡ï¼Œç„¶åŽåœ¨æ–¹æ³•ä¸­è¿”å›žã€‚ 12345678910public class Singletom &#123; private static Singletom ourInstance = new Singletom(); public static Singletom getInstance() &#123; return ourInstance; &#125; private Singletom() &#123; &#125;&#125; ä¸Šé¢ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œå› ä¸ºåŠ è½½ç±»çš„æ—¶å€™å°±ä¼šåˆ›å»ºSingletomçš„å¯¹è±¡ï¼Œç„¶åŽæ‰€æœ‰çº¿ç¨‹æ¥èŽ·å–çš„æ—¶å€™éƒ½æ˜¯è¿”å›žè¿™ä¸ªå¯¹è±¡ã€‚ æ‡’æ±‰æ¨¡å¼åˆšå¼€å§‹å¹¶ä¸ç›´æŽ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯åœ¨éœ€è¦çš„æ—¶å€™åœ¨åˆ›å»ºï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ 1234567891011121314public class OtherSingleton &#123; private static OtherSingleton instance; private OtherSingleton() &#123;&#125; public static OtherSingleton getInstance()&#123; if (instance == null)&#123; â€”â€”â€”â€”1 instance = new OtherSingleton(); â€”â€”â€”â€”â€”2 return instance; &#125; return instance; &#125;&#125; è¿™ä¸ªæ—¶å€™æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå‡è®¾ä¸¤ä¸ªçº¿ç¨‹ä¸€å‰ä¸€åŽæ¥æ‰§è¡ŒgetInstance()æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹Aæ­£åœ¨æ‰§è¡Œ2è¿™ä¸ªä½ç½®ï¼Œç”±äºŽnewå¯¹è±¡å¹¶éžä¸€ä¸ªåŽŸå­æ“ä½œï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥ï¼š 1) åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ã€‚ 2) è°ƒç”¨æž„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡ã€‚ 3ï¼‰å°†instanceå¼•ç”¨æŒ‡å‘å †å†…å­˜ç©ºé—´çš„èµ·å§‹åœ°å€ï¼ˆæ­¤æ—¶instanceæ‰ä¸ºéžnullï¼‰ã€‚ è‹¥å°†ä¸Šè¾¹ä¸‰æ­¥ç”¨ä¼ªä»£ç æ¥è¡¨ç¤ºå°±æ˜¯ä¸‹è¾¹è¿™æ ·ï¼š 123memory = allocate(); // 1ã€åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´ctorInstance(memory); // 2ã€åˆå§‹åŒ–å¯¹è±¡instance = memoryï¼› //3ã€è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ å®žé™…ä¸Šåœ¨ä¸Šè¾¹çš„ä¼ªä»£ç ä¸­2å’Œ3ä¹‹é—´ï¼Œå¯èƒ½ä¼šè¢«é‡æŽ’åºï¼ˆåœ¨ä¸€äº›JITç¼–è¯‘å™¨ä¸Šï¼Œè¿™ç§é‡æŽ’åºä¹Ÿæ˜¯çœŸå®žå‘ç”Ÿçš„ï¼‰ ï¼Œæ ¹æ®ã€Šjavaè¯­è¨€è§„èŒƒã€‹ï¼Œæ‰€æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œjavaç¨‹åºæ—¶å¿…é¡»éµå®ˆintra-thread semantics,intra-thread semanticsä¿è¯æŽ’åºä¸ä¼šæ”¹å˜å•çº¿ç¨‹çš„æ‰§è¡Œç»“æžœã€‚æ¢å¥è¯è¯´ï¼Œintra-thread semanticså…è®¸é‚£äº›åœ¨å•çº¿ç¨‹ä¸­ä¸æ”¹å˜æ‰§è¡Œç»“æžœçš„é‡æŽ’åºï¼Œè¿™æ ·ä¼šæé«˜ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚ è¿™ä¸ªæ—¶å€™Açº¿ç¨‹æ‰§è¡Œåˆšåˆšæ‰æ‰§è¡Œåˆ°åˆ›å»ºå¯¹è±¡çš„ç¬¬äºŒæ­¥ï¼Œçº¿ç¨‹Bå°±æ‰§è¡Œåˆ°ä»£ç 1å¤„ï¼Œæ­¤æ—¶åˆ¤æ–­å‡ºinstanceä¸ºnullï¼Œç„¶åŽè¿›å…¥å¯¹è±¡åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ è¿™ä¸ªæ—¶å€™å°±å‡ºçŽ°é—®é¢˜äº†ï¼Œå•ä¾‹æ¨¡å¼æ­¤æ—¶åˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ã€‚è¿èƒŒäº†å•ä¾‹æ¨¡å¼çš„åˆè¡·ã€‚ åŒé‡é”æ£€æŸ¥123456789101112131415161718public class OtherSingleton &#123; private static OtherSingleton instance; private OtherSingleton() &#123;&#125; public static OtherSingleton getInstance()&#123; if (instance == null)&#123; â€”â€”â€”â€”1 synchronized (OtherSingleton.class)&#123; if (instance == null)&#123; â€”â€”â€”â€”2 instance = new OtherSingleton(); â€”â€”â€”â€”3 return instance; &#125; &#125; &#125; return instance; &#125;&#125; è¿™é‡ŒåŠ åŒé‡æ£€æŸ¥é”å°±æ˜¯åœ¨åŒæ­¥ä»£ç å‰å’ŒåŒæ­¥ä»£ç åŽè¾¹éƒ½æ£€æŸ¥å®žä¾‹æ˜¯å¦ä¸ºç©ºã€‚å¦‚æžœä»…ä»…åœ¨åŒæ­¥å—å¤–è¾¹æ£€æŸ¥ï¼Œè€Œåœ¨åŒæ­¥å—å†…ä¸æ£€æŸ¥ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥äº†åŒæ­¥å—å¤–çš„ä»£ç ï¼Œåˆ™å¯èƒ½ç”Ÿæˆå¤šä¸ªå®žä¾‹ã€‚ ä¸Šè¾¹ä»£ç çœ‹èµ·æ¥è¿˜ä¸é”™ï¼Œä½†æ˜¯ä»–è¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚é—®é¢˜å‡ºçŽ°åœ¨ä»£ç 3å¤„ï¼Œè¿™ä¸ªåœ°æ–¹å¹¶éžæ˜¯åŽŸå­æ“ä½œï¼Œå¦‚ä¸Šè¾¹çš„æè¿°åˆ†ä¸ºä¸‰æ­¥ã€‚ç”±äºŽcpuä¸ºäº†æé«˜æ‰§è¡Œæ•ˆçŽ‡å¯èƒ½ä¼šå°†è¿™ä¸ªä¸‰æ­¥åˆ†ä¸º1-2-3æˆ–è€…1-3-2ã€‚ å¦‚æžœçº¿ç¨‹Aæ‰§è¡Œåˆ°ä»£ç 3å¤„çš„1-3æ­¥ï¼Œæ­¤æ—¶instanceå·²ç»ä¸ä¸ºnulläº†ï¼Œä½†æ˜¯åˆ›å»ºå¯¹è±¡çš„ç¬¬äºŒéƒ¨å´å¹¶æ²¡æœ‰æ‰§è¡Œã€‚è€Œæ­¤æ—¶çº¿ç¨‹Bè¿›å…¥åˆ°æ–¹æ³•çš„1å¤„ï¼Œåˆ¤æ–­instanceæ˜¯å¦ä¸ºç©ºï¼Œæ­¤æ—¶å·²ç»ä¸ä¼šç©ºäº†ï¼Œä½†æ˜¯è¿”å›žçš„å¯¹è±¡å´å¹¶æ²¡æœ‰åˆå§‹åŒ–ï¼Œé¡ºç†æˆç« çš„æŠ¥é”™ã€‚ã€‚ è¿™é‡Œçš„å…³é”®æ˜¯instanceå¯¹è±¡è¿˜æ²¡æœ‰åˆå§‹åŒ–æ‰§è¡Œç¬¬äºŒæ­¥ï¼Œå°±æ‰§è¡Œçš„ç¬¬ä¸‰æ­¥ï¼Œå¯¼è‡´çº¿ç¨‹Bæ‹¿åˆ°ä¸€ä¸ªç©ºçš„å¯¹è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è®©cpuåœ¨æ‰§è¡Œåˆ›å»ºå¯¹è±¡æ—¶ç¦æ­¢é‡æŽ’åºå°±èƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚æ˜Žæ˜¾éœ€è¦ä½¿ç”¨volatileå…³é”®å­—æ¥ç¦æ­¢é‡æŽ’åºã€‚ 123456789101112131415161718public class OtherSingleton &#123; private volatile static OtherSingleton instance; private OtherSingleton() &#123;&#125; public static OtherSingleton getInstance()&#123; if (instance == null)&#123; synchronized (OtherSingleton.class)&#123; if (instance == null)&#123; instance = new OtherSingleton(); return instance; &#125; &#125; &#125; return instance; &#125;&#125; è¿™é‡Œåˆ©ç”¨çš„æ˜¯volatileçš„ç¦æ­¢é‡æŽ’åºçš„æ€§è´¨ï¼Œåœ¨volatileå˜é‡çš„èµ‹å€¼æ“ä½œåŽè¾¹ä¼šåŠ ä¸Šä¸€ä¸ªå†…å­˜å±éšœï¼Œè¯»æ“ä½œä¸ä¼šå‡ºçŽ°åœ¨å†…å­˜å±éšœå‰è¾¹ï¼Œæ‰€ä»¥å–æ“ä½œ*å¿…é¡»æ˜¯1-2-3æˆ–è€…1-3-2ä¹‹åŽï¼Œä¸å­˜åœ¨1-3**ä¹‹åŽå°±è¯»å–åˆ°ã€‚ä»Žhappen-beforeåŽŸåˆ™æ¥çœ‹ï¼Œå°±æ˜¯å¯¹äºŽä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œéƒ½å…ˆè¡Œå‘ç”ŸäºŽåŽé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼ˆè¿™é‡Œçš„â€œåŽé¢â€æ˜¯æ—¶é—´ä¸Šçš„å…ˆåŽé¡ºåºï¼‰ã€‚ å‚è€ƒ å¦‚ä½•æ­£ç¡®åœ°å†™å‡ºå•ä¾‹æ¨¡å¼ ã€Šjavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼è°ƒåº¦ä¸­å¿ƒ]]></title>
    <url>%2F2018%2F09%2F06%2F%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘å…¬å¸çš„æœåŠ¡å·²ç»ä»Žä¼ ç»ŸtomcatæœåŠ¡æ‹†åˆ†æˆäº†å¾®æœåŠ¡ï¼Œä½¿å¾—å„ä¸ªåŽŸæœ¬è‡ƒè‚¿çš„ä¸šåŠ¡å˜å¾—è½»é‡ã€æ˜“ç»´æŠ¤ï¼Œä½†æ˜¯ä¹Ÿå¸¦äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ç”Ÿäº§ã€æµ‹è¯•çŽ¯å¢ƒä¸­çš„å®šæ—¶ä»»åŠ¡ç®¡ç†å°±æˆäº†é—®é¢˜ï¼Œç”±äºŽæœåŠ¡å™¨å˜å¾—æ›´å¤šï¼Œå®šæ—¶ä»»åŠ¡å˜å¾—åˆ†æ•£ï¼Œå„ä¸ªçŽ¯å¢ƒå®¹æ˜“å˜å¾—æ··æ‚ã€ç»´æŠ¤æˆæœ¬å‡é«˜ä¸”å®¹æ˜“å‡ºé”™ï¼ŒåŒæ—¶æ— æ³•çŸ¥é“è¿™ä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ˜¯å¦æˆåŠŸï¼Œåªæœ‰å½“æœåŠ¡å‡ºçŽ°äº†é—®é¢˜æ‰èƒ½åæŽ¨å®šæ—¶ä»»åŠ¡å‡ºçŽ°äº†é—®é¢˜ã€‚ ä½¿ç”¨ç³»ç»Ÿçº§å®šæ—¶crontabå­˜åœ¨çš„ä¸»è¦é—®é¢˜ ä»»åŠ¡çš„æ—¶é—´ç²’åº¦ä¸å¤Ÿå°ï¼ˆåªèƒ½æ˜¯åˆ†é’Ÿçº§åˆ«ä»¥ä¸Šï¼‰ å½“ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰é€šçŸ¥ï¼Œä¸èƒ½åŠæ—¶å‘çŽ°å®šæ—¶ä»»åŠ¡æ˜¯å¦æ‰§è¡Œï¼Œåªæœ‰å½“å‡ºçŽ°å¼‚å¸¸çš„æ—¶å€™æ‰èƒ½å‘çŽ°å®šæ—¶çš„æ‰§è¡Œå‡ºçŽ°äº†é—®é¢˜ã€‚ ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹æ²¡æœ‰æ—¥å¿—è®°å½•ï¼Œå‡ºçŽ°çš„é—®é¢˜ä¸å®¹æ˜“å®šä½ æ²¡æœ‰å¤±è´¥å¤„ç†ç­–ç•¥ï¼ˆå¤±è´¥é‡è¯•ã€å¤±è´¥å‘Šè­¦ï¼‰ æ²¡æœ‰é˜»å¡žç­–ç•¥ ä¾èµ–è¿ç»´äººå‘˜ï¼Œä½Žæ•ˆ é‚£ä¹ˆä¸Šè¾¹è¿™äº›é—®é¢˜è¦æ€Žæ ·è§£å†³å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼è°ƒåº¦ç³»ç»Ÿæ¥å½»åº•è§£å†³è¿™äº›ç—›ç‚¹ã€‚ åˆ†å¸ƒå¼è°ƒåº¦ç³»ç»Ÿ TBScheduleï¼šé˜¿é‡Œæ—©æœŸå¼€æºçš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿã€‚ä»£ç ç•¥é™ˆæ—§ï¼Œä½¿ç”¨timerè€Œéžçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡è°ƒåº¦ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œtimeråœ¨å¤„ç†å¼‚å¸¸çŠ¶å†µæ—¶æ˜¯æœ‰ç¼ºé™·çš„ã€‚è€Œä¸”TBScheduleä½œä¸šç±»åž‹è¾ƒä¸ºå•ä¸€ï¼Œåªèƒ½æ˜¯èŽ·å–/å¤„ç†æ•°æ®ä¸€ç§æ¨¡å¼ã€‚è¿˜æœ‰å°±æ˜¯æ–‡æ¡£ç¼ºå¤±æ¯”è¾ƒä¸¥é‡ Saturnï¼šæ˜¯å”¯å“ä¼šè‡ªä¸»ç ”å‘çš„åˆ†å¸ƒå¼çš„å®šæ—¶ä»»åŠ¡çš„è°ƒåº¦å¹³å°ï¼ŒåŸºäºŽå½“å½“çš„elastic-job ç‰ˆæœ¬1å¼€å‘ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå¥½çš„éƒ¨ç½²åˆ°dockerå®¹å™¨ä¸Šã€‚ elastic-jobï¼šå½“å½“å¼€å‘çš„å¼¹æ€§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼ŒåŠŸèƒ½ä¸°å¯Œå¼ºå¤§ï¼Œé‡‡ç”¨zookeeperå®žçŽ°åˆ†å¸ƒå¼åè°ƒï¼Œå®žçŽ°ä»»åŠ¡é«˜å¯ç”¨ä»¥åŠåˆ†ç‰‡ï¼Œç›®å‰æ˜¯ç‰ˆæœ¬2.15ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒäº‘å¼€å‘ xxl-job: æ˜¯å¤§ä¼—ç‚¹è¯„å‘˜å·¥å¾é›ªé‡ŒäºŽ2015å¹´å‘å¸ƒçš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œæ˜¯ä¸€ä¸ªè½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æž¶ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±• åœ¨ä¸Šè¾¹è¿™å‡ ç§è§£å†³æ–¹æ¡ˆä¸­ï¼Œä»¥xxl-jobå’Œelastic-jobç”¨çš„æ›´å¤šã€æ–‡æ¡£ç›¸å¯¹å®Œå–„ã€‚ å…±åŒç‚¹ï¼š E-Jobå’ŒX-jobéƒ½æœ‰å¹¿æ³›çš„ç”¨æˆ·åŸºç¡€å’Œå®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£ï¼Œéƒ½èƒ½æ»¡è¶³å®šæ—¶ä»»åŠ¡çš„åŸºæœ¬åŠŸèƒ½éœ€æ±‚ã€‚ ä¸åŒç‚¹ï¼šX-Job ä¾§é‡çš„ä¸šåŠ¡å®žçŽ°çš„ç®€å•å’Œç®¡ç†çš„æ–¹ä¾¿ï¼Œå­¦ä¹ æˆæœ¬ç®€å•ï¼Œå¤±è´¥ç­–ç•¥å’Œè·¯ç”±ç­–ç•¥ä¸°å¯Œã€‚æŽ¨èä½¿ç”¨åœ¨â€œç”¨æˆ·åŸºæ•°ç›¸å¯¹å°‘ï¼ŒæœåŠ¡å™¨æ•°é‡åœ¨ä¸€å®šèŒƒå›´å†…â€çš„æƒ…æ™¯ä¸‹ä½¿ç”¨E-Job å…³æ³¨çš„æ˜¯æ•°æ®ï¼Œå¢žåŠ äº†å¼¹æ€§æ‰©å®¹å’Œæ•°æ®åˆ†ç‰‡çš„æ€è·¯ï¼Œä»¥ä¾¿äºŽæ›´å¤§é™åº¦çš„åˆ©ç”¨åˆ†å¸ƒå¼æœåŠ¡å™¨çš„èµ„æºã€‚ä½†æ˜¯å­¦ä¹ æˆæœ¬ç›¸å¯¹é«˜äº›ï¼ŒæŽ¨èåœ¨â€œæ•°æ®é‡åºžå¤§ï¼Œä¸”éƒ¨ç½²æœåŠ¡å™¨æ•°é‡è¾ƒå¤šâ€æ—¶ä½¿ç”¨ æ ¹æ®æˆ‘ä»¬ä¸šåŠ¡çš„æ•°æ®é‡ã€ç”¨æˆ·æ•°é‡å¯ä»¥é‡‡ç”¨xxl-jobå¿«é€Ÿå®žçŽ°åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒã€‚ xxl-jobä¸‹è½½ã€è¿è¡Œé¦–å…ˆæˆ‘ä»¬å…ˆåŽ»githubä¸­ä¸‹è½½xxl-jobæœ€æ–°çš„ä»£ç  1&gt; git clone https://github.com/xuxueli/xxl-job.git ç„¶åŽåœ¨ideaä¸­åŠ è½½è¿™ä¸ªæ¨¡å— æ³¨æ„ä¸Šè¾¹çš„ä¸‰ä¸ªé»„è‰²æ¡†åœˆèµ·æ¥çš„éƒ¨åˆ†ï¼Œä»Žä¸Šå¾€ä¸‹ï¼š 1ã€tables_xxl_job.sqlè¿™ä¸ªæ˜¯æˆ‘ä»¬åœ¨åº“é‡Œè¾¹åˆ›å»ºçš„åº“-è¡¨ï¼Œæ‰§è¡Œä¹‹åŽä¼šæœ‰16å¼ è¡¨è¢«åˆ›å»º 1&gt; mysql -uroot -p &lt; tables_xxl_job.sql 2ã€xxl-job-adminå°±æ˜¯è°ƒåº¦ä¸­å¿ƒï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹resourcesé‡Œè¾¹çš„xxl-job-admin.propertiesæ–‡ä»¶ä¸€äº›å­—æ®µ 123456789101112131415161718192021 ### xxl-job db (use &amp;amp; replace &amp; in xml)xxl.job.db.driverClass=com.mysql.jdbc.Driverxxl.job.db.url=jdbc:mysql://localhost:3306/xxl-job?useUnicode=true&amp;characterEncoding=UTF-8xxl.job.db.user=rootxxl.job.db.password=123456### xxl-job emailxxl.job.mail.host=smtp.163.comxxl.job.mail.port=25xxl.job.mail.username=ovono802302@163.comxxl.job.mail.password=asdfzxcvxxl.job.mail.sendNick=ã€Šä»»åŠ¡è°ƒåº¦å¹³å°XXL-JOBã€‹### xxl-job loginxxl.job.login.username=adminxxl.job.login.password=123456### xxl-job, access tokenxxl.job.accessToken=### xxl-job, i18n (default empty as chinese, "en" as english)xxl.job.i18n= é…ç½®å®Œæˆä¹‹åŽå°±å¯ä»¥å¯åŠ¨äº†ã€‚ 3ã€ ç¬¬ä¸‰ä¸ªæ˜¯xxl-job-executor-sample-springbootè¿™ä¸ªæ˜¯xxl-jobæä¾›çš„æ‰§è¡Œå™¨ä¸­çš„ä¸€ç§ï¼Œå¦å¤–è¿˜æ”¯æŒspringç­‰ç­‰ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†ç›¸åº”å‚æ•°ä¿®æ”¹æˆå’Œè‡ªå·±çŽ¯å¢ƒåŒ¹é…çš„å‚æ•°ã€‚ 123456789101112131415161718192021# web portserver.port=8081# log configlogging.config=classpath:logback.xml### xxl-job admin address list, such as "http://address" or "http://address01,http://address02"xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin### xxl-job executor addressxxl.job.executor.appname=xxl-job-executor-samplexxl.job.executor.ip=xxl.job.executor.port=9999### xxl-job, access tokenxxl.job.accessToken=### xxl-job log pathxxl.job.executor.logpath=/Users/leon/work/logs/xxl-job/jobhandler### xxl-job log retention daysxxl.job.executor.logretentiondays=-1 ä¸Šè¾¹æ‰§è¡Œå™¨æ˜¯å…·ä½“æ‰§è¡Œä»»åŠ¡çš„æ¨¡å—ã€‚ä¸‹è¾¹å°±æ¥å…·ä½“è®²è®²xxl-jobæ•´ä½“ä½¿ç”¨æž¶æž„å›¾ã€‚ ä¸Šå›¾ä¸­è™šçº¿åŒ…å›´èµ·æ¥çš„ä¸¤ä¸ªéƒ¨åˆ†å°±æ˜¯xxl-jobæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œä¸€ä¸ªå«è°ƒåº¦ä¸­å¿ƒï¼Œä¸€ä¸ªå«æ‰§è¡Œå™¨ï¼ˆæˆ‘æ›´æ„¿æ„å«ä»–æ‰§è¡Œå™¨ç¾¤ï¼‰ã€‚å…¶ä¸­è°ƒåº¦ä¸­å¿ƒè´Ÿè´£æ‰€æœ‰æ‰§è¡Œå™¨ç¾¤çš„ç®¡ç†ï¼Œå„ä¸ªæ‰§è¡Œå™¨ç¾¤çš„ä»»åŠ¡åˆ†å‘ç®¡ç†ï¼Œæ—¥å¿—çš„æŸ¥è¯¢ç­‰ç­‰åŠŸèƒ½ï¼Œè€Œæ‰§è¡Œå™¨è´Ÿè´£å…·ä½“æ‰§è¡Œä»»åŠ¡ã€‚è€Œä¸­é—´çš„é€šè®¯ç»„ä»¶åˆ™æ˜¯è‡ªç ”çš„RPCç»„ä»¶ï¼Œç”Ÿäº§ä¸šåŠ¡æ‰§è¡Œå™¨å°±ç›¸å½“äºŽæ˜¯ç”Ÿäº§çŽ¯å¢ƒçš„æ‰§è¡Œå™¨ç¾¤ï¼Œæµ‹è¯•ä¸šåŠ¡æ‰§è¡Œå™¨ç›¸å½“äºŽæµ‹è¯•çŽ¯å¢ƒçš„æ‰§è¡Œå™¨ç¾¤ã€‚è¿™æ ·å°±èƒ½æ»¡è¶³å°†å„ä¸ªçŽ¯å¢ƒé€šè¿‡æ‰§è¡Œå™¨ç¾¤æ¥åŒºåˆ†ï¼Œç„¶åŽç»Ÿä¸€ç®¡ç†èµ·æ¥åœ¨ä¸€ä¸ªwebåŽå°å°±èƒ½å¤„ç†æ‰€æœ‰çŽ¯å¢ƒçš„å®šæ—¶ä»»åŠ¡äº†ã€‚ è°ƒåº¦ä¸­å¿ƒç›¸å…³ è¦ä½¿ç”¨xxl-jobæ¥ç®¡ç†æ‰€æœ‰çŽ¯å¢ƒçš„å®šæ—¶ä»»åŠ¡ï¼Œé¦–å…ˆéœ€è¦æ ¹æ®çŽ¯å¢ƒåˆ›å»ºæ‰§è¡Œå™¨ç¾¤ï¼Œç„¶åŽåœ¨çŸ¥æƒ…å™¨ç¾¤çš„åŸºç¡€ä¸Šåˆ›å»ºä»»åŠ¡ã€‚ åˆ›å»ºæ‰§è¡Œå™¨ç¾¤ç‚¹å‡»webé¡µé¢å·¦ä¾§çš„æ‰§è¡Œå™¨ç®¡ç† =&gt; æ–°å¢žæ‰§è¡Œå™¨ ä¸Šè¾¹çš„AppNameå¾ˆé‡è¦ï¼Œæ˜¯åŒºåˆ†å„ä¸ªæ‰§è¡Œå™¨ç¾¤çš„æ ‡å¿—ï¼Œå¦‚æžœé€‰æ‹©ä¸‹è¾¹çš„æ‰‹åŠ¨å½•å…¥çš„è¯é‚£ä¹ˆå°±éœ€è¦å°†æœºå™¨ip:portæ·»åŠ åˆ°æœºå™¨åœ°å€ä¸­ã€‚æŠŠæ‰§è¡Œå™¨ç¾¤åˆ›å»ºå¥½äº†ä¹‹åŽå°±å¯ä»¥åˆ›å»ºå®šæ—¶ä»»åŠ¡äº†ã€‚ åˆ›å»ºå®šæ—¶ä»»åŠ¡ ç‚¹å‡»å·¦ä¾§çš„ä»»åŠ¡ç®¡ç† =&gt; æ–°å¢žä»»åŠ¡ é‡Œè¾¹çš„å…·ä½“é€‰é¡¹çš„å«ä¹‰å¤§å®¶å¯ä»¥åŽ»æŸ¥xxl-jobçš„å®˜æ–¹æ–‡æ¡£ï¼Œä¹Ÿè®°å½•çš„å¾ˆè¯¦ç»†ã€‚è¿™é‡Œä¸åœ¨é‡æ–°å¤è¿°ã€‚ è¿™é‡Œè¿˜æƒ³å¤šæä¸€ç‚¹çš„æ˜¯ä»–çš„æŠ¥è­¦æœºåˆ¶ï¼Œåªæ”¯æŒé‚®ä»¶æŠ¥è­¦ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´å¤§å®¶æ‰“å¼€é‚®ä»¶çš„é¢‘çŽ‡æ¯”è¾ƒä½Žï¼Œå¹³æ—¶ä¹Ÿè®¸ä¸å¤ªå…³æ³¨é‚®ä»¶ï¼Œæ‰€ä»¥å¯èƒ½å¯¼è‡´ä¸€äº›ä»»åŠ¡æ‰§è¡Œå¤±è´¥äº†æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åŠæ—¶å‘çŽ°ã€‚åŸºäºŽä¸Šé¢çš„åŽŸå› ï¼Œå°±åœ¨ä½œè€…åŽŸæ¥çš„ä»£ç åŸºç¡€ä¸Šå¢žåŠ é’‰é’‰æŠ¥è­¦ï¼ˆåœ¨github issuesä¸­ä¹Ÿæœ‰äººæå‡ºè¿‡ï¼‰ï¼Œå®žçŽ°èµ·æ¥ä¹Ÿå¹¶ä¸å¤æ‚ã€‚ä¿®æ”¹ä¹‹åŽåˆ›å»ºä»»åŠ¡çš„æ—¶å€™å¤šäº†ä¸¤ä¸ªå‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°ä¹Ÿéœ€è¦åœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸¤ä¸ªå­—æ®µã€‚ è‹¥å‡ºçŽ°ä»»åŠ¡å¼‚å¸¸ï¼Œé‚£ä¹ˆä¼šç›´æŽ¥å°†è‡ªå®šä¹‰çš„ä¿¡æ¯é€šè¿‡http postçš„æ–¹å¼å‘é€ç»™é…ç½®çš„é’‰é’‰ç¾¤ï¼Œä¸‹é¢æ˜¯æˆ‘æµ‹è¯•çš„æ•ˆæžœã€‚ æ€ç»´å¯¼å›¾å¤§è‡´ç”»äº†ä¸€ä¸‹xxl-jobçš„æ€ç»´å¯¼å›¾ï¼Œè¿˜ä¸å¤Ÿå®Œå¤‡ã€‚ å‚è€ƒ ç¾Žå›¢ç‚¹è¯„è®¸é›ªé‡Œï¼šåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å° XXL-JOB xxl-jobå®˜æ–¹æ–‡æ¡£ åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦ç³»ç»ŸæŠ€æœ¯é€‰åž‹]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ELK+KAFKAè¯¦è§£(äºŒ)]]></title>
    <url>%2F2018%2F08%2F25%2FELK%2BKAFKA%E8%AF%A6%E8%A7%A3(%E4%BA%8C)%2F</url>
    <content type="text"><![CDATA[ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å·²ç»å°†filebeatã€kafkaã€zookeeperã€logstashå®‰è£…é…ç½®å®Œæ¯•äº†ã€‚æŽ¥ä¸‹æ¥ä¸»è¦æ˜¯ç´¢å¼•æ•°æ®ã€å±•ç¤ºæ•°æ®é˜¶æ®µã€‚ å®‰è£…Elasticsearché¦–å…ˆåˆ°å®˜ç½‘ä¸‹è½½5.3.3ç‰ˆæœ¬çš„å®‰è£…åŒ… 1&gt; axel -n 5 https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.3.3.tar.gz ç„¶åŽåœ¨ESçš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªç›®å½•dataã€logsï¼Œç”¨æ¥ä¿å­˜ç´¢å¼•æ•°æ®ã€æ—¥å¿—ç­‰ç­‰ 12&gt; mkdir logs&gt; mkdir data è¿›å…¥configç›®å½•ç¼–è¾‘elasticsearch.ymlæ–‡ä»¶ï¼Œè¿™ç§ä»¥.ymlç±»åž‹ç»“å°¾çš„æ–‡ä»¶è¦æ³¨æ„ç¼©è¿›ã€‚ 12345678910# Path to directory where to store the data (separate multiple locations by comma):path.data: /opt/soft/elasticsearch-5.5.3/data# Path to log files:path.logs: /opt/soft/elasticsearch-5.5.3/logs# ç»‘å®šä¸€ä¸ªæŒ‡å®šçš„ip# network.host: 0.0.0.0http.port: 9200# åŽè¾¹ä½¿ç”¨æ’ä»¶çš„æ—¶å€™éœ€è¦ä½¿ç”¨åˆ°ä¸‹è¾¹ä¸¤ä¸ªé…ç½®ã€‚http.cors.enabled: truehttp.cors.allow-origin: "*" ä¸Šè¾¹æ˜¯ä¸€äº›ä¸»è¦çš„é…ç½®ï¼Œç„¶åŽå¯ä»¥ç›´æŽ¥å¯åŠ¨ESäº† 1&gt; ./bin/elasticsearch &amp; ä¸Šè¾¹æˆ‘ä»¬æ˜¯å·²ç»å¯åŠ¨äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜ä¸çŸ¥é“æ•°æ®æ˜¯å¦é€šè¿‡logstashå†™å…¥åˆ°ESä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸¤ä¸ªæ­¥éª¤æ¥ç¡®ä¿æˆ‘ä»¬å®‰è£…é…ç½®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼š åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼ˆESä¸­çš„ç´¢å¼•ç±»ä¼¼äºŽæ•°æ®åº“ä¸­çš„ä¸€ä¸ªæ•°æ®åº“å®žä¾‹ï¼‰ ã€‚ å®‰è£…headæ’ä»¶ï¼ŒæŸ¥çœ‹ESæƒ…å†µ ç´¢å¼•åœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ESä¸­çš„ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µï¼š indexï¼šESç®¡ç†æ•°æ®çš„æœ€é¡¶å±‚å•ä½ï¼Œç±»ä¼¼äºŽå•ä¸ªæ•°æ®åº“çš„æ¦‚å¿µã€‚ document ï¼šESçš„indexä¸­å•æ¡æ•°æ®è¢«ç§°ä¸ºdocument typeï¼šdocumentå¯ä»¥åˆ†ç»„ï¼Œåˆ†ç»„å°±å«type é€šè¿‡æŒ‡å®šä¸€ä¸ªæ–‡ä»¶çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼š 1&gt; curl -XPUT 'http://localhost:9200/nginx_log_index/test_log/1?pretty' -H 'Content-Type: application/json' -d '/opt/soft/logstash-5.5.3/output/es_template.json' åˆ é™¤ç´¢å¼•ï¼š 1&gt; curl -X DELETE 'localhost:9200/nginx_log_index' å®‰è£…headæ’ä»¶headæ’ä»¶è¿è¡Œéœ€è¦nodeçŽ¯å¢ƒï¼Œè¿™é‡Œå°±ä¸è®¨è®ºå¦‚ä½•å®‰è£…nodeäº†ï¼Œç½‘ä¸Šèµ„æ–™æ¯”è¾ƒå¤šã€‚ ä½¿ç”¨gitä¸‹è½½headæºç ï¼š 1&gt; git clone git://github.com/mobz/elasticsearch-head.git ç„¶åŽè¿›å…¥headçš„ç›®å½•æ‰§è¡ŒæŒ‡ä»¤ 1&gt; npm install å¯åŠ¨ 1&gt; npm run start è‹¥æ˜¯ESä½¿ç”¨çš„éƒ½æ˜¯é»˜è®¤ç«¯å£ï¼Œé‚£ä¹ˆheadæ’ä»¶å°±ä¸éœ€è¦ä¿®æ”¹é…ç½®ã€‚ åœ¨æµè§ˆå™¨ä¸­è®¿é—®http://ip:9100/å°±å¯ä»¥çœ‹åˆ°ESçš„æƒ…å†µ ESè¡¥å……Elasticsearchæ˜¯ä¸€ä¸ªæœç´¢å¼•æ“Žï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæä¾›çš„æŸ¥è¯¢è¯­å¥å®žçŽ°ç±»ä¼¼sqlçš„æŸ¥è¯¢åŠŸèƒ½ï¼Œä¸ºæˆ‘ä»¬å±•ç¤ºæ•°æ®æä¾›ä¾¿åˆ©ï¼Œä¸‹é¢åˆ—ä¸¾ä¸€ä¸ªå¸¸ç”¨çš„æŸ¥è¯¢ã€‚ 1ã€æŒ‡å®šä¸€ä¸ªindexï¼Œæœç´¢å…¶ä¸‹æ‰€æœ‰typeçš„æ•°æ® 123456&gt; curl -X GET 'http://localhost:9200/nginx-log/_search?pretty' -H 'Content-Type: application/json' -d ' &#123; "query": &#123; "match_all": &#123;&#125; &#125;&#125;' ä¸Šè¾¹çš„nginx-logå°±æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„index 2ã€æŸ¥çœ‹æ¯ä¸ªindexæ‰€åŒ…å«çš„type 1&gt; curl 'localhost:9200/_mapping?pretty=true' 3ã€æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰Index 1&gt; curl -X GET 'http://localhost:9200/_cat/indices?v' 4ã€æ ¹æ®æŸä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„åŽç»Ÿè®¡ï¼Œå®žçŽ°ç±»ä¼¼äºŽsqlé‡Œè¾¹çš„åŠŸèƒ½ 1select count(*) from table_name group by field; ä¸‹é¢çš„ESæŸ¥è¯¢è¯­å¥åŠŸèƒ½å’Œä¸Šè¾¹çš„sqlæ˜¯ç±»ä¼¼çš„ 1234567891011&gt; curl -X POST 'http://localhost:9200/nginx-log/nginxlog/_search?pretty' -H 'Content-Type: application/json' -d'&#123; "size": 0, "aggs": &#123; "group_by_service_name": &#123; "terms": &#123; "field": "service_name.keyword" &#125; &#125; &#125;&#125;' å®‰è£…kibanaä¸‹è½½ï¼š 1&gt; axel -n 5 https://artifacts.elastic.co/downloads/kibana/kibana-5.5.3-linux-x86_64.tar.gz kibanaçš„å®‰è£…é…ç½®è¾ƒä¸ºç®€å•ï¼Œåªéœ€è¦åœ¨configç›®å½•ä¸­çš„kibana.ymlæ–‡ä»¶é…ç½®ä¸¤ä¸ªå­—æ®µ 1234# Kibana is served by a back end server. This setting specifies the port to use.server.port: 5601# The URL of the Elasticsearch instance to use for all your queries.elasticsearch.url: "http://localhost:9200" ç„¶åŽå¯åŠ¨ 1&gt; ./bin/kibana &amp; åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨kibanaçš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ä¸€ä¸ªindexï¼Œç„¶åŽkibanaä¼šé€šè¿‡è¿™ä¸ªindexåŽ»ESä¸­æŸ¥è¯¢å¹¶å±•ç¤ºã€‚ æˆ‘ä»¬å°†åˆšæ‰åˆ›å»ºçš„indexåŠ å…¥åˆ°é‡Œè¾¹ï¼Œç„¶åŽç‚¹å‡»Discoveré€‰æ‹©åˆšæ‰é…ç½®çš„indexï¼Œåœ¨é€‰æ‹©æ—¶é—´ï¼Œå°±èƒ½å¤Ÿçœ‹åˆ°æ•°æ®å·²ç»è¢«å±•ç¤ºå‡ºæ¥äº†ã€‚ ä¸Šå›¾ä¸­çš„å·¦ä¾§å¯ä»¥é€‰æ‹©åœ¨å³ä¾§å±•ç¤ºå“ªäº›å­—æ®µã€‚ ä½¿ç”¨kibanaç»˜å›¾&emsp;&emsp;åœ¨kibanaä¸­ä¹Ÿæ˜¯å¯ä»¥å®Œæˆä¸€äº›ç»˜å›¾çš„ï¼Œä½†æ˜¯ç”±äºŽkibanaæ²¡æœ‰ç›¸åº”æƒé™æŽ§åˆ¶ï¼Œå¹¶ä¸”kibanaçš„é¢œå€¼æ˜¯æ²¡æœ‰Grafanaé«˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯ç”¨Grafanaæ¥å±•ç¤ºå›¾è¡¨ï¼ŒkibanaæŸ¥è¯¢æ—¥å¿—ã€‚ä¸‹é¢å°±æ¥æŽ¢è®¨ä¸€ä¸‹Grafanaç›¸å…³å†…å®¹ Grafanaç›¸å…³æˆ‘ä»¬å…ˆè¿›å…¥Grafanaçš„å®˜ç½‘ï¼Œé‡Œè¾¹æœ‰ä»‹ç»å¦‚ä½•å®‰è£…ï¼Œä¹Ÿå¾ˆç®€å•ã€‚ 12&gt; wget https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana_5.2.2_amd64.deb &gt; sudo dpkg -i grafana_5.2.2_amd64.deb ç„¶åŽå¯åŠ¨ 1&gt; sudo /bin/systemctl start grafana-server è®¿é—®http://localhost:3000ç„¶åŽä½¿ç”¨adminç™»å½•è¿›åŽ»ï¼Œå¯†ç é»˜è®¤ä¹Ÿæ˜¯adminã€‚è¿›åŽ»åŽéœ€è¦å…ˆé…ç½®æ•°æ®æºã€‚ ä¸Šè¾¹æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š typeï¼šç”±äºŽæˆ‘ä»¬æ˜¯ä½¿ç”¨ESä½œä¸ºæ•°æ®æºï¼Œæ‰€ä»¥è¿™é‡Œä¸€å®šè¦é€‰æ‹©elasticsearch url : è¿žæŽ¥elasticsearchæœåŠ¡çš„åœ°å€ Accessï¼šéœ€è¦é€‰æ‹©å…·ä½“æŸç§è¿žæŽ¥æ–¹å¼ï¼Œä¸¤ç§æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œå…·ä½“ä¸åŒè¿™é‡Œä¸è¯¦ç»†æè¿° Authï¼šESè‹¥æ˜¯å®‰è£…äº†ç›¸åº”å¯†ç æƒé™ï¼Œè¿™é‡Œéœ€è¦æ­£ç¡®é…ç½®ä¹‹åŽæ‰èƒ½è®¿é—®ã€‚ Index name ï¼š è¿™é‡Œæ˜¯å¡«åœ¨ESä¸­åˆ›å»ºçš„indexï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œè‹¥æ˜¯index nameåŒ…å«äº†æ—¥å¿—ï¼Œé‚£ä¹ˆåŽè¾¹çš„patternå°±ä¸è¦é€‰æ‹©ä»»ä½•æ—¥æœŸäº†ã€‚ Version ï¼š éœ€è¦é€‰æ‹©å’Œå®‰è£…çš„ESåŒ¹é…çš„ç‰ˆæœ¬ ç„¶åŽä¿å­˜ï¼Œç„¶åŽå°±å¯ä»¥åˆ›å»ºDashBoardã€panelã€‚grafanaç»˜å›¾ã€æŸ¥è¯¢ç›¸å…³å†…å®¹è¾ƒå¤šï¼ŒåŽè¾¹è‹¥æœ‰æ—¶é—´è¿˜ä¼šæŽ¢è®¨ä¸€ä¸‹grafanaç»˜å›¾ç›¸å…³ã€‚ å‚è€ƒï¼š elasticsearch åˆ›å»ºç´¢å¼•ï¼Œä»¥åŠæ£€ç´¢ä¸€æ¡æ•°æ® grafanaå®˜ç½‘ groups.io]]></content>
      <categories>
        <category>ELK</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ELK+KAFKAè¯¦è§£ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2018%2F08%2F22%2FELK%2BKAFKA%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[&emsp;&emsp;æ—¥å¿—ï¼Œå¯¹äºŽä»»ä½•ç³»ç»Ÿæ¥è¯´éƒ½æ˜¯åŠå…¶é‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚åœ¨è®¡ç®—æœºç³»ç»Ÿé‡Œé¢ï¼Œæ›´æ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯ç”±äºŽçŽ°åœ¨çš„è®¡ç®—æœºç³»ç»Ÿå¤§å¤šæ¯”è¾ƒå¤æ‚ï¼Œå¾ˆå¤šç³»ç»Ÿéƒ½ä¸æ˜¯åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç”šè‡³éƒ½æ˜¯è·¨å›½ç•Œçš„ï¼›å³ä½¿æ˜¯åœ¨ä¸€ä¸ªåœ°æ–¹çš„ç³»ç»Ÿï¼Œä¹Ÿæœ‰ä¸åŒçš„æ¥æºï¼Œæ¯”å¦‚ï¼Œæ“ä½œç³»ç»Ÿï¼Œåº”ç”¨æœåŠ¡ï¼Œä¸šåŠ¡é€»è¾‘ç­‰ç­‰ã€‚ä»–ä»¬éƒ½åœ¨ä¸åœäº§ç”Ÿå„ç§å„æ ·çš„æ—¥å¿—æ•°æ®ã€‚ &emsp;&emsp;æ ¹æ®ä¸å®Œå…¨ç»Ÿè®¡ï¼Œæˆ‘ä»¬å…¨çƒæ¯å¤©å¤§çº¦è¦äº§ç”Ÿ 2EBï¼ˆ1018ï¼‰çš„æ•°æ®ã€‚é¢å¯¹å¦‚æ­¤æµ·é‡çš„æ•°æ®ï¼Œåˆæ˜¯åˆ†å¸ƒåœ¨å„ä¸ªä¸åŒåœ°æ–¹ï¼Œå¦‚æžœæˆ‘ä»¬éœ€è¦åŽ»æŸ¥æ‰¾ä¸€äº›é‡è¦çš„ä¿¡æ¯ï¼Œéš¾é“è¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹æ³•ï¼ŒåŽ»ç™»é™†åˆ°ä¸€å°å°æœºå™¨ä¸ŠæŸ¥çœ‹ï¼Ÿçœ‹æ¥ä¼ ç»Ÿçš„å·¥å…·å’Œæ–¹æ³•å·²ç»æ˜¾å¾—éžå¸¸ç¬¨æ‹™å’Œä½Žæ•ˆäº†ã€‚äºŽæ˜¯ï¼Œä¸€äº›èªæ˜Žäººå°±æå‡ºäº†å»ºç«‹ä¸€å¥—é›†ä¸­å¼çš„æ–¹æ³•ï¼ŒæŠŠä¸åŒæ¥æºçš„æ•°æ®é›†ä¸­æ•´åˆåˆ°ä¸€ä¸ªåœ°æ–¹ã€‚ ä¸€ä¸ªå®Œæ•´çš„é›†ä¸­å¼æ—¥å¿—ç³»ç»Ÿï¼Œæ˜¯ç¦»ä¸å¼€ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç‰¹ç‚¹çš„ã€‚ æ”¶é›†ï¼èƒ½å¤Ÿé‡‡é›†å¤šç§æ¥æºçš„æ—¥å¿—æ•°æ® ä¼ è¾“ï¼èƒ½å¤Ÿç¨³å®šçš„æŠŠæ—¥å¿—æ•°æ®ä¼ è¾“åˆ°ä¸­å¤®ç³»ç»Ÿ å­˜å‚¨ï¼å¦‚ä½•å­˜å‚¨æ—¥å¿—æ•°æ® åˆ†æžï¼å¯ä»¥æ”¯æŒ UI åˆ†æž è­¦å‘Šï¼èƒ½å¤Ÿæä¾›é”™è¯¯æŠ¥å‘Šï¼Œç›‘æŽ§æœºåˆ¶ æœ¬æ–‡é‡‡ç”¨ELK + FILEBEAT + KAFKAçš„æž¶æž„æ­å»ºæ—¥å¿—æ”¶é›†ç³»ç»Ÿã€‚æž¶æž„å›¾å¦‚ä¸‹ï¼š çŽ¯å¢ƒã€ç‰ˆæœ¬ JDK 1.8 OS : ubuntu18.04 filebeatã€logstashã€elasticsearchã€kibanaï¼ˆ5.3.3ï¼‰ kafka_2.11-0.10.0.1 Grafana ï¼šLatest version filebeatå®‰è£… &emsp;&emsp;ä¸€ä¸ªè½»é‡çº§å¼€æºæ—¥å¿—æ–‡ä»¶æ•°æ®æœé›†å™¨ï¼ŒåŸºäºŽLogstash-Forwarder æºä»£ç å¼€å‘ï¼Œæ˜¯å¯¹å®ƒçš„æ›¿ä»£ã€‚åœ¨éœ€è¦é‡‡é›†æ—¥å¿—æ•°æ®çš„ server ä¸Šå®‰è£… Filebeatï¼Œå¹¶æŒ‡å®šæ—¥å¿—ç›®å½•æˆ–æ—¥å¿—æ–‡ä»¶åŽï¼ŒFilebeat å°±èƒ½è¯»å–æ•°æ®ï¼Œè¿…é€Ÿå‘é€åˆ°æŒ‡å®šçš„MQä¸­ï¼Œäº¦æˆ–ç›´æŽ¥å‘é€åˆ°logstashè¿›è¡Œè¿‡æ»¤è½¬å‘ã€‚çŽ°ä¸‹è½½åˆ°æœ¬åœ° 123&gt; axel -n 5 https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.3.3-linux-x86_64.tar.gz&gt; tar -zxvf filebeat-5.5.3-linux-x86_64.tar.gz&gt; mv filebeat-5.5.3-linux-x86_64 filebeat-5.5.3 ç„¶åŽè¿›å…¥ç›®å½•ä¸­å¤åˆ¶ä¸€ä»½cp filebeat.yml filebeat-kafka.ymlï¼Œä¿®æ”¹æ–‡ä»¶ä¸­ç›¸åº”çš„åœ°æ–¹ã€‚ 1234567891011#æŒ‡å®šè¾“å…¥ç±»åž‹- input_type: log # éœ€è¦ç›‘æŽ§çš„æ–‡ä»¶ç›®å½•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦å¯¹æ•´ä¸ªç›®å½•ç›‘æŽ§ paths: - /opt/soft/logs/platform.pro.access.log#å®šä¹‰kafkaä¸ºè¾“å‡ºç›®çš„åœ°output.kafka: # Array of hosts to connect to. hosts: ["ip:9092"] #kafkaçš„ä¸»é¢˜ topic: nginx_log ä¸Šè¾¹éœ€è¦æ³¨æ„ä¸€å®šéœ€è¦å°†outputè¾“å‡ºç›®çš„ä»Žé»˜è®¤çš„ElasticSearchä¿®æ”¹æˆkafkaï¼Œä»¥ä¸Šé…ç½®å°±ç®—å®‰è£…å®Œæˆäº†ï¼ŒæŽ¥ç€å¯åŠ¨. 1&gt; ./filebeat -e -c filebeat-kafka.yml kafkaå®‰è£…é…ç½® kafkaçš„è¿è¡Œä¾èµ–zookeeperï¼Œæ‰€ä»¥å®‰è£…kafkaä¹‹å‰éœ€è¦å…ˆå®‰è£…zookeeperï¼Œè¿™é‡Œä¸ç”¨kafkaè‡ªèº«å¸¦æœ‰çš„zookeeperã€‚ zookeeperé…ç½®12&gt; axel -n 5 https://archive.apache.org/dist/zookeeper/zookeeper-3.4.6/zookeeper-3.4.6.tar.gz&gt; tar -zxvf zookeeper-3.4.6.tar.gz ç„¶åŽè¿›å…¥zookeeperç›®å½•åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹ 12&gt; mkdir logs&gt; mkdir data åœ¨/root/elk/zookeeper-3.4.6/confç›®å½•ä¸‹å¤åˆ¶zoo_sample.cfgå‘½åä¸ºzoo.cfg 1&gt; cp zoo_sample.cfg zoo.cfg æ‰“å¼€zoo.cfgï¼Œä¿®æ”¹éœ€è¦é…ç½®çš„åœ°æ–¹ 123456tickTime=2000initLimit=10syncLimit=5dataDir=/opt/soft/zookeeper-3.4.6/datadataLogDir=/opt/soft/zookeeper-3.4.6/logsclientPort=2181 åœ¨/root/elk/zookeeper-3.4.6/dataç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidæ–‡ä»¶ã€‚ç”±äºŽæˆ‘ä»¬è¿™é‡Œåªæ˜¯å•ç‚¹çŽ¯å¢ƒä¸‹ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨æ–‡ä»¶é‡Œè¾¹å†™å…¥server.1ã€‚ æœ€åŽå°†zkçš„è·¯å¾„æ·»åŠ åˆ°ç›¸å…³çš„çŽ¯å¢ƒå˜é‡ä¸­ï¼Œå¹¶æ·»åŠ PATH,ç„¶åŽå¯åŠ¨ 1&gt; zkServer.sh start æœ€åŽæŸ¥çœ‹zkæ˜¯å¦å¯åŠ¨æˆåŠŸ 1&gt; zkServer.sh status kafkaé…ç½®å®‰è£…kafkaçš„æ—¶å€™éœ€è¦æ³¨æ„å’Œlogstashä¹‹é—´ç‰ˆæœ¬åŒ¹é…çš„é—®é¢˜ï¼Œlogstash5.xä»¥ä¸Šå¿…é¡»ä½¿ç”¨kakfa 0.10ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸è¿è¡Œã€‚ 1&gt; axel -n 5 https://archive.apache.org/dist/kafka/0.10.0.1/kafka_2.11-0.10.0.1.tgz ä¸‹è½½å®Œæˆä¹‹åŽè§£åŽ‹ã€è¿›å…¥kafkaæ ¹ç›®å½•åˆ›å»ºlogsç›®å½•,ç„¶åŽæ‰“å¼€configç›®å½•ä¸‹çš„server.propertiesä¿®æ”¹ä¸€äº›å‚æ•° 123log.dirs=/opt/soft/kafka_2.11-0.10.0.1/logszookeeper.connect=ip:2181å…¶ä»–é¡¹æ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹.... ç„¶åŽå¯ä»¥å¯åŠ¨kafka 1&gt; bin/kafka-server-start.sh config/server.properties &amp; åˆ›å»ºä¸€ä¸ªåå«nginx_logçš„kafkaä¸»é¢˜ 1&gt; bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic nginx_log ç„¶åŽè‡ªå·±å¯ä»¥å°è¯•æ‰“å¼€ä¸€ä¸ªç»ˆç«¯è¿›å…¥ç”Ÿäº§è€…æ¨¡å¼ï¼Œå‘é€å‡ æ¡æ•°æ® 1&gt; bin/kafka-console-producer.sh --broker-list localhost:9092 --topic nginx_log åœ¨å¦å¤–ä¸€ä¸ªç»ˆç«¯ä¸­å¼€å¯æ¶ˆè´¹è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹ç”Ÿäº§è€…å‘é€çš„æ•°æ®æ˜¯å¦èƒ½å¤Ÿçœ‹åˆ°ï¼Œè‹¥èƒ½æ­£å¸¸çœ‹åˆ°å‘é€çš„æ•°æ®ï¼Œè¯´æ˜Žkafkaå®‰è£…æ²¡æœ‰é—®é¢˜ã€‚ 1&gt; bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic nginx_log --from-beginning logstashå®‰è£…é…ç½® &emsp;&emsp;&ensp;è®°ä½æ–‡ç« å¼€å§‹çš„é‚£å¼ æ•´ä½“æž¶æž„å›¾ï¼Œkafkaæ˜¯ä»ŽfilebeatæŽ¥æ”¶æ•°æ®ï¼Œç„¶åŽå‘é€ç»™logstashã€‚æ‰€ä»¥è¿™é‡Œlogstashçš„inputå°±æ˜¯kafkaäº†ã€‚ logstashæ˜¯æ•´ä¸ªæµç¨‹ä¸­é…ç½®ã€ä¿®æ”¹æœ€å¤šçš„ä¸€çŽ¯ï¼Œè¿‡ç¨‹ä¸­ä¹Ÿæœ‰ä¸€äº›å‘ã€‚ 1&gt; axel -n 5 https://artifacts.elastic.co/downloads/logstash/logstash-5.3.3.tar.gz è€è§„çŸ©ï¼Œå…ˆè§£åŽ‹ï¼Œè¿›å…¥configç›®å½•åˆ›å»ºä¸€ä¸ªlogstash.confçš„æ–‡ä»¶ï¼Œç„¶åŽåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œè¾¹æ·»åŠ inputã€filterã€outputä¸‰ä¸ªæ¨¡å—ã€‚ inputæ¨¡å—å…ˆæ¥è®²è®²inputæ¨¡å—ï¼Œç”±äºŽåœ¨logstash5.xä¸­å·²ç»é»˜è®¤æ”¯æŒkafkaä½œä¸ºinput,æ‰€ä»¥å¯ä»¥ç›´æŽ¥ä½¿ç”¨ã€‚ 1234567input&#123; kafka&#123; topics =&gt; ["nginx_log"] type =&gt; "nginx-access" bootstrap_servers =&gt; "ip:9092" &#125;&#125; topics :æŒ‡å®šæ¶ˆè´¹kafkaçš„topic type ï¼š è‹¥æ˜¯logstashéœ€è¦å¤„ç†å¤šä¸ªæ•°æ®æºï¼Œå¯ä»¥ä½¿ç”¨typeæ¥åšåŽè¾¹è¿‡æ»¤çš„åŒºåˆ†ã€‚ bootstrap_servers ï¼škakfaæœåŠ¡çš„ipå’Œç«¯å£å· filteræ¨¡å—&emsp;&emsp;&ensp; filteræ¨¡å—æ˜¯å…·ä½“å¤„ç†æ•°æ®çš„ä¸€ä¸ªçŽ¯èŠ‚ï¼Œå½“kafkaçš„æ•°æ®è¢«inputæ¨¡å—æŽ¥æ”¶è¿‡æ¥ä¹‹åŽï¼ŒæŽ¥ä¸‹æ¥å°±ä¼šäº¤ç»™filteræ¨¡å—å¤„ç†ã€‚è¿™é‡Œæˆ‘ä»¬æ˜¯ä¸ºäº†å¤„ç†nginxçš„accessæ—¥å¿—ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦æ ¹æ®nginxçš„log_formatæ¥å®šåˆ¶è‡ªå·±çš„grokæ­£åˆ™è¡¨è¾¾å¼ã€‚ç”Ÿäº§çŽ¯å¢ƒçš„log_formatæ˜¯ä¸‹é¢è¿™æ ·ðŸ‘‡ 1234log_format '$remote_addr [$time_local] $host "$request" ' '$status $body_bytes_sent "$http_referer" ' '"$http_x_forwarded_for" "$http_user_agent" $request_time $upstream_response_time'; å®žé™…çš„æ—¥å¿—é•¿æˆè¿™æ · 1100.116.224.17 [14/Aug/2018:07:45:49 +0800] platform.blingabc.com "POST /homeworkRecord/v1/insert HTTP/1.1" 200 517 "https://i.blingabc.com/home/read-book?stuID=11936" "27.187.252.91" "Mozilla/5.0 (iPhone; CPU iPhone OS 11_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E216 MicroMessenger/6.7.1 NetType/WIFI Language/zh_CN" 0.456 0.456 &emsp;&emsp;&ensp;å½“æˆ‘ä»¬åœ¨åšnginxæ—¥å¿—è§£æžçš„æ—¶å€™ï¼Œå°½é‡å¤ç”¨grokè‡ªèº«å¸¦æœ‰çš„ã€‚å°‘æ•°ä¸èƒ½è§£æžçš„æ ¹æ®çŽ°æœ‰ä¿®æ”¹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ»¡è¶³è§£æžnginxæ—¥å¿—ã€‚åœ¨filteræ¨¡å—ä¸­åŠ å…¥ä¸‹é¢çš„é…ç½® 123456grok &#123; patterns_dir =&gt; "/opt/soft/logstash-5.5.3/patterns/nginx_pattern" match =&gt; &#123; "message" =&gt; "%&#123;NGINXACCESS&#125;" &#125; &#125; &emsp;&emsp;&ensp;éœ€è¦æ³¨æ„ä¸Šè¾¹çš„patterns_dirï¼Œè¿™ä¸ªè·¯å¾„ä¸­patternsè¿™ä¸ªç›®å½•å¿…é¡»åˆ›å»ºåœ¨logstashçš„æ ¹ç›®å½•ä¸­ä¸”åªèƒ½å«è¿™ä¸ªåå­—ï¼Œä¹‹åŽçš„nginx_patternå¯ä»¥éšæ„å–ã€‚nginx_patternæ–‡ä»¶çš„å†…å®¹ï¼š 1234STATUS ([0-9.]&#123;0,3&#125;)REQUEST_TIME ([0-9.]&#123;0,5&#125;)FORWORD (?:%&#123;IPV4&#125;[,]?[ ]?)NGINXACCESS %&#123;IPV4:remote_addr&#125; \[%&#123;HTTPDATE:time_local&#125;\] (%&#123;HOSTNAME:host&#125;) (%&#123;QUOTEDSTRING:request&#125;) %&#123;STATUS:http_status&#125; %&#123;BASE10NUM:body_bytes_sent&#125; \"(?:%&#123;DATA:http_referer&#125;|-)\" \"(%&#123;FORWORD:http_x_forwarded_for&#125;|-)\" \"(%&#123;GREEDYDATA:user_agent&#125;|-)\" (%&#123;REQUEST_TIME:request_time&#125;|-) (%&#123;REQUEST_TIME:upstream_response_time&#125;|-) &emsp;&emsp;&ensp;å…¶ä¸­å‰é¢ä¸‰æ¡æ˜¯è‡ªå·±çš„å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŽè¾¹NGINXACCESSæ˜¯æ•´ä½“è§£æžnginxæ—¥å¿—çš„è¡¨è¾¾å¼ã€‚åœ¨è‡ªå·±å†™è§£æžæ—¥å¿—çš„grokè¡¨è¾¾å¼çš„æ—¶å€™åœ¨Grok Debuggerä¸­æµ‹è¯•ã€‚ æœ€ç»ˆè§£æžå‡ºæ¥çš„æ•°æ®å¦‚ä¸‹ ã€éƒ¨åˆ†çœç•¥ã€‘ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657&#123; "remote_addr": [ [ "100.116.224.72" ] ], "time_local": [ [ "14/Aug/2018:00:20:14 +0800" ] ], "host": [ [ "platform.blingabc.com" ] ], "request": [ [ ""OPTIONS /foreign/teacher/v1/login HTTP/1.1"" ] ], "http_status": [ [ "200" ] ], "body_bytes_sent": [ [ "0" ] ], "http_referer": [ [ "-" ] ], "http_x_forwarded_for": [ [ "181.143.78.26" ] ], "user_agent": [ [ "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36" ] ], "request_time": [ [ "0.001" ] ], "upstream_response_time": [ [ "0.001" ] ]&#125; æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦é€šè¿‡ä¸‹é¢çš„requestè§£æžå¾—åˆ°/foreign/teacher/v1/loginå’Œforeignï¼Œç„¶åŽé€šè¿‡Grafanaç»Ÿè®¡åštop Nå±•ç¤ºï¼Œé‚£ä¹ˆæ•°æ®å°±è¿˜éœ€è¦è¿›ä¸€æ­¥æ‹†åˆ†ã€‚ 12345"request": [ [ ""OPTIONS /foreign/teacher/v1/login HTTP/1.1"" ] ], filteræ¨¡å—ä¸­æ”¯æŒå¾ˆå¤šæ’ä»¶ç»™æˆ‘ä»¬ä½¿ç”¨ï¼Œä¾‹å¦‚grokã€kvã€rubyã€mutateç­‰ç­‰â€¦ ä¸‹é¢å°±ç”¨rubyå’Œmutateæ¥å®žçŽ°æˆ‘ä»¬æƒ³è¾¾åˆ°çš„ç›®æ ‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546 filter &#123; grok &#123; patterns_dir =&gt; "/opt/soft/logstash-5.5.3/patterns/nginx_pattern" match =&gt; &#123; "message" =&gt; "%&#123;NGINXACCESS&#125;" &#125; &#125; if [request] &#123; ruby &#123; init =&gt; "@kname = ['method','uri']" code =&gt; " new_event = LogStash::Event.new(Hash[@kname.zip(event.get('request').split(' '))]) new_event.remove('@timestamp') event.append(new_event) " &#125; if [uri] &#123; ruby &#123; init =&gt; "@kname = ['url_path','url_args']" code =&gt; " new_event = LogStash::Event.new(Hash[@kname.zip(event.get('uri').split('?'))]) new_event.remove('@timestamp') event.append(new_event) " &#125; &#125; if [url_path] &#123; ruby &#123; init =&gt; "@kname = ['service_name', 'url_path']" code =&gt; " new_event = LogStash::Event.new(Hash[@kname.zip(event.get('uri').split('/'))]) new_event.remove('@timestamp') event.append(new_event) " &#125; &#125; &#125; mutate &#123; rename =&gt; ["url_path[1]", "service_name"] rename =&gt; ["url_path[0]", "uri"] &#125; if [service_name] == "monitor" or [service_name] == "weixin" or [method] == "OPTIONS" &#123; drop &#123;&#125; &#125;&#125; ä¸Šè¾¹çš„æ‰§è¡Œæ—¶æµå¼æ‰§è¡Œçš„ï¼Œå°±æ˜¯è¯´ä¸Šè¾¹æ‰§è¡Œå¾—åˆ°çš„ç»“æžœä¸‹è¾¹å¯ä»¥ç›´æŽ¥ä½¿ç”¨ã€‚ç„¶åŽå°†æ•°ç»„é‡Œè¾¹çš„ç»“æžœé‡ååï¼Œæä¾›ç»™ä¸‹é¢ESä½¿ç”¨ã€‚ outputæœ€åŽå°±æ˜¯outputæ¨¡å—äº†ï¼Œè¿™é‡Œæ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯è®²è¿‡æ»¤åŽçš„æ•°æ®äº¤ç»™ESã€‚ 123456789output &#123; elasticsearch&#123; hosts =&gt; ["ip:9200"] index =&gt; "nginx-log" template_overwrite =&gt; true template =&gt; "/opt/soft/logstash-5.5.3/output/es_template.json" &#125; stdout&#123;codec =&gt; rubydebug&#125;&#125; ä½†æ˜¯éœ€è¦æ³¨æ„ä¸Šè¾¹çš„templateæŒ‡å®šçš„æ–‡ä»¶ï¼Œåœ¨es_template.jsonè¿™ä¸ªæ–‡ä»¶ä¸­å®šä¹‰äº†filteræ¨¡å—è§£æžå‡ºæ¥çš„å­—æ®µåç§°ã€ç±»åž‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293&#123; "template":"nginx-log", "settings":&#123; "index.refresh_interval":"5s", "index.number_of_replicas":"1" &#125;, "analysis":&#123; "analyzer":&#123; "default":&#123; "type":"standard", "stopwords":"_none_" &#125; &#125; &#125;, "mappings":&#123; "nginx_log":&#123; "_all":&#123; "enabled":false &#125;, "properties":&#123; "remote_addr":&#123; "type":"ip", "fielddata": true &#125;, "time_local":&#123; "type":"date", "format":"dd/MMM/yyyy:HH:mm:ss Z" &#125;, "host":&#123; "type":"string", "fielddata": true &#125;, "uri":&#123; "type":"string", "fielddata": true &#125;, "request":&#123; "type":"string" &#125;, "http_status":&#123; "type":"integer", "fielddata": true &#125;, "body_bytes_sent":&#123; "type":"integer" &#125;, "http_referer":&#123; "type":"string" &#125;, "http_x_forwarded_for":&#123; "type":"ip" &#125;, "user_agent":&#123; "type":"string" &#125;, "request_time":&#123; "type":"float", "fielddata": true &#125;, "upstream_response_time":&#123; "type":"float" &#125;, "service_name":&#123; "type":"string", "fielddata": true &#125;, "request_url":&#123; "type":"string", "fielddata": true &#125;, "geoip":&#123; "properties":&#123; "city_name":&#123; "type":"keyword" &#125;, "country_name":&#123; "type":"keyword" &#125;, "latitude":&#123; "type":"float" &#125;, "location":&#123; "type":"geo_point" &#125;, "longitude":&#123; "type":"float" &#125; &#125; &#125; &#125; &#125; &#125;&#125; æœ€ç»ˆå½¢æˆçš„é…ç½®æ–‡ä»¶å°±æ˜¯è¿™æ ·çš„ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364input&#123; file &#123; path =&gt; "/opt/soft/logs/platform.pro.access.log" type =&gt; "nginxlog" start_position =&gt; "beginning" &#125;&#125;filter &#123; grok &#123; patterns_dir =&gt; "/opt/soft/logstash-5.5.3/patterns/nginx_pattern" match =&gt; &#123; "message" =&gt; "%&#123;NGINXACCESS&#125;" &#125; &#125; if [request] &#123; ruby &#123; init =&gt; "@kname = ['method','uri']" code =&gt; " new_event = LogStash::Event.new(Hash[@kname.zip(event.get('request').split(' '))]) new_event.remove('@timestamp') event.append(new_event) " &#125; if [uri] &#123; ruby &#123; init =&gt; "@kname = ['url_path','url_args']" code =&gt; " new_event = LogStash::Event.new(Hash[@kname.zip(event.get('uri').split('?'))]) new_event.remove('@timestamp') event.append(new_event) " &#125; &#125; if [url_path] &#123; ruby &#123; init =&gt; "@kname = ['service_name', 'url_path']" code =&gt; " new_event = LogStash::Event.new(Hash[@kname.zip(event.get('uri').split('/'))]) new_event.remove('@timestamp') event.append(new_event) " &#125; &#125; &#125; mutate &#123; rename =&gt; ["url_path[1]", "service_name"] rename =&gt; ["url_path[0]", "uri"] &#125; if [service_name] == "monitor" or [service_name] == "weixin" or [method] == "OPTIONS" &#123; drop &#123;&#125; &#125;&#125;output &#123; elasticsearch&#123; hosts =&gt; ["localhost:9200"] index =&gt; "nginx-log" template_overwrite =&gt; true template =&gt; "/opt/soft/logstash-5.5.3/output/es_template.json" &#125; stdout&#123;codec =&gt; rubydebug&#125;&#125; ä¸Šè¾¹å·²ç»æ•´ä¸ªçŽ¯å¢ƒæ­å»ºå®Œæˆäº†ä¸€å¤§åŠäº†ï¼ŒæŽ¥ä¸‹æ¥å°±æ˜¯å®‰è£…Elasticsearchå’Œkibanaã€Grafanaã€‚ å‚è€ƒï¼š ELKåˆä½“éªŒ-Nginxæ—¥å¿—å®žæ—¶åˆ†æž æ­å»ºELKæ—¥å¿—åˆ†æžå¹³å°ï¼ˆä¸Šï¼‰ elkæ­å»ºå®žæˆ˜ ELK(ElasticSearch, Logstash, Kibana)æ­å»ºå®žæ—¶æ—¥å¿—åˆ†æžå¹³å° â€¦â€¦]]></content>
      <categories>
        <category>ELK</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[java å·¥ç¨‹å¸ˆæˆç¥žä¹‹è·¯(è½¬è½½)]]></title>
    <url>%2F2018%2F06%2F28%2Fjava%20%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%88%90%E7%A5%9E%E4%B9%8B%E8%B7%AF(%E8%BD%AC%E8%BD%BD)%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©åœ¨è®ºå›ä¸Šçœ‹åˆ°çš„ä¸€ä¸ªå¸–å­ï¼Œä¸Šè¾¹æåˆ°çš„å†…å®¹æžä¸ºå®½æ³›ï¼Œå¯èƒ½åœ¨çŸ­æ—¶é—´å†…ä¸å¯èƒ½å®Œå…¨åšåˆ°æåˆ°çš„æ‰€æœ‰å†…å®¹ï¼Œä½†ä¹Ÿä¸å¦¨ä½œä¸ºä¸€ä¸ªå­¦ä¹ çš„ç›®æ ‡ã€‚åŽŸæ–‡åœ°å€ åŸºç¡€ç¯‡JVMJVMå†…å­˜ç»“æž„å †ã€æ ˆã€æ–¹æ³•åŒºã€ç›´æŽ¥å†…å­˜ã€å †å’Œæ ˆåŒºåˆ« Java å†…å­˜æ¨¡åž‹å†…å­˜å¯è§æ€§ã€é‡æŽ’åºã€é¡ºåºä¸€è‡´æ€§ã€volatileã€é”ã€final åžƒåœ¾å›žæ”¶å†…å­˜åˆ†é…ç­–ç•¥ã€åžƒåœ¾æ”¶é›†å™¨ï¼ˆ G1 ï¼‰ã€GC ç®—æ³•ã€GC å‚æ•°ã€å¯¹è±¡å­˜æ´»çš„åˆ¤å®š JVM å‚æ•°åŠè°ƒä¼˜Java å¯¹è±¡æ¨¡åž‹oop-klassã€å¯¹è±¡å¤´ HotSpotå³æ—¶ç¼–è¯‘å™¨ã€ç¼–è¯‘ä¼˜åŒ– ç±»åŠ è½½æœºåˆ¶classLoaderã€ç±»åŠ è½½è¿‡ç¨‹ã€åŒäº²å§”æ´¾ï¼ˆç ´ååŒäº²å§”æ´¾ï¼‰ã€æ¨¡å—åŒ–ï¼ˆ jboss modulesã€osgiã€jigsaw ï¼‰ è™šæ‹Ÿæœºæ€§èƒ½ç›‘æŽ§ä¸Žæ•…éšœå¤„ç†å·¥å…· jps, jstack, jmapã€jstat, jconsole, jinfo, jhat, javap, btraceã€TProfiler ç¼–è¯‘ä¸Žåç¼–è¯‘ javacã€javapã€jadã€CRF Java åŸºç¡€çŸ¥è¯†é˜…è¯»æºä»£ç Stringã€Integerã€Longã€Enumã€BigDecimalã€ThreadLocalã€ClassLoader &amp; URLClassLoaderã€ArrayList &amp; LinkedListã€HashMap &amp; LinkedHashMap &amp; TreeMap &amp; CouncurrentHashMapã€HashSet &amp; LinkedHashSet &amp; TreeSet Javaä¸­å„ç§å˜é‡ç±»åž‹ç†Ÿæ‚‰ Java String çš„ä½¿ç”¨ï¼Œç†Ÿæ‚‰ String çš„å„ç§å‡½æ•°JDK 6 å’Œ JDK 7 ä¸­ substring çš„åŽŸç†åŠåŒºåˆ«ã€ replaceFirstã€replaceAllã€replace åŒºåˆ«ã€ String å¯¹â€œ+â€çš„é‡è½½ã€ String.valueOf å’Œ Integer.toString çš„åŒºåˆ«ã€ å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§ è‡ªåŠ¨æ‹†è£…ç®± Integer çš„ç¼“å­˜æœºåˆ¶ ç†Ÿæ‚‰ Java ä¸­å„ç§å…³é”®å­—transientã€instanceofã€volatileã€synchronizedã€finalã€staticã€const åŽŸç†åŠç”¨æ³•ã€‚ é›†åˆç±»å¸¸ç”¨é›†åˆç±»çš„ä½¿ç”¨ã€ArrayList å’Œ LinkedList å’Œ Vector çš„åŒºåˆ« ã€SynchronizedList å’Œ Vector çš„åŒºåˆ«ã€HashMapã€HashTableã€ConcurrentHashMap åŒºåˆ«ã€Java 8 ä¸­ stream ç›¸å…³ç”¨æ³•ã€apache é›†åˆå¤„ç†å·¥å…·ç±»çš„ä½¿ç”¨ã€ä¸åŒç‰ˆæœ¬çš„ JDK ä¸­ HashMap çš„å®žçŽ°çš„åŒºåˆ«ä»¥åŠåŽŸå›  æžšä¸¾æžšä¸¾çš„ç”¨æ³•ã€æžšä¸¾ä¸Žå•ä¾‹ã€Enum ç±» Java IO&amp;Java NIOï¼Œå¹¶å­¦ä¼šä½¿ç”¨bioã€nio å’Œ aio çš„åŒºåˆ«ã€ä¸‰ç§ IO çš„ç”¨æ³•ä¸ŽåŽŸç†ã€netty Java åå°„ä¸Ž javassiståå°„ä¸Žå·¥åŽ‚æ¨¡å¼ã€ java.lang.reflect.* Java åºåˆ—åŒ–ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸Žååºåˆ—åŒ–ã€ä¸ºä»€ä¹ˆåºåˆ—åŒ–ã€åºåˆ—åŒ–åº•å±‚åŽŸç†ã€åºåˆ—åŒ–ä¸Žå•ä¾‹æ¨¡å¼ã€protobufã€ä¸ºä»€ä¹ˆè¯´åºåˆ—åŒ–å¹¶ä¸å®‰å…¨ æ³¨è§£å…ƒæ³¨è§£ã€è‡ªå®šä¹‰æ³¨è§£ã€Java ä¸­å¸¸ç”¨æ³¨è§£ä½¿ç”¨ã€æ³¨è§£ä¸Žåå°„çš„ç»“åˆ JMSä»€ä¹ˆæ˜¯ Java æ¶ˆæ¯æœåŠ¡ã€JMS æ¶ˆæ¯ä¼ é€æ¨¡åž‹ JMXjava.lang.management.ã€ javax.management. æ³›åž‹æ³›åž‹ä¸Žç»§æ‰¿ã€ç±»åž‹æ“¦é™¤ã€æ³›åž‹ä¸­ K T V E ï¼Ÿ object ç­‰çš„å«ä¹‰ã€æ³›åž‹å„ç§ç”¨æ³• å•å…ƒæµ‹è¯•junitã€mockã€mockitoã€å†…å­˜æ•°æ®åº“ï¼ˆ h2 ï¼‰ æ­£åˆ™è¡¨è¾¾å¼java.lang.util.regex.* å¸¸ç”¨çš„ Java å·¥å…·åº“commons.lang, commons.*â€¦ guava-libraries netty ä»€ä¹ˆæ˜¯ API&amp;SPIå¼‚å¸¸å¼‚å¸¸ç±»åž‹ã€æ­£ç¡®å¤„ç†å¼‚å¸¸ã€è‡ªå®šä¹‰å¼‚å¸¸ æ—¶é—´å¤„ç†æ—¶åŒºã€æ—¶ä»¤ã€Java ä¸­æ—¶é—´ API ç¼–ç æ–¹å¼è§£å†³ä¹±ç é—®é¢˜ã€å¸¸ç”¨ç¼–ç æ–¹å¼ è¯­æ³•ç³–Java ä¸­è¯­æ³•ç³–åŽŸç†ã€è§£è¯­æ³•ç³– Java å¹¶å‘ç¼–ç¨‹ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œä¸Žè¿›ç¨‹çš„åŒºåˆ«é˜…è¯»æºä»£ç ï¼Œå¹¶å­¦ä¼šä½¿ç”¨Threadã€Runnableã€Callableã€ReentrantLockã€ReentrantReadWriteLockã€Atomic*ã€Semaphoreã€CountDownLatchã€ã€ConcurrentHashMapã€Executors çº¿ç¨‹æ± è‡ªå·±è®¾è®¡çº¿ç¨‹æ± ã€submit() å’Œ execute() çº¿ç¨‹å®‰å…¨æ­»é”ã€æ­»é”å¦‚ä½•æŽ’æŸ¥ã€Java çº¿ç¨‹è°ƒåº¦ã€çº¿ç¨‹å®‰å…¨å’Œå†…å­˜æ¨¡åž‹çš„å…³ç³» é”CASã€ä¹è§‚é”ä¸Žæ‚²è§‚é”ã€æ•°æ®åº“ç›¸å…³é”æœºåˆ¶ã€åˆ†å¸ƒå¼é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ã€monitorã€é”ä¼˜åŒ–ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€è‡ªæ—‹é”ã€å¯é‡å…¥é”ã€é˜»å¡žé”ã€æ­»é” æ­»é”volatilehappens-beforeã€ç¼–è¯‘å™¨æŒ‡ä»¤é‡æŽ’å’Œ CPU æŒ‡ä»¤é‡synchronizedsynchronized æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ synchronized å’Œ lock ä¹‹é—´å…³ç³»ã€ä¸ä½¿ç”¨ synchronized å¦‚ä½•å®žçŽ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ sleep å’Œ waitwait å’Œ notifynotify å’Œ notifyAllThreadLocalå†™ä¸€ä¸ªæ­»é”çš„ç¨‹åºå†™ä»£ç æ¥è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å®ˆæŠ¤çº¿ç¨‹å®ˆæŠ¤çº¿ç¨‹å’Œéžå®ˆæŠ¤çº¿ç¨‹çš„åŒºåˆ«ä»¥åŠç”¨æ³•è¿›é˜¶ç¯‡Java åº•å±‚çŸ¥è¯†å­—èŠ‚ç ã€class æ–‡ä»¶æ ¼å¼CPU ç¼“å­˜ï¼ŒL1ï¼ŒL2ï¼ŒL3 å’Œä¼ªå…±äº«å°¾é€’å½’ä½è¿ç®—ç”¨ä½è¿ç®—å®žçŽ°åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–ä½™è®¾è®¡æ¨¡å¼äº†è§£ 23 ç§è®¾è®¡æ¨¡å¼ä¼šä½¿ç”¨å¸¸ç”¨è®¾è®¡æ¨¡å¼å•ä¾‹ã€ç­–ç•¥ã€å·¥åŽ‚ã€é€‚é…å™¨ã€è´£ä»»é“¾ã€‚ å®žçŽ° AOPå®žçŽ° IOCä¸ç”¨ synchronized å’Œ lockï¼Œå®žçŽ°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼nio å’Œ reactor è®¾è®¡æ¨¡å¼ç½‘ç»œç¼–ç¨‹çŸ¥è¯†tcpã€udpã€httpã€https ç­‰å¸¸ç”¨åè®®ä¸‰æ¬¡æ¡æ‰‹ä¸Žå››æ¬¡å…³é—­ã€æµé‡æŽ§åˆ¶å’Œæ‹¥å¡žæŽ§åˆ¶ã€OSI ä¸ƒå±‚æ¨¡åž‹ã€tcp ç²˜åŒ…ä¸Žæ‹†åŒ… http/1.0 http/1.1 http/2 ä¹‹å‰çš„åŒºåˆ«Java RMIï¼ŒSocketï¼ŒHttpClientcookie ä¸Ž sessioncookie è¢«ç¦ç”¨ï¼Œå¦‚ä½•å®žçŽ° session ç”¨ Java å†™ä¸€ä¸ªç®€å•çš„é™æ€æ–‡ä»¶çš„ HTTP æœåŠ¡å™¨å®žçŽ°å®¢æˆ·ç«¯ç¼“å­˜åŠŸèƒ½ï¼Œæ”¯æŒè¿”å›ž 304 å®žçŽ°å¯å¹¶å‘ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ ä½¿ç”¨ nio å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ æ”¯æŒç®€å•çš„ rewrite è§„åˆ™ ä¸Šè¿°åŠŸèƒ½åœ¨å®žçŽ°çš„æ—¶å€™éœ€è¦æ»¡è¶³â€œå¼€é—­åŽŸåˆ™â€ äº†è§£ nginx å’Œ apache æœåŠ¡å™¨çš„ç‰¹æ€§å¹¶æ­å»ºä¸€ä¸ªå¯¹åº”çš„æœåŠ¡å™¨ç”¨ Java å®žçŽ° FTPã€SMTP åè®®è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼ä»€ä¹ˆæ˜¯ CDN ï¼Ÿå¦‚æžœå®žçŽ°ï¼Ÿä»€ä¹ˆæ˜¯ DNS ï¼Ÿåå‘ä»£ç†æ¡†æž¶çŸ¥è¯†Servlet çº¿ç¨‹å®‰å…¨é—®é¢˜Servlet ä¸­çš„ filter å’Œ listenerHibernate çš„ç¼“å­˜æœºåˆ¶Hiberate çš„æ‡’åŠ è½½Spring Bean çš„åˆå§‹åŒ–Spring çš„ AOP åŽŸç†è‡ªå·±å®žçŽ° Spring çš„ IOCSpring MVCSpring Boot2.0Spring Boot çš„ starter åŽŸç†ï¼Œè‡ªå·±å®žçŽ°ä¸€ä¸ª starterSpring Securityåº”ç”¨æœåŠ¡å™¨çŸ¥è¯† JBosstomcatjettyWeblogicå·¥å…·git &amp; svnmaven &amp; gradleideaé«˜çº§ç¯‡æ–°æŠ€æœ¯java8 lambda è¡¨è¾¾å¼ã€Stream APIã€ Java 9Jigsawã€Jshellã€Reactive Streams Java 10å±€éƒ¨å˜é‡ç±»åž‹æŽ¨æ–­ã€G1 çš„å¹¶è¡Œ Full GCã€ThreadLocal æ¡æ‰‹æœºåˆ¶ Spring 5å“åº”å¼ç¼–ç¨‹ Spring Boot 2.0æ€§èƒ½ä¼˜åŒ–ä½¿ç”¨å•ä¾‹ã€ä½¿ç”¨ Future æ¨¡å¼ã€ä½¿ç”¨çº¿ç¨‹æ± ã€é€‰æ‹©å°±ç»ªã€å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ã€å‡å°‘é”ç²’åº¦ã€æ•°æ®åŽ‹ç¼©ã€ç»“æžœç¼“å­˜ çº¿ä¸Šé—®é¢˜åˆ†æždump èŽ·å–çº¿ç¨‹ Dumpã€å†…å­˜ Dumpã€gc æƒ…å†µ dump åˆ†æžåˆ†æžæ­»é”ã€åˆ†æžå†…å­˜æ³„éœ² è‡ªå·±ç¼–å†™å„ç§ outofmemoryï¼Œstackoverflow ç¨‹åºHeapOutOfMemoryã€Young OutOfMemoryã€MethodArea OutOfMemoryã€ConstantPool OutOfMemoryã€DirectMemory OutOfMemoryã€Stack OutOfMemory Stack OverFlow å¸¸è§é—®é¢˜è§£å†³æ€è·¯å†…å­˜æº¢å‡ºã€çº¿ç¨‹æ­»é”ã€ç±»åŠ è½½å†²çª ä½¿ç”¨å·¥å…·å°è¯•è§£å†³ä»¥ä¸‹é—®é¢˜ï¼Œå¹¶å†™ä¸‹æ€»ç»“å½“ä¸€ä¸ª Java ç¨‹åºå“åº”å¾ˆæ…¢æ—¶å¦‚ä½•æŸ¥æ‰¾é—®é¢˜ã€ å½“ä¸€ä¸ª Java ç¨‹åºé¢‘ç¹ FullGC æ—¶å¦‚ä½•è§£å†³é—®é¢˜ã€ å¦‚ä½•æŸ¥çœ‹åžƒåœ¾å›žæ”¶æ—¥å¿—ã€ å½“ä¸€ä¸ª Java åº”ç”¨å‘ç”Ÿ OutOfMemory æ—¶è¯¥å¦‚ä½•è§£å†³ã€ å¦‚ä½•åˆ¤æ–­æ˜¯å¦å‡ºçŽ°æ­»é”ã€ å¦‚ä½•åˆ¤æ–­æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ² ç¼–è¯‘åŽŸç†çŸ¥è¯†ç¼–è¯‘ä¸Žåç¼–è¯‘Java ä»£ç çš„ç¼–è¯‘ä¸Žåç¼–è¯‘Java çš„åç¼–è¯‘å·¥å…·è¯æ³•åˆ†æžï¼Œè¯­æ³•åˆ†æžï¼ˆ LL ç®—æ³•ï¼Œé€’å½’ä¸‹é™ç®—æ³•ï¼ŒLR ç®—æ³•ï¼‰ï¼Œè¯­ä¹‰åˆ†æžï¼Œè¿è¡Œæ—¶çŽ¯å¢ƒï¼Œä¸­é—´ä»£ç ï¼Œä»£ç ç”Ÿæˆï¼Œä»£ç ä¼˜åŒ–æ“ä½œç³»ç»ŸçŸ¥è¯†Linux çš„å¸¸ç”¨å‘½ä»¤è¿›ç¨‹åŒæ­¥ç¼“å†²åŒºæº¢å‡ºåˆ†æ®µå’Œåˆ†é¡µè™šæ‹Ÿå†…å­˜ä¸Žä¸»å­˜æ•°æ®åº“çŸ¥è¯†MySql æ‰§è¡Œå¼•æ“ŽMySQL æ‰§è¡Œè®¡åˆ’å¦‚ä½•æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚ä½•æ ¹æ®æ‰§è¡Œè®¡åˆ’è¿›è¡Œ SQL ä¼˜åŒ–SQL ä¼˜åŒ–äº‹åŠ¡äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€äº‹åŠ¡èƒ½ä¸èƒ½å®žçŽ°é”çš„åŠŸèƒ½ æ•°æ®åº“é”è¡Œé”ã€è¡¨é”ã€ä½¿ç”¨æ•°æ®åº“é”å®žçŽ°ä¹è§‚é”ã€ æ•°æ®åº“ä¸»å¤‡æ­å»ºbinlogå†…å­˜æ•°æ®åº“h2 å¸¸ç”¨çš„ nosql æ•°æ®åº“redisã€memcached åˆ†åˆ«ä½¿ç”¨æ•°æ®åº“é”ã€NoSql å®žçŽ°åˆ†å¸ƒå¼é”æ€§èƒ½è°ƒä¼˜æ•°æ®ç»“æž„ä¸Žç®—æ³•çŸ¥è¯†ç®€å•çš„æ•°æ®ç»“æž„æ ˆã€é˜Ÿåˆ—ã€é“¾è¡¨ã€æ•°ç»„ã€å“ˆå¸Œè¡¨ã€æ ‘äºŒå‰æ ‘ã€å­—å…¸æ ‘ã€å¹³è¡¡æ ‘ã€æŽ’åºæ ‘ã€B æ ‘ã€B+æ ‘ã€R æ ‘ã€å¤šè·¯æ ‘ã€çº¢é»‘æ ‘ æŽ’åºç®—æ³•å„ç§æŽ’åºç®—æ³•å’Œæ—¶é—´å¤æ‚åº¦ æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆæœç´¢ å…¨æŽ’åˆ—ã€è´ªå¿ƒç®—æ³•ã€KMP ç®—æ³•ã€hash ç®—æ³•ã€æµ·é‡æ•°æ®å¤„ç† å¤§æ•°æ®çŸ¥è¯†ZookeeperåŸºæœ¬æ¦‚å¿µã€å¸¸è§ç”¨æ³• Solrï¼ŒLuceneï¼ŒElasticSearchåœ¨ linux ä¸Šéƒ¨ç½² solrï¼Œsolrcloudï¼Œï¼Œæ–°å¢žã€åˆ é™¤ã€æŸ¥è¯¢ç´¢å¼• Stormï¼Œæµå¼è®¡ç®—ï¼Œäº†è§£ Sparkï¼ŒS4åœ¨ linux ä¸Šéƒ¨ç½² stormï¼Œç”¨ zookeeper åšåè°ƒï¼Œè¿è¡Œ storm hello worldï¼Œlocal å’Œ remote æ¨¡å¼è¿è¡Œè°ƒè¯• storm topologyã€‚ Hadoopï¼Œç¦»çº¿è®¡ç®—HDFSã€MapReduce åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›† flumeï¼Œkafkaï¼Œlogstashæ•°æ®æŒ–æŽ˜ï¼Œmahoutç½‘ç»œå®‰å…¨çŸ¥è¯†ä»€ä¹ˆæ˜¯ XSSXSS çš„é˜²å¾¡ ä»€ä¹ˆæ˜¯ CSRFä»€ä¹ˆæ˜¯æ³¨å…¥æ”»å‡»SQL æ³¨å…¥ã€XML æ³¨å…¥ã€CRLF æ³¨å…¥ ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ æ¼æ´žåŠ å¯†ä¸Žè§£å¯†MD5ï¼ŒSHA1ã€DESã€AESã€RSAã€DSA ä»€ä¹ˆæ˜¯ DOS æ”»å‡»å’Œ DDOS æ”»å‡»memcached ä¸ºä»€ä¹ˆå¯ä»¥å¯¼è‡´ DDos æ”»å‡»ã€ä»€ä¹ˆæ˜¯åå°„åž‹ DDoS SSLã€TLSï¼ŒHTTPSå¦‚ä½•é€šè¿‡ Hash ç¢°æ’žè¿›è¡Œ DOS æ”»å‡»ç”¨ openssl ç­¾ä¸€ä¸ªè¯ä¹¦éƒ¨ç½²åˆ° apache æˆ– nginxå››ã€æž¶æž„ç¯‡åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§ã€æœåŠ¡æ²»ç†ã€æœåŠ¡é™çº§ åˆ†å¸ƒå¼äº‹åŠ¡2PCã€3PCã€CAPã€BASEã€ å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ã€æœ€å¤§åŠªåŠ›é€šçŸ¥ã€TCC DubboæœåŠ¡æ³¨å†Œã€æœåŠ¡å‘çŽ°ï¼ŒæœåŠ¡æ²»ç† åˆ†å¸ƒå¼æ•°æ®åº“æ€Žæ ·æ‰“é€ ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ã€ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†å¸ƒå¼æ•°æ®åº“ã€mycatã€otterã€HBase åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿmfsã€fastdfs åˆ†å¸ƒå¼ç¼“å­˜ç¼“å­˜ä¸€è‡´æ€§ã€ç¼“å­˜å‘½ä¸­çŽ‡ã€ç¼“å­˜å†—ä½™ å¾®æœåŠ¡SOAã€åº·å¨å®šå¾‹ ServiceMeshDocker &amp; KubernetsSpring BootSpring Cloudé«˜å¹¶å‘åˆ†åº“åˆ†è¡¨åˆ†åº“åˆ†è¡¨CDN æŠ€æœ¯æ¶ˆæ¯é˜Ÿåˆ—ActiveMQã€RabbitMQã€Kafka ç›‘æŽ§ç›‘æŽ§ä»€ä¹ˆCPUã€å†…å­˜ã€ç£ç›˜ I/Oã€ç½‘ç»œ I/O ç­‰ ç›‘æŽ§æ‰‹æ®µè¿›ç¨‹ç›‘æŽ§ã€è¯­ä¹‰ç›‘æŽ§ã€æœºå™¨èµ„æºç›‘æŽ§ã€æ•°æ®æ³¢åŠ¨ ç›‘æŽ§æ•°æ®é‡‡é›†æ—¥å¿—ã€åŸ‹ç‚¹ Dapperè´Ÿè½½å‡è¡¡tomcat è´Ÿè½½å‡è¡¡ã€Nginx è´Ÿè½½å‡è¡¡ DNSDNS åŽŸç†ã€DNS çš„è®¾è®¡ CDNæ•°æ®ä¸€è‡´æ€§äº”ã€ æ‰©å±•ç¯‡äº‘è®¡ç®—IaaSã€SaaSã€PaaSã€è™šæ‹ŸåŒ–æŠ€æœ¯ã€openstackã€Serverlsess æœç´¢å¼•æ“ŽSolrã€Luceneã€Nutchã€Elasticsearch æƒé™ç®¡ç†Shiro åŒºå—é“¾å“ˆå¸Œç®—æ³•ã€Merkle æ ‘ã€å…¬é’¥å¯†ç ç®—æ³•ã€å…±è¯†ç®—æ³•ã€Raft åè®®ã€Paxos ç®—æ³•ä¸Ž Raft ç®—æ³•ã€æ‹œå åº­é—®é¢˜ä¸Žç®—æ³•ã€æ¶ˆæ¯è®¤è¯ç ä¸Žæ•°å­—ç­¾å æ¯”ç‰¹å¸æŒ–çŸ¿ã€å…±è¯†æœºåˆ¶ã€é—ªç”µç½‘ç»œã€ä¾§é“¾ã€çƒ­ç‚¹é—®é¢˜ã€åˆ†å‰ ä»¥å¤ªåŠè¶…çº§è´¦æœ¬äººå·¥æ™ºèƒ½æ•°å­¦åŸºç¡€ã€æœºå™¨å­¦ä¹ ã€äººå·¥ç¥žç»ç½‘ç»œã€æ·±åº¦å­¦ä¹ ã€åº”ç”¨åœºæ™¯ã€‚ å¸¸ç”¨æ¡†æž¶TensorFlowã€DeepLearning4J å…¶ä»–è¯­è¨€Groovyã€Pythonã€Goã€NodeJsã€Swiftã€Rust å…­ã€ æŽ¨èä¹¦ç±ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ ã€Š Effective Java ã€‹ ã€Šæ·±å…¥åˆ†æž Java Web æŠ€æœ¯å†…å¹•ã€‹ ã€Šå¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„ã€‹ ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹ ã€Š Head First è®¾è®¡æ¨¡å¼ã€‹ ã€Š maven å®žæˆ˜ã€‹ ã€ŠåŒºå—é“¾åŽŸç†ã€è®¾è®¡ä¸Žåº”ç”¨ã€‹ ã€Š Java å¹¶å‘ç¼–ç¨‹å®žæˆ˜ã€‹ ã€Šé¸Ÿå“¥çš„ Linux ç§æˆ¿èœã€‹ ã€Šä»Ž Paxos åˆ° Zookeeper ã€‹ ã€Šæž¶æž„å³æœªæ¥ã€‹]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Guava CacheåˆæŽ¢]]></title>
    <url>%2F2018%2F06%2F01%2FGuava%E5%88%9D%E6%8E%A2%2F</url>
    <content type="text"><![CDATA[ç¼“å­˜çš„ç±»åˆ«ã€åº”ç”¨åœºæ™¯ &emsp;&emsp;é«˜é€Ÿç¼“å­˜ç®€ç§°ç¼“å­˜ï¼ŒåŽŸå§‹æ„ä¹‰æ˜¯æŒ‡è®¿é—®é€Ÿåº¦æ¯”ä¸€èˆ¬éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆRAMï¼‰å¿«çš„ä¸€ç§RAMï¼Œé€šå¸¸å®ƒä¸åƒç³»ç»Ÿä¸»å­˜é‚£æ ·ä½¿ç”¨DRAMæŠ€æœ¯ï¼Œè€Œä½¿ç”¨æ˜‚è´µä½†è¾ƒå¿«é€Ÿçš„SRAMæŠ€æœ¯ã€‚å½“CPUå¤„ç†æ•°æ®æ—¶ï¼Œå®ƒä¼šå…ˆåˆ°Cacheä¸­åŽ»å¯»æ‰¾ï¼Œå¦‚æžœæ•°æ®å› ä¹‹å‰çš„æ“ä½œå·²ç»è¯»å–è€Œè¢«æš‚å­˜å…¶ä¸­ï¼Œå°±ä¸éœ€è¦å†ä»Žéšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆMain memoryï¼‰ä¸­è¯»å–æ•°æ®â€”â€”ç”±äºŽCPUçš„è¿è¡Œé€Ÿåº¦ä¸€èˆ¬æ¯”ä¸»å†…å­˜çš„è¯»å–é€Ÿåº¦å¿«ï¼Œä¸»å­˜å‚¨å™¨å‘¨æœŸï¼ˆè®¿é—®ä¸»å­˜å‚¨å™¨æ‰€éœ€è¦çš„æ—¶é—´ï¼‰ä¸ºæ•°ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚å› æ­¤è‹¥è¦è®¿é—®ä¸»å†…å­˜çš„è¯ï¼Œå°±å¿…é¡»ç­‰å¾…æ•°ä¸ªCPUå‘¨æœŸä»Žè€Œé€ æˆæµªè´¹ã€‚ &emsp;&emsp; çŽ°åœ¨çš„ç¼“å­˜æ¦‚å¿µä¸ä»…ä»…æ˜¯CPUå’Œä¸»å­˜ä¹‹é—´æœ‰Cacheï¼Œè€Œä¸”åœ¨å†…å­˜å’Œç¡¬ç›˜ä¹‹é—´ä¹Ÿæœ‰ç¼“å­˜ï¼ˆç£ç›˜ç¼“å­˜ï¼‰ï¼Œä¹ƒè‡³åœ¨ç¡¬ç›˜ä¸Žç½‘ç»œä¹‹é—´ä¹Ÿæœ‰æŸç§æ„ä¹‰ä¸Šçš„Cacheâ”€â”€ç§°ä¸ºInternetä¸´æ—¶æ–‡ä»¶å¤¹æˆ–ç½‘ç»œå†…å®¹ç¼“å­˜ç­‰ã€‚å‡¡æ˜¯ä½äºŽé€Ÿåº¦ç›¸å·®è¾ƒå¤§çš„ä¸¤ç§ç¡¬ä»¶ä¹‹é—´ï¼Œç”¨äºŽåè°ƒä¸¤è€…æ•°æ®ä¼ è¾“é€Ÿåº¦å·®å¼‚çš„ç»“æž„ï¼Œå‡å¯ç§°ä¹‹ä¸ºCacheã€‚ æ‘˜å½•è‡ªç»´åŸºç™¾ç§‘ &emsp;&emsp;åœ¨è¿™é‡Œæˆ‘ä»¬è®¨è®ºçš„æ˜¯ç£ç›˜ç¼“å­˜ï¼Œå½“æˆ‘ä»¬åœ¨å®žé™…å¼€å‘ä¸­é‡åˆ°æŸ¥è¯¢è¿œè¿œæ¯”æ›´æ–°ã€æ’å…¥æ“ä½œæ›´å¤šçš„æ—¶å€™å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¼“å­˜ï¼Œç”¨ç©ºé—´æ¥æ¢å–æ—¶é—´çš„ç­–ç•¥ã€‚ JVMç¼“å­˜æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„Mapã€Listéƒ½å±žäºŽJVMç¼“å­˜ï¼Œä½¿ç”¨JVMç¼“å­˜çš„ä¼˜åŠ¿åœ¨äºŽç®€å•ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ åªèƒ½æ˜¾å¼çš„å†™å…¥ã€æ¸…ç†æ•°æ® ä¸èƒ½æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ·˜æ±°æ•°æ®ï¼Œå¦‚ï¼ˆLRUï¼‰ã€å…ˆè¿›å…ˆå‡ºç®—æ³•ï¼ˆFIFOï¼‰ã€æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼ˆLFUï¼‰ã€éžæœ€è¿‘ä½¿ç”¨ç®—æ³•ï¼ˆNMRUï¼‰ è€Œæœ¬æ–‡æåˆ°çš„Guava Cacheæœ‰å¦‚ä¸‹çš„ä¼˜åŠ¿ï¼š å½“ç¼“å­˜çš„æ•°æ®å·²ç»è¶…è¿‡é¢„å…ˆè®¾ç½®çš„æœ€å¤§å€¼æ—¶ï¼Œä½¿ç”¨LRUç®—æ³•ç§»é™¤ä¸€äº›æ•°æ®;ç”±äºŽGuavaCahceæ˜¯åŸºäºŽJVMçš„ç¼“å­˜æ–¹å¼ï¼Œæ‰€ä»¥å®ƒç¼“å­˜çš„å¤§å°å¯¹äºŽæˆ‘ä»¬è‡ªå·±åº”ç”¨çš„æœ¬èº«æœ‰å¾ˆå¤§çš„å½±å“ï¼Œæ‰€ä»¥åœ¨å¿…è¦çš„æ—¶å€™éœ€è¦å¯¹å®ƒè¿›è¡Œéƒ¨åˆ†æŽ§åˆ¶å’Œæ·˜æ±°ï¼Œåœ¨Guavaä¸­é‡‡ç”¨LRUç®—æ³•ã€‚ å…·å¤‡æ ¹æ®entryèŠ‚ç‚¹ä¸Šæ¬¡è¢«è®¿é—®æˆ–è€…å†™å…¥çš„æ—¶é—´æ¥è®¡ç®—è¿‡æœŸæœºåˆ¶ï¼›ä¾‹å¦‚åœ¨åˆå§‹åŒ–loadingCacheå¯¹è±¡çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥æŒ‡å®šå†™å…¥çš„èŠ‚ç‚¹ç»è¿‡å¤šé•¿æ—¶é—´æ²¡æœ‰æ›´æ–°æ“ä½œï¼Œå°±ä¼šè¢«æ·˜æ±°ï¼ˆexpireAfterWriteï¼‰ ç¼“å­˜çš„keyè¢«å°è£…åœ¨WeakReferenceå¼•ç”¨å†…;åŒæ ·ä¸ºäº†è®©ç¼“å­˜ä¸ä¼šå½±å“åˆ°è‡ªå·±çš„åº”ç”¨ï¼ŒGuavaå¼•å…¥äº†è½¯ã€å¼±å¼•ç”¨ï¼›å½“ç¼“å­˜å¤ªå¤§ï¼Œæˆ–è€…ç¼“å­˜åœ¨GCçš„æ—¶å€™æ— æ³•è¢«å›žæ”¶æŽ‰ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç›´æŽ¥å°†è¿™éƒ¨åˆ†æ•°æ®å›žæ”¶æŽ‰ã€‚ ç§»é™¤entryèŠ‚ç‚¹ï¼Œå¯ä»¥è§¦å‘ç›‘å¬å™¨é€šçŸ¥äº‹ä»¶ï¼›ä¸€èˆ¬åœ¨Guava Cacheä¸­åˆ é™¤entryå¯¹äºŽæˆ‘ä»¬æ˜¯é€æ˜Žçš„ï¼Œä½†æ˜¯Guavaä¸ºæˆ‘ä»¬æä¾›äº†removeLinstenerï¼Œè¿™æ ·æˆ‘ä»¬åœ¨åˆ é™¤entryçš„æ—¶å€™å¯¹æˆ‘ä»¬å¯è§ã€‚ ç»Ÿè®¡ç¼“å­˜ä½¿ç”¨è¿‡ç¨‹ä¸­å‘½ä¸­çŽ‡/å¼‚å¸¸çŽ‡/æœªå‘½ä¸­çŽ‡ç­‰æ•°æ®ã€‚ &emsp;&emsp;&ensp;åŒæ—¶ï¼ŒGuava Cacheå’ŒConcurrentHashMap çš„æ ¸å¿ƒæ•°æ®ç»“æž„ä¸€è‡´ï¼Œå®žé™…ä¸ŠGuavaçš„æ ¸å¿ƒç±»LocalCacheå®žçŽ°äº†ConcurrentMapï¼Œæ‰€ä»¥Guava Cache Cacheå’ŒConcurrentHashMapæ˜¯æœ‰â€œä¸€æ ·çš„è¡€ç»Ÿâ€ï¼Œä½†æ˜¯åœ¨å…·ä½“åŠŸèƒ½ä¸Šè¿˜æœ‰æœ‰ä¸€äº›åŒºåˆ«ï¼ŒConcurrentHashMap ä¼šä¸€è‡´ä¿å­˜æ‰€æœ‰æ·»åŠ çš„å…ƒç´ ï¼Œç›´åˆ°æ˜¾å¼çš„ç§»é™¤ï¼Œè€ŒGuava Cacheåˆ™åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å°±éœ€è¦è®¾ç½®è‡ªåŠ¨å›žæ”¶å…ƒç´ çš„æ–¹å¼ã€‚ åˆ†å¸ƒå¼ç¼“å­˜ä¸Šé¢çš„å‡ ç§æ”¾ç¼“æ–¹å¼éƒ½åªèƒ½æ˜¯åœ¨å•èŠ‚ç‚¹ä¸­ä½¿ç”¨ï¼Œè€Œå¯¹äºŽåœ¨åˆ†å¸ƒå¼çš„çŽ¯å¢ƒä¸‹åˆ™éœ€è¦ä½¿ç”¨Redisã€Memcachedè¿™æ ·çš„ç¼“å­˜ä¸­é—´ä»¶äº†ã€‚ å¦‚ä½•ä½¿ç”¨Guava Cacheé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨pomæ–‡ä»¶åŠ å…¥ç›¸å…³çš„ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;21.0&lt;/version&gt; &lt;/dependency&gt; ç„¶åŽæˆ‘ä»¬å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªLoadingCacheå¯¹è±¡ 123456789&lt;div&gt; &lt;ul&gt; &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt; &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt; &lt;li class="item-inactive"&gt;&lt;a href="link3.html"&gt;&lt;span class="bold"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; &lt;li class="item-1"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt; &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; 12345678910111213141516171819202122232425262728private LoadingCache&lt;String, String&gt; loadingCache ;private void init() throws InterruptedException &#123; loadingCache = CacheBuilder.newBuilder() // è‹¥åœ¨2ç§’ä»¥å†…æ²¡æœ‰è¢«æ›´æ–°å°±ä¼šexpire .expireAfterWrite(2, TimeUnit.SECONDS) //å½“entriesæŽ¥è¿‘maximumSizeçš„æ—¶å€™å°±ä¼šé©±èµ¶å‡ºä¸€ä¸ªæœ€è¿‘æœ€å°‘ç”¨çš„entry .maximumSize(1000) .build(new CacheLoader&lt;String, String&gt;() &#123; @Override public String load(String key) &#123; return "kobe"; &#125; &#125;); for (int i = 10; i &lt; 15; i++) &#123; QUEUE.put("jordan" + i); &#125; &#125;private void testCache() &#123; try &#123; TimeUnit.SECONDS.sleep(3); logger.info("å½“å‰ç¼“å­˜å€¼ : &#123;&#125;,ç¼“å­˜å¤§å° : &#123;&#125;", loadingCache.get(KEY), loadingCache.size()); loadingCache.get(key); &#125; catch (ExecutionException e ) &#123; logger.error("Exception", e); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125; ä¸Šè¾¹åˆå§‹åŒ–æ˜¯ç»™å®š2ç§’é’Ÿå†…è‹¥æ²¡æœ‰è¢«æ›´æ–°å°±å¤±æ•ˆï¼Œè€Œæˆ‘ä»¬è°ƒç”¨testCacheæ–¹æ³•ä¸­å…ˆsleepäº†3ç§’ï¼Œæ‰€ä»¥æ­¤æ—¶ç¼“å­˜ä¸­çš„å€¼ä¸€å®šæ˜¯å¤±æ•ˆéƒ½æ¸…é™¤æŽ‰äº†ã€‚ä¸‹é¢æˆ‘ä»¬å¯ä»¥é€šè¿‡debugä¸€æ­¥ä¸€æ­¥çœ‹çœ‹loadingCache.get(key)è¿™ä¸ªæ–¹æ³•åˆ°åº•æ˜¯æ€Žæ ·èŽ·å–åˆ°å¯¹åº”çš„å€¼çš„ã€‚ 1234V get(K key, CacheLoader&lt;? super K, V&gt; loader) throws ExecutionException &#123; int hash = hash(checkNotNull(key)); return segmentFor(hash).get(key, hash, loader); &#125; é¦–å…ˆå¯ä»¥çœ‹åˆ°å°†keyå“ˆå¸Œä¸€æ¬¡ï¼Œé€šè¿‡hashå’ŒsegmentShiftã€segmentMaskåšä½è¿ç®—å¾—åˆ°å¯¹åº”çš„ä¸‹æ ‡ã€‚åœ¨è¿™ä¸€ç‚¹å’ŒConcurrentHashMap æ˜¯ä¸€è‡´çš„ã€‚ 123456789101112131415161718192021222324V get(K key, int hash, CacheLoader&lt;? super K, V&gt; loader) throws ExecutionException &#123; checkNotNull(key); checkNotNull(loader); try &#123; if (count != 0) &#123; // read-volatile // don't call getLiveEntry, which would ignore loading values ReferenceEntry&lt;K, V&gt; e = getEntry(key, hash); if (e != null) &#123; long now = map.ticker.read(); // èŽ·å–æ²¡æœ‰å¤±æ•ˆã€è¿‡æœŸçš„entry V value = getLiveValue(e, now); if (value != null) &#123; recordRead(e, now); statsCounter.recordHits(1); return scheduleRefresh(e, key, hash, value, now, loader); &#125; ValueReference&lt;K, V&gt; valueReference = e.getValueReference(); if (valueReference.isLoading()) &#123; return waitForLoadingValue(e, key, valueReference); &#125; &#125; &#125; ... &#125; åœ¨ä¸Šé¢æ–¹æ³•é‡Œè¾¹æ¯”è¾ƒå…³é”®çš„æ˜¯V value = getLiveValue(e, now);è¿™è¡Œï¼ŒåŽ»èŽ·å–ä»ç„¶æœ‰æ•ˆçš„valueï¼Œç»§ç»­è¿½è¸ª 12345678910111213141516V getLiveValue(ReferenceEntry&lt;K, V&gt; entry, long now) &#123; if (entry.getKey() == null) &#123; tryDrainReferenceQueues(); return null; &#125; V value = entry.getValueReference().get(); if (value == null) &#123; tryDrainReferenceQueues(); return null; &#125; if (map.isExpired(entry, now)) &#123; tryExpireEntries(now); return null; &#125; return value; &#125; ä»Žif (map.isExpired(entry, now))è¿™è¡Œå¯ä»¥çœ‹åˆ°æ˜¯å¦è¿‡æœŸæ˜¯é€šè¿‡æ—¶é—´æ¥åˆ¤æ–­çš„ 12345678910boolean isExpired(ReferenceEntry&lt;K, V&gt; entry, long now) &#123; checkNotNull(entry); if (expiresAfterAccess() &amp;&amp; (now - entry.getAccessTime() &gt;= expireAfterAccessNanos)) &#123; return true; &#125; if (expiresAfterWrite() &amp;&amp; (now - entry.getWriteTime() &gt;= expireAfterWriteNanos)) &#123; return true; &#125; return false; &#125; å»ºé€ è€…æ¨¡å¼ä¸Šè¾¹æˆ‘ä»¬åœ¨åˆå§‹åŒ–loadingCacheå¯¹è±¡æ—¶ï¼Œè‡ªä¸»é€‰æ‹©æ€§çš„åˆå§‹åŒ–äº†è‡ªå·±çš„å‚æ•°ã€‚é‡‡ç”¨å»ºé€ è€…æ¨¡å¼èµ‹äºˆçš„çµæ´»æ€§å¯¹äºŽåˆå§‹åŒ–å‚æ•°è¾ƒå¤šã€è‡ªå®šä¹‰ç¨‹åº¦é«˜çš„å¯¹è±¡æ—¶ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ guava cacheä¸ºæˆ‘ä»¬æä¾›äº†ä¸‹é¢è¿™äº›åˆå§‹åŒ–æ–¹æ³•ã€‚ 1234567public CacheBuilder&lt;K, V&gt; maximumSize(long size)public CacheBuilder&lt;K, V&gt; initialCapacity(int initialCapacity)public CacheBuilder&lt;K, V&gt; maximumWeight(long weight)public CacheBuilder&lt;K, V&gt; refreshAfterWrite(long duration, TimeUnit unit)CacheBuilder&lt;K, V&gt; setValueStrength(Strength strength)public CacheBuilder&lt;K, V&gt; softValues() .... å‚è€ƒï¼š Guava æºç åˆ†æžï¼ˆCache åŽŸç†ï¼‰ guava Cacheæºç åˆ†æžï¼ˆäºŒï¼‰]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•åœ¨ubuntu16.04ä¸­æ­å»ºredisé›†ç¾¤]]></title>
    <url>%2F2018%2F04%2F01%2F%E5%A6%82%E4%BD%95%E5%9C%A8ubuntu16.04%E4%B8%AD%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4%2F</url>
    <content type="text"><![CDATA[å¦‚ä½•åœ¨ubuntu16.04ä¸­æ­å»ºredisé›†ç¾¤ è¦æƒ³æ­å»ºä¸€ä¸ªæœ€ç®€å•çš„Redisé›†ç¾¤ï¼Œé‚£ä¹ˆè‡³å°‘éœ€è¦6ä¸ªèŠ‚ç‚¹ï¼š3ä¸ªMasterå’Œ3ä¸ªSlaveã€‚ åœ¨ubuntu16.04ä¸­å®‰è£…redis 12345678910111213//ä¸‹è½½axel -n 5 http://download.redis.io/releases/redis-4.0.9.tar.gz//è§£åŽ‹tar -zxvf redis-4.0.9.tar.gzç¼–è¯‘make//ä¸ºäº†æ–¹ä¾¿å¯åŠ¨redisï¼Œåœ¨profileä¸­æ·»åŠ PATH#SET REDIS_HOMEexport REDIS_HOME=/opt/local/software/redis-4.0.9export PATH=$PATH:$REDIS_HOME/src ç„¶åŽå°è¯•å¯åŠ¨redisæ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸï¼Œè‹¥å‡ºçŽ°ä¸‹é¢çš„å†…å®¹è¯´æ˜Žå®‰è£…æˆåŠŸã€‚ é…ç½®redisé›†ç¾¤ç”±äºŽç”µè„‘é…ç½®æœ‰é™ï¼Œä¸å¤§å¯èƒ½å®‰è£…é‚£ä¹ˆå¤šè™šæ‹Ÿæœºã€‚å¯ä»¥åœ¨ä¸€å°è™šæ‹Ÿæœºä¸­å¼€å¯å¤šä¸ªrediså®žä¾‹ï¼Œå°†è¿™å¤šä¸ªå®žä¾‹ç»„å»ºæˆä¸€ä¸ªredisé›†ç¾¤ã€‚é¦–å…ˆåˆ›å»ºå…­ä¸ªæ–‡ä»¶å¤¹ï¼Œå°†redis-confæ–‡ä»¶copyåˆ°æ¯ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚ 123456cp ../redis-4.0.9/redis.conf ./8001cp ../redis-4.0.9/redis.conf ./8002cp ../redis-4.0.9/redis.conf ./8003cp ../redis-4.0.9/redis.conf ./8004cp ../redis-4.0.9/redis.conf ./8005cp ../redis-4.0.9/redis.conf ./8006 redisé…ç½®æ–‡ä»¶123456789101112131415161718# redis æä¾›æœåŠ¡æ—¶ç»‘å®šçš„æœ¬æœºç½‘ç»œåœ°å€ï¼Œå¯ä»¥æ˜¯å¤šä¸ªæ»¡è¶³å¤šå—ç½‘å¡åˆ†åˆ«å¯¹å¤–ç½‘å†…ç½‘çš„è®¿é—®, æŒ‰éœ€è¦æ”¹bind 127.0.0.1# æä¾›æœåŠ¡çš„ç«¯å£, ä¾›å®¢æˆ·ç«¯è¿žæŽ¥port 8001# å¯åŠ¨redisæœåŠ¡æ—¶,è¿›ç¨‹pidå­˜å‚¨ä½ç½®pidfile /opt/local/software/redis-node/8001/redis.pid# redis æ—¥å¿—æ–‡ä»¶æ‰€åœ¨logfile &quot;/opt/local/software/redis-node/8001/log.txt&quot;# æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨ç›®å½•dir /opt/local/software/redis-node/8001# å¼€å¯é›†ç¾¤æ¨¡å¼cluster-enabled yes# é›†ç¾¤æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹é…ç½®ä¿¡æ¯cluster-config-file nodes.conf# é›†ç¾¤ä¸­å„èŠ‚ç‚¹é—´è¿žæŽ¥è¶…æ—¶æ—¶é—´cluster-node-timeout 5000# å…è®¸æ•°æ®æŒä¹…åŒ–è¿½åŠ appendonly yes ç„¶åŽæ ¹æ®ä¸Šé¢çš„é…ç½®æ–‡ä»¶å°†æ¯ä¸€ä¸ªrediså®žä¾‹çš„ç«¯å£å·ã€ç›®å½•ã€æ—¥å¿—æ–‡ä»¶ç­‰ç­‰æŒ‰ç…§å…·ä½“çš„æƒ…å†µè®¾ç½®ã€‚ å¯åŠ¨redis123456redis-server 8001/redis.confredis-server 8002/redis.confredis-server 8003/redis.confredis-server 8004/redis.confredis-server 8005/redis.confredis-server 8006/redis.conf å¯åŠ¨å®Œæˆä¹‹åŽå…ˆæŸ¥çœ‹ä¸€ä¸‹å„ä¸ªèŠ‚ç‚¹æ˜¯å¦å¯åŠ¨æˆåŠŸ 12345678910leon at leon_ubuntu in /opt/local/software/redis-node $ ps aux | grep redisleon 15499 0.0 0.1 50908 5580 pts/19 Sl+ 14:22 0:02 redis-server 127.0.0.1:8001 [cluster]leon 15506 0.0 0.1 50908 5580 pts/4 Sl+ 14:22 0:02 redis-server 127.0.0.1:8002 [cluster]leon 15511 0.0 0.1 50908 5536 pts/18 Sl+ 14:23 0:02 redis-server 127.0.0.1:8003 [cluster]leon 15516 0.0 0.1 50908 5320 pts/21 Sl+ 14:23 0:02 redis-server 127.0.0.1:8004 [cluster]leon 15521 0.0 0.1 50908 5436 pts/20 Sl+ 14:23 0:02 redis-server 127.0.0.1:8005 [cluster]leon 15526 0.0 0.1 50908 5464 pts/22 Sl+ 14:23 0:02 redis-server 127.0.0.1:8006 [cluster]leon 15536 0.0 0.0 14352 2624 pts/23 S+ 14:23 0:00 redis-cli -c -p 8001leon 15886 0.0 0.0 14224 936 pts/25 S+ 15:05 0:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn redis ä¸Šé¢çš„å‡ ä¸ªèŠ‚ç‚¹éƒ½å·²ç»å¯åŠ¨æˆåŠŸäº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç»„å»ºæˆä¸ºé›†ç¾¤ï¼Œè¦æƒ³ç»„å»ºä¸€ä¸ªé›†ç¾¤è¿˜éœ€è¦ä½¿ç”¨redis-trib.rbå·¥å…·å°†ä¸Šé¢å…­ä¸ªèŠ‚ç‚¹è¿žæŽ¥èµ·æ¥ã€‚ä½†æ˜¯å®ƒéœ€è¦åœ¨rubyçš„çŽ¯å¢ƒä¸‹è¿è¡Œå¹¶ä¸”åœ¨è¿™ä¸ªçŽ¯å¢ƒä¸‹å®‰è£…å¯¹åº”çš„redisæ’ä»¶ã€‚1sudo gem install redis å®‰è£…å®Œæˆä¹‹åŽæ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤å°†rediså®žä¾‹ç»„å»ºæˆä¸€ä¸ªé›†ç¾¤1redis-trib.rb create --replicas 1 127.0.0.1:8001 127.0.0.1:8002 127.0.0.1:8003 127.0.0.1:8004 127.0.0.1:8005 127.0.0.1:8006 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253leon at leon_ubuntu in /opt/local/software/redis-4.0.9/src $ redis-trib.rb create --replicas 1 127.0.0.1:8001 127.0.0.1:8002 127.0.0.1:8003 127.0.0.1:8004 127.0.0.1:8005 127.0.0.1:8006&gt;&gt;&gt; Creating cluster&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...Using 3 masters:127.0.0.1:8001127.0.0.1:8002127.0.0.1:8003Adding replica 127.0.0.1:8005 to 127.0.0.1:8001Adding replica 127.0.0.1:8006 to 127.0.0.1:8002Adding replica 127.0.0.1:8004 to 127.0.0.1:8003&gt;&gt;&gt; Trying to optimize slaves allocation for anti-affinity[WARNING] Some slaves are in the same host as their masterM: 1bc512b4d4b5d0c73a72d97e7d70ea307db7ae96 127.0.0.1:8001 slots:0-5460 (5461 slots) masterM: b9b6ff12c2a788a708a5fc754ee6e9add83ef089 127.0.0.1:8002 slots:5461-10922 (5462 slots) masterM: 01742676bd6bb86313c44365df28328a383a007f 127.0.0.1:8003 slots:10923-16383 (5461 slots) masterS: 5d3d629269a52017f0e1fb5d043f5797319aa306 127.0.0.1:8004 replicates 1bc512b4d4b5d0c73a72d97e7d70ea307db7ae96S: ab65c3dd627b885d60e7f01d69acc7fbd1db50b0 127.0.0.1:8005 replicates b9b6ff12c2a788a708a5fc754ee6e9add83ef089S: 2487d2d01333914e7d407a7fe89ddfa2f12884a9 127.0.0.1:8006 replicates 01742676bd6bb86313c44365df28328a383a007fCan I set the above configuration? (type &apos;yes&apos; to accept): yes&gt;&gt;&gt; Nodes configuration updated&gt;&gt;&gt; Assign a different config epoch to each node&gt;&gt;&gt; Sending CLUSTER MEET messages to join the clusterWaiting for the cluster to join..&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:8001)M: 1bc512b4d4b5d0c73a72d97e7d70ea307db7ae96 127.0.0.1:8001 slots:0-5460 (5461 slots) master 1 additional replica(s)M: b9b6ff12c2a788a708a5fc754ee6e9add83ef089 127.0.0.1:8002 slots:5461-10922 (5462 slots) master 1 additional replica(s)S: 2487d2d01333914e7d407a7fe89ddfa2f12884a9 127.0.0.1:8006 slots: (0 slots) slave replicates 01742676bd6bb86313c44365df28328a383a007fS: 5d3d629269a52017f0e1fb5d043f5797319aa306 127.0.0.1:8004 slots: (0 slots) slave replicates 1bc512b4d4b5d0c73a72d97e7d70ea307db7ae96M: 01742676bd6bb86313c44365df28328a383a007f 127.0.0.1:8003 slots:10923-16383 (5461 slots) master 1 additional replica(s)S: ab65c3dd627b885d60e7f01d69acc7fbd1db50b0 127.0.0.1:8005 slots: (0 slots) slave replicates b9b6ff12c2a788a708a5fc754ee6e9add83ef089[OK] All nodes agree about slots configuration.&gt;&gt;&gt; Check for open slots...&gt;&gt;&gt; Check slots coverage...[OK] All 16384 slots covered. ä¸Šé¢çš„æ—¥å¿—æ‰“å°çœ‹å‡ºå·²ç»æˆåŠŸå°†6ä¸ªèŠ‚ç‚¹å…¨éƒ¨ç»„å»ºæˆä¸€ä¸ªredisé›†ç¾¤äº†ï¼ŒåŒæ—¶å°†[8001,8002,8003]ä½œä¸ºmasterï¼Œ[8004ï¼Œ8005ï¼Œ8006]ä¸ºå‰é¢ä¸‰ä¸ªçš„å¤åˆ¶èŠ‚ç‚¹ã€‚ è‡³æ­¤redisé›†ç¾¤æ­å»ºå®Œæˆã€‚ å‚è€ƒï¼š ubuntuå®‰è£…redisé›†ç¾¤ å¦‚ä½•åœ¨Ubuntu 14.04é…ç½®çš„Redisé›†ç¾¤ Linuxä¸‹Redisé›†ç¾¤å®‰è£…éƒ¨ç½²åŠä½¿ç”¨è¯¦è§£]]></content>
      <categories>
        <category>ä¸­é—´ä»¶</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æµ…æžjavaè¯­è¨€ä¸­é”æœºåˆ¶]]></title>
    <url>%2F2018%2F03%2F17%2F%E6%B5%85%E6%9E%90java%E8%AF%AD%E8%A8%80%E4%B8%AD%E9%94%81%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[æµ…æžjavaè¯­è¨€ä¸­é”æœºåˆ¶ &emsp;&emsp;å¤šä»»åŠ¡å¹¶å‘å·²ç»æ˜¯è®¡ç®—æœºä¸­ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†äº†ï¼Œå¾ˆå¤šæ—¶å€™è®©è®¡ç®—æœºåŒä¸€æ—¶åˆ»åšå‡ ä»¶äº‹ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºè¿ç®—èƒ½åŠ›æé«˜äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦åŽŸå› å°±æ˜¯cpuçš„è¿ç®—é€Ÿåº¦å’Œå­˜å‚¨ã€é€šä¿¡å­ç³»ç»Ÿé€Ÿåº¦å·®å¼‚å¤ªå¤§ã€‚æ‰€ä»¥ä¸å¾—ä¸â€œåŽ‹æ¦¨â€è¿ç®—èƒ½åŠ›ã€‚ è€ŒåŽ‹æ¦¨è¿ç®—èƒ½åŠ›å°±ä¸å¾—ä¸ç”¨åˆ°å¤šçº¿ç¨‹ï¼Œåœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹è¿ç®—çŽ¯å¢ƒè¾ƒä¸ºç®€å•ï¼Œè€Œåˆ°äº†å¤šçº¿ç¨‹æƒ…å†µä¸‹åˆ™ä¼šäº§ç”Ÿå¾ˆå¤šæ„æƒ³ä¸åˆ°çš„ç»“æžœã€‚è¦ä¿è¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å„ä¸ªçº¿ç¨‹â€œç›¸å®‰æ— äº‹â€çš„è¿è¡Œï¼Œåˆ™å¿…é¡»ç”¨åˆ°é”æœºåˆ¶ã€‚ javaå†…å­˜æ¨¡åž‹åœ¨è®²é”æœºåˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆäº†è§£jvmçš„å†…å­˜æ¨¡åž‹ã€‚ æ¨¡åž‹å›¾å¦‚ä¸‹ &emsp;&emsp;javaçº¿ç¨‹è¯»å†™æ•°æ®æ˜¯ç›´æŽ¥è¯»å†™å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œå·¥ä½œå†…å­˜å¯èƒ½å¹¶éžæ˜¯ç‰©ç†å†…å­˜ï¼Œä¸ºäº†æ€§èƒ½å¾ˆå¤§å¯èƒ½æ˜¯é«˜é€Ÿç¼“å­˜å’Œå¯„å­˜å™¨ã€‚çº¿ç¨‹é—´é€šä¿¡å¿…é¡»é€šè¿‡å†…å†…å­˜æ¥å®žçŽ°ã€‚å‡è®¾åˆå§‹å€¼x = 0ï¼Œ ç„¶åŽçº¿ç¨‹Aå°†xå€¼ä¿®æ”¹ä¸º1ï¼Œ é‚£ä¹ˆBè¦çŸ¥é“æ­¤æ—¶Aä¿®æ”¹è¿‡åŽçš„å€¼å°±å¿…é¡»æ˜¯Açº¿ç¨‹å…ˆå°†å€¼ä»Žå·¥ä½œå†…å­˜ä¸­å†™å…¥åˆ°ä¸»å†…å­˜ï¼Œç„¶åŽçº¿ç¨‹Bå†ä»Žä¸»å†…å­˜ä¸­è¯»å–xçš„å€¼ï¼Œå¦‚æ­¤å®Œæˆçº¿ç¨‹é—´çš„é€šä¿¡â€“å…±äº«å†…å­˜çš„æ–¹å¼ã€‚ JVMå†…å­˜æ¨¡åž‹å›´ç»•ä¸‰ä¸ªç‚¹è¿›è¡Œï¼š åŽŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ã€‚ åŽŸå­æ€§ï¼šä¸å¯åˆ†å‰²ï¼Œjavaä¸­çš„åŸºæœ¬ç±»åž‹çš„è¯»å†™åŸºæœ¬å¯ä»¥è®¤ä¸ºæ˜¯åŽŸå­æ“ä½œï¼Œå¦‚æžœè¦åœ¨æ›´å¤§èŒƒå›´å†…ä¿è¯åŽŸå­æ€§ï¼Œå¯ä»¥æ˜¯ç”¨synchronizedæ¥ä¿è¯åŽŸå­æ€§ã€‚ å¯è§æ€§ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªå˜åŒ–ã€‚volatileã€synchronizedã€finaléƒ½èƒ½å¤Ÿä¿è¯å†…å­˜å¯è§æ€§ã€‚volatileèƒ½å¤Ÿä¿è¯ä¸€ä¸ªè¢«ä¿®æ”¹ä¹‹åŽç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œç„¶åŽå…¶ä»–çº¿ç¨‹ä½¿ç”¨åˆ°è¢«volatileä¿®é¥°çš„å˜é‡æ—¶ï¼Œå¿…é¡»å…ˆä»Žä¸»å†…å­˜ä¸­åŒæ­¥åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚synchronizedä¿è¯å¯è§æ€§æ˜¯ä¸€ä¸ªçº¿ç¨‹unlockæ—¶ï¼Œå¿…é¡»å°†ä¿®æ”¹çš„å€¼åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œä¸‹ä¸€ä¸ªèŽ·å–åˆ°lockçš„çº¿ç¨‹å¿…é¡»å…ˆåŒæ­¥ä¸»å†…å­˜æ•°æ®ï¼Œä»Žè€Œä¿è¯å¯è§æ€§ã€‚ æœ‰åºæ€§ï¼šå¦‚æžœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æžœåœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚ å‰é¢åŠå¥æ„æ€æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…è¡¨çŽ°ä¸ºä¸²è¡Œçš„è¯­ä¹‰ï¼ŒåŽåŠå¥æ˜¯â€œæŒ‡ä»¤é‡æŽ’åºâ€çŽ°è±¡å’Œâ€œå·¥ä½œå†…å­˜ä¸Žä¸»å†…å­˜ä¹‹é—´å»¶è¿Ÿâ€çŽ°è±¡ã€‚ å…ˆè¡Œå‘ç”Ÿï¼šæŒ‡çš„æ˜¯å¦‚æžœAå…ˆè¡Œå‘ç”ŸäºŽBï¼Œé‚£ä¹ˆæ“ä½œAçš„å½±å“èƒ½å¤Ÿè¢«æ“ä½œBè§‚å¯Ÿåˆ°ï¼Œâ€œå½±å“â€åŒ…æ‹¬ä¿®æ”¹äº†å…±äº«å†…å­˜å˜é‡çš„å€¼ã€å‘é€çš„æ¶ˆæ¯ã€è°ƒç”¨æ–¹æ³•ç­‰ã€‚ç”±äºŽä¼˜åŒ–é‡æŽ’åºçš„åŽŸå› ï¼Œæ“ä½œä¹‹é—´çš„æ—¶é—´ä¸Šå…ˆåŽæ‰§è¡Œå’Œâ€œå…ˆè¡Œå‘ç”Ÿâ€å¹¶æ²¡æœ‰å…³ç³»ã€‚ volatile éœ€è¦æ³¨æ„çš„æ˜¯volatileå¹¶ä¸æ˜¯é”ï¼Œå®ƒæ˜¯jvmæä¾›çš„æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚å¤§å¤šæ•°äººå¯¹volatileçš„åŽŸç†å’Œä½¿ç”¨å¹¶ä¸æ¸…æ¥šã€‚volatileä¸»è¦å…·å¤‡ä¸¤ä¸ªç‰¹æ€§ï¼š ä¿è¯å†…å­˜å¯è§æ€§ ç¦æ­¢æŒ‡ä»¤é‡æŽ’åº å†…å­˜å¯è§æ€§&emsp;&emsp;è¢«volatileä¿®é¥°çš„å˜é‡ï¼Œè¢«çº¿ç¨‹ä¿®æ”¹ä¹‹åŽä¼šç«‹å³ä»Žå·¥ä½œå†…å­˜ä¸­åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹è‹¥è¦è¯»è¢«volatileä¿®é¥°çš„å˜é‡åˆ™å¿…é¡»å…ˆä»Žä¸»å†…å­˜ä¸­åŒæ­¥æœ€æ–°çš„å€¼ï¼Œè¿™æ ·å°±ä¿è¯äº†çº¿ç¨‹ä¹‹é—´å˜é‡çš„åŒæ­¥ã€‚ä½†æ˜¯çº¿ç¨‹ä¹‹é—´å˜é‡çš„å€¼å¹¶éžç«‹å³åŒæ­¥çš„ï¼Œå„ä¸ªçº¿ç¨‹ä¹‹é—´çš„å€¼å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯ç”±äºŽæ¯ä¸€æ¬¡è¯»çš„æ—¶å€™éƒ½ä»Žä¸»å†…å­˜ä¸­æ›´æ–°ï¼Œå› æ­¤ä¹Ÿä¸è®¤ä¸ºå­˜æœ‰ä¸ä¸€è‡´çš„æƒ…å†µã€‚ ä½†æ˜¯ç”±äºŽvolatileåªèƒ½ä¿è¯å¯è§æ€§ï¼Œå¹¶ä¸ä¿è¯åŽŸå­æ€§ï¼Œæ‰€ä»¥åœ¨ä¸ç¬¦åˆä¸‹é¢çš„ä¸¤ç§æƒ…å†µè¿˜æ˜¯éœ€è¦é€šè¿‡åŠ é”æ¥ä¿è¯åŽŸå­æ€§ã€‚ è¿ç®—ç»“æžœå¹¶ä¸ä¾èµ–å½“å‰å€¼ ä¾‹å¦‚ï¼š a++ ã€ b += 3 å˜é‡ä¸éœ€è¦å‚åŠ å…¶ä»–çŠ¶æ€å˜é‡å…±åŒå‚ä¸Žä¸å˜çº¦æŸã€‚ ä¾‹å¦‚ï¼š low &lt; up ç¦æ­¢æŒ‡ä»¤é‡æŽ’åº &emsp;&emsp;çŽ°ä»£cpuä¸ºäº†æé«˜æ‰§è¡Œæ•ˆçŽ‡ï¼Œä¸€ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œè¢«åˆ†æˆï¼šå–æŒ‡ã€è¯‘ç ã€è®¿å­˜ã€æ‰§è¡Œã€å†™å›žã€ç­‰è‹¥å¹²ä¸ªé˜¶æ®µã€‚ç„¶åŽï¼Œå¤šæ¡æŒ‡ä»¤å¯ä»¥åŒæ—¶å­˜åœ¨äºŽæµæ°´çº¿ä¸­ï¼ŒåŒæ—¶è¢«æ‰§è¡Œã€‚ä½†æ˜¯æ— è®ºæ€Žæ ·é‡æŽ’åºå¿…é¡»è¦æ»¡è¶³as-if-serialè¯­ä¹‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹ç¼–ç¨‹å¹¶ä¸éœ€è¦è€ƒè™‘ä»£ç æ‰§è¡Œé¡ºåºçš„é—®é¢˜ï¼Œå› ä¸ºæ— è®ºæ€Žæ ·æŽ’åºï¼Œæœ€åŽæ‰§è¡Œçš„ç»“æžœæ€»æ˜¯å’Œé¡ºåºæ‰§è¡Œçš„ç»“æžœä¸€è‡´ã€‚ &emsp;&emsp;&ensp; ç¦æ­¢é‡æŽ’åºæ—¶å€™é€šè¿‡å†…å­˜å±éšœæ¥å®žçŽ°çš„ï¼Œå³æ˜¯è¯´é‡æŽ’åºæ—¶ä¸èƒ½è®²åŽé¢çš„æŒ‡ä»¤é‡æŽ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ã€‚è‹¥åªæœ‰ä¸€ä¸ªcpuè®¿é—®å†…å­˜æ—¶å¹¶ä¸éœ€è¦å†…å­˜å±éšœï¼Œè‹¥å¤šä¸ªcpuè®¿é—®å†…å­˜æ—¶ï¼Œå¹¶ä¸”ä¸€ä¸ªæ­£åœ¨è§‚å¯Ÿå¦å¤–ä¸€ä¸ªæ—¶ï¼Œå°±éœ€è¦å†…å­˜å±éšœæ¥ä¿è¯ä¸€è‡´æ€§ã€‚ &emsp;&emsp;&ensp; ä¸‹é¢æ‘˜è‡ªã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼š â€œè§‚å¯ŸåŠ å…¥volatileå…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥volatileå…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å‘çŽ°ï¼ŒåŠ å…¥volatileå…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ªlockå‰ç¼€æŒ‡ä»¤â€lockå‰ç¼€æŒ‡ä»¤å®žé™…ä¸Šç›¸å½“äºŽä¸€ä¸ªå†…å­˜å±éšœï¼ˆä¹Ÿæˆå†…å­˜æ …æ ï¼‰ï¼Œå†…å­˜å±éšœä¼šæä¾›3ä¸ªåŠŸèƒ½ï¼š 1ã€å®ƒç¡®ä¿æŒ‡ä»¤é‡æŽ’åºæ—¶ä¸ä¼šæŠŠå…¶åŽé¢çš„æŒ‡ä»¤æŽ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æŽ’åˆ°å†…å­˜å±éšœçš„åŽé¢ï¼›å³åœ¨æ‰§è¡Œåˆ°å†…å­˜å±éšœè¿™å¥æŒ‡ä»¤æ—¶ï¼Œåœ¨å®ƒå‰é¢çš„æ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼› 2ï¼‰å®ƒä¼šå¼ºåˆ¶å°†å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼› 3ï¼‰å¦‚æžœæ˜¯å†™æ“ä½œï¼Œå®ƒä¼šå¯¼è‡´å…¶ä»–CPUä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚ synchronized synchronizedæ˜¯æˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„åŠ é”æ–¹å¼ï¼Œä¹Ÿæ˜¯å®˜æ–¹æŽ¨èçš„æ–¹å¼ã€‚ &emsp;&emsp;synchronizedæœ€å¸¸ç”¨çš„äº’æ–¥æœ‰æ®µï¼Œsynchronizedç»è¿‡ç¼–è¯‘ä¹‹åŽï¼Œä¼šåœ¨åŒæ­¥å—å‰åŽåˆ†åˆ«å½¢æˆmonitorenterå’Œmonitorexitä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ã€‚è¿™ä¸¤ä¸ªæŒ‡ä»¤éƒ½éœ€è¦æ˜Žç¡®æŒ‡å®šä¸€ä¸ªå¼•ç”¨ç±»åž‹çš„å¯¹è±¡å‚æ•°æ¥ç¡®å®šéœ€è¦é”å®šå’Œè§£é”çš„å¯¹è±¡ã€‚ &emsp;&emsp;&ensp; æ ¹æ®è™šæ‹Ÿæœºçš„è§„èŒƒè¦æ±‚ï¼Œåœ¨æ‰§è¡ŒmonitorenteræŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆè¦å°è¯•èŽ·å–å¯¹è±¡çš„é”ï¼Œå¦‚æžœå¯¹è±¡æ²¡æœ‰è¢«é”å®šï¼Œæˆ–è€…å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰é‚£ä¸ªå¯¹è±¡çš„é”ï¼ŒæŠŠé”çš„è®¡æ•°å™¨åŠ 1ï¼Œç›¸åº”çš„ï¼Œå¦‚æžœæ‰§è¡ŒmonitorexitæŒ‡ä»¤å°±ä¼šå°†é”è®¡æ•°å™¨å‡1ï¼Œå½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œé”å°±è¢«é‡Šæ”¾ã€‚å¦‚æžœèŽ·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±è¦ä¸€ç›´é˜»å¡žç­‰å¾…ï¼Œç›´åˆ°å¯¹è±¡é”è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚åŒæ—¶Synchronizedé”æ˜¯å¯é‡å…¥çš„ï¼Œå‡è®¾å¯¹è±¡personæœ‰ä¸¤ä¸ªè¢«Synchronizedä¿®é¥°çš„åŒæ­¥æ–¹æ³•Mã€Nï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®ŒMä¹‹åŽè¿˜å¯ä»¥æŽ¥ç€æ‰§è¡ŒNï¼Œæ‰€ä»¥è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…äº†æ­»é”ï¼Œ å¦‚ä½•ä¿è¯å¯è§æ€§ï¼Ÿ &emsp;&emsp;&ensp; å½“ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®ä»Žå·¥ä½œå†…å­˜æ›´æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼ŒèŽ·å–é”é‚£ä¸ªçº¿ç¨‹ä¹Ÿä¼šå…ˆå°†ä¸»å†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°ä¸»æœºçš„å·¥ä½œå†…å­˜ä¸­ï¼Œå¦‚æ­¤å°±ä¿è¯äº†å†…å­˜å¯è§æ€§ã€‚ ReentrantLock ReentrantLock ç±»å®žçŽ°äº†Lockï¼Œå®ƒæ‹¥æœ‰ä¸Ž synchronizedç›¸åŒçš„å¹¶å‘æ€§å’Œå†…å­˜è¯­ä¹‰ï¼Œä½†æ˜¯æ·»åŠ äº†ç±»ä¼¼å…¬å¹³é”ã€è½®è¯¢é”ã€å®šæ—¶é”ç­‰å€™å’Œå¯ä¸­æ–­é”ç­‰å€™çš„ä¸€äº›ç‰¹æ€§ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æä¾›äº†åœ¨æ¿€çƒˆäº‰ç”¨æƒ…å†µä¸‹æ›´ä½³çš„æ€§èƒ½ã€‚ &emsp;&emsp;&ensp; ä½†ç›¸æ¯”synchronizedé”æ¥è¯´ï¼ŒLocké”ä½¿ç”¨éœ€è¦æ‰‹åŠ¨èŽ·å–ã€æ‰‹åŠ¨é‡Šæ”¾ã€‚æˆ‘ä»¬åœ¨åˆ›å»ºLockå®žä¾‹çš„æ—¶å€™å¯ä»¥æŒ‡å®šä½¿ç”¨å…¬å¹³é”è¿˜æ˜¯éžå…¬å¹³é”ï¼Œéžå…¬å¹³é”æ€§èƒ½ä¼šæ›´å¥½ä¸€ä¸‹(å…¬å¹³é”éœ€è¦ç»´æŠ¤å…¬å¹³æ‰€éœ€è¦çš„è®°è´¦å’ŒåŒæ­¥)ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸æ—¶å€™æ—¶éƒ½æ˜¯ç”¨éžå…¬å¹³é”ã€‚ 123public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync(); &#125; è¿™é‡ŒFairSyncå’ŒNonfairSyncéƒ½ç»§æ‰¿äº†Syncã€‚è€Œå…¬å¹³é”å’Œéžå…¬å¹³é”çš„åŒºåˆ«åœ¨äºŽèŽ·å–é”çš„æ–¹å¼ã€‚éžå…¬å¹³é”ï¼š 1234567final void lock() &#123; // å…ˆåˆ¤æ–­æ­¤æ—¶é”æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œæ²¡æœ‰çš„è¯é€šè¿‡CASæ›´æ–°é”çŠ¶æ€ if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1); &#125; è‡ªæ—‹é” Javaçš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŽŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ï¼Œå¦‚æžœè¦é˜»å¡žæˆ–å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿæ¥å¸®å¿™å®Œæˆï¼Œè¿™å°±éœ€è¦ä»Žç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ä¸­ï¼Œå› æ­¤çŠ¶æ€è£…æ¢éœ€è¦è€—è´¹å¾ˆå¤šçš„å¤„ç†å™¨æ—¶é—´ï¼Œå¯¹äºŽä»£ç ç®€å•çš„åŒæ­¥å—çŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿ã€‚ &emsp;&emsp;&ensp; é‚£ä¹ˆå°±å¯ä»¥é‡‡ç”¨è‡ªæ—‹é”çš„æ–¹å¼ï¼Œå‡è®¾è¿™ä¸ªæ—¶å€™æœ‰Açº¿ç¨‹æŒæœ‰é”ï¼ŒBçº¿ç¨‹ç­‰å¾…é”ï¼Œè‹¥æ˜¯Açº¿ç¨‹æŒæœ‰é”çš„æ—¶é—´å¹¶ä¸é•¿ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™Bçº¿ç¨‹ä¸ä¼šè¢«é˜»å¡žè€Œæ˜¯é‡‡ç”¨â€œå¿™ç­‰â€çš„æ–¹å¼ç­‰å¾…é”è¢«é‡Šæ”¾ã€‚ä»Žè€Œé¿å…äº†æ“ä½œç³»ç»Ÿåˆ‡æ¢ç”¨æˆ·æ€ã€å†…æ ¸æ€çš„æ¶ˆè€—ã€‚ å¸¦æ¥çš„é—®é¢˜ï¼š1ã€å¯èƒ½å ç”¨å¤ªå¤šcpuèµ„æºï¼š &emsp;&emsp;&ensp; è‹¥æ˜¯Açº¿ç¨‹åœ¨çŸ­æ—¶é—´å†…å¹¶ä¸é‡Šæ”¾é”ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å¯èƒ½å ç”¨å¤ªå¤šcpuæ—¶é—´ï¼Œå¯¼è‡´cpuèµ„æºæµªè´¹ã€‚å› æ­¤jvmæœ‰ä¸€ä¸ªé»˜è®¤è‡ªæ—‹æ¬¡æ•°é™åˆ¶ï¼ˆé»˜è®¤æ˜¯10æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨-XX:PreBlockSpinæ¥æ›´æ”¹ï¼‰ï¼Œè‹¥è¿˜æ˜¯æ²¡æœ‰èŽ·å–åˆ°é”ï¼Œé‚£å°±åº”è¯¥ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼åŽ»æŒ‚èµ·çº¿ç¨‹äº†ã€‚ 2ã€æ­»é”é—®é¢˜ &emsp;&emsp;&ensp; å‡è®¾æœ‰æœ‰ä¸€ä¸ªçº¿ç¨‹è¿è¡Œåœ¨ä¸€ä¸ªå¤„ç†å™¨ä¸Šï¼Œ è€Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æƒ³èŽ·å–è¿™ä¸ªå¤„ç†å™¨çš„é”ï¼Œ é‚£ä¹ˆä»–å°†ä¸€ç›´æŒæœ‰è¿™ä¸ªcpuè¿›è¡Œè‡ªæ—‹æ“ä½œï¼Œä½ çš„çº¿ç¨‹ä»£ç åˆ™æ°¸è¿œæ— æ³•èŽ·å¾—æœºä¼šé‡Šæ”¾é”ï¼ŒäºŽæ˜¯é™·å…¥æ­»é”ã€‚ è‡ªé€‚åº”è‡ªæ—‹&emsp;&emsp;&ensp; åœ¨jdk1.6ä¸­å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸åœ¨å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å®žçŽ°ã€‚å¦‚æžœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡åˆšåˆšæˆåŠŸèŽ·å–åˆ°äº†é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆjvmä¹…è®¤ä¸ºè¿™æ¬¡ä¹Ÿèƒ½å¤ŸèŽ·å–æˆåŠŸï¼Œé‚£ä¹ˆä¹…å¯èƒ½å¤šå°è¯•å‡ æ¬¡æ¥èŽ·å–ï¼Œæ¯”æ–¹è¯´50æ¬¡ã€‚è‹¥æ˜¯å¯¹äºŽæŸä¸€ä¸ªé”ï¼Œè‡ªé€‚åº”é”å¾ˆå°‘æˆåŠŸè¿‡ï¼Œé‚£ä¹ˆjvmå¯èƒ½å°±å¿½ç•¥æŽ‰è‡ªæ—‹çš„è¿‡ç¨‹è€Œç›´æŽ¥æŒ‚èµ·ã€‚ é”æ¶ˆé™¤ é”æ¶ˆé™¤æ˜¯Javaè™šæ‹Ÿæœºåœ¨JITç¼–è¯‘æ˜¯ï¼Œé€šè¿‡å¯¹è¿è¡Œä¸Šä¸‹æ–‡çš„æ‰«æï¼ŒåŽ»é™¤ä¸å¯èƒ½å­˜åœ¨å…±äº«èµ„æºç«žäº‰çš„é”ï¼Œé€šè¿‡é”æ¶ˆé™¤ï¼Œå¯ä»¥èŠ‚çœæ¯«æ— æ„ä¹‰çš„è¯·æ±‚é”æ—¶é—´ã€‚ &emsp;&emsp;&ensp; åœ¨åŠ¨æ€ç¼–è¯‘åŒæ­¥å—çš„æ—¶å€™ï¼ŒJITç¼–è¯‘å™¨å¯ä»¥å€ŸåŠ©ä¸€ç§è¢«ç§°ä¸ºé€ƒé€¸åˆ†æžï¼ˆEscape Analysisï¼‰çš„æŠ€æœ¯æ¥åˆ¤æ–­åŒæ­¥å—æ‰€ä½¿ç”¨çš„é”å¯¹è±¡æ˜¯å¦åªèƒ½å¤Ÿè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®è€Œæ²¡æœ‰è¢«å‘å¸ƒåˆ°å…¶ä»–çº¿ç¨‹ã€‚å¦‚æžœåŒæ­¥å—æ‰€ä½¿ç”¨çš„é”å¯¹è±¡é€šè¿‡è¿™ç§åˆ†æžè¢«è¯å®žåªèƒ½å¤Ÿè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆJITç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿™ä¸ªåŒæ­¥å—çš„æ—¶å€™å¹¶ä¸ç”Ÿæˆsynchronizedæ‰€è¡¨ç¤ºçš„é”çš„ç”³è¯·ä¸Žé‡Šæ”¾å¯¹åº”çš„æœºå™¨ç ï¼Œè€Œä»…ç”ŸæˆåŽŸä¸´ç•ŒåŒºä»£ç å¯¹åº”çš„æœºå™¨ç ï¼Œè¿™å°±é€ æˆäº†è¢«åŠ¨æ€ç¼–è¯‘çš„å­—èŠ‚ç å°±åƒæ˜¯ä¸åŒ…å«monitorenterï¼ˆç”³è¯·é”ï¼‰å’Œmonitorexitï¼ˆé‡Šæ”¾é”ï¼‰è¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ä¸€æ ·ï¼Œå³æ¶ˆé™¤äº†é”çš„ä½¿ç”¨ã€‚è¿™ç§ç¼–è¯‘å™¨ä¼˜åŒ–å°±è¢«ç§°ä¸ºé”æ¶ˆé™¤ï¼ˆLock Elisionï¼‰ï¼Œå®ƒä½¿å¾—ç‰¹å®šæƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å®Œå…¨æ¶ˆé™¤é”çš„å¼€é”€ã€‚ ç¤ºæ„å›¾ï¼š é”ç²—åŒ– é”ç²—åŒ–ï¼ˆLock Coarsening/Lock Mergingï¼‰æ˜¯JITç¼–è¯‘å™¨å¯¹å†…éƒ¨é”çš„å…·ä½“å®žçŽ°æ‰€åšçš„ä¸€ç§ä¼˜åŒ–ã€‚ &emsp;&emsp;ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åŠ é”ä¼šå°½é‡é”ä½æ›´å°çš„ä»£ç å—ï¼Œ è¿™æ ·ä½¿å¾—éœ€è¦åŒæ­¥çš„æ“ä½œæ•°é‡å°½å¯èƒ½å°ï¼Œå¦‚æžœå­˜åœ¨ç«žäº‰é‚£ä¹ˆä¹Ÿèƒ½å°½å¿«æ‹¿åˆ°é”ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹è¿™éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å¦‚æžœåå¤å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œç”šè‡³åŠ é”æ“ä½œå‡ºçŽ°åœ¨äº†å¾ªçŽ¯ä½“ä¸­ï¼Œé¢‘ç¹çš„è¿›è¡Œäº’æ–¥æ“ä½œä¹Ÿä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ã€‚å¦‚æžœè™šæ‹ŸæœºæŽ¢æµ‹åˆ°æœ‰è¿™æ ·çš„æƒ…å†µçš„è¯ï¼Œä¼šæŠŠåŠ é”åŒæ­¥çš„èŒƒå›´æ‰©å±•åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ï¼Œè¿™æ ·çš„ä¸€ä¸ªé”èŒƒå›´æ‰©å±•çš„æ“ä½œå°±ç§°ä¹‹ä¸ºé”ç²—åŒ–ã€‚ åå‘é” å®ƒçš„ç›®çš„æ˜¯æ¶ˆé™¤æ•°æ®åœ¨æ— ç«žäº‰æƒ…å†µä¸‹çš„åŒæ­¥åŽŸè¯­ï¼Œè¿›ä¸€æ­¥æé«˜ç¨‹åºæ€§èƒ½ã€‚å¦‚æžœè¯´è½»é‡çº§é”æ˜¯åœ¨æ— ç«žäº‰çš„æƒ…å†µä¸‹ä½¿ç”¨CASæ“ä½œåŽ»æ¶ˆé™¤åŒæ­¥ä½¿ç”¨çš„äº’æ–¥é‡ï¼Œé‚£åå‘é”å°±æ˜¯åœ¨æ— ç«žäº‰çš„æƒ…å†µä¸‹æŠŠæ•´ä¸ªåŒæ­¥éƒ½æ¶ˆé™¤æŽ‰ï¼Œè¿žCASéƒ½ä¸åšã€‚ &emsp;&emsp;åå‘é”ä¼šåå‘äºŽç¬¬ä¸€ä¸ªèŽ·å¾—å®ƒçš„çº¿ç¨‹ï¼Œå¦‚æžœåœ¨æŽ¥ä¸‹æ¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯¥é”æ²¡æœ‰è¢«å…¶ä»–çš„çº¿ç¨‹èŽ·å–ï¼Œåˆ™æŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦åŒæ­¥ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«žäº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡èŽ·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹èŽ·å¾—é”çš„ä»£ä»·æ›´ä½Žè€Œå¼•å…¥äº†åå‘é”ã€‚ &emsp;&emsp;å½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«çº¿ç¨‹èŽ·å–çš„æ—¶å€™ï¼Œçº¿ç¨‹ä½¿ç”¨CASæ“ä½œæŠŠè¿™ä¸ªé”çš„çº¿ç¨‹IDè®°å½•å†å¯¹è±¡Mark Wordä¹‹ä¸­ï¼ŒåŒæ—¶ç½®åå‘æ ‡å¿—ä½1ã€‚ä»¥åŽè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡ŒCASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€è¦ç®€å•åœ°æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æžœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»èŽ·å¾—äº†é” å‚è€ƒï¼š -ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹ http://blog.csdn.net/u013256816/article/details/51008443 https://segmentfault.com/a/1190000009828216 https://www.jianshu.com/p/dfbe0ebfec95 http://www.importnew.com/19472.html http://traxexer.iteye.com/blog/1846344 http://www.broadview.com.cn/article/789]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•å°†github pagesæ˜ å°„åˆ°åŸŸåä¸Š]]></title>
    <url>%2F2018%2F03%2F17%2F%E5%A6%82%E4%BD%95%E5%B0%86github%20pages%E6%98%A0%E5%B0%84%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9F%9F%E5%90%8D%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨github pageså’Œhexoå¯ä»¥è½»æ¾æ­å»ºä¸€ä¸ªå±žäºŽè‡ªå·±çš„åšå®¢ï¼Œä½†æ˜¯è¿™ä¸ªåšå®¢çš„åŸŸåæ˜¯ä¸€ä¸ªgithub.ioç»“å°¾çš„ã€‚çœ‹ç€ä¸çˆ½ï¼Œä¸‹é¢è®²ä¸€ä¸‹å…·ä½“çš„æ­¥éª¤ã€‚å…³äºŽå¦‚ä½•ä½¿ç”¨github pageså’Œhexoæ­å»ºåšå®¢ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚ å°†username.github.ioè§£æžåˆ°è‡ªå·±çš„åŸŸåä¸Šï¼Œé¦–å…ˆéœ€è¦å°†åŸŸåè§£æžåˆ°github pagesçš„ipä¸Šï¼Œç„¶åŽåœ¨githubçš„settingsä¸­æ·»åŠ ä¸€ä¸ªCNAMEæ–‡ä»¶ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ æ³¨å†ŒåŸŸåå¯ä»¥åŽ»è…¾è®¯äº‘ä¸Šè¾¹ä¹°ä¸€ä¸ªåŸŸåï¼Œä¾¿å®œç‚¹çš„å°±è¡Œã€‚ è§£æžåŸŸååŸŸåå…¶å®žå°±æ˜¯ä¸€ä¸ªipçš„é‡å‘½åè€Œå·²ï¼Œæ‰€ä»¥è§£æžå°±ç›¸å½“äºŽå°†åŸŸåç»‘å®šåˆ°ä¸€ä¸ªipï¼Œé‚£ä¹ˆä»¥åŽæˆ‘ä»¬å°±å¯ä»¥ç›´æŽ¥ç”¨åŸŸåæ¥è®¿é—®é‚£ä¸ªipå¯¹åº”çš„æœåŠ¡å™¨çš„æœåŠ¡ã€‚ è¿™é‡Œç›´æŽ¥ä½¿ç”¨è…¾è®¯æä¾›çš„å¿«é€Ÿè§£æžæ–¹æ³•,å°†githubæä¾›çš„ä¸¤ä¸ªipä¸­çš„ä¸€ä¸ªåŠ å…¥å°±è¡Œ 192.30.252.153 192.30.252.154 åˆ›å»ºCNAMEæ–‡ä»¶ æˆ‘ä»¬æ‰“å¼€åœ¨githubä¸­çš„åšå®¢ç›®å½•ä¸­çš„settingsï¼Œå¡«å…¥è‡ªå·±çš„åŸŸåï¼Œç„¶åŽsaveã€‚å°±å¯ä»¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­çœ‹åˆ°ä¸€ä¸ªCNAMEçš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å°±å·²ç»å¡«å…¥äº†æˆ‘ä»¬çš„åŸŸåï¼Œä½†æ˜¯å½“æˆ‘ä»¬é‡æ–°å‘å¸ƒä¹‹åŽè¿™ä¸ªCNAMEæ–‡ä»¶ä¼šè¢«è¦†ç›–ï¼Œæ‰€ä»¥éœ€è¦sourceç›®å½•ä¸‹åˆ›å»ºåŒæ ·çš„ä¸€ä¸ªCNAMEçš„æ–‡ä»¶ã€‚ æœ€åŽè®¿é—®è‡ªå·±çš„åŸŸåï¼Œå°±èƒ½ç›´æŽ¥è®¿é—®åˆ°åšå®¢äº†ã€‚]]></content>
      <categories>
        <category>åšå®¢</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä»Žè¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ]]></title>
    <url>%2F2018%2F01%2F14%2F%E5%AE%8C%E6%95%B4%E6%8F%8F%E8%BF%B0%E4%B8%80%E6%AC%A1URL%E8%AE%BF%E9%97%AE%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E5%88%B0%E5%BA%95%E9%83%BD%E7%BB%8F%E5%8E%86%E4%BA%86%E4%BA%9B%E4%BB%80%E4%B9%88%2F</url>
    <content type="text"><![CDATA[ä»Žè¾“å…¥URLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ &emsp;&emsp;å¹³æ—¶æˆ‘ä»¬æ€»æ˜¯ä¹ æƒ¯äº†è¾“å…¥ä¸€ä¸ªç½‘å€ï¼Œç„¶åŽå°±é™é™çš„ç­‰å¾…ç€å„ç§æ¼‚äº®çš„ç½‘é¡µå±•ç¤ºåœ¨æˆ‘ä»¬çš„é¢å‰ï¼Œä½†æ˜¯å¯èƒ½å¤§å¤šæ•°äººéƒ½æ²¡æœ‰å…³æ³¨è¿™å…¶ä¸­éƒ½ç»åŽ†äº†å“ªäº›ä»€ä¹ˆã€‚ä¸‹é¢å¤§è‡´åšä¸€ä¸ªæ€»ç»“ã€‚ ä¸€ã€é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹OSIä¸ƒå±‚æ¨¡åž‹ï¼š &emsp;&emsp;å¼€æ”¾å¼ç³»ç»Ÿäº’è”é€šä¿¡å‚è€ƒæ¨¡åž‹ï¼ˆè‹±è¯­ï¼šOpen System Interconnection Reference Modelï¼Œç¼©å†™ä¸º OSIï¼‰ï¼Œç®€ç§°ä¸ºOSIæ¨¡åž‹ï¼ˆOSI modelï¼‰ï¼Œä¸€ç§æ¦‚å¿µæ¨¡åž‹ï¼Œç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰æå‡ºï¼Œä¸€ä¸ªè¯•å›¾ä½¿å„ç§è®¡ç®—æœºåœ¨ä¸–ç•ŒèŒƒå›´å†…äº’è¿žä¸ºç½‘ç»œçš„æ ‡å‡†æ¡†æž¶ã€‚ å…¶ä¸­å„å±‚çš„è¯¦ç»†å†…å®¹å¤§å®¶å¯ä»¥å‚è€ƒç»´åŸºç™¾ç§‘ OSIæ˜¯ä¸€ä¸ªç†æƒ³çš„åˆ†å±‚æ¨¡åž‹ï¼Œå¾ˆå°‘æœ‰å®Œå…¨éµå®ˆè¿™æ ·çš„åˆ†å±‚ï¼Œåªä¼šä½¿ç”¨å…¶ä¸­çš„å‡ å±‚è€Œå·²ã€‚ äºŒã€ä»Žè®¿é—®googleè¯´èµ·è¿™é‡Œå°±ä¸è®¨è®ºæˆ‘ä»¬ä¼Ÿå¤§çš„é˜²ç«é•¿åŸŽäº†ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œè¿™æ˜¯åŸºæœ¬æŠ€èƒ½ å½“ä½ å•å‡»å›žè½¦é”®ï¼Œå°±æ„å‘³ç€ä½ éœ€è¦å‘googleçš„æœåŠ¡å™¨å‘é€ä¸€æ¬¡ç½‘é¡µè¯·æ±‚çš„æ•°æ®åŒ…ã€‚ä¸‹é¢ä»Žæ¶‰åŠåˆ°çš„åè®®æˆ–è€…æœåŠ¡è¯´èµ·ã€‚ 1ã€DNSåè®®&emsp;&emsp;å½“æˆ‘ä»¬è¦è®¿é—®https://www.google.co.jp/æ—¶ï¼Œå¿…é¡»è¦çŸ¥é“ipåœ°å€ï¼Œä½†è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¹¶ä¸çŸ¥é“ipæ˜¯å¤šå°‘ã€‚DNSæœåŠ¡å°±å¯ä»¥å¸®æˆ‘ä»¬é€šè¿‡åŸŸåæ‰¾åˆ°ipåœ°å€ã€‚å®ƒæ˜¯ä¸€ä¸ªå­˜å‚¨ç€ipå’ŒåŸŸåæ˜ å°„çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚GFWå…¶ä¸­å°±æœ‰é€šè¿‡dnsæ±¡æŸ“å’ŒdnsåŠ«æŒçš„æ–¹å¼ä½¿å¾—æˆ‘ä»¬æ— æ³•è®¿é—®åˆ°å›½å¤–çš„æŸäº›â€œfdâ€ç½‘ç«™ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œipå’ŒåŸŸåå¹¶éžä¸€å¯¹ä¸€çš„å…³ç³»ã€‚è€Œæ˜¯å¤šå¯¹å¤šï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªipå¯ä»¥ç»‘å®šå¤šä¸ªåŸŸåï¼Œä¸€ä¸ªåŸŸåä¹Ÿå¯ä»¥ç»‘å®šå¤šä¸ªipï¼Œä½†åŒä¸€æ—¶åˆ»åªèƒ½æ˜¯ä¸€å¯¹ä¸€çš„ã€‚ okï¼ŒçŽ°åœ¨æˆ‘ä»¬æœ‰äº†ipåœ°å€ã€‚ 2ã€ å­ç½‘æŽ©ç  &emsp;&emsp;å…¨ä¸–ç•Œè¿™ä¹ˆå¤šè®¡ç®—æœºï¼Œå½“ç„¶ä¸å¯èƒ½éƒ½åœ¨åŒä¸€ä¸ªå­ç½‘é‡Œã€‚é‚£è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç¡®è®¤googleæœåŠ¡å™¨å’Œæˆ‘ä»¬æœ¬æœºæ˜¯å¦åœ¨åœ¨åŒä¸€ä¸ªå­ç½‘é‡Œï¼Œè¿™é‡Œç”¨åˆ°äº†å­ç½‘æŽ©ç ã€‚ &emsp;&emsp;å­ç½‘æŽ©ç å’Œipåœ°å€ä¸€æ ·ï¼Œéƒ½æ˜¯32ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œé€šå¸¸ç”¨4æ®µå¼è¡¨ç¤ºï¼Œç½‘ç»œä½å…¨ä¸º1ï¼Œä¸»æœºä½å…¨ä¸º0ã€‚å°†æˆ‘ä»¬çš„ç›®æ ‡åœ°å€å’Œæœ¬æœºåœ°å€åˆ†åˆ«ä¸Žå­ç½‘æŽ©ç æŒ‰ä½åšandæ“ä½œã€‚å¦‚æžœæœ€ç»ˆç»“æžœç›¸åŒé‚£ä¹ˆåœ¨åŒä¸€å­ç½‘ä¸­ã€‚ä¸éœ€è¦å°†æ•°æ®åŒ…è½¬å‘åˆ°ç½‘å…³ã€‚å¦åˆ™ï¼Œå°†æ•°æ®åŒ…è½¬å‘åˆ°ç½‘å…³å¤„ç†ã€‚ ä¾‹å¦‚ï¼š DNS: 255.255.255.0 ä¸»æœºipï¼š10.20.0.121 googleï¼š216.239.34.10 æ˜Žæ˜¾ä¸åœ¨åŒä¸€ä¸ªå­ç½‘ä¸­ 3ã€http/httpsåè®®æµè§ˆå™¨è®¿é—®ç½‘é¡µä½¿ç”¨çš„æ˜¯httpåè®®ï¼Œåœ¨OSIåè®®ä¸­å±žäºŽåº”ç”¨å±‚åè®®ã€‚ httpè¯·æ±‚çš„æŠ¥æ–‡æ ¼å¼ï¼š å¤´éƒ¨ï¼ˆrequest line + headerï¼‰ + æ•°æ®ï¼ˆdataï¼‰ å…¶ä¸­çš„è¯·æ±‚è¡Œï¼ˆrequest lineï¼‰åŒ…æ‹¬è¯·æ±‚æ–¹æ³•å­—æ®µã€URLå­—æ®µå’ŒHTTPåè®®çš„ç‰ˆæœ¬ä¸‰ä¸ªå­—æ®µç»„æˆ GET/index.html HTTP/1.1 ç›®å‰å¤§å¤šæ•°HTTPè¯·æ±‚ä½¿ç”¨çš„æ˜¯é•¿è¿žæŽ¥ï¼ˆHTTP/1.1é»˜è®¤keep-aliveä¸ºtrueï¼‰ï¼Œè€Œé•¿è¿žæŽ¥æ„å‘³ç€ï¼Œä¸€ä¸ªTCPçš„socketåœ¨å½“å‰è¯·æ±‚ç»“æŸåŽï¼Œå¦‚æžœæ²¡æœ‰æ–°çš„è¯·æ±‚åˆ°æ¥ï¼Œsocketä¸ä¼šç«‹é©¬é‡Šæ”¾ï¼Œè€Œæ˜¯ç­‰timeoutåŽå†é‡Šæ”¾ã€‚ è¯·æ±‚æ–¹æ³•å­—æ®µæœ‰ï¼šGETã€POSTã€HEADã€PUTã€DELETEã€TRACE, è¿™äº›å­—æ®µåœ¨REST fulé£Žæ ¼ä¸­èƒ½å¤Ÿè¢«å……åˆ†åˆ©ç”¨ï¼Œè€Œä¸åœ¨ä½¿ç”¨URLæ¥è¡¨è¾¾ç›®çš„åŠ¨ä½œã€‚ ç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼š 123456789101112131415alt-svc:hq=":443"; ma=2592000; quic=51303431; quic=51303339; quic=51303338; quic=51303337; quic=51303335,quic=":443"; ma=2592000; v="41,39,38,37,35"cache-control:private, max-age=0content-encoding:brcontent-type:text/html; charset=UTF-8date:Thu, 18 Jan 2018 10:37:50 GMTexpires:-1p3p:CP="This is not a P3P policy! See g.co/p3phelp for more info."server:gwsset-cookie:1P_JAR=2018-01-18-10; expires=Sat, 17-Feb-2018 10:37:50 GMT; path=/; domain=.google.co.jpset-cookie:NID=*, 20-Jul-2018 10:37:50 GMT; path=/; domain=.google.co.jp; HttpOnlystatus:200strict-transport-security:max-age=3600x-frame-options:SAMEORIGINx-xss-protection:1; mode=blockRequest Headers 4ã€tcpã€udpåè®® tcpåè®®æ˜¯è¾“å…¥ä¼ è¾“å±‚çš„åè®®ï¼Œä¸»è¦ä½œç”¨æ˜¯å»ºç«‹ç«¯å£åˆ°ç«¯å£çš„é€šä¿¡ï¼ŒåŒæ—¶ä¿è¯æ•°æ®çš„æ­£ç¡®ä¼ è¾“å’Œå·®é”™å¤„ç†ã€‚ åŒæ—¶å’ŒtcpåŒå‡ºäºŽä¼ è¾“å±‚åè®®çš„è¿˜æœ‰udpï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ï¼Œè¿™ä¸ªåè®®æ¯”è¾ƒç®€å•ï¼Œä¸ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œæ•°æ®ä¸€æ—¦å‘å‡ºæ— æ³•çŸ¥é“å¯¹æ–¹æ˜¯å¦æ”¶åˆ°ã€‚ä½†æ˜¯ä¼˜ç‚¹æ˜¯è¿‡ç¨‹ç®€å•ï¼ŒèŠ‚çœèµ„æºã€‚ æ— è®ºæ˜¯tcpè¿˜æ˜¯udpåè®®ï¼Œhttpçš„æ•°æ®åŒ…éƒ½æ˜¯åŠ å…¥åˆ°ä»–ä»¬çš„æ•°æ®æ®µä¸­ã€‚ ä¸‰æ¬¡æ¡æ‰‹é—®é¢˜ï¼šæ‰€è°“ä¸‰æ¬¡æ¡æ‰‹ï¼ˆThree-Way Handshakeï¼‰å³å»ºç«‹TCPè¿žæŽ¥ï¼Œå°±æ˜¯æŒ‡å»ºç«‹ä¸€ä¸ªTCPè¿žæŽ¥æ—¶ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ€»å…±å‘é€3ä¸ªåŒ…ä»¥ç¡®è®¤è¿žæŽ¥çš„å»ºç«‹ã€‚åœ¨socketç¼–ç¨‹ä¸­ï¼Œè¿™ä¸€è¿‡ç¨‹ç”±å®¢æˆ·ç«¯æ‰§è¡Œconnectæ¥è§¦å‘ã€‚ ï¼ˆ1ï¼‰ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClientå°†æ ‡å¿—ä½SYNç½®ä¸º1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=Jï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒClientè¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…Serverç¡®è®¤ã€‚ ï¼ˆ2ï¼‰ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šServeræ”¶åˆ°æ•°æ®åŒ…åŽç”±æ ‡å¿—ä½SYN=1çŸ¥é“Clientè¯·æ±‚å»ºç«‹è¿žæŽ¥ï¼ŒServerå°†æ ‡å¿—ä½SYNå’ŒACKéƒ½ç½®ä¸º1ï¼Œack=J+1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=Kï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Clientä»¥ç¡®è®¤è¿žæŽ¥è¯·æ±‚ï¼ŒServerè¿›å…¥SYN_RCVDçŠ¶æ€ã€‚ ï¼ˆ3ï¼‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClientæ”¶åˆ°ç¡®è®¤åŽï¼Œæ£€æŸ¥ackæ˜¯å¦ä¸ºJ+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æžœæ­£ç¡®åˆ™å°†æ ‡å¿—ä½ACKç½®ä¸º1ï¼Œack=K+1ï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒServeræ£€æŸ¥ackæ˜¯å¦ä¸ºK+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æžœæ­£ç¡®åˆ™è¿žæŽ¥å»ºç«‹æˆåŠŸï¼ŒClientå’ŒServerè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼ŒéšåŽClientä¸ŽServerä¹‹é—´å¯ä»¥å¼€å§‹ä¼ è¾“æ•°æ®äº†ã€‚ ç™½è¯ä¸€ç‚¹å°±æ˜¯ï¼š ä¸»æœºï¼š ä½ å¥½ï¼Œæˆ‘æƒ³è®¤è¯†ä½  æœåŠ¡å™¨ï¼šå¥½çš„ï¼Œæˆ‘ä¹Ÿæƒ³è®¤è¯†ä½  ä¸»æœºï¼šå¾ˆé«˜å…´è®¤è¯†ä½  é‚£ä¸ºä»€ä¹ˆä¸€å®šè¦ä¸‰æ¬¡æ¡æ‰‹è€Œä¸æ˜¯ä¸¤æ¬¡å‘¢ï¼Ÿ æˆ‘ä»¬å‡è®¾æœ‰ä¸‹é¢çš„è¿™ç§æƒ…å†µï¼š &emsp;&emsp;å½“å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯ç”±äºŽæ­¤æ—¶ç½‘ç»œæ‹¥å¡žè¿™ä¸ªåŒ…æš‚æ—¶æ²¡æœ‰åˆ°è¾¾æœåŠ¡å™¨ï¼Œ å®¢æˆ·ç«¯ç­‰å¾…è¶…æ—¶ä¹‹åŽåˆé‡æ–°å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ­¤æ—¶æœåŠ¡å™¨ç«¯æŽ¥æ”¶åˆ°äº†ï¼Œå¹¶æ­£ç¡®åº”ç­”ï¼ŒåŒæ–¹å¼€å§‹é€šä¿¡ï¼Œé€šä¿¡ç»“æŸåŽé‡Šæ”¾socketè¿žæŽ¥ã€‚ä½†è¿™ä¸ªæ—¶å€™ï¼Œé‚£ä¸ªè¢«æ‹¥å¡žçš„è¿žæŽ¥æ­¤æ—¶åˆ°è¾¾äº†æœåŠ¡å™¨ï¼Œå¦‚ä½•tcpæ˜¯é‡‡ç”¨ä¸¤æ¬¡æ¡æ‰‹çš„æ–¹å¼ï¼Œé‚£ä¹ˆæ­¤æ—¶æœåŠ¡å™¨ä»¥ä¸ºå®¢æˆ·ç«¯åˆå‘èµ·äº†ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚ï¼Œç„¶åŽè¿”å›žç¡®è®¤è¯·æ±‚ï¼Œæ­¤æ—¶è¿žæŽ¥å°±å·²ç»å»ºç«‹å¥½äº†ã€‚æœåŠ¡å™¨çŠ¶æ€ä¸ºESTABLISHEDï¼Œç­‰å¾…ç€å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œä½†ç”±äºŽæ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥äº†closeçŠ¶æ€ï¼Œå°†å¯¼è‡´æœåŠ¡å™¨ç­‰å¾…ä¸‹åŽ»ï¼Œæµªè´¹èµ„æºã€‚ å››æ¬¡æŒ¥æ‰‹ï¼š é¦–å…ˆéœ€è¦çŸ¥é“çš„æ˜¯tcpæ˜¯å…¨åŒå·¥é€šä¿¡çš„ï¼Œé‚£ä¹ˆå…³é—­å°±åªèƒ½ä¸€ä¸ªä¸€ä¸ªå…³é—­ã€‚ å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€è¦å…³é—­socketæ—¶ï¼ˆsocketç¿»è¯‘æˆå¥—æŽ¥å­—å¹¶ä¸æ°å½“ï¼ŒæŠŠå®ƒå½“åšâ€œæ’åº§â€ä¹Ÿè®¸æ›´å®¹æ˜“ç†è§£ï¼‰ï¼Œå…·ä½“çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å‡è®¾è¿™ä¸ªæ—¶å€™clientå‘èµ·è¯·æ±‚ä¸­æ–­çš„è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å‘é€FinæŠ¥æ–‡ï¼Œå‘Šè¯‰serverï¼šâ€œæˆ‘æ²¡æœ‰æ•°æ®å‘ç»™ä½ äº†ï¼Œä½†å¦‚æžœä½ è¿˜æœ‰æ•°æ®è¦å‘ç»™æˆ‘ï¼Œé‚£å°±å…ˆä¸ç”¨å…³é—­socketï¼Œå‘é€å®Œæ¯•åœ¨å‘Šè¯‰æˆ‘â€ï¼Œæ­¤æ—¶clientå¤„äºŽFIN_WAIT1ã€‚ å½“serveræŽ¥æ”¶åˆ°äº†ä¹‹åŽå‘é€ackç»™clientï¼šâ€œä½ çš„è¯·æ±‚æˆ‘æ”¶åˆ°äº†ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¯·ç»§ç»­ç­‰æˆ‘æ¶ˆæ¯â€æ­¤æ—¶clientè¿›å…¥FIN_WAIT2çŠ¶æ€ã€‚ å½“serverç«¯ç¡®è®¤æ•°æ®å‘é€å®Œæ¯•äº†ï¼Œå°±å‘Šè¯‰clientï¼šâ€œå¥½äº†ï¼Œæˆ‘è¿™è¾¹æ•°æ®å‘å®Œäº†ï¼Œå‡†å¤‡å¥½å…³é—­è¿žæŽ¥äº†â€ã€‚ ä½†æ˜¯è¿™ä¸ªæ—¶å€™clientå¹¶ä¸ç›¸ä¿¡ç½‘ç»œï¼Œæ€•serverç«¯ä¸çŸ¥é“è¦å…³é—­ï¼Œæ‰€ä»¥è¿›å…¥TIME_WAIT,å¦‚æžœserverç«¯æ²¡æœ‰æ”¶åˆ°ackåˆ™å¯ä»¥é‡ä¼ ï¼Œserverç«¯æ”¶åˆ°ackåŽå°±çŸ¥é“å¯ä»¥æ–­å¼€äº†ï¼Œclientç­‰å¾…2MSL(æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)ä¹‹åŽè¿˜æ²¡æœ‰æ”¶åˆ°å›žå¤ï¼Œé‚£ä¹ˆä¹…è®¤ä¸ºserverç«¯æ­£å¸¸å…³é—­äº†ï¼Œclientä¹Ÿå¯ä»¥å…³é—­äº†ã€‚ &emsp;&emsp;åœ¨è¿™é‡Œéœ€è¦æ³¨æ„æœ€åŽclientç­‰å¾…2MSL(æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)ï¼Œè™½ç„¶æŒ‰é“ç†ï¼Œå››ä¸ªæŠ¥æ–‡éƒ½å‘é€å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æŽ¥è¿›å…¥CLOSEçŠ¶æ€äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»å‡è±¡ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæœ‰å¯ä»¥æœ€åŽä¸€ä¸ªACKä¸¢å¤±ã€‚æ‰€ä»¥TIME_WAITçŠ¶æ€å°±æ˜¯ç”¨æ¥é‡å‘å¯èƒ½ä¸¢å¤±çš„ACKæŠ¥æ–‡ã€‚ 5ã€IPåè®®ï¼Œç½‘ç»œå±‚ åœ¨ä¸ƒå±‚ç½‘ç»œåˆ†å±‚ä¸­ï¼Œç½‘ç»œå±‚æ˜¯æœ€å¤æ‚çš„ã€‚è´Ÿè´£ä¸»æœºåˆ°ä¸»æœºé—´çš„é€šä¿¡ï¼Œå…¶ä¸­ipåè®®æ˜¯æœ€é‡è¦çš„ã€‚ è®¡ç®—æœºè‹¥åœ¨åŒä¸€ä¸ªå­ç½‘é‡Œè¾¹ï¼Œå®Œå…¨å¯ä»¥åªéœ€è¦macåœ°å€å°±å¯ä»¥é€šä¿¡ï¼Œä¸»æœºAæƒ³å’Œä¸»æœºBé€šä¿¡ï¼Œé‚£ä¹ˆåªéœ€è¦å°†è¯·æ±‚å¹¿æ’­åˆ°æ•´ä¸ªå­ç½‘ï¼Œç„¶åŽå„å°è®¡ç®—æœºæ‹¿å‡ºç›®çš„macåœ°å€å’Œè‡ªå·±çš„macåœ°å€ç›¸å¯¹æ¯”ï¼Œå¦‚æžœç›¸åŒï¼Œä¸¤å°ä¸»æœºè¿›è¡Œé€šä¿¡ã€‚ä½†æ˜¯è®¡ç®—æœºéå¸ƒå…¨ä¸–ç•Œï¼Œä¸å¯èƒ½éƒ½åœ¨ä¸€ä¸ªå­ç½‘é‡Œè¾¹ï¼Œè‹¥åœ¨å…¶ä»–å­ç½‘é‡Œè¾¹æ€Žä¹ˆåŠžå‘¢ï¼Ÿ &emsp;&emsp;è¿™ä¸ªæ—¶å€™å°±å¿…é¡»ç”¨åˆ°ipåœ°å€äº†ã€‚ç”±äºŽipåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ç½‘ç»œæ®µï¼Œä¸€éƒ¨åˆ†æ˜¯ä¸»æœºæ®µã€‚ç½‘ç»œæ®µå†³å®šå¤„äºŽå“ªä¸€ä¸ªå­ç½‘ï¼Œä¸»æœºæ®µå†³å®šæ˜¯å­ç½‘çš„é‚£ä¸€å°æœºå™¨ã€‚å½“æˆ‘ä»¬è¦è®¿é—®googleçš„æœåŠ¡å™¨ipæ˜¯216.239.34.10æ—¶ï¼Œç”±äºŽä¸åœ¨åŒä¸€ä¸ªå­ç½‘ä¸­ï¼Œéœ€è¦å°†æ•°æ®æŠ¥è½¬å‘ç»™ç½‘å…³ï¼Œç„¶åŽå†é€šè¿‡å¤æ‚çš„è·¯ç”±ï¼Œæœ€ç»ˆåˆ°è¾¾æœåŠ¡å™¨ã€‚ ipæŠ¥æ–‡å°†tcpçš„æŠ¥æ–‡åµŒå…¥åœ¨æ•°æ®å—ä¸­ 6ã€ARPåè®®ã€ä»¥å¤ªç½‘åè®® æœ€åŽï¼Œipæ•°æ®åŒ…åµŒå…¥åˆ°ä»¥å¤ªç½‘æ•°æ®æŠ¥ï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…éœ€è¦è®¾ç½®é€šä¿¡åŒæ–¹çš„macåœ°å€ï¼Œå‘é€æ–¹ä¸ºæœ¬æœºçš„macåœ°å€ï¼ŒæŽ¥æ”¶æ–¹ç½‘å¡216.239.34.1çš„macåœ°å€éœ€è¦ç”¨ARPåè®®å¾—åˆ°ã€‚ &emsp;&emsp;æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œèƒ½å¤Ÿä»ŽIPåœ°å€å¾—åˆ°MACåœ°å€ã€‚è¿™é‡Œåˆå¯ä»¥åˆ†æˆä¸¤ç§æƒ…å†µã€‚ç¬¬ä¸€ç§æƒ…å†µï¼Œå¦‚æžœä¸¤å°ä¸»æœºä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œé‚£ä¹ˆäº‹å®žä¸Šæ²¡æœ‰åŠžæ³•å¾—åˆ°å¯¹æ–¹çš„MACåœ°å€ï¼Œåªèƒ½æŠŠæ•°æ®åŒ…ä¼ é€åˆ°ä¸¤ä¸ªå­ç½‘ç»œè¿žæŽ¥å¤„çš„â€ç½‘å…³â€ï¼ˆgatewayï¼‰ï¼Œè®©ç½‘å…³åŽ»å¤„ç†ã€‚ &emsp;&emsp;ç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æžœä¸¤å°ä¸»æœºåœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ARPåè®®ï¼Œå¾—åˆ°å¯¹æ–¹çš„MACåœ°å€ã€‚ARPåè®®ä¹Ÿæ˜¯å‘å‡ºä¸€ä¸ªæ•°æ®åŒ…ï¼ˆåŒ…å«åœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…ä¸­ï¼‰ï¼Œå…¶ä¸­åŒ…å«å®ƒæ‰€è¦æŸ¥è¯¢ä¸»æœºçš„IPåœ°å€ï¼Œåœ¨å¯¹æ–¹çš„MACåœ°å€è¿™ä¸€æ ï¼Œå¡«çš„æ˜¯FF:FF:FF:FF:FF:FFï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªâ€å¹¿æ’­â€åœ°å€ã€‚å®ƒæ‰€åœ¨å­ç½‘ç»œçš„æ¯ä¸€å°ä¸»æœºï¼Œéƒ½ä¼šæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œä»Žä¸­å–å‡ºIPåœ°å€ï¼Œä¸Žè‡ªèº«çš„IPåœ°å€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æžœä¸¤è€…ç›¸åŒï¼Œéƒ½åšå‡ºå›žå¤ï¼Œå‘å¯¹æ–¹æŠ¥å‘Šè‡ªå·±çš„MACåœ°å€ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚ æ€»ä¹‹ï¼Œæœ‰äº†ARPåè®®ä¹‹åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°åŒä¸€ä¸ªå­ç½‘ç»œå†…çš„ä¸»æœºMACåœ°å€ï¼Œå¯ä»¥æŠŠæ•°æ®åŒ…å‘é€åˆ°ä»»æ„ä¸€å°ä¸»æœºä¹‹ä¸Šäº†ã€‚ 7ã€æœåŠ¡å™¨å“åº” ç»è¿‡å¤šä¸ªç½‘å…³çš„è½¬å‘ï¼ŒGoogleçš„æœåŠ¡å™¨216.239.34.10ï¼Œæ”¶åˆ°æ•°æ®åŒ…ä¹‹åŽé€šè¿‡è§£æžï¼Œå–å‡ºå…¶ä¸­çš„è¯·æ±‚request lineï¼Œåšå‡ºå“åº”ï¼Œå°è£…æˆresponseè¿”å›žç»™æµè§ˆå™¨ã€‚ 8ã€æµè§ˆå™¨è§£æžæ¸²æŸ“é¡µé¢æµè§ˆå™¨åœ¨æ”¶åˆ°HTML,CSS,JSæ–‡ä»¶åŽï¼Œå®ƒæ˜¯å¦‚ä½•æŠŠé¡µé¢å‘ˆçŽ°åˆ°å±å¹•ä¸Šçš„ï¼Ÿä¸‹å›¾å¯¹åº”çš„å°±æ˜¯WebKitæ¸²æŸ“çš„è¿‡ç¨‹ã€‚ ç”±äºŽæ¶‰åŠåˆ°å¾ˆå¤šçš„å†…å®¹ï¼Œéš¾å…æœ‰åå·®çš„åœ°æ–¹ï¼Œè¿˜è¯·è§è°…ã€‚ å‚è€ƒï¼š https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B http://blog.csdn.net/whuslei/article/details/6667471 http://www.ruanyifeng.com/blog/2012/06/internet_protocol_suite_part_ii.html http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ç±»unixå¹³å°ä¸­å‡ ä¸ªå¤§æ€å™¨æŒ‡ä»¤]]></title>
    <url>%2F2017%2F12%2F14%2F%E7%B1%BBunix%E5%B9%B3%E5%8F%B0%E4%B8%AD%E5%87%A0%E4%B8%AA%E5%A4%A7%E6%9D%80%E5%99%A8%E6%8C%87%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[ç±»unixå¹³å°ä¸­å‡ ä¸ªå¤§æ€å™¨æŒ‡ä»¤ ä¸‹è¾¹ä»‹ç»å‡ ä¸ªâ€œå¾ˆå¼ºåŠ¿â€çš„å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼Œèƒ½å¤§å¤§æé«˜æˆ‘ä»¬çš„å·¥ä½œç”Ÿäº§æ•ˆçŽ‡ã€‚ä½¿ç”¨macOS Sierraä½œä¸ºæ¼”ç¤ºçŽ¯å¢ƒã€‚ 1ã€autojump é€šå¸¸æˆ‘ä»¬åœ¨ç±»unixæ“ä½œç³»ç»Ÿä¸­åˆ‡æ¢ç›®å½•éƒ½æ˜¯ä½¿ç”¨cdï¼Œä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤å¦‚æžœè¦åˆ‡æ¢åˆ°å¾ˆæ·±çš„ç›®å½•ï¼Œæ˜¯å¾ˆçƒ¦æ¼çš„ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™autojumpå°±æ˜¯å¤§æ€å™¨ã€‚ 1ã€ åœ¨macä¸­å®‰è£…autojumpæ¯”è¾ƒç®€å•ï¼š 1brew install autojump ä½†æ˜¯éœ€è¦æ³¨æ„å®‰è£…å®Œå¹¶ä¸èƒ½ç›´æŽ¥ä½¿ç”¨ã€‚åœ¨æˆ‘ä»¬å®‰è£…çš„è¿‡ç¨‹ä¸­ä¼šæœ‰å¦‚ä¸‹çš„æç¤ºï¼š æˆ‘ä»¬åªéœ€è¦æŒ‰ç…§æ­¥éª¤æ“ä½œå°±å¥½ï¼šï¼ˆ1ï¼‰ å…ˆåœ¨~/.zshrcæ–‡ä»¶æˆ–è€…~/.bash_profileä¸­æ·»åŠ  1[ -f /usr/local/etc/profile.d/autojump.sh ] &amp;&amp; . /usr/local/etc/profile.d/autojump.sh (2) ç„¶åŽsourceç›¸åº”çš„æ–‡ä»¶ï¼Œé‡æ–°æ‰“å¼€ä¸€ä¸ªçª—å£ã€‚å°±å¯ä»¥ä½¿ç”¨äº†ã€‚ ç®€å•ä»‹ç»ä¸€ä¸‹autojumpçš„ç®€å•ä½¿ç”¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªç›®å½• 1&gt; autojump -a [ç›®å½•] å¦‚æžœä½ çªç„¶æƒ³è¦æŠŠå½“å‰ç›®å½•å˜æˆä½ çš„æœ€çˆ±å’Œä½¿ç”¨æœ€é¢‘ç¹çš„æ–‡ä»¶å¤¹ï¼Œä½ å¯ä»¥åœ¨è¯¥ç›®å½•é€šè¿‡å‘½ä»¤çš„å‚æ•° i æ¥æ‰‹å·¥å¢žåŠ å®ƒçš„æƒé‡ 1&gt; autojump -i [æƒé‡] è¿™å°†ä½¿å¾—è¯¥ç›®å½•æ›´å¯èƒ½è¢«é€‰æ‹©è·³è½¬ã€‚ç›¸åçš„ä¾‹å­æ˜¯åœ¨è¯¥ç›®å½•ä½¿ç”¨å‚æ•° d æ¥å‡å°‘æƒé‡ï¼š 1&gt; autojump -d [æƒé‡] è¦è·Ÿè¸ªæ‰€æœ‰è¿™äº›æ”¹å˜ï¼Œè¾“å…¥ï¼š 1&gt; autojump -s 2ã€mycli &emsp;&emsp; å¯¹äºŽç¨‹åºå‘˜æ¥è¯´ï¼Œæ•°æ®åº“å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ›´å–œæ¬¢ç”¨å‘½ä»¤è¡Œæ¥è®¿é—®æ•°æ®åº“ï¼Œä½†æ˜¯é»˜è®¤è‡ªå¸¦çš„mysqlå¯¹æ“ä½œå¹¶ä¸æ˜¯ååˆ†å‹å¥½ï¼Œä¸èƒ½è‡ªåŠ¨è¡¥å…¨ï¼Œæ²¡æœ‰è¯­æ³•é«˜äº®ã€‚è¿™ä¸ªæ—¶å€™ä½¿ç”¨mycliå°±å†åˆé€‚ä¸è¿‡äº†ã€‚ 1ã€ å…ˆå®‰è£…ï¼Œä¾æ—§ä½¿ç”¨brewæ¥å®‰è£…ç®¡ç†1brew install mycli ç„¶åŽä½¿ç”¨mycli -u usernameè¿›å…¥æ•°æ®åº“ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œä¸éœ€è¦-på‚æ•°ã€‚ å¦‚ä¸‹æ‰€ç¤ºï¼š 3ã€screen å½“æˆ‘ä»¬åœ¨é€šè¿‡sshè¿žæŽ¥è¿œç«¯æœºå™¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå¦‚æžœä»»åŠ¡æ‰§è¡Œæ—¶é—´ç›¸å¯¹æ¯”è¾ƒçŸ­è¿˜å¥½ï¼Œå¦‚æžœæ˜¯æ‰§è¡Œhadoopçš„ä»»åŠ¡ï¼Œå¾ˆå¤šæ—¶å€™å›žè¶…è¿‡å‡ ä¸ªå°æ—¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å¦‚æžœsshè¿žæŽ¥ä¸­æ–­äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡ä¹Ÿä¼šå¤±è´¥ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™screenå°±æ´¾ä¸Šç”¨åœºäº†ã€‚ 1&gt; brew install screen è¿›å…¥åŽå°æ‰§è¡Œï¼š 1&gt; screen å½“å¼€å§‹æ‰§è¡Œä»»åŠ¡ä¹‹åŽä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤é€€å‡ºï¼š 1&gt; control + A + D å°†æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡åˆ—ä¸¾å‡ºæ¥ 1&gt; screen -ls æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œè¿›åº¦ï¼š 1&gt; screen -r è¿›ç¨‹å· è¿˜åŒ…æ‹¬axelã€fasdã€m-cliç­‰ç­‰æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªå·±ç ”ç©¶ã€‚]]></content>
      <categories>
        <category>macOS</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[è®°å½•sparkä¸€æ¬¡è¸©å‘]]></title>
    <url>%2F2017%2F11%2F27%2F%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1spark%E8%B8%A9%E5%9D%91%2F</url>
    <content type="text"><![CDATA[Application has been killed. Reason: Master removed our application: FAILED sparkä»Žäº”æœˆä»½å¼€å§‹è·‘åˆ°11æœˆä»½ä¸€ç›´æ­£å¸¸ï¼Œä½†æ˜¯åœ¨æœ€è¿‘ä¸¤å¤©æŠ¥å¦‚ä¸‹çš„é”™è¯¯ã€‚ æŸ¥çœ‹workerè¿è¡Œçš„logï¼Œå‘çŽ°ä¸‹é¢çš„é—®é¢˜ã€‚ ç„¶åŽè¿›å…¥åˆ°/opt/soft/spark/workç›®å½•å‘çŽ°å½“å‰æœ‰31999ä¸ªæ–‡ä»¶ï¼Œ è€Œåœ¨linuxæ–‡ä»¶ç³»ç»Ÿä¸­ä¸€ä¸ªæ–‡ä»¶å¤¹æœ€å¤šèƒ½å¤Ÿ32000ä¸ªå­æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå½“å‰ç›®å½•ã€çˆ¶çº§ç›®å½•ï¼Œé‚£ä¹ˆæ“ä½œè¿™ä¸ªæ•°å°±æ— æ³•åœ¨è¿™ä¸ªç›®å½•ä¸­å†™å…¥æ–‡ä»¶ã€‚åœ¨linux å†…æ ¸ä¸­æœ‰ä¸‹é¢çš„å®šä¹‰ï¼š 12include/linux/ext2_fs.h:#define EXT2_LINK_MAX 32000include/linux/ext3_fs.h:#define EXT3_LINK_MAX 32000 æ‰€ä»¥ï¼Œåªèƒ½å°†ç”Ÿæˆçš„å¤šä½™ä¸´æ—¶æ–‡ä»¶åˆ é™¤äº†ã€‚åŠ¨æ‰‹ingâ€¦. åˆ é™¤ä¹‹åŽï¼Œé‡æ–°æäº¤sparkä»»åŠ¡ï¼Œæ²¡æœ‰é—®é¢˜ã€‚]]></content>
      <categories>
        <category>spark</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•è§£å†³â€œéžWeChatå®˜æ–¹ç½‘é¡µï¼Œç»§ç»­è®¿é—®å°†è½¬æ¢æˆ.....â€çš„é—®é¢˜]]></title>
    <url>%2F2017%2F10%2F18%2F%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E2%80%9C%E9%9D%9EWeChat%E5%AE%98%E6%96%B9%E7%BD%91%E9%A1%B5%EF%BC%8C%E7%BB%A7%E7%BB%AD%E8%AE%BF%E9%97%AE%E5%B0%86%E8%BD%AC%E6%8D%A2%E6%88%90......%E2%80%9D%E7%9A%84%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬åœ¨å¼€å‘å¾®ä¿¡å…¬ä¼—å·æ—¶ï¼Œä½¿ç”¨ç½‘é¡µå·¥å…·ç”Ÿæˆè‡ªå®šä¹‰èœå•ï¼Œå…³è”åˆ°æŸä¸€ä¸ªç½‘ç«™ï¼Œå½“æˆ‘ä»¬è®¿é—®è¿™ä¸ªç½‘é¡µçš„æ—¶å€™å°±ä¼šå‡ºçŽ°å¦‚ä¸‹æƒ…å†µï¼š è¦è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š 1ã€ç™»å½•å¾®ä¿¡å…¬ä¼—å·ï¼Œè¿›å…¥å…¬ä¼—å·è®¾ç½® â€“&gt; åŠŸèƒ½è®¾ç½®ï¼Œè¿›å…¥åˆ°ä¸‹é¢çš„é¡µé¢ä¸­ï¼Œç„¶åŽç‚¹å‡»è®¾ç½®ã€‚ ç„¶åŽæœ€ç»ˆè¿›å…¥åˆ°è®¾ç½®çš„é¡µé¢ã€‚æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šï¼ˆ1ï¼‰é¦–å…ˆè¦ç¡®ä¿è®¾ç½®çš„åŸŸåå¿…é¡»æ˜¯å¤‡è¿‡æ¡ˆçš„ã€‚ï¼ˆ2ï¼‰åŒæ—¶è¿˜éœ€è¦ä¸‹è½½MP_verify_zvHGyljL5rHLDOB1.txtæ–‡ä»¶åˆ°èƒ½å¤Ÿè®¿é—®çš„ç›®å½•ã€‚ å‡è®¾æ˜¯java webçš„é¡¹ç›®ï¼Œå¤‡æ¡ˆçš„urlå¯ä»¥å…·ä½“åˆ°è®¿é—®çš„é¦–é¡µç›®å½•ï¼ˆWebContentç›®å½•ä¸‹ï¼‰ï¼Œé‚£ä¹ˆä¹Ÿå°±å¯ä»¥å°†MP_verify_zvHGyljL5rHLDOB1.txtæ–‡ä»¶æ”¾ç½®åˆ°WebContentç›®å½•ä¸‹ã€‚ é€šè¿‡ä»¥ä¸Šçš„è®¾ç½®ï¼Œè¿‡ä¸€æ®µæ—¶é—´ç”Ÿæ•ˆä¹‹åŽï¼Œå°±ä¸ä¼šåœ¨å‡ºçŽ°å®‰å…¨æç¤ºäº†ã€‚]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spring MVCè®¿é—®é™æ€èµ„æºæ–‡ä»¶]]></title>
    <url>%2F2017%2F09%2F27%2FSpringMVC%E8%AE%BF%E9%97%AE%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[Spring MVCè®¿é—®é™æ€èµ„æºæ–‡ä»¶ æˆ‘ä»¬åœ¨ä½¿ç”¨spring MVCå¼€å‘æ—¶ï¼Œéœ€è¦åœ¨web.xmlæ–‡ä»¶ä¸­é…ç½®DispatcherServletï¼ŒæŒ‡å®šæ˜ å°„æ¡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314&lt;servlet&gt; &lt;servlet-name&gt;Dispatcher&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:/conf/spring-mvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;Dispatcher&lt;/servlet-name&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; é€šå¸¸éƒ½éœ€è¦å°†DispatcherServleté…ç½®ä¸ºæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œæ‰€ä»¥å°†url-patterné…ç½®ä¸ºâ€/â€œã€‚ä½†è¿™æ ·å°±ä¼šå‡ºçŽ°ä¸€ä¸ªé—®é¢˜ï¼Œé€šå¸¸åœ¨é¡µé¢ä¸­éœ€è¦ä½¿ç”¨åˆ°çš„jsã€cssã€å›¾ç‰‡ç­‰ç­‰é™æ€æ–‡ä»¶å°±æ— æ³•è¯·æ±‚äº†ã€‚ ä¸€èˆ¬æœ‰ç”¨ä¸¤ç§æ–¹å¼æ¥å¤„ç†è¿™ç§æƒ…å†µ1ã€ä½¿ç”¨ mvc:resourcesçš„æ–¹å¼ï¼Œå°†é…ç½®æ·»åŠ åˆ°appContext-**.xmlæ–‡ä»¶ä¸­ä¾‹å¦‚ï¼š 12 &lt;!-- å¯¹é™æ€èµ„æºæ–‡ä»¶çš„è®¿é—® --&gt;&lt;mvc:resources mapping="/**" location="/" /&gt; mappingæ˜¯urlæ˜ å°„å¤„ç†ï¼Œlocationæ˜¯ç›¸å¯¹äºŽWebContentçš„è·¯å¾„ã€‚ 2ã€ é…ç½®DispatcherServletå€¼æ‹¦æˆª.doçš„è¯·æ±‚ã€‚ 1234567891011121314&lt;servlet&gt; &lt;servlet-name&gt;Dispatcher&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet &lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:configure/spring-mvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;Dispatcher&lt;/servlet-name&gt; &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;&lt;/servlet-mapping&gt;]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[çˆ¬å–çŒ«çœ¼ç”µå½±æ•°æ®ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2017%2F09%2F24%2F%E7%88%AC%E5%8F%96%E7%8C%AB%E7%9C%BC%E7%94%B5%E5%BD%B1%E6%95%B0%E6%8D%AE-1%2F</url>
    <content type="text"><![CDATA[çˆ¬å–çŒ«çœ¼ç”µå½±æ•°æ®(ä¸€) æ¦‚è¿°ï¼šè¿‘æœŸç”±äºŽä¸šåŠ¡éœ€è¦ï¼Œéœ€è¦å°†çˆ¬å–çŒ«çœ¼ç½‘ç«™ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºå…¬ä¼—å·æ•°æ®æºï¼ŒçŒ«çœ¼çš„ç”µå½±æ•°æ®ç›¸å½“ä¹‹å…¨å¤‡ï¼Œå¤§æ¦‚æ”¶å½•äº†å‡ åä¸‡éƒ¨ç”µå½±ã€‚å½“ç„¶è¿™äº›æ•°æ®æˆ‘ä»¬ä¹Ÿæ²¡é‚£ä¹ˆå®¹æ˜“å°±èƒ½çˆ¬å–åˆ°çš„ã€‚é‚å°†æ•´ä¸ªçˆ¬å–è¿‡ç¨‹è®°å½•å¦‚ä¸‹ã€‚ 1ã€ä½¿ç”¨chromeè¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼Œè§‚å¯Ÿhtmlç»“æž„ã€å…ƒç´ ï¼Œæ‰¾åˆ°æˆ‘ä»¬æ‰€éœ€æ•°æ®ï¼Œç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦çŽ°èŽ·å–æ¯ä¸€ä¸ªç”µå½±çš„è¯¦æƒ…é¡µé¢urlã€‚ æ³¨æ„ï¼Œåœ¨çˆ¬å–çŒ«çœ¼çš„ç”µå½±æ•°æ®æ—¶å¹¶ä¸éœ€è¦ç™»å½•å’Œæºå¸¦cookieåŽ»è¯·æ±‚html 2ã€ è¿™é‡Œæˆ‘ä»¬ç»“åˆBeautifulSoupå’Œxpathæ¥å®žçŽ°å¯¹æ•°æ®çš„è¿‡æ»¤ã€‚å®žçŽ°ä»£ç å¦‚ä¸‹ï¼š 12345678910111213def get_detail_url(self, targetUrl): """ä»Žæ¦‚è§ˆé¡µé¢ä¸­åŽ»èŽ·å–å‰§é€å½±ç‰‡çš„è¯¦æƒ…é¡µé¢""" html = self.getHtml(targetUrl) print html soup = BeautifulSoup(html, 'lxml') urls = soup.find_all('a', attrs=&#123;'data-act':'movie-click'&#125;) dd = soup.find_all('dd') print dd for url in urls: detailPath = etree.HTML(str(url)) detail_url = detailPath.xpath(r'//a/@href') for durl in detail_url: self.getContents('https://maoyan.com' + durl, proxys) ç„¶åŽèŽ·å–åˆ°å¯¹åº”æ¯ä¸€ä¸ªç”µå½±çš„è¯¦æƒ…urlï¼Œè¿›å…¥è¯¦æƒ…é¡µï¼Œåˆ†æžæ‰€éœ€æ•°æ®å¯¹åº”htmlå…ƒç´ ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬åªéœ€è¦ä¸‰ä¸ªå­—æ®µã€ç”µå½±åç§°ã€ç”µå½±æµ·æŠ¥urlã€ç”µå½±ä¸Šæ˜ æ—¶é—´ã€‚ æç¤º:ä½¿ç”¨xpathæ—¶ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯åœ¨chromeä¸­ç‚¹å‡»é€‰ä¸­å…·ä½“æŸä¸€ä¸ªå…ƒç´ ï¼Œç„¶åŽå³é”®â€”â€”&gt; copy â€“&gt; copy xpathå°±èƒ½èŽ·å–åˆ°å¯¹åº”çš„xpathè·¯å¾„ å®žçŽ°ä»£ç ï¼š 12345678910def getContents(self, url, proxys): """ä»Žè¯¦æƒ…é¡µé¢ä¸­èŽ·å–æ‰€éœ€data""" html = self.getHtml(url,proxys) detailPath = etree.HTML(html) #ç”µå½±åç§° film_name = detailPath.xpath(r'/html/body/div[3]/div/div[2]/div[1]/h3/text()') #å›¾ç‰‡url pic_url = detailPath.xpath(r'/html/body/div[3]/div/div[1]/div/img/@src') #ä¸Šæ˜ æ—¶é—´ release_time = detailPath.xpath(r'/html/body/div[3]/div/div[2]/div[1]/ul/li[3]/text()') 3ã€ è¿™ä¸ªæ—¶å€™èŽ·å–åˆ°æ•°æ®äº†ï¼Œå°±è¯¥å­˜åº“äº†ã€‚å—¯ï¼Œå°±å­˜åˆ°mysqlä¸­å§ã€‚æ²¡å•¥è¯´çš„ï¼Œä¸Šä»£ç ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748def insertData(self, my_dict): try: self.db.set_character_set('utf8') cols = ', '.join(my_dict.keys()) print cols values = '","'.join(my_dict.values()) print values sql = "INSERT INTO maoyan (%s) VALUES (%s)" % (cols, '"' + values + '"') try: result = self.cur.execute(sql) insert_id = self.db.insert_id() self.db.commit() # åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒæˆåŠŸ if result: return insert_id else: return 0 except MySQLdb.Error, e: # å‘ç”Ÿé”™è¯¯æ—¶å›žæ»š self.db.rollback() # ä¸»é”®å”¯ä¸€ï¼Œæ— æ³•æ’å…¥ if "key 'PRIMARY'" in e.args[1]: print self.getCurrentTime(), "æ•°æ®å·²å­˜åœ¨ï¼Œæœªæ’å…¥æ•°æ®" else: print self.getCurrentTime(), "æ’å…¥æ•°æ®å¤±è´¥ï¼ŒåŽŸå›  %d: %s" % (e.args[0], e.args[1]) except MySQLdb.Error, e: print self.getCurrentTime(), "æ•°æ®åº“é”™è¯¯ï¼ŒåŽŸå› %d: %s" % (e.args[0], e.args[1]) def dealData(self, my_dict): """å…ˆä»Žæ•°æ®åº“ä¸­æŸ¥è¯¢è¿™ä¸ªå½±ç‰‡åçš„è®°å½•ï¼Œå¦‚æžœæ²¡æœ‰ç›´æŽ¥æ’å…¥ï¼› è‹¥æ˜¯æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨æ•°æ®ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸åš""" self.db.set_character_set('utf8') filmTitile = my_dict.get('film_title') result = self.findFilmByfilmTitle(filmTitile) if len(result) == 0: self.insertData(my_dict) return else: pass def findFilmByfilmTitle(self, filmTitile): """é€šè¿‡å½±ç‰‡åç§°åŽ»æ•°æ®åº“ä¸­æŸ¥è¯¢""" self.db.set_character_set('utf8') sql = "select * from maoyan where film_title='%s'" % (filmTitile) self.cur.execute(sql) results = self.cur.fetchall() self.db.commit() return results 4ã€ ä¸‡äº‹ä¿±å¤‡åªæ¬ å¯åŠ¨äº†ï¼Œè·‘å•Šè·‘å•Šã€‚æƒ³å¿…å¤§å®¶éƒ½æƒ³åˆ°äº†ï¼ŒçŒ«çœ¼è‚¯å®šæ˜¯ä¸å¯èƒ½éšä¾¿è®©äººè¿™æ ·çˆ¬å–ä»–ä»¬çš„æ•°æ®ï¼Œè€Œä¸”çŸ­æ—¶é—´å¤§é‡çš„è¯·æ±‚å¯¹æœåŠ¡å™¨çš„è´Ÿè½½ä¹Ÿæ˜¯ç›¸å½“å¤§çš„ï¼Œä¸å‡ºæ„æ–™çˆ¬å–äº†ä¸åˆ°300æ¡æ•°æ®ï¼Œå°±è¢«åœæ­¢äº†ã€‚(à²¥ _ à²¥)å¤„ç†è¿™ç§æƒ…å†µä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§é€šè¿‡å»¶ç¼“è¯·æ±‚ï¼Œä¸€ç§æ˜¯é€šè¿‡ä»£ç†ipçš„æ–¹å¼ã€‚ç¬¬ä¸€ç§æˆ‘å°è¯•å»¶ç¼“5ã€10sï¼Œä½†å¹¶æ²¡æœ‰ç”¨ã€‚å› è€Œå°è¯•ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œä»£ç†ipæ± çš„æ–¹å¼ã€‚ä»£ç†ipå¦‚ä½•ä½¿ç”¨åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è®°å½•ã€‚ ä¸‹é¢æ˜¯æœ¬æ¬¡çš„å®Œæˆä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133#!/usr/bin/env python# coding: utf-8import urllib2import urllibimport requestsfrom bs4 import BeautifulSoupfrom lxml import etreeimport MySQLdbimport timeimport randomimport sysreload(sys)sys.setdefaultencoding('utf8')"""çŒ«çœ¼ä¸éœ€è¦httpè¯·æ±‚çš„å¤´éƒ¨ä¿¡æ¯ï¼Œæ·»åŠ ä¸Šåè€Œä¼šå‡ºé”™"""class Maoyan(): # èŽ·å–å½“å‰æ—¶é—´ def getCurrentTime(self): return time.strftime('[%Y-%m-%d %H:%M:%S]', time.localtime(time.time())) def __init__(self): self.time = time self.base_url = "https://maoyan.com/films?showType=1&amp;sortId=2" try: self.db = MySQLdb.connect('localhost', 'flyer_user', 'Tu4a0X9hOPKz6jS!e', 'flyer_db',charset='utf8') self.cur = self.db.cursor() except MySQLdb.Error, e: print self.getCurrentTime(), "è¿žæŽ¥æ•°æ®åº“é”™è¯¯ï¼ŒåŽŸå› %d: %s" % (e.args[0], e.args[1]) # æ’å…¥æ•°æ® def insertData(self, my_dict): try: self.db.set_character_set('utf8') cols = ', '.join(my_dict.keys()) print cols values = '","'.join(my_dict.values()) print values sql = "INSERT INTO maoyan (%s) VALUES (%s)" % (cols, '"' + values + '"') try: result = self.cur.execute(sql) insert_id = self.db.insert_id() self.db.commit() # åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒæˆåŠŸ if result: return insert_id else: return 0 except MySQLdb.Error, e: # å‘ç”Ÿé”™è¯¯æ—¶å›žæ»š self.db.rollback() # ä¸»é”®å”¯ä¸€ï¼Œæ— æ³•æ’å…¥ if "key 'PRIMARY'" in e.args[1]: print self.getCurrentTime(), "æ•°æ®å·²å­˜åœ¨ï¼Œæœªæ’å…¥æ•°æ®" else: print self.getCurrentTime(), "æ’å…¥æ•°æ®å¤±è´¥ï¼ŒåŽŸå›  %d: %s" % (e.args[0], e.args[1]) except MySQLdb.Error, e: print self.getCurrentTime(), "æ•°æ®åº“é”™è¯¯ï¼ŒåŽŸå› %d: %s" % (e.args[0], e.args[1]) def dealData(self, my_dict): """å…ˆä»Žæ•°æ®åº“ä¸­æŸ¥è¯¢è¿™ä¸ªå½±ç‰‡åçš„è®°å½•ï¼Œå¦‚æžœæ²¡æœ‰ç›´æŽ¥æ’å…¥ï¼› è‹¥æ˜¯æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨æ•°æ®ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸åš""" self.db.set_character_set('utf8') filmTitile = my_dict.get('film_title') result = self.findFilmByfilmTitle(filmTitile) if len(result) == 0: self.insertData(my_dict) return else: pass def findFilmByfilmTitle(self, filmTitile): """é€šè¿‡å½±ç‰‡åç§°åŽ»æ•°æ®åº“ä¸­æŸ¥è¯¢""" self.db.set_character_set('utf8') sql = "select * from maoyan where film_title='%s'" % (filmTitile) self.cur.execute(sql) results = self.cur.fetchall() self.db.commit() return results def getHtml(self,url,proxys): """èŽ·å–html""" req = urllib2.Request(url) html = urllib2.urlopen(req).read().decode('utf-8') return html def get_detail_url(self, targetUrl, proxys): """ä»Žæ¦‚è§ˆé¡µé¢ä¸­åŽ»èŽ·å–å‰§é€å½±ç‰‡çš„è¯¦æƒ…é¡µé¢""" html = self.getHtml(targetUrl, proxys) print html soup = BeautifulSoup(html, 'lxml') urls = soup.find_all('a', attrs=&#123;'data-act':'movie-click'&#125;) dd = soup.find_all('dd') print dd for url in urls: detailPath = etree.HTML(str(url)) detail_url = detailPath.xpath(r'//a/@href') for durl in detail_url: self.getContents('https://maoyan.com' + durl, proxys) def getContents(self, url, proxys): """ä»Žè¯¦æƒ…é¡µé¢ä¸­èŽ·å–æ‰€éœ€data""" tmp1 = [] tmp2 = [] html = self.getHtml(url,proxys) detailPath = etree.HTML(html) film_name = detailPath.xpath(r'/html/body/div[3]/div/div[2]/div[1]/h3/text()') for name in film_name: tmp1.append("film_title") tmp2.append(name) pic_url = detailPath.xpath(r'/html/body/div[3]/div/div[1]/div/img/@src') for url in pic_url: strs = url.split('@') tmp1.append("pic_url") tmp2.append(strs[0]) release_time = detailPath.xpath(r'/html/body/div[3]/div/div[2]/div[1]/ul/li[3]/text()') for time in release_time: tmp1.append("release_time") tmp2.append(time[:10]) #å°†ä¸¤ä¸ªåˆ—è¡¨è½¬æ¢ä¸ºå­—å…¸ï¼Œæ–¹ä¾¿æ’å…¥æ•°æ®åº“ result_dict = dict(zip(tmp1, tmp2)) self.dealData(result_dict) def main(self): self.get_detail_url(self.base_url, proxys) for i in range(50): targetUrl = self.base_url + '&amp;offset=' + str((i+1)*30) self.get_detail_url(targetUrl, proxys)if __name__ == '__main__': maoyan = Maoyan() maoyan.main()]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[pythonçˆ¬è™«å¦‚ä½•èŽ·å–åˆ°åªéœ€è¦çš„æ•°æ®]]></title>
    <url>%2F2017%2F09%2F18%2Fpython%E7%88%AC%E8%99%AB%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%88%B0%E5%8F%AA%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%2F</url>
    <content type="text"><![CDATA[pythonçˆ¬è™«å¦‚ä½•èŽ·å–åˆ°åªéœ€è¦çš„æ•°æ® æ¦‚è¿°ï¼šåœ¨çˆ¬è™«çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæœ€éº»çƒ¦çš„ä¹Ÿè®¸å°±æ˜¯å¦‚ä½•ä»Žä¸€å¤§å †htmlæ ‡ç­¾ä¸­è¿‡æ»¤å‡ºæˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œåœ¨è¿™é‡Œæœ‰ä¸‰ç§æ–¹æ³•ï¼šreæ­£åˆ™è¡¨è¾¾å¼ã€BeautifulSoupã€ä½¿ç”¨lxmlä¸­çš„xpathã€‚ 1 ã€å…ˆä»‹ç»å¦‚ä½•ä½¿ç”¨lxmlä¸­çš„xpath(1) æˆ‘ä»¬éœ€è¦å®‰è£…ç›¸åº”çš„ä¾èµ–ï¼Œç„¶åŽåœ¨é¡¹ç›®ä¸­å¯¼å…¥ç›¸åº”çš„æ¨¡å— 12from lxml import etreeimport lxml (2) ä¹‹åŽå†ä»£ç ä¸­è½¬åŒ–æˆxpath12detailPath = etree.HTML(html) questions_titile = detailPath.xpath('//ul[@class="list-group"]/li/div/div[@class="question-title"]/a/text()') æ³¨æ„ä¸Šè¾¹çš„ä¸¤ä¸ªå•å¼•å·ä¹‹é—´çš„ä¸€ä¸²ï¼Œå‰é¢ä¸¤ä¸ªâ€™//â€˜æ˜¯è¡¨ç¤ºä»Žè¿™é‡Œå¼€å§‹ï¼Œç„¶åŽä¸€çº§ä¸€çº§çš„åŽ»å¯»æ‰¾æ‰€éœ€è¦çš„å…ƒç´ ï¼Œå¦‚æžœæƒ³èŽ·å–å±žæ€§å€¼ï¼Œä¾‹å¦‚æ˜¯å›¾ç‰‡çš„urlï¼Œæœ€åŽå¯ä»¥ä½¿ç”¨@hrefï¼Œå¦‚æžœæƒ³èŽ·å–é‡Œè¾¹çš„æ–‡æœ¬å€¼ï¼Œé‚£å°±ä½¿ç”¨text()ã€‚ (3) ç‰¹æ®Šç”¨æ³•12345678910from lxml import etreehtml=&quot;&quot;&quot; &lt;body&gt; &lt;div id=&quot;aa&quot;&gt;aa&lt;/div&gt; &lt;div id=&quot;ab&quot;&gt;ab&lt;/div&gt; &lt;div id=&quot;ac&quot;&gt;ac&lt;/div&gt; &lt;/body&gt; &quot;&quot;&quot;selector=etree.HTML(html)content=selector.xpath(&apos;//div[starts-with(@id,&quot;a&quot;)]/text()&apos;) #è¿™é‡Œä½¿ç”¨starts-withæ–¹æ³•æå–divçš„idæ ‡ç­¾å±žæ€§å€¼å¼€å¤´ä¸ºaçš„divæ ‡ç­¾ è¿™ç¯‡æ–‡ç« æœ‰ç®€å•åº”ç”¨ï¼šhttp://blog.csdn.net/winterto1990/article/details/47903653ä»‹ç» æœ€åŽä¸€ä¸ªå¤§ç»æ‹›ï¼šç›´æŽ¥åœ¨chromeä¸­å¼€å‘è€…æ¨¡å¼ï¼Œå³é”®æ‰¾åˆ°ä½ æƒ³å¯»æ‰¾çš„å…ƒç´ æ ‡ç­¾ï¼Œcopy xpathå°±èƒ½å°†è¿™ä¸ªå…ƒç´ å¯¹åº”çš„xpathæ‰¾åˆ°ï¼ 1 ã€pythonä¸­æä¾›çš„reæ¨¡å— æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç§æ›´ä¸ºå¼ºå¤§çš„å­—ç¬¦ä¸²åŒ¹é…ã€å­—ç¬¦ä¸²æŸ¥æ‰¾ã€å­—ç¬¦ä¸²æ›¿æ¢ç­‰æ“ä½œå·¥å…·ã€‚ä¸Šç¯‡è®²è§£äº†æ­£åˆ™è¡¨è¾¾å¼çš„åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•ä»¥åŠreæ¨¡å—çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼Œè¿™èŠ‚æ¥è¯¦ç»†è¯´è¯´ re æ¨¡å—ä½œä¸º Python æ­£åˆ™è¡¨è¾¾å¼å¼•æ“Žæä¾›äº†å“ªäº›ä¾¿åˆ©æ€§æ“ä½œã€‚æ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯å›´ç»•ç€åŒ¹é…å¯¹è±¡(Match)è¿›è¡Œçš„ï¼Œåªæœ‰è¡¨è¾¾å¼ä¸Žå­—ç¬¦ä¸²åŒ¹é…æ‰æœ‰å¯èƒ½è¿›è¡ŒåŽç»­æ“ä½œã€‚åˆ¤æ–­åŒ¹é…ä¸Žå¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ re.match() å’Œ re.search()ï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ åŒºåˆ«ï¼šmatch æ–¹æ³•ä»Žå­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®å¼€å§‹æ£€æŸ¥ï¼Œå¦‚æžœåˆšå¥½æœ‰ä¸€ä¸ªå­å­—ç¬¦ä¸²ä¸Žæ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…ï¼Œåˆ™è¿”å›žä¸€ä¸ªMatchå¯¹è±¡ï¼Œåªè¦èµ·å§‹ä½ç½®ä¸åŒ¹é…åˆ™é€€å‡ºï¼Œä¸å†å¾€åŽæ£€æŸ¥äº†ï¼Œè¿”å›ž None 1234&gt;&gt;&gt; re.match(r&quot;b.r&quot;, &quot;foobar&quot;) # ä¸åŒ¹é…&gt;&gt;&gt; re.match(r&quot;b.r&quot;, &quot;barfoo&quot;) # åŒ¹é…&lt;_sre.SRE_Match object at 0x102f05b28&gt;&gt;&gt;&gt; search æ–¹æ³•è™½ç„¶ä¹Ÿæ˜¯ä»Žèµ·å§‹ä½ç½®å¼€å§‹æ£€æŸ¥ï¼Œä½†æ˜¯å®ƒåœ¨èµ·å§‹ä½ç½®ä¸åŒ¹é…çš„æ—¶å€™ä¼šä¸€ç›´å°è¯•å¾€åŽæ£€æŸ¥ï¼Œç›´åˆ°åŒ¹é…ä¸ºæ­¢ï¼Œå¦‚æžœåˆ°å­—ç¬¦ä¸²çš„æœ«å°¾è¿˜æ²¡æœ‰åŒ¹é…ï¼Œåˆ™è¿”å›ž None123&gt;&gt;&gt; re.search(r&quot;b.r&quot;, &quot;foobar&quot;) # åŒ¹é…&lt;_sre.SRE_Match object at 0x000000000254D578&gt;&gt;&gt;&gt; re.match(r&quot;b.r&quot;, &quot;foobr&quot;) # ä¸åŒ¹é… ä½†æ˜¯äºŒè€…éƒ½æ˜¯åŒ¹é…åˆ°å°±åœæ­¢åŒ¹é…äº†ï¼Œå“ªæ€•è¿˜æœ‰æ›´å¤šèƒ½åŒ¹é…çš„ä¹Ÿä¸ç®¡ã€‚ å‚è€ƒï¼šhttps://foofish.net/re-tutorial.html ã€https://foofish.net/crawler-re-second.html]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¸Šä¼ æœ¬åœ°jaråŒ…åˆ°nexusä»“åº“ä¸­]]></title>
    <url>%2F2017%2F09%2F16%2F%E4%B8%8A%E4%BC%A0%E6%9C%AC%E5%9C%B0jar%E5%8C%85%E5%88%B0nexus%E4%BB%93%E5%BA%93%E4%B8%AD%2F</url>
    <content type="text"><![CDATA[#ä¸Šä¼ æœ¬åœ°jaråŒ…åˆ°nexusä»“åº“ä¸­ æ¦‚è¿°ï¼šæœ‰æ—¶åœ¨æˆ‘ä»¬çš„nexusä»“åº“ä¸­æ²¡æœ‰é¡¹ç›®ä¸­æ‰€éœ€çš„jaråŒ…ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä»Žç½‘ç»œä¸­ä¸‹è½½ï¼Œç„¶åŽä¸Šä¼ åˆ°nexusä»“åº“ä¸­ï¼Œç„¶åŽæˆ‘ä»¬å°±å¯ä»¥å—¨æ£®çš„æ•²ä»£ç å•¦ã€‚ 1ã€é¦–å…ˆéœ€è¦æ˜¯å¯¹åº”çš„repositoryæœ‰ä¸Šä¼ çš„æƒé™ 2ã€æˆ‘ä»¬è¿™é‡Œè®²jaråŒ…ä¸Šä¼ åˆ°3rd partyä»“åº“ä¸­ã€‚å…ˆç‚¹å‡»artifact uploadç„¶åŽé€‰æ‹©GAV definitionï¼Œæ‰‹åŠ¨å°†group idã€artifactã€versionå¡«å…¥ï¼Œç„¶åŽpackagingé€‰æ‹©jarã€‚ 3ã€ç„¶åŽç‚¹å‡»select artifactï¼ˆsï¼‰ to uploadå°†æœ¬åœ°çš„jaråŠ å…¥ï¼Œç‚¹å‡»add artifactï¼Œç„¶åŽç‚¹å‡»upload artifactã€‚ 4ã€æœ€åŽåˆ·æ–°å°±èƒ½çœ‹åˆ°åˆšæ‰åŠ å…¥çš„jaråŒ…ã€‚ æ­¤å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°†å…¥åˆ°3rdä»“åº“ä¹‹åŽå¯èƒ½å¯¹åº”çš„åæ ‡ä¼šå‘ç”Ÿå˜åŒ–ã€‚å¦‚æžœå‰åŽåæ ‡æ²¡æœ‰å¯¹åº”ä¸Šï¼Œé‚£ä¹ˆåœ¨pomæ–‡ä»¶ä¸­è¿˜æ˜¯æ‰¾ä¸åˆ°ç›¸åº”çš„ä¾èµ–ã€‚]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[hiveå¦‚ä½•å®žçŽ°è‡ªå®šä¹‰å‡½æ•°]]></title>
    <url>%2F2017%2F09%2F14%2Fhive%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%2F</url>
    <content type="text"><![CDATA[hiveå¦‚ä½•å®žçŽ°è‡ªå®šä¹‰å‡½æ•° æ¦‚è¿°ï¼šæˆ‘ä»¬åœ¨ä½¿ç”¨hiveçš„æ—¶å€™ï¼Œå¾ˆå¤šæ—¶å€™æ‰§è¡Œå¤æ‚çš„sqlæ—¶ï¼Œhiveæä¾›çš„å‡½æ•°æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬è‡ªå·±åŽ»å®šä¹‰ä¸€ä¸ªå‡½æ•°ã€‚å¹¸å¥½ï¼Œhiveä¸ºæˆ‘ä»¬å…è®¸ä½¿ç”¨javaæ¥å­çº¿è‡ªå®šä¹‰å‡½æ•°ã€‚ 1ã€å®žçŽ°è‡ªå®šä¹‰UDFå‡½æ•°å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚ ï¼ˆ1ï¼‰ å¿…é¡»æ˜¯org.apache.Hadoop.hive.ql.exec.UDFçš„å­ç±» ï¼ˆ2ï¼‰ å¿…é¡»å®žçŽ°evaluateå‡½æ•°ã€‚ 2ã€å®žçŽ°æ–¹æ³•å…·ä½“å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰å°†$HIVE_HOME/libä¸­çš„ä¸¤ä¸ªjaråŒ…ï¼Œåˆ†åˆ«æ˜¯hive-contrib-2.1.1.jarå’Œhive-exec-2.1.1.jarï¼ŒæŠŠä¸¤ä¸ªjaråŒ…æ”¾ç½®åˆ°javaçš„ç›®å½•ä¸‹ï¼Œç„¶åŽæ–°å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿UDFã€‚ 123456789101112131415161718package org.apache.hadoop.hive.contrib.udf.example;import org.apache.commons.lang.StringUtils;import org.apache.hadoop.hive.ql.exec.UDF;import java.util.Arrays;public class ReturnMin extends UDF&#123; public static Integer evaluate(String str, String separator) &#123; int result = 100; if(StringUtils.isEmpty(str))&#123; return result; &#125; String[] strArray = str.split(separator); int[] intArray = new int[strArray.length]; for(int i = 0 ; i &lt; strArray.length ; i++) &#123; intArray[i] = Integer.parseInt(strArray[i]); &#125; Arrays.sort(intArray); return intArray[0]; &#125; (2) ç„¶åŽå°†ReturnMin.classæ–‡ä»¶æ‹·è´åˆ°hive-contrib-2.1.1.jar\org\apache\hadoop\hive\contrib\udf\exampleç›®å½•ä¸­ï¼Œç„¶åŽæ›¿æ¢hive selectåœ¨hiveçš„cliä¸­æ‰§è¡Œï¼šCREATE FUNCTION ReturnMin AS â€˜org.apache.hadoop.hive.contrib.udf.example.ReturnMinâ€™;ç„¶åŽé‡æ–°è¿›å…¥cliä¸­ï¼Œç»™è¿™ä¸ªå‡½æ•°ä¼ é€’ä¸€ä¸ªæ•°å­—çš„å­—ç¬¦ä¸²å’Œåˆ†éš”ç¬¦å°±èƒ½å¤Ÿå°†è¿™ä¸ªå­—ç¬¦ä¸²æœ€å°çš„å€¼è¿”å›žã€‚ hiveåˆ é™¤ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼š drop function cutString;]]></content>
      <categories>
        <category>hive</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[hiveä¸­sqlæ€»ç»“]]></title>
    <url>%2F2017%2F09%2F14%2Fhive%E4%B8%ADsql%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[hiveä¸­sqlæ€»ç»“1ã€å¯¹æŒ‡å®šçš„æŸä¸€ä¸ªåˆ—åŽ»é‡1insert into table allrecord partition (year=2017, month=08, day=25) select t.id, t.tssend, t.apmac, t.mac, t.rssi from (select id, tssend, apmac ,mac, rssi, row_number() over(distribute by mac sort by tssend )as rn from allrecords) t where t.rn=1; ä¸Šé¢è¯•å¯¹å­—æ®µmacåŽ»é‡ï¼Œç„¶åŽå¯¹tssendæŽ’åºåŽæ’å…¥allrecordè¿™å¼ è¡¨ 2ã€åˆ é™¤åˆ†åŒº1ALTER TABLE macinfo_2017 DROP IF EXISTS PARTITION (year=2017, month=03, day=22); 3ã€åˆ é™¤ä¸€å¼ è¡¨ï¼Œå¦‚æžœå¯åŠ¨äº†å›žæ”¶ç«™åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™å¼ è¡¨ä¼šä¿å­˜åœ¨å›žæ”¶ç«™é‡Œï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿæ¢å¤ä¿¡æ¯çš„ã€‚1drop table tablename; è‹¥æ˜¯è¡¨åˆ›å»ºä¸ºå¤–éƒ¨è¡¨ï¼Œåˆ™åªä¼šåˆ é™¤ç›¸åº”çš„åŽŸä¿¡æ¯ï¼Œå¯¹æ•°æ®æ²¡æœ‰å½±å“ã€‚ 4ã€ åˆ›å»ºä¸€ä¸ªpartition_table002çš„è¡¨ï¼Œä½¿å¾—è¡¨ç»“æž„å’Œpartition_table001ä¸€æ ·ã€‚1create table if not exists partition_table002 like partition_table001; 5ã€ä½¿ç”¨loadåŠ è½½æ•°æ®åˆ°è¡¨ä¸­1load data local inpath 't_student1.txt' overwrite inte table t_student1; 6ã€åˆ›å»ºå¤–éƒ¨è¡¨create EXTERNAL table IF NOT EXISTS macinfo_20170221( tssend string COMMENT 'Probe upload data time', apmac string COMMENT 'Probe MAC address', mac string COMMENT 'Mobile device MAC address', rssi string COMMENT 'WiFi signal strength of mobile devices') partitioned by (year int, month int, day int) ROW FORMAT SERDE 'org.openx.data.jsonserde.JsonSerDe' WITH SERDEPROPERTIES ( "mac"="$.mac", "apmac"="$.apmac", "rssi"="$.rssi", "tssend"="$.tssend" ) STORED AS TEXTFILE LOCATION '/opt/local/software/a.txt'; æ³¨æ„ï¼šè¿™é‡Œåˆ›å»ºå¤–éƒ¨è¡¨æ—¶ä¼šæœ‰å‘ï¼Œä¸»è¦æ˜¯æ•°æ®å­˜å‚¨æ ¼å¼çš„é—®é¢˜ï¼Œæˆ‘çš„æ•°æ®å­˜å‚¨ä¸ºjsonæ ¼å¼ï¼Œè€Œhiveå¹¶ä¸ç›´æŽ¥æ”¯æŒè¯»å–jsonæ ¼å¼æ•°æ®ï¼Œéœ€è¦æ·»åŠ ç›¸åº”çš„jaråŒ…æ‰èƒ½è§£æžæ•°æ®ã€‚ 7ã€hiveå¤–éƒ¨è¡¨åˆ›å»ºåˆ†åŒºå…³è”ç›¸åº”çš„ç›®å½•ï¼ˆå¿…é¡»æ˜¯ç›®å½•ï¼‰ALTER TABLE macinfo_2017 ADD PARTITION (year = 2017, month = 02, day = 21); æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ã€‚]]></content>
      <categories>
        <category>hive</category>
      </categories>
  </entry>
</search>
